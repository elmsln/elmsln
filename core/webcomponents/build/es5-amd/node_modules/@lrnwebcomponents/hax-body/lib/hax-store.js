define(["meta","require","../../../@polymer/polymer/polymer-legacy.js","../../../@polymer/polymer/lib/legacy/polymer.dom.js","../../../@polymer/polymer/lib/utils/resolve-url.js","../../../@polymer/polymer/lib/utils/settings.js","../../../@polymer/iron-ajax/iron-ajax.js","../../simple-toast/simple-toast.js","../../media-behaviors/media-behaviors.js","../../hax-body-behaviors/hax-body-behaviors.js","../../hal-9000/hal-9000.js","../../code-sample/code-sample.js","./shadows-safari.js","./hax-app.js","./hax-stax.js","./hax-stax-browser.js","./hax-blox.js","./hax-blox-browser.js"],function(meta,_require,_polymerLegacy,_polymerDom,_resolveUrl,_settings,_ironAjax,_simpleToast,_mediaBehaviors,_haxBodyBehaviors,_hal,_codeSample,_shadowsSafari){"use strict";meta=babelHelpers.interopRequireWildcard(meta);_require=babelHelpers.interopRequireWildcard(_require);function _templateObject_9476f710499511e9a5428ba375554590(){var data=babelHelpers.taggedTemplateLiteral(["\n    <style>\n      :host {\n        display: none;\n      }\n    </style>\n    <slot></slot>\n    <iron-ajax\n      id=\"appstore\"\n      url=\"[[appStore.url]]\"\n      params=\"[[appStore.params]]\"\n      method=\"GET\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      last-response=\"{{__appStoreData}}\"\n    ></iron-ajax>\n    <hal-9000 id=\"hal\" debug=\"debug\" commands=\"[[voiceCommands]]\"></hal-9000>\n  "]);_templateObject_9476f710499511e9a5428ba375554590=function(){return data};return data}window.HaxStore=window.HaxStore||{};window.HaxStore.instance=null;window.HaxStore.requestAvailability=function(){if(!window.HaxStore.instance){window.HaxStore.instance=document.createElement("hax-store");document.body.appendChild(window.HaxStore.instance)}return window.HaxStore.instance};(0,_polymerLegacy.Polymer)({_template:(0,_polymerLegacy.html)(_templateObject_9476f710499511e9a5428ba375554590()),is:"hax-store",behaviors:[MediaBehaviors.Video,HAXBehaviors.PropertiesBehaviors],observers:["_loadAppStoreData(__ready, __appStoreData, haxAutoloader)"],properties:{skipHAXConfirmation:{type:Boolean,value:!1,reflectToAttribute:!0},storageData:{type:Object,value:{},observer:"_storageDataChanged"},haxAppPicker:{type:Object},haxStaxPicker:{type:Object},haxManager:{type:Object},haxAutoloader:{type:Object},haxBodies:{type:Array,value:[]},activePlaceHolder:{type:Object,value:null},activeHaxBody:{type:Object},appStore:{type:Object,observer:"_appStoreChanged"},haxToast:{type:Object},haxPanel:{type:Object},haxExport:{type:Object},haxPreferences:{type:Object},activeHaxElement:{type:Object},activeNode:{type:Object},activeContainerNode:{type:Object},sessionObject:{type:Object,value:{}},editMode:{type:Boolean,value:!1,observer:"_editModeChanged"},canSupportUploads:{type:Boolean,value:!1},skipExitTrap:{type:Boolean,value:!1},defaults:{type:Object,value:{image:{src:"stock.jpg",alt:"A beachfront deep in the heart of Alaska."},iframe:{src:"https://www.wikipedia.org/"}}},gizmoList:{type:Array,value:[]},elementList:{type:Object,value:{}},appList:{type:Array,value:[]},staxList:{type:Array,value:[]},bloxList:{type:Array,value:[]},globalPreferences:{type:Object,value:{},observer:"_globalPreferencesChanged"},activeApp:{type:Object,value:{}},validTagList:{type:Array,value:["p","div","ol","ul","li","a","strong","kbd","em","i","b","hr","h1","h2","h3","h4","h5","h6","blockquote","code","figure","img","iframe","video","audio","section","grid-plate","template","webview"]},validGizmoTypes:{type:Array,value:["data","video","audio","text","link","file","pdf","image","csv","doc","content","text","inline","*"]},_isSandboxed:{type:Boolean,value:function value(){var test=document.createElement("webview");if("function"===typeof test.reload){return!0}return!1}},__appStoreData:{type:Object},__ready:{type:Boolean},voiceCommands:{type:Object}},_storageDataChanged:function _storageDataChanged(newValue){if(newValue&&window.HaxStore.ready&&this.__storageDataProcessed){if(window.localStorage.getItem("haxConfirm")){window.localStorage.setItem("haxUserData",JSON.stringify(newValue))}else if(window.sessionStorage.getItem("haxConfirm")){window.sessionStorage.setItem("haxUserData",JSON.stringify(newValue))}}},isTextElement:function isTextElement(node){if(null!=node&&this.validTagList.includes(node.tagName.toLowerCase())){if(["p","ol","ul","li","a","h1","h2","h3","h4","h5","h6","span","i","bold","em","strong","blockquote","code","figure"].includes(node.tagName.toLowerCase())){return!0}}return!1},isGridPlateElement:function isGridPlateElement(node){var tag=node.tagName.toLowerCase();if(this.validTagList.includes(tag)){if(["p","ol","ul","li","div","h1","h2","h3","h4","h5","h6","blockquote","code","figure","grid-plate"].includes(tag)){return!0}}return!1},_appStoreChanged:function _appStoreChanged(newValue){var _this=this;if(babelHelpers.typeof(newValue)!=="undefined"&&null!=newValue){if(babelHelpers.typeof(newValue.apps)==="undefined"){this.$.appstore.generateRequest()}else{setTimeout(function(){_this.__appStoreData=newValue},500)}}},_loadAppStoreData:function _loadAppStoreData(ready,appDataResponse,haxAutoloader){var _this2=this;if(babelHelpers.typeof(appDataResponse)!=="undefined"&&null!=appDataResponse){if(babelHelpers.typeof(appDataResponse.autoloader)!=="undefined"){for(var _loop=function(){_this2.push("validTagList",appDataResponse.autoloader[i]);var CEname=appDataResponse.autoloader[i],basePath=(0,_resolveUrl.pathFromUrl)(decodeURIComponent(meta.url));new Promise(function(res,rej){return _require.default(["".concat(basePath,"../../").concat(CEname,"/").concat(CEname,".js")],res,rej)}).then(function(){var CEClass=window.customElements.get(CEname);if("function"===typeof CEClass.getHaxProperties){_this2.setHaxProperties(CEClass.getHaxProperties(),CEname)}else if("function"===typeof CEClass.HAXWiring){_this2.setHaxProperties(CEClass.HAXWiring.getHaxProperties(),CEname)}else if(CEClass.haxProperties){_this2.setHaxProperties(CEClass.haxProperties,CEname)}else{(0,_polymerDom.dom)(haxAutoloader).appendChild(document.createElement(CEname))}}).catch(function(error){console.log(error)})},i=0;i<appDataResponse.autoloader.length;i++){_loop()}}if(babelHelpers.typeof(appDataResponse.apps)!=="undefined"){for(var apps=appDataResponse.apps,i=0,app;i<apps.length;i++){app=document.createElement("hax-app");app.data=apps[i];if(apps[i].connection.operations.add){window.HaxStore.write("canSupportUploads",!0,this)}window.HaxStore.instance.appendChild(app)}}if(babelHelpers.typeof(appDataResponse.stax)!=="undefined"){for(var staxs=appDataResponse.stax,i=0,stax;i<staxs.length;i++){stax=document.createElement("hax-stax");stax.data=staxs[i];window.HaxStore.instance.appendChild(stax)}}if(babelHelpers.typeof(appDataResponse.blox)!=="undefined"){for(var bloxs=appDataResponse.blox,i=0,blox;i<bloxs.length;i++){blox=document.createElement("hax-blox");blox.data=bloxs[i];window.HaxStore.instance.appendChild(blox)}}var evt=new CustomEvent("hax-store-app-store-loaded",{bubbles:!0,cancelable:!0,detail:!0});this.dispatchEvent(evt)}},_editModeChanged:function _editModeChanged(newValue){if(newValue&&this.globalPreferences.haxVoiceCommands){this.$.hal.auto=!0}else{this.$.hal.auto=!1}},_globalPreferencesChanged:function _globalPreferencesChanged(newValue){if(this.__storageDataProcessed&&newValue&&babelHelpers.typeof(newValue.haxVoiceCommands)!=="undefined"&&window.HaxStore.ready){var storageData=this.storageData;storageData.globalPreferences=newValue;this.set("storageData",{});this.set("storageData",storageData);if(newValue.haxVoiceCommands&&this.editMode){this.$.hal.auto=!0}else{this.$.hal.auto=!1}}},detached:function detached(){window.removeEventListener("hax-register-properties",this._haxStoreRegisterProperties.bind(this));document.body.removeEventListener("hax-register-app",this._haxStoreRegisterApp.bind(this));document.body.removeEventListener("hax-register-stax",this._haxStoreRegisterStax.bind(this));document.body.removeEventListener("hax-register-blox",this._haxStoreRegisterBlox.bind(this));document.body.removeEventListener("hax-store-write",this._writeHaxStore.bind(this));document.body.removeEventListener("hax-register-manager",this._haxStoreRegisterManager.bind(this));document.body.removeEventListener("hax-register-autoloader",this._haxStoreRegisterAutoloader.bind(this));document.body.removeEventListener("hax-register-body",this._haxStoreRegisterBody.bind(this));document.body.removeEventListener("hax-register-panel",this._haxStoreRegisterPanel.bind(this));document.body.removeEventListener("hax-register-app-picker",this._haxStoreRegisterAppPicker.bind(this));document.body.removeEventListener("hax-register-stax-picker",this._haxStoreRegisterStaxPicker.bind(this));document.body.removeEventListener("hax-register-blox-picker",this._haxStoreRegisterBloxPicker.bind(this));document.body.removeEventListener("hax-register-preferences",this._haxStoreRegisterPreferences.bind(this));document.body.removeEventListener("hax-register-export",this._haxStoreRegisterExport.bind(this));document.body.removeEventListener("hax-insert-content",this._haxStoreInsertContent.bind(this));document.body.removeEventListener("hax-insert-content-array",this._haxStoreInsertMultiple.bind(this));window.removeEventListener("hax-add-voice-command",this._addVoiceCommand.bind(this));window.removeEventListener("onbeforeunload",this._onBeforeUnload.bind(this));window.removeEventListener("hax-consent-tap",this._haxConsentTap.bind(this));window.removeEventListener("paste",this._onPaste.bind(this));this.fire("hax-store-ready",!1);window.HaxStore.ready=!1},_haxConsentTap:function _haxConsentTap(){window.localStorage.setItem("haxConfirm",!0);window.localStorage.setItem("haxUserData",JSON.stringify(this.storageData))},ready:function ready(){if(this.skipHAXConfirmation){window.sessionStorage.setItem("haxConfirm",!0);window.localStorage.setItem("haxConfirm",!0)}var haxConfirm=window.sessionStorage.getItem("haxConfirm")||window.localStorage.getItem("haxConfirm");if(!haxConfirm){window.sessionStorage.setItem("haxConfirm",!0);window.HaxStore.toast("\n      The HAX content editor keeps preferences in order to improve your experience.\n      This data is stored in your browser and is never sent anywhere.\n      Click to accept.\n      ","-1","fit-bottom","I Accept","hax-consent-tap")}else{if(window.sessionStorage.getItem("haxConfirm")&&!window.localStorage.getItem("haxConfirm")){try{var globalData=window.sessionStorage.getItem("haxUserData")?JSON.parse(window.sessionStorage.getItem("haxUserData")):{};this.set("storageData",globalData)}catch(e){}}else{try{var _globalData=window.localStorage.getItem("haxUserData")?JSON.parse(window.localStorage.getItem("haxUserData")):{};this.set("storageData",_globalData)}catch(e){}}}},attached:function attached(){var _this3=this;this.fire("hax-store-ready",!0);window.HaxStore.ready=!0;this.__ready=!0;this._buildPrimitiveDefinitions();window.addEventListener("hax-consent-tap",this._haxConsentTap.bind(this));window.addEventListener("onbeforeunload",this._onBeforeUnload.bind(this));window.addEventListener("paste",this._onPaste.bind(this));this.voiceCommands=this._initVoiceCommands();setTimeout(function(){_this3.__storageDataProcessed=!0;if(_this3.storageData.globalPreferences){window.HaxStore.write("globalPreferences",_this3.storageData.globalPreferences,_this3)}},325)},_initVoiceCommands:function _initVoiceCommands(){var _this4=this,commands={};commands["".concat(this.$.hal.respondsTo," scroll up")]=function(){window.scrollBy({top:-(.5*window.innerHeight),left:0,behavior:"smooth"})};commands["".concat(this.$.hal.respondsTo," scroll (down)")]=function(){window.scrollBy({top:.5*window.innerHeight,left:0,behavior:"smooth"})};commands["hey ".concat(this.$.hal.respondsTo)]=function(){_this4.$.hal.speak("Yeah what do you want")};commands["".concat(this.$.hal.respondsTo," find media")]=function(){window.HaxStore.write("activeHaxElement",{},window.HaxStore.instance);window.HaxStore.instance.haxManager.resetManager(1);window.HaxStore.instance.haxManager.toggleDialog(!1)};return commands},addVoiceCommand:function addVoiceCommand(command){this.push("voiceCommands",command);this.notifyPath("voiceCommands.*")},_addVoiceCommand:function _addVoiceCommand(e){this.addVoiceCommand(e.detail)},_onBeforeUnload:function _onBeforeUnload(){if(!window.HaxStore.instance.skipExitTrap&&window.HaxStore.instance.editMode){return"Are you sure you want to leave? Your work will not be saved!"}},_onPaste:function _onPaste(e){if(window.HaxStore.instance.isTextElement(window.HaxStore.instance.activeNode)&&!window.HaxStore.instance.haxManager.opened){e.preventDefault();var text="";if(e.clipboardData||e.originalEvent.clipboardData){text=(e.originalEvent||e).clipboardData.getData("text/plain")}else if(window.clipboardData){text=window.clipboardData.getData("Text")}var sel=window.HaxStore.getSelection(),range;if(range=window.HaxStore.getRange()){range.deleteContents();range.insertNode(document.createTextNode(text))}}},created:function created(){(0,_settings.setPassiveTouchGestures)(!0);if(null==window.HaxStore.instance){window.HaxStore.instance=this}this.haxToast=window.SimpleToast.requestAvailability();window.addEventListener("hax-register-properties",this._haxStoreRegisterProperties.bind(this));document.body.addEventListener("hax-register-app",this._haxStoreRegisterApp.bind(this));document.body.addEventListener("hax-register-stax",this._haxStoreRegisterStax.bind(this));document.body.addEventListener("hax-register-blox",this._haxStoreRegisterBlox.bind(this));document.body.addEventListener("hax-store-write",this._writeHaxStore.bind(this));document.body.addEventListener("hax-register-manager",this._haxStoreRegisterManager.bind(this));document.body.addEventListener("hax-register-autoloader",this._haxStoreRegisterAutoloader.bind(this));document.body.addEventListener("hax-register-body",this._haxStoreRegisterBody.bind(this));document.body.addEventListener("hax-register-panel",this._haxStoreRegisterPanel.bind(this));document.body.addEventListener("hax-register-app-picker",this._haxStoreRegisterAppPicker.bind(this));document.body.addEventListener("hax-register-stax-picker",this._haxStoreRegisterStaxPicker.bind(this));document.body.addEventListener("hax-register-blox-picker",this._haxStoreRegisterBloxPicker.bind(this));document.body.addEventListener("hax-register-preferences",this._haxStoreRegisterPreferences.bind(this));document.body.addEventListener("hax-register-export",this._haxStoreRegisterExport.bind(this));document.body.addEventListener("hax-insert-content",this._haxStoreInsertContent.bind(this));document.body.addEventListener("hax-insert-content-array",this._haxStoreInsertMultiple.bind(this));window.addEventListener("hax-add-voice-command",this._addVoiceCommand.bind(this));document.body.style.setProperty("--hax-ui-headings","#d4ff77")},_buildPrimitiveDefinitions:function _buildPrimitiveDefinitions(){if(window.HaxStore.instance._isSandboxed){this.setHaxProperties({canScale:!0,canPosition:!0,canEditSource:!1,settings:{quick:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"}],configure:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"}],advanced:[]}},"webview")}this.setHaxProperties({canScale:!0,canPosition:!0,canEditSource:!0,gizmo:{title:"Basic iframe",description:"A basic iframe",icon:"icons:fullscreen",color:"grey",groups:["Content"],handles:[{type:"link",source:"src",height:"height",width:"width"}],meta:{author:"W3C"}},settings:{quick:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"}],configure:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"}],advanced:[]}},"iframe");this.setHaxProperties({canScale:!0,canPosition:!0,canEditSource:!1,gizmo:{title:"Image",description:"A basic img tag",icon:"image:image",color:"grey",groups:["Image","Media"],handles:[{type:"link",source:"src"},{type:"image",source:"src",height:"height",width:"width"}],meta:{author:"W3C"}},settings:{quick:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"},{attribute:"alt",title:"Alt text",description:"Useful for screen readers and improved SEO.",inputMethod:"alt",icon:"accessibility"},{attribute:"height",title:"Height",description:"height in pixels of the item",inputMethod:"textfield",icon:"icons:swap-vert"},{attribute:"width",title:"Width",description:"width in pixels of the item",inputMethod:"textfield",icon:"icons:swap-horiz"}],configure:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"},{attribute:"alt",title:"Alt text",description:"Useful for screen readers and improved SEO.",inputMethod:"alt",icon:"accessibility"},{attribute:"height",title:"Height",description:"height in pixels of the item",inputMethod:"textfield",icon:"icons:swap-vert"},{attribute:"width",title:"Width",description:"width in pixels of the item",inputMethod:"textfield",icon:"icons:swap-horiz"}],advanced:[]}},"img");this.setHaxProperties({canScale:!1,canPosition:!1,canEditSource:!0,gizmo:{title:"Basic link",description:"A basic a tag",icon:"icons:link",color:"grey",groups:["Link"],handles:[{type:"link",source:"href",title:"innerText",alt:"title"}],meta:{author:"W3C"}},settings:{quick:[{attribute:"href",title:"Link",description:"The URL for this video.",inputMethod:"textfield",icon:"icons:link",required:!0,validationType:"url"},{attribute:"title",title:"Title text",description:"Useful for screen readers and improved SEO.",inputMethod:"textfield",icon:"icons:accessibility"}],configure:[{attribute:"innerText",title:"Text",description:"Text of the link",inputMethod:"textfield",required:!0},{attribute:"href",title:"Link",description:"The URL for this video.",inputMethod:"textfield",icon:"icons:link",required:!0,validationType:"url"},{attribute:"title",title:"Title text",description:"Useful for screen readers and improved SEO.",inputMethod:"textfield",icon:"icons:accessibility"},{attribute:"target",title:"Target",description:"Where to place the link.",inputMethod:"select",icon:"icons:launch",options:{"":"Same window",_blank:"New window",_top:"Top window",_parent:"Parent window"}}],advanced:[]}},"a");this.setHaxProperties({canScale:!1,canPosition:!1,canEditSource:!0,settings:{quick:[],configure:[],advanced:[]}},"p");this.setHaxProperties({canScale:!0,canPosition:!0,canEditSource:!1,settings:{quick:[],configure:[],advanced:[]}},"hr");this.setHaxProperties(_codeSample.CodeSample.haxProperties,_codeSample.CodeSample.tag)},_haxStoreRegisterManager:function _haxStoreRegisterManager(e){if(e.detail&&babelHelpers.typeof(this.haxManager)==="undefined"){this.haxManager=e.detail}},_haxStoreRegisterAutoloader:function _haxStoreRegisterAutoloader(e){if(e.detail&&babelHelpers.typeof(this.haxAutoloader)==="undefined"){this.haxAutoloader=e.detail}},_haxStoreRegisterAppPicker:function _haxStoreRegisterAppPicker(e){if(e.detail&&babelHelpers.typeof(this.haxAppPicker)==="undefined"){this.haxAppPicker=e.detail}},_haxStoreRegisterStaxPicker:function _haxStoreRegisterStaxPicker(e){if(e.detail&&babelHelpers.typeof(this.haxStaxPicker)==="undefined"){this.haxStaxPicker=e.detail}},_haxStoreRegisterBloxPicker:function _haxStoreRegisterBloxPicker(e){if(e.detail&&babelHelpers.typeof(this.haxBloxPicker)==="undefined"){this.haxBloxPicker=e.detail}},closeAllDrawers:function closeAllDrawers(){var active=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!1,drawers=["haxManager","haxBloxPicker","haxStaxPicker","haxPreferences","haxExport"];for(var i in drawers){if(active===this[drawers[i]]){active.open();if("haxManager"===drawers[i]){setTimeout(function(){if(null!=active.querySelector("#activepage .iron-selected paper-input")){active.querySelector("#activepage .iron-selected paper-input").focus()}},325)}else{setTimeout(function(){if(null!=active.querySelector("paper-checkbox,paper-input,textarea,paper-button")){active.querySelector("paper-checkbox,paper-input,textarea,paper-button").focus()}},325)}}else{this[drawers[i]].close()}}},_haxStoreInsertContent:function _haxStoreInsertContent(e){if(e.detail){var properties={};if(babelHelpers.typeof(e.detail.properties)!=="undefined"){properties=e.detail.properties}this.activeHaxBody.__activeHover=null;if(e.detail.replace&&e.detail.replacement){var node=window.HaxStore.haxElementToNode(e.detail.tag,e.detail.content,properties);if(this.activeNode!==this.activeContainerNode){this.activeHaxBody.haxReplaceNode(this.activeNode,node,this.activeContainerNode)}else{this.activeHaxBody.haxReplaceNode(this.activeNode,node)}}else if(babelHelpers.typeof(e.detail.__type)!=="undefined"&&"inline"===e.detail.__type){var _node=window.HaxStore.haxElementToNode(e.detail.tag,e.detail.content,properties);if(null!==this.activePlaceHolder){this.activePlaceHolder.deleteContents();this.activePlaceHolder.insertNode(_node)}this.activePlaceHolder=null}else{this.activeHaxBody.haxInsert(e.detail.tag,e.detail.content,properties)}}},_haxStoreInsertMultiple:function _haxStoreInsertMultiple(e){var _this5=this;if(e.detail){var properties;for(var i in e.detail){properties={};if(babelHelpers.typeof(e.detail[i].properties)!=="undefined"){properties=e.detail[i].properties}this.activeHaxBody.haxInsert(e.detail[i].tag,e.detail[i].content,properties,!1)}setTimeout(function(){_this5.activeHaxBody.breakUpdateLock()},300)}},_haxStoreRegisterBody:function _haxStoreRegisterBody(e){if(e.detail){this.haxBodies.push(e.detail);this.activeHaxBody=e.detail;window.HaxStore.write("activeHaxBody",this.activeHaxBody,this);window.HaxStore.write("editMode",this.editMode,this)}},_haxStoreRegisterPanel:function _haxStoreRegisterPanel(e){if(e.detail&&babelHelpers.typeof(this.haxPanel)==="undefined"){this.haxPanel=e.detail}},_haxStoreRegisterExport:function _haxStoreRegisterExport(e){if(e.detail&&babelHelpers.typeof(this.haxExport)==="undefined"){this.haxExport=e.detail}},_haxStoreRegisterPreferences:function _haxStoreRegisterPreferences(e){if(e.detail&&babelHelpers.typeof(this.haxPreferences)==="undefined"){this.haxPreferences=e.detail}},computePolyfillSafe:function computePolyfillSafe(){if(document.head.createShadowRoot||document.head.attachShadow){return!0}else{console.log("Shadow DOM missing, certain operations hidden");return!1}},_writeHaxStore:function _writeHaxStore(e){if(e.detail&&babelHelpers.typeof(e.detail.value)!=="undefined"&&e.detail.property&&e.detail.owner){if("object"===babelHelpers.typeof(e.detail.value)){this.set(e.detail.property,{})}this.set(e.detail.property,e.detail.value);this.fire("hax-store-property-updated",{property:e.detail.property,value:e.detail.value,owner:e.detail.owner})}},_haxStoreRegisterApp:function _haxStoreRegisterApp(e){if(e.detail){e.detail.index=this.appList.length;this.push("appList",e.detail);window.HaxStore.write("appList",this.appList,this);if(babelHelpers.typeof(e.target.parentElement)!=="undefined"&&"HAX-STORE"===e.target.parentElement.tagName){(0,_polymerDom.dom)(e.target.parentElement).removeChild(e.target)}}},_haxStoreRegisterStax:function _haxStoreRegisterStax(e){if(e.detail){e.detail.index=this.staxList.length;this.push("staxList",e.detail);window.HaxStore.write("staxList",this.staxList,this);if(babelHelpers.typeof(e.target.parentElement)!=="undefined"&&"HAX-STORE"===e.target.parentElement.tagName){(0,_polymerDom.dom)(e.target.parentElement).removeChild(e.target)}}},_haxStoreRegisterBlox:function _haxStoreRegisterBlox(e){if(e.detail){e.detail.index=this.bloxList.length;this.push("bloxList",e.detail);window.HaxStore.write("bloxList",this.bloxList,this);if(babelHelpers.typeof(e.target.parentElement)!=="undefined"&&"HAX-STORE"===e.target.parentElement.tagName){(0,_polymerDom.dom)(e.target.parentElement).removeChild(e.target)}}},_haxStoreRegisterProperties:function _haxStoreRegisterProperties(e){if(e.detail&&e.detail.properties&&e.detail.tag){if(babelHelpers.typeof(this.elementList[e.detail.tag])==="undefined"){var gizmo=e.detail.properties.gizmo;if(gizmo){gizmo.tag=e.detail.tag;var gizmos=this.gizmoList;gizmos.push(gizmo);window.HaxStore.write("gizmoList",gizmos,this)}this.set("elementList."+e.detail.tag,e.detail.properties);if(!this.validTagList.find(function(element){return element===e.detail.tag})){this.push("validTagList",e.detail.tag)}}if(babelHelpers.typeof(e.target.parentElement)!=="undefined"&&"HAX-AUTOLOADER"===e.target.parentElement.tagName){(0,_polymerDom.dom)(this.haxAutoloader).removeChild(e.target)}}}});window.HaxStore.toArray=function(obj){return Object.keys(obj).map(function(key){return obj[key]})};window.HaxStore.camelToDash=function(str){return str.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()};window.HaxStore.dashToCamel=function(str){return str.replace(/-([a-z])/g,function(g){return g[1].toUpperCase()})};window.HaxStore.htmlToHaxElements=function(html){var elements=[],validTags=window.HaxStore.instance.validTagList,fragment=document.createElement("div");fragment.innerHTML=html;for(var children=fragment.childNodes,i=0;i<children.length;i++){if(babelHelpers.typeof(children[i].tagName)!=="undefined"&&validTags.includes(children[i].tagName.toLowerCase())){elements.push(window.HaxStore.nodeToHaxElement(children[i],null))}}return elements};window.HaxStore.nodeToHaxElement=function(node){var eventName=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"insert-element",props={};if(babelHelpers.typeof(node.style)!=="undefined"){props.style=node.getAttribute("style")}if(null===props.style||"null"===props.style){delete props.style}if(babelHelpers.typeof(node.attributes.class)!=="undefined"){props.class=node.attributes.class.nodeValue.replace("hax-active","")}if(babelHelpers.typeof(node.attributes.id)!=="undefined"){props.id=node.getAttribute("id")}var tmpProps=node.properties;if(babelHelpers.typeof(tmpProps)==="undefined"){tmpProps=node.__data}if(babelHelpers.typeof(tmpProps)!=="undefined"){for(var property in tmpProps){if("class"!=property&&"style"!=property&&tmpProps.hasOwnProperty(property)&&babelHelpers.typeof(node[property])!==void 0&&null!=node[property]&&""!=node[property]){props[property]=node[property]}else if(!1===node[property]){props[property]=node[property]}}for(var attribute in node.attributes){if(babelHelpers.typeof(node.attributes[attribute].name)!=="undefined"&&"class"!=node.attributes[attribute].name&&"style"!=node.attributes[attribute].name&&"id"!=node.attributes[attribute].name&&node.attributes.hasOwnProperty(attribute)&&babelHelpers.typeof(node.attributes[attribute].value)!==void 0&&null!=node.attributes[attribute].value&&""!=node.attributes[attribute].value&&!tmpProps.hasOwnProperty(window.HaxStore.dashToCamel(node.attributes[attribute].name))){props[window.HaxStore.dashToCamel(node.attributes[attribute].name)]=node.attributes[attribute].value}}}else{for(var attribute in node.attributes){if(babelHelpers.typeof(node.attributes[attribute].name)!=="undefined"&&"class"!=node.attributes[attribute].name&&"style"!=node.attributes[attribute].name&&"id"!=node.attributes[attribute].name&&node.attributes.hasOwnProperty(attribute)&&babelHelpers.typeof(node.attributes[attribute].value)!==void 0&&null!=node.attributes[attribute].value&&""!=node.attributes[attribute].value){props[window.HaxStore.dashToCamel(node.attributes[attribute].name)]=node.attributes[attribute].value}}}var tag=node.tagName.toLowerCase();if(window.HaxStore.instance._isSandboxed&&"iframe"===tag){tag="webview"}var slotContent=window.HaxStore.getHAXSlot(node);if("a"===tag){props.innerText=slotContent}else if("p"===tag||"ol"===tag||"ul"===tag||"div"===tag){props.innerHTML=slotContent}var element={tag:tag,properties:props,content:slotContent};if(null!==eventName){element.eventName=eventName}return element};window.HaxStore.haxElementToNode=function(tag,content,properties){if(window.HaxStore.instance._isSandboxed&&"iframe"===tag){tag="webview"}var frag=document.createElement(tag);frag.innerHTML=content;var newNode=frag.cloneNode(!0);for(var property in properties){var attributeName=window.HaxStore.camelToDash(property);if(properties.hasOwnProperty(property)){if(!0===properties[property]){newNode.setAttribute(attributeName,properties[property])}else if(!1===properties[property]){newNode.removeAttribute(attributeName)}else if(null!=properties[property]&&properties[property].constructor===Array){if(!(frag.properties&&frag.properties[property]&&frag.properties[property].readOnly)){newNode.set(attributeName,properties[property])}}else if(null!=properties[property]&&properties[property].constructor===Object){if(!(frag.properties&&frag.properties[property]&&frag.properties[property].readOnly)){newNode.set(attributeName,properties[property])}}else{newNode.setAttribute(attributeName,properties[property])}}}return newNode};window.HaxStore.haxNodeToContent=function(node){if(window.HaxStore.instance.activeHaxBody.globalPreferences.haxDeveloperMode){console.log(node)}var prototype=Object.getPrototypeOf(node);if(babelHelpers.typeof(prototype.preProcessHaxNodeToContent)!=="undefined"){var clone=node.cloneNode(!0);node=prototype.preProcessHaxNodeToContent(clone)}var tag=node.tagName.toLowerCase();if(window.HaxStore.instance._isSandboxed&&"webview"===tag){tag="iframe"}var content="";content+="<"+tag;for(var props=window.HaxStore.instance.elementList[tag],propvals={},j=0,l=node.attributes.length;j<l;++j){var nodeName=node.attributes.item(j).nodeName,value=node.attributes.item(j).value;if("style"!=nodeName&&(babelHelpers.typeof(value)===("undefined"===typeof Object?"undefined":babelHelpers.typeof(Object))||value.constructor===Array)){propvals[nodeName]=JSON.stringify(value).replace(/"/g,"&quot;")}else if(null!=value&&"null"!=value){if(!0===value||"true"===value){propvals[nodeName]=!0}else if(!(!1===value)){if("string"===typeof value&&""!==value){value=value.replace(/"/g,"&quot;");propvals[nodeName]=value}else if(""===value){if(""==value&&""!=node.attributes.item(j).value){value=node.attributes.item(j).value}propvals[nodeName]=value}else{propvals[nodeName]=value}}}}if(babelHelpers.typeof(node.properties)!=="undefined"){for(var j in node.properties){var nodeName=window.HaxStore.camelToDash(j),value=null;if(babelHelpers.typeof(node[j])!=="undefined"){value=node[j]}if(!node.properties[j].readOnly&&value!==node.properties[j].value){if(null!=value&&(babelHelpers.typeof(value)===("undefined"===typeof Object?"undefined":babelHelpers.typeof(Object))||value.constructor===Array)){propvals[nodeName]=JSON.stringify(value).replace(/"/g,"&quot;")}else if(null!=value&&"null"!=value){if(!0===value||"true"===value){propvals[nodeName]=!0}else if(!(!1===value)){if("string"===typeof value&&""!==value){value=value.replace(/"/g,"&quot;");propvals[nodeName]=value}else if(""===value){if(""==value&&""!=node.properties[j].value){value=node.properties[j].value}else if(""===value&&""==node.properties[j].value){}}else{propvals[nodeName]=value}}}}}}if(babelHelpers.typeof(props)!=="undefined"&&babelHelpers.typeof(props.saveOptions.unsetAttributes)!=="undefined"){for(var i in props.saveOptions.unsetAttributes){delete propvals[props.saveOptions.unsetAttributes[i]]}}var delProps=["inner-text","tabindex","guestinstance"];for(var delProp in delProps){if(babelHelpers.typeof(propvals[delProps[delProp]])!=="undefined"){delete propvals[delProps[delProp]]}}if(babelHelpers.typeof(propvals.id)!=="undefined"&&""===propvals.id){delete propvals.id}for(var i in propvals){if(!0===propvals[i]){content+=" "+i}else{content+=" "+i+"=\""+propvals[i]+"\""}}if(["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"].includes(tag)){content+="/>"}else{content+=">"}if(babelHelpers.typeof(props)==="undefined"||!props.saveOptions.wipeSlot){var slotnodes=(0,_polymerDom.dom)(node).getEffectiveChildNodes();if(0<slotnodes.length){for(var j=0,len2=slotnodes.length;j<len2;j++){if(babelHelpers.typeof(slotnodes[j].tagName)!=="undefined"){if(!window.HaxStore.HTMLPrimativeTest(slotnodes[j].tagName)&&"TEMPLATE"!==slotnodes[j].tagName){content+=window.HaxStore.haxNodeToContent(slotnodes[j])}else{slotnodes[j].setAttribute("data-editable",!1);slotnodes[j].removeAttribute("data-hax-ray");slotnodes[j].contentEditable=!1;content+=slotnodes[j].outerHTML}}else if(8===slotnodes[j].nodeType){content+="<!-- "+slotnodes[j].textContent+" -->"}else if(1!==slotnodes[j].nodeType&&babelHelpers.typeof(slotnodes[j].textContent)!=="undefined"&&"undefined"!==slotnodes[j].textContent){content+=slotnodes[j].textContent}}}}if("span"===tag){content+="</"+tag+">"}else if(!("hr"===tag||"br"===tag||"img"===tag)){content+="</"+tag+">"+"\n"}if(window.HaxStore.instance.activeHaxBody.globalPreferences.haxDeveloperMode){console.log(content)}if("function"===node.postProcesshaxNodeToContent){content=node.postProcesshaxNodeToContent(content)}return content};window.HaxStore.HTMLPrimativeTest=function(node){if(babelHelpers.typeof(node.tagName)!=="undefined"&&-1==node.tagName.indexOf("-")){return!0}return!1};window.HaxStore.getHAXSlot=function(node){var content="",slotnodes=(0,_polymerDom.dom)(node).children;if(0<slotnodes.length){for(var j=0,len2=slotnodes.length;j<len2;j++){if(babelHelpers.typeof(slotnodes[j].tagName)!=="undefined"){if(0<slotnodes[j].tagName.indexOf("-")){content+="  "+window.HaxStore.haxNodeToContent(slotnodes[j])+"\n"}else{content+="  "+slotnodes[j].outerHTML+"\n"}}else if(8===slotnodes[j].nodeType){content+="<!-- "+slotnodes[j].textContent+" -->"}else if(1!==slotnodes[j].nodeType&&babelHelpers.typeof(slotnodes[j].textContent)!=="undefined"&&"undefined"!==slotnodes[j].textContent){content+=slotnodes[j].textContent}}}return content};window.HaxStore.write=function(prop,value,obj){obj.fire("hax-store-write",{property:prop,value:value,owner:obj})};window.HaxStore.guessGizmoType=function(guess){if(babelHelpers.typeof(guess.source)!=="undefined"){if(-1!=guess.source.indexOf(".mp3")){return"audio"}else if(-1!=guess.source.indexOf(".png")||-1!=guess.source.indexOf(".jpg")||-1!=guess.source.indexOf(".jpeg")||-1!=guess.source.indexOf(".gif")){return"image"}else if(-1!=guess.source.indexOf(".pdf")){return"pdf"}else if(-1!=guess.source.indexOf(".svg")){return"svg"}else if(-1!=guess.source.indexOf(".csv")){return"csv"}else if("external"!=window.HaxStore.instance.getVideoType(guess.source)){return"video"}else{return"*"}}};window.HaxStore.guessGizmo=function(guess,values){var skipPropMatch=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!1,matches=[];if(babelHelpers.typeof(guess)!=="undefined"){var store=window.HaxStore.instance;if(store.validGizmoTypes.includes(guess)){for(var gizmoposition in store.gizmoList){var gizmo=store.gizmoList[gizmoposition],props={},match=!1;if(gizmo.handles){for(var i=0;i<gizmo.handles.length;i++){if(guess===gizmo.handles[i].type||"*"===guess&&!match){for(var property in gizmo.handles[i]){if("type"!==property){if(babelHelpers.typeof(values[property])!=="undefined"){match=!0;props[gizmo.handles[i][property]]=values[property]}}}if(match||skipPropMatch){matches.push(window.HaxStore.haxElementPrototype(gizmo,props,""))}}}}}}}return matches};window.HaxStore.getHaxAppStoreTargets=function(type){var targets=window.HaxStore.instance.appList.filter(function(app){if(babelHelpers.typeof(app.connection.operations.add)!=="undefined"){var add=app.connection.operations.add;if(babelHelpers.typeof(add.acceptsGizmoTypes)!=="undefined"&&add.acceptsGizmoTypes.includes(type)){return!0}}return!1});return targets};window.HaxStore.haxElementPrototype=function(gizmo,properties){var content=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"";return{tag:gizmo.tag,properties:properties,content:content,gizmo:gizmo}};window.HaxStore.wipeSlot=function(element){var slot=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"";if("*"===slot){while(null!==(0,_polymerDom.dom)(element).firstChild){(0,_polymerDom.dom)(element).removeChild((0,_polymerDom.dom)(element).firstChild)}}else{for(var i in(0,_polymerDom.dom)(element).childNodes){if(babelHelpers.typeof((0,_polymerDom.dom)(element).childNodes[i])!=="undefined"&&(0,_polymerDom.dom)(element).childNodes[i].slot===slot){(0,_polymerDom.dom)(element).removeChild((0,_polymerDom.dom)(element).childNodes[i])}}}};window.HaxStore.encapScript=function(html){if("function"===typeof html.replace){html=html.replace(/<script[\s\S]*?>/gi,"&lt;script&gt;");html=html.replace(/<\/script>/gi,"&lt;/script&gt;");html=html.replace(/<hax[\s\S]*?>/gi,"");html=html.replace(/<\/hax[\s\S]*?>/gi,"");html=html.replace(/<h-a-x[\s\S]*?>/gi,"");html=html.replace(/<\/h-a-x*?>/gi,"");html=html.replace(/<style[\s\S]*?>/gi,"&lt;style&gt;");html=html.replace(/<\/style>/gi,"&lt;/style&gt;");html=html.replace(/<template[\s\S]*?>[\s\S]*?&lt;script[\s\S]*?&gt;[\s\S]*?&lt;\/script&gt;/gi,function(match){match=match.replace("&lt;script&gt;","<script>");match=match.replace("&lt;/script&gt;","</script>");match=match.replace("&lt;style&gt;","<style>");match=match.replace("&lt;/style&gt;","</style>");return match})}return html};window.HaxStore.toast=function(message){var duration=1<arguments.length&&arguments[1]!==void 0?arguments[1]:4e3,classStyle=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"",closeText=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null,eventCallback=4<arguments.length&&arguments[4]!==void 0?arguments[4]:null,evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:message,duration:duration,classStyle:classStyle,closeText:closeText,eventCallback:eventCallback}});window.dispatchEvent(evt)};window.HaxStore.getSelection=function(){if(window.HaxStore.instance.activeHaxBody.parentNode){if(window.HaxStore.instance.activeHaxBody.parentNode.getSelection){return window.HaxStore.instance.activeHaxBody.parentNode.getSelection()}else if((0,_shadowsSafari.getRange)(window.HaxStore.instance.activeHaxBody.parentNode)){return(0,_shadowsSafari.getRange)(window.HaxStore.instance.activeHaxBody.parentNode)}}return window.getSelection()};window.HaxStore.getRange=function(){var sel=window.HaxStore.getSelection();if(sel.getRangeAt&&sel.rangeCount){return sel.getRangeAt(0)}else if(sel){return sel}else;}});