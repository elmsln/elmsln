define(["../../../../@polymer/polymer/polymer-legacy.js","../../../../@polymer/polymer/lib/legacy/polymer.dom.js","../../../../@polymer/polymer/lib/utils/async.js","../../../../@polymer/app-route/app-route.js","../../../../@polymer/iron-ajax/iron-ajax.js","../../../../@polymer/app-layout/app-toolbar/app-toolbar.js","../../../../@polymer/marked-element/marked-element.js","../../../../@polymer/iron-icon/iron-icon.js","../../../../@polymer/paper-dialog/paper-dialog.js","../../../../@polymer/paper-button/paper-button.js","../../../../@polymer/paper-badge/paper-badge.js","../../../../@polymer/paper-toast/paper-toast.js","../../../../@vaadin/vaadin-split-layout/vaadin-split-layout.js","../../../lrnsys-layout/lib/lrnsys-dialog.js","../../../lrnsys-button/lrnsys-button.js","../../../lrnsys-comment/lib/lrnsys-comment-list.js","../../../elmsln-loading/elmsln-loading.js","./lrnapp-studio-submission-object.js","./lrnapp-studio-submission-comments.js","./lrnapp-studio-submission-comment.js"],function(_polymerLegacy,_polymerDom,async){"use strict";async=babelHelpers.interopRequireWildcard(async);function _templateObject_a14aa810499511e9a5428ba375554590(){var data=babelHelpers.taggedTemplateLiteral(["\n    <style>\n      :host {\n        display: block;\n        position: relative;\n      }\n\n      p {\n        font-size: 14px;\n        line-height: 18px;\n      }\n\n      h1 {\n        margin: 0;\n        text-align: left;\n      }\n\n      iron-selector {\n        line-height: 1em;\n      }\n\n      iron-selector lrnsys-button {\n        display: inline-flex;\n      }\n\n      iron-image {\n        margin: 0 0.5em;\n      }\n\n      lrnsys-dialog {\n        display: inline;\n      }\n\n      .contain {\n        width: 10em;\n        height: 10em;\n        background: #ddd;\n      }\n\n      .center {\n        margin: auto;\n        width: 100%;\n      }\n\n      .title {\n        color: #222;\n        font-size: 2rem;\n        font-weight: 600;\n        line-height: 2.5rem;\n        padding: 0.25rem 0;\n        white-space: nowrap;\n        overflow-x: hidden;\n        text-overflow: ellipsis;\n        margin-top: 1rem;\n        text-transform: uppercase;\n        text-align: left;\n      }\n\n      .author {\n        color: #555;\n        font-size: 1rem;\n        font-weight: 500;\n        font-style: normal;\n        line-height: 1rem;\n        padding: 0.25rem 0 0.5rem 0;\n        margin: 0;\n        text-transform: capitalize;\n      }\n\n      .comments {\n        text-align: right;\n        margin: 0;\n        font-size: 1.5em;\n      }\n\n      .submission-page-wrapper {\n        padding: 0;\n        --vaadin-split-layout-splitter: {\n          min-width: 0.4em;\n          background: var(--paper-amber-200);\n        }\n      }\n\n      .submission-page {\n        width: 70vw;\n      }\n\n      .submission-page-card {\n        width: 100%;\n        margin: 0;\n        padding: 0 0 2em 1em;\n      }\n\n      .submission-comments {\n        overflow-y: hidden;\n        padding: 0;\n        margin: 0;\n      }\n\n      elmsln-loading {\n        position: absolute;\n        display: none;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(255, 255, 255, 0.8);\n        z-index: 10;\n        align-items: flex-end;\n        justify-content: center;\n      }\n\n      :host([saving]) elmsln-loading {\n        display: block;\n      }\n\n      elmsln-loading {\n        top: calc(50% - 5vmax);\n        left: calc(50% - 5vmax);\n        position: fixed;\n        transform-origin: center center;\n        width: 10vmax !important;\n        height: 10vmax !important;\n      }\n\n      iron-pages {\n        width: 100%;\n      }\n\n      paper-dialog {\n        width: 50%;\n        width: 50vmax;\n        padding: 1em;\n        z-index: 99999;\n      }\n\n      lrnapp-studio-submission-object {\n        width: 100%;\n      }\n\n      .assignment-body {\n        padding: 2em;\n      }\n\n      iron-icon {\n        margin: 0.2em;\n      }\n    </style>\n\n    <app-route\n      route=\"{{route}}\"\n      pattern=\"/edit\"\n      tail=\"{{tail}}\"\n      active=\"{{editPage}}\"\n    >\n    </app-route>\n\n    <iron-ajax\n      id=\"ajaxRequest\"\n      auto=\"\"\n      url=\"[[reqUrl]]\"\n      method=\"GET\"\n      params=\"[[reqParams]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleResponse\"\n    ></iron-ajax>\n    <!-- Update Submission Node -->\n    <iron-ajax\n      id=\"ajaxUpdateRequest\"\n      url=\"[[reqUrl]]\"\n      method=\"PUT\"\n      body=\"[[submission]]\"\n      params=\"[[reqParams]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleUpdateResponse\"\n    ></iron-ajax>\n    <!-- Delete Submission Node -->\n    <iron-ajax\n      id=\"ajaxDeleteRequest\"\n      url=\"[[reqUrl]]\"\n      method=\"DELETE\"\n      params=\"[[reqParams]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleDeleteResponse\"\n    ></iron-ajax>\n\n    <app-toolbar class=\"amber lighten-3\" hidden$=\"[[hideMenuBar]]\">\n      <template is=\"dom-if\" if=\"[[showComments]]\">\n        <lrnsys-button\n          on-tap=\"_backToStudio\"\n          icon=\"arrow-back\"\n          label=\"See in studio\"\n          hover-class=\"amber darken-4 white-text\"\n        ></lrnsys-button>\n      </template>\n      <template is=\"dom-if\" if=\"[[!showComments]]\">\n        <lrnsys-button\n          on-tap=\"_backToKanban\"\n          icon=\"arrow-back\"\n          label=\"Back to project management\"\n          hover-class=\"amber darken-4 white-text\"\n        ></lrnsys-button>\n      </template>\n      <div spacer=\"\" main-title=\"\">[[submission.attributes.title]]</div>\n      <div spacer=\"\">\n        <lrnsys-dialog\n          body-append=\"\"\n          header=\"[[submission.relationships.assignment.attributes.title]]\"\n        >\n          <span slot=\"button\"\n            ><iron-icon icon=\"icons:assignment\"></iron-icon>Assignment\n            Details</span\n          >\n          <div class=\"assignment-body\">\n            <marked-element\n              id=\"assignment-body\"\n              markdown=\"[[submission.relationships.assignment.attributes.body]]\"\n            ></marked-element>\n          </div>\n        </lrnsys-dialog>\n      </div>\n      <div>\n        <paper-button\n          id=\"comment-count\"\n          style=\"margin:0;padding:.25em;text-transform:none;\"\n        >\n          <iron-icon icon=\"communication:forum\"></iron-icon>\n          [[submission.meta.comment_count]] Comments\n        </paper-button>\n        <paper-badge\n          hidden$=\"[[displayNewBadge(submission.meta.comment_new)]]\"\n          for=\"comment-count\"\n          label$=\"[[submission.meta.comment_new]]\"\n        ></paper-badge>\n      </div>\n      <div hidden$=\"[[editPage]]\">\n        <lrnsys-button\n          on-tap=\"_setEditRoute\"\n          icon=\"create\"\n          label=\"Edit\"\n          hover-class=\"amber darken-4 white-text\"\n          hidden$=\"[[!submission.meta.canUpdate]]\"\n        ></lrnsys-button>\n      </div>\n      <div hidden$=\"[[!editPage]]\">\n        <lrnsys-button\n          on-tap=\"_resetRoute\"\n          icon=\"cancel\"\n          label=\"Cancel\"\n          hover-class=\"amber darken-4 white-text\"\n          hidden$=\"[[!submission.meta.canUpdate]]\"\n        ></lrnsys-button>\n      </div>\n    </app-toolbar>\n\n    <vaadin-split-layout class=\"submission-page-wrapper\">\n      <div\n        id=\"commentcolumn\"\n        class=\"submission-comments\"\n        style=\"min-width: 25%; max-width: 40%; width:30%;\"\n      >\n        <template is=\"dom-if\" if=\"[[showComments]]\">\n          <lrnsys-comment-list\n            comment-ops-base=\"{{commentOpsBase}}\"\n            csrf-token=\"[[csrfToken]]\"\n            source-path=\"{{commentsUrl}}\"\n            create-stub-url=\"{{createStubUrl}}\"\n          ></lrnsys-comment-list>\n        </template>\n      </div>\n      <div id=\"submissioncolumn\" style=\"width:70%;\">\n        <lrnapp-studio-submission-object\n          submission=\"{{submission}}\"\n          edit=\"[[editPage]]\"\n        ></lrnapp-studio-submission-object>\n      </div>\n      <iron-icon class=\"splitter-handle\" icon=\"more-vert\"></iron-icon>\n    </vaadin-split-layout>\n\n    <elmsln-loading></elmsln-loading>\n\n    <paper-dialog\n      id=\"deletedialog\"\n      entry-animation=\"scale-up-animation\"\n      exit-animation=\"fade-out-animation\"\n      with-backdrop=\"\"\n    >\n      <h2>Delete submission?</h2>\n      <p>Are you sure you want to delete this submission?</p>\n      <div class=\"buttons\">\n        <paper-button dialog-dismiss=\"\">Cancel</paper-button>\n        <paper-button dialog-confirm=\"\" on-click=\"_submissionDeleteConfirmed\"\n          >Delete</paper-button\n        >\n      </div>\n    </paper-dialog>\n    <paper-dialog\n      id=\"publishdialog\"\n      entry-animation=\"scale-up-animation\"\n      exit-animation=\"fade-out-animation\"\n      with-backdrop=\"\"\n    >\n      <h2>Ready to publish?</h2>\n      <p>\n        By publishing, the author of this submission will be able to view your\n        feedback. Are you ready to publish?\n      </p>\n      <div class=\"buttons\">\n        <paper-button dialog-dismiss=\"\">Cancel</paper-button>\n        <paper-button dialog-confirm=\"\" on-click=\"_submissionPublishConfirmed\"\n          >Yes Publish</paper-button\n        >\n      </div>\n    </paper-dialog>\n\n    <paper-toast id=\"toast\"></paper-toast>\n  "],["\n    <style>\n      :host {\n        display: block;\n        position: relative;\n      }\n\n      p {\n        font-size: 14px;\n        line-height: 18px;\n      }\n\n      h1 {\n        margin: 0;\n        text-align: left;\n      }\n\n      iron-selector {\n        line-height: 1em;\n      }\n\n      iron-selector lrnsys-button {\n        display: inline-flex;\n      }\n\n      iron-image {\n        margin: 0 0.5em;\n      }\n\n      lrnsys-dialog {\n        display: inline;\n      }\n\n      .contain {\n        width: 10em;\n        height: 10em;\n        background: #ddd;\n      }\n\n      .center {\n        margin: auto;\n        width: 100%;\n      }\n\n      .title {\n        color: #222;\n        font-size: 2rem;\n        font-weight: 600;\n        line-height: 2.5rem;\n        padding: 0.25rem 0;\n        white-space: nowrap;\n        overflow-x: hidden;\n        text-overflow: ellipsis;\n        margin-top: 1rem;\n        text-transform: uppercase;\n        text-align: left;\n      }\n\n      .author {\n        color: #555;\n        font-size: 1rem;\n        font-weight: 500;\n        font-style: normal;\n        line-height: 1rem;\n        padding: 0.25rem 0 0.5rem 0;\n        margin: 0;\n        text-transform: capitalize;\n      }\n\n      .comments {\n        text-align: right;\n        margin: 0;\n        font-size: 1.5em;\n      }\n\n      .submission-page-wrapper {\n        padding: 0;\n        --vaadin-split-layout-splitter: {\n          min-width: 0.4em;\n          background: var(--paper-amber-200);\n        }\n      }\n\n      .submission-page {\n        width: 70vw;\n      }\n\n      .submission-page-card {\n        width: 100%;\n        margin: 0;\n        padding: 0 0 2em 1em;\n      }\n\n      .submission-comments {\n        overflow-y: hidden;\n        padding: 0;\n        margin: 0;\n      }\n\n      elmsln-loading {\n        position: absolute;\n        display: none;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(255, 255, 255, 0.8);\n        z-index: 10;\n        align-items: flex-end;\n        justify-content: center;\n      }\n\n      :host([saving]) elmsln-loading {\n        display: block;\n      }\n\n      elmsln-loading {\n        top: calc(50% - 5vmax);\n        left: calc(50% - 5vmax);\n        position: fixed;\n        transform-origin: center center;\n        width: 10vmax !important;\n        height: 10vmax !important;\n      }\n\n      iron-pages {\n        width: 100%;\n      }\n\n      paper-dialog {\n        width: 50%;\n        width: 50vmax;\n        padding: 1em;\n        z-index: 99999;\n      }\n\n      lrnapp-studio-submission-object {\n        width: 100%;\n      }\n\n      .assignment-body {\n        padding: 2em;\n      }\n\n      iron-icon {\n        margin: 0.2em;\n      }\n    </style>\n\n    <app-route\n      route=\"{{route}}\"\n      pattern=\"/edit\"\n      tail=\"{{tail}}\"\n      active=\"{{editPage}}\"\n    >\n    </app-route>\n\n    <iron-ajax\n      id=\"ajaxRequest\"\n      auto=\"\"\n      url=\"[[reqUrl]]\"\n      method=\"GET\"\n      params=\"[[reqParams]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleResponse\"\n    ></iron-ajax>\n    <!-- Update Submission Node -->\n    <iron-ajax\n      id=\"ajaxUpdateRequest\"\n      url=\"[[reqUrl]]\"\n      method=\"PUT\"\n      body=\"[[submission]]\"\n      params=\"[[reqParams]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleUpdateResponse\"\n    ></iron-ajax>\n    <!-- Delete Submission Node -->\n    <iron-ajax\n      id=\"ajaxDeleteRequest\"\n      url=\"[[reqUrl]]\"\n      method=\"DELETE\"\n      params=\"[[reqParams]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleDeleteResponse\"\n    ></iron-ajax>\n\n    <app-toolbar class=\"amber lighten-3\" hidden\\$=\"[[hideMenuBar]]\">\n      <template is=\"dom-if\" if=\"[[showComments]]\">\n        <lrnsys-button\n          on-tap=\"_backToStudio\"\n          icon=\"arrow-back\"\n          label=\"See in studio\"\n          hover-class=\"amber darken-4 white-text\"\n        ></lrnsys-button>\n      </template>\n      <template is=\"dom-if\" if=\"[[!showComments]]\">\n        <lrnsys-button\n          on-tap=\"_backToKanban\"\n          icon=\"arrow-back\"\n          label=\"Back to project management\"\n          hover-class=\"amber darken-4 white-text\"\n        ></lrnsys-button>\n      </template>\n      <div spacer=\"\" main-title=\"\">[[submission.attributes.title]]</div>\n      <div spacer=\"\">\n        <lrnsys-dialog\n          body-append=\"\"\n          header=\"[[submission.relationships.assignment.attributes.title]]\"\n        >\n          <span slot=\"button\"\n            ><iron-icon icon=\"icons:assignment\"></iron-icon>Assignment\n            Details</span\n          >\n          <div class=\"assignment-body\">\n            <marked-element\n              id=\"assignment-body\"\n              markdown=\"[[submission.relationships.assignment.attributes.body]]\"\n            ></marked-element>\n          </div>\n        </lrnsys-dialog>\n      </div>\n      <div>\n        <paper-button\n          id=\"comment-count\"\n          style=\"margin:0;padding:.25em;text-transform:none;\"\n        >\n          <iron-icon icon=\"communication:forum\"></iron-icon>\n          [[submission.meta.comment_count]] Comments\n        </paper-button>\n        <paper-badge\n          hidden\\$=\"[[displayNewBadge(submission.meta.comment_new)]]\"\n          for=\"comment-count\"\n          label\\$=\"[[submission.meta.comment_new]]\"\n        ></paper-badge>\n      </div>\n      <div hidden\\$=\"[[editPage]]\">\n        <lrnsys-button\n          on-tap=\"_setEditRoute\"\n          icon=\"create\"\n          label=\"Edit\"\n          hover-class=\"amber darken-4 white-text\"\n          hidden\\$=\"[[!submission.meta.canUpdate]]\"\n        ></lrnsys-button>\n      </div>\n      <div hidden\\$=\"[[!editPage]]\">\n        <lrnsys-button\n          on-tap=\"_resetRoute\"\n          icon=\"cancel\"\n          label=\"Cancel\"\n          hover-class=\"amber darken-4 white-text\"\n          hidden\\$=\"[[!submission.meta.canUpdate]]\"\n        ></lrnsys-button>\n      </div>\n    </app-toolbar>\n\n    <vaadin-split-layout class=\"submission-page-wrapper\">\n      <div\n        id=\"commentcolumn\"\n        class=\"submission-comments\"\n        style=\"min-width: 25%; max-width: 40%; width:30%;\"\n      >\n        <template is=\"dom-if\" if=\"[[showComments]]\">\n          <lrnsys-comment-list\n            comment-ops-base=\"{{commentOpsBase}}\"\n            csrf-token=\"[[csrfToken]]\"\n            source-path=\"{{commentsUrl}}\"\n            create-stub-url=\"{{createStubUrl}}\"\n          ></lrnsys-comment-list>\n        </template>\n      </div>\n      <div id=\"submissioncolumn\" style=\"width:70%;\">\n        <lrnapp-studio-submission-object\n          submission=\"{{submission}}\"\n          edit=\"[[editPage]]\"\n        ></lrnapp-studio-submission-object>\n      </div>\n      <iron-icon class=\"splitter-handle\" icon=\"more-vert\"></iron-icon>\n    </vaadin-split-layout>\n\n    <elmsln-loading></elmsln-loading>\n\n    <paper-dialog\n      id=\"deletedialog\"\n      entry-animation=\"scale-up-animation\"\n      exit-animation=\"fade-out-animation\"\n      with-backdrop=\"\"\n    >\n      <h2>Delete submission?</h2>\n      <p>Are you sure you want to delete this submission?</p>\n      <div class=\"buttons\">\n        <paper-button dialog-dismiss=\"\">Cancel</paper-button>\n        <paper-button dialog-confirm=\"\" on-click=\"_submissionDeleteConfirmed\"\n          >Delete</paper-button\n        >\n      </div>\n    </paper-dialog>\n    <paper-dialog\n      id=\"publishdialog\"\n      entry-animation=\"scale-up-animation\"\n      exit-animation=\"fade-out-animation\"\n      with-backdrop=\"\"\n    >\n      <h2>Ready to publish?</h2>\n      <p>\n        By publishing, the author of this submission will be able to view your\n        feedback. Are you ready to publish?\n      </p>\n      <div class=\"buttons\">\n        <paper-button dialog-dismiss=\"\">Cancel</paper-button>\n        <paper-button dialog-confirm=\"\" on-click=\"_submissionPublishConfirmed\"\n          >Yes Publish</paper-button\n        >\n      </div>\n    </paper-dialog>\n\n    <paper-toast id=\"toast\"></paper-toast>\n  "]);_templateObject_a14aa810499511e9a5428ba375554590=function(){return data};return data}(0,_polymerLegacy.Polymer)({_template:(0,_polymerLegacy.html)(_templateObject_a14aa810499511e9a5428ba375554590()),is:"lrnapp-studio-submission-page",properties:{id:{type:String},hideMenuBar:{type:Boolean,value:!1},endPoint:{type:String},basePath:{type:String},csrfToken:{type:String},reqUrl:{type:String},reqParams:{type:Object},submission:{type:Object},commentsUrl:{type:String,computed:"_computeCommentsUrl(id, endPoint, csrfToken)"},createStubUrl:{type:String,computed:"_computeCommentsStubUrl(id, endPoint, csrfToken)"},commentOpsBase:{type:String,computed:"_computeCommentsOpsUrl(id, endPoint, csrfToken)"},editPage:{type:Boolean,reflectToAttribute:!0},saving:{type:Boolean,value:!1,notify:!0,reflectToAttribute:!0},showComments:{type:Boolean,computed:"_computeShowComments(submission)"}},observers:["_urlVarsChanged(id, endPoint)","_paramsChanged(csrfToken)","_bodyChanged(title)"],listeners:{submissionDeleteClicked:"_submissionDeleteClicked",submissionPublishClicked:"_submissionPublishClicked",submissionSaveDraftClicked:"_submissionSaveDraftClicked"},_backToStudio:function _backToStudio(){window.location.href=this.basePath+"lrnapp-open-studio"},_backToKanban:function _backToKanban(){window.location.href=this.basePath+"lrnapp-studio-kanban"},_setEditRoute:function _setEditRoute(){this.set("route.path","edit");this.notifyPath("route.path")},_resetRoute:function _resetRoute(){this.set("route.path","");this.notifyPath("route.path")},displayNewBadge:function displayNewBadge(count){if(0==count){return!0}return!1},_computeCommentsUrl:function _computeCommentsUrl(id,endPoint,csrfToken){return endPoint+"/api/submissions/"+id+"/comments?token="+csrfToken},_computeCommentsOpsUrl:function _computeCommentsOpsUrl(id,endPoint){return endPoint+"/api/submissions/"+id+"/comments"},_computeCommentsStubUrl:function _computeCommentsStubUrl(id,endPoint,csrfToken){return endPoint+"/api/submissions/"+id+"/comments/create-stub?token="+csrfToken},_urlVarsChanged:function _urlVarsChanged(id,endPoint){this.reqUrl=endPoint+"/api/submissions/"+id},_paramsChanged:function _paramsChanged(csrfToken){var params=this.reqParams||{};params.token=csrfToken;this.reqParams=params},_handleResponse:function _handleResponse(data){if(data.detail.response.data){this.set("submission",[]);this.set("submission",data.detail.response.data);async.microTask.run(function(){window.dispatchEvent(new Event("resize"))})}},_isReply:function _isReply(){this.thread=submission.relationships.comments.data.attributes.thread},_submissionSaveDraftClicked:function _submissionSaveDraftClicked(){this.saving=!0;this.shadowRoot.querySelector("#ajaxUpdateRequest").generateRequest()},_submissionPublishClicked:function _submissionPublishClicked(){this.shadowRoot.querySelector("#publishdialog").open()},_submissionPublishConfirmed:function _submissionPublishConfirmed(){this.saving=!0;this.shadowRoot.querySelector("#ajaxUpdateRequest").generateRequest()},_submissionDeleteClicked:function _submissionDeleteClicked(){this.shadowRoot.querySelector("#deletedialog").open()},_submissionDeleteConfirmed:function _submissionDeleteConfirmed(){this.saving=!0;this.$.ajaxDeleteRequest.generateRequest()},_handleUpdateResponse:function _handleUpdateResponse(res){var root=this,status=res.detail.response.status,submission=res.detail.response.data;root.saving=!1;if(200===status){root.set("submission",{});root.set("submission",submission);root.set("route.path","");if("submission_ready"===submission.attributes.state){this.$.toast.show("Published!")}window.location.href=this.endPoint+"/submissions/"+submission.id}},_handleDeleteResponse:function _handleDeleteResponse(res){var root=this,status=res.detail.response.status;root.saving=!1;if(200===status){window.location.href=this.basePath+"lrnapp-studio-kanban?deletetoast"}},_computeShowComments:function _computeShowComments(submission){try{var type=submission.meta.submissionType;if("critique"!==type&&"submission_ready"==submission.attributes.state){return!0}}catch(error){}return!1},_toArray:function _toArray(obj){if("object"===babelHelpers.typeof(obj)&&null!==obj){return Object.keys(obj).map(function(key){return obj[key]})}return[]}})});