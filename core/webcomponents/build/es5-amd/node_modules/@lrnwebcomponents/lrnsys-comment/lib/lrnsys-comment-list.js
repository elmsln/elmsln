define(["../../../@polymer/polymer/polymer-legacy.js","../../../@polymer/polymer/lib/utils/async.js","../../../@polymer/iron-ajax/iron-ajax.js","../../../@polymer/iron-list/iron-list.js","../../../@polymer/iron-form-element-behavior/iron-form-element-behavior.js","../../../@polymer/app-layout/app-layout.js","../../../@polymer/app-layout/app-toolbar/app-toolbar.js","../../simple-toast/simple-toast.js","../../simple-modal/simple-modal.js","../../../@polymer/paper-input/paper-input.js","../../../@polymer/paper-button/paper-button.js","../../../@polymer/paper-dropdown-menu/paper-dropdown-menu.js","../../../@polymer/paper-item/paper-item.js","../../../@polymer/paper-listbox/paper-listbox.js","../../lrnsys-button/lrnsys-button.js","../../grafitto-filter/grafitto-filter.js","../../dropdown-select/dropdown-select.js","../lrnsys-comment.js"],function(_polymerLegacy,async){"use strict";async=babelHelpers.interopRequireWildcard(async);function _templateObject_95f336d0499511e9a5428ba375554590(){var data=babelHelpers.taggedTemplateLiteral(["\n    <style>\n      :host {\n        display: block;\n      }\n      app-toolbar {\n        padding: 0;\n      }\n      app-toolbar > *:not(:last-child) {\n        margin-right: 10px;\n      }\n      .comment-button {\n        min-width: 125px;\n      }\n    </style>\n    <!-- Load all comments on load of element -->\n    <iron-ajax\n      auto\n      url=\"[[sourcePath]]\"\n      handle-as=\"json\"\n      method=\"[[opsRequestMethod.list]]\"\n      last-response=\"{{comments}}\"\n    ></iron-ajax>\n    <!-- Create stub-comment -->\n    <iron-ajax\n      id=\"ajaxcreatestub\"\n      url=\"[[createStubUrl]]\"\n      method=\"[[opsRequestMethod.create]]\"\n      body=\"[[activeComment.id]]\"\n      on-response=\"_updateReply\"\n      handle-as=\"json\"\n      last-response=\"{{newComment}}\"\n    ></iron-ajax>\n    <!-- Update comment -->\n    <iron-ajax\n      id=\"ajaxupdaterequest\"\n      url=\"[[reqUrl]]\"\n      method=\"[[opsRequestMethod.update]]\"\n      body=\"[[activeComment]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleUpdateResponse\"\n    ></iron-ajax>\n    <!-- Delete comment -->\n    <iron-ajax\n      id=\"ajaxdeleterequest\"\n      url=\"[[reqUrl]]\"\n      method=\"[[opsRequestMethod.delete]]\"\n      body=\"[[activeComment]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleDeleteResponse\"\n    ></iron-ajax>\n    <!-- Like comment -->\n    <iron-ajax\n      id=\"ajaxlikerequest\"\n      url=\"[[reqUrl]]\"\n      method=\"[[opsRequestMethod.like]]\"\n      body=\"[[activeComment]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleLikeResponse\"\n    ></iron-ajax>\n    <app-toolbar>\n      <lrnsys-button\n        class=\"comment-button\"\n        raised=\"\"\n        on-click=\"handleTopReply\"\n        id=\"leavecomment\"\n        hover-class=\"blue white-text\"\n        label=\"Add Comment\"\n      ></lrnsys-button>\n      <dropdown-select\n        id=\"filtertype\"\n        label=\"Filter Comments by\"\n        value=\"attributes.body\"\n      >\n        <paper-item value=\"attributes.body\">Body</paper-item>\n        <paper-item value=\"relationships.author.data.name\"\n          >User Name</paper-item\n        >\n      </dropdown-select>\n      <paper-input\n        label=\"Filter Text\"\n        id=\"filtercomments\"\n        aria-controls=\"filteredcomments\"\n        value=\"\"\n        always-float-label=\"\"\n      ></paper-input>\n    </app-toolbar>\n    <grafitto-filter\n      id=\"filteredcomments\"\n      items$=\"[[_toArray(comments.data)]]\"\n      where=\"\"\n      as=\"filtered\"\n      like=\"\"\n    >\n      <template>\n        <iron-list id=\"commentlist\" items=\"[[filtered]]\" as=\"item\">\n          <template>\n            <lrnsys-comment\n              comment=\"{{item}}\"\n              hover-class=\"blue white-text\"\n            ></lrnsys-comment>\n          </template>\n        </iron-list>\n      </template>\n    </grafitto-filter>\n  "],["\n    <style>\n      :host {\n        display: block;\n      }\n      app-toolbar {\n        padding: 0;\n      }\n      app-toolbar > *:not(:last-child) {\n        margin-right: 10px;\n      }\n      .comment-button {\n        min-width: 125px;\n      }\n    </style>\n    <!-- Load all comments on load of element -->\n    <iron-ajax\n      auto\n      url=\"[[sourcePath]]\"\n      handle-as=\"json\"\n      method=\"[[opsRequestMethod.list]]\"\n      last-response=\"{{comments}}\"\n    ></iron-ajax>\n    <!-- Create stub-comment -->\n    <iron-ajax\n      id=\"ajaxcreatestub\"\n      url=\"[[createStubUrl]]\"\n      method=\"[[opsRequestMethod.create]]\"\n      body=\"[[activeComment.id]]\"\n      on-response=\"_updateReply\"\n      handle-as=\"json\"\n      last-response=\"{{newComment}}\"\n    ></iron-ajax>\n    <!-- Update comment -->\n    <iron-ajax\n      id=\"ajaxupdaterequest\"\n      url=\"[[reqUrl]]\"\n      method=\"[[opsRequestMethod.update]]\"\n      body=\"[[activeComment]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleUpdateResponse\"\n    ></iron-ajax>\n    <!-- Delete comment -->\n    <iron-ajax\n      id=\"ajaxdeleterequest\"\n      url=\"[[reqUrl]]\"\n      method=\"[[opsRequestMethod.delete]]\"\n      body=\"[[activeComment]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleDeleteResponse\"\n    ></iron-ajax>\n    <!-- Like comment -->\n    <iron-ajax\n      id=\"ajaxlikerequest\"\n      url=\"[[reqUrl]]\"\n      method=\"[[opsRequestMethod.like]]\"\n      body=\"[[activeComment]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleLikeResponse\"\n    ></iron-ajax>\n    <app-toolbar>\n      <lrnsys-button\n        class=\"comment-button\"\n        raised=\"\"\n        on-click=\"handleTopReply\"\n        id=\"leavecomment\"\n        hover-class=\"blue white-text\"\n        label=\"Add Comment\"\n      ></lrnsys-button>\n      <dropdown-select\n        id=\"filtertype\"\n        label=\"Filter Comments by\"\n        value=\"attributes.body\"\n      >\n        <paper-item value=\"attributes.body\">Body</paper-item>\n        <paper-item value=\"relationships.author.data.name\"\n          >User Name</paper-item\n        >\n      </dropdown-select>\n      <paper-input\n        label=\"Filter Text\"\n        id=\"filtercomments\"\n        aria-controls=\"filteredcomments\"\n        value=\"\"\n        always-float-label=\"\"\n      ></paper-input>\n    </app-toolbar>\n    <grafitto-filter\n      id=\"filteredcomments\"\n      items\\$=\"[[_toArray(comments.data)]]\"\n      where=\"\"\n      as=\"filtered\"\n      like=\"\"\n    >\n      <template>\n        <iron-list id=\"commentlist\" items=\"[[filtered]]\" as=\"item\">\n          <template>\n            <lrnsys-comment\n              comment=\"{{item}}\"\n              hover-class=\"blue white-text\"\n            ></lrnsys-comment>\n          </template>\n        </iron-list>\n      </template>\n    </grafitto-filter>\n  "]);_templateObject_95f336d0499511e9a5428ba375554590=function(){return data};return data}(0,_polymerLegacy.Polymer)({_template:(0,_polymerLegacy.html)(_templateObject_95f336d0499511e9a5428ba375554590()),is:"lrnsys-comment-list",listeners:{"comment-save":"handleSave","comment-editing":"handleEditing","comment-reply":"handleReply","comment-like":"handleLike","comment-delete-dialog":"handleDeleteDialog"},properties:{csrfToken:{type:String},opsRequestMethod:{type:Object,value:{list:"GET",create:"POST",update:"PUT",delete:"DELETE",like:"PATCH"}},activeComment:{type:Object,notify:!0},newComment:{type:Object,notify:!0},comments:{type:Object,notify:!0},sourcePath:{type:String,notify:!0},commentOpsBase:{type:String,notify:!0},createStubUrl:{type:String,notify:!0},reqUrl:{type:String,notify:!0,computed:"_computeCommentOpsUrl(activeComment, commentOpsBase, csrfToken)"}},attached:function attached(){var _this=this;window.SimpleModal.requestAvailability();async.microTask.run(function(){if(_this.$.filteredcomments.querySelector("iron-list")){_this.$.filteredcomments.querySelector("iron-list").fire("iron-resize")}window.dispatchEvent(new Event("resize"))});this.$.filtercomments.addEventListener("value-changed",function(e){_this.$.filteredcomments.like=e.target.value});this.$.filtertype.addEventListener("change",function(e){_this.$.filtercomments.value="";_this.$.filteredcomments.where=e.detail.value;_this.$.filteredcomments.like=""})},detached:function detached(){var _this2=this;this.$.filtercomments.removeEventListener("value-changed",function(e){_this2.$.filteredcomments.like=e.target.value});this.$.filtertype.removeEventListener("change",function(e){_this2.$.filtercomments.value="";_this2.$.filteredcomments.where=e.detail.value;_this2.$.filteredcomments.like=""})},_computeCommentOpsUrl:function _computeCommentOpsUrl(activeComment,commentOpsBase,csrfToken){if(babelHelpers.typeof(activeComment)!=="undefined"){return commentOpsBase+"/"+activeComment.id+"?token="+csrfToken}},handleLike:function handleLike(e){this.activeComment=e.detail.comment;this.$.ajaxlikerequest.generateRequest()},_handleLikeResponse:function _handleLikeResponse(){},handleDeleteDialog:function handleDeleteDialog(e){this.activeComment=e.detail.comment;var c=document.createElement("p"),t=document.createTextNode("Are you sure you want to delete your comment?");c.appendChild(t);var b=document.createElement("div");b.classList.add("buttons");var pb=document.createElement("paper-button");pb.setAttribute("dialog-dismiss","dialog-dismiss");t=document.createTextNode("Decline");pb.appendChild(t);b.appendChild(pb);var pb2=document.createElement("paper-button");pb2.setAttribute("dialog-confirm","dialog-confirm");pb2.setAttribute("autofocus","autofocus");pb2.addEventListener("click",this._handleDeleteConfirm.bind(this));t=document.createTextNode("Accept");pb2.appendChild(t);b.appendChild(pb2);var evt=new CustomEvent("simple-modal-show",{bubbles:!0,cancelable:!0,detail:{title:"Delete comment",elements:{content:c,buttons:b},invokedBy:e.detail.target,clone:!1}});this.dispatchEvent(evt)},handleEditing:function handleEditing(){var evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"Be awesome to each other",duration:4e3}});this.dispatchEvent(evt)},handleTopReply:function handleTopReply(){this.set("newComment",[]);this.set("activeComment",[]);this.$.ajaxcreatestub.generateRequest()},handleReply:function handleReply(e){this.set("newComment",[]);this.activeComment=e.detail.comment;this.$.ajaxcreatestub.generateRequest()},_updateReply:function _updateReply(){var comment=this.activeComment,comments=this.comments.data;this.newComment=this.newComment.data;if(0==comments.length){comments.push(this.newComment)}else if(babelHelpers.typeof(comment.id)=="undefined"){comments.push(this.newComment)}else{for(var index=0;index<comments.length;index++){if(comments[index].id==comment.id){comments.splice(index+1,0,this.newComment)}}}this.activeComment=this.newComment;this.set("comments.data",[]);this.set("comments.data",comments);this.notifyPath("comments.data")},_handleDeleteConfirm:function _handleDeleteConfirm(){this.$.ajaxdeleterequest.generateRequest()},_handleDeleteResponse:function _handleDeleteResponse(){for(var comment=this.activeComment,comments=this.comments.data,index=0;index<comments.length;index++){if(comments[index].id==comment.id){comments.splice(index,1);this.set("activeComment",[]);this.set("comments.data",[]);this.set("comments.data",comments);this.notifyPath("comments.data");var evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"Comment deleted",duration:4e3}});this.dispatchEvent(evt);return!0}}},handleSave:function handleSave(e){this.activeComment=e.detail.comment;this.$.ajaxupdaterequest.generateRequest()},_handleUpdateResponse:function _handleUpdateResponse(){var evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"Comment saved!",duration:4e3}});this.dispatchEvent(evt)},_toArray:function _toArray(obj){return Object.keys(obj).map(function(key){return obj[key]})}})});