<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../hax-body-behaviors/hax-body-behaviors.html">
<link rel="import" href="aframe-aframe.html">
<link rel="import" href="aframe-arjs.html">

<!--
`aframe-player`
A LRN element to wire up and integrate a-frame.

@demo demo/index.html
-->

<dom-module id="aframe-player">
  <template>
    <style>
      :host {
        display: block;
        position: relative;
        height: 100vh;
      }
    </style>
      <a-scene embedded arjs="[[ar]]">
        <a-entity id="entity" gltf-model$="[[source]]" position="0 0 0"></a-entity>
        <a-sky color$="[[skyColor]]"></a-sky>
        <a-marker-camera preset='hiro'></a-marker-camera>
      </a-scene>
  </template>

  <script>
    Polymer({

      is: 'aframe-player',
      behaviors: [HAXBehaviors.PropertiesBehaviors],
      properties: {
        /**
         * Source to reference for the 3D object
         */
        source: {
          type: String,
          value: '',
        },
        /**
         * Color of the sky / background.
         */
        skyColor: {
          type: String,
          value: '#ECECEC',
        },
        /**
         * If this is for augmented reality or not.
         */
        ar: {
          type: Boolean,
          value: false,
        },
        /**
         * x position for the AR element.
         */
        x: {
          type: String,
          value: '0'
        },
        /**
         * y position for the AR element.
         */
        y: {
          type: String,
          value: '0'
        },
        /**
         * z position for the AR element.
         */
        z: {
          type: String,
          value: '0'
        },
        /**
         * Generate a position object when coordinates change.
         */
        position: {
          type: Object,
          computed: '_computePosition(x, y, z)',
          observer: '_positionChanged'
        }
      },
      /**
       * Ready.
       */
      ready: function() {
        // Establish hax properties if they exist
        let props = {
          'canScale': true,
          'canPosition': true,
          'settings': [
            {
              'property': 'source',
              'title': 'Source',
              'description': 'The URL for this AR file.',
              'inputMethod': 'textfield',
              'type': 'bar',
              'icon': 'link',
              'required': true,
            },
            {
              'property': 'x',
              'title': 'X',
              'description': 'X position of the element in AR.',
              'inputMethod': 'textfield',
              'type': 'bar',
              'icon': 'communication:location',
              'required': true,
            },
            {
              'property': 'y',
              'title': 'Y',
              'description': 'Y position of the element in AR.',
              'inputMethod': 'textfield',
              'type': 'bar',
              'icon': 'communication:location',
              'required': true,
            },
            {
              'property': 'z',
              'title': 'Z',
              'description': 'Z position of the element in AR.',
              'inputMethod': 'textfield',
              'type': 'bar',
              'icon': 'communication:location',
              'required': true,
            },
            {
              'property': 'skyColor',
              'title': 'Sky color',
              'description': 'Select the color of the sky in the scene.',
              'inputMethod': 'colorpicker',
              'type': 'bar',
              'icon': 'editor:format-color-fill',
            }
          ]
        };
        this.setHaxProperties(props);
      },
      /**
       * Generate position object based on format a-frame expects.
       */
      _computePosition: function (x, y, z) {
        return {
          x: x,
          y: y,
          z: z
        }
      },
      /**
       * When position is updated, inject this into a-frame tag.
       */
      _positionChanged: function (position) {
        this.$$('#entity').setAttribute('position', position);
      },
    });
  </script>
</dom-module>
