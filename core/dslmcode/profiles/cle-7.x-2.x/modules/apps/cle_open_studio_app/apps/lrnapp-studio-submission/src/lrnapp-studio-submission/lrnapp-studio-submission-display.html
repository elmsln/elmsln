<link rel="import" href="../../../elements/moment-element/moment-element.html">

<dom-module id="lrnapp-studio-submission-display">
  <template>
    <style>
       :host {
        display: block;
      }

      p {
        font-size: 14px;
        line-height: 18px;
      }
      h1,h2,h3 {
        margin: 0;
        text-align: left;
      }

      iron-selector {
        line-height: 1em;
      }

      iron-selector lrnsys-button {
        display: inline-flex;
      }

      marked-element {
        display: block;
        margin: 0 5em 0 5em;
      }

      iron-image {
        margin: 0 .5em;
      }

      lrnsys-dialog {
        display: inline;
      }

      .contain {
        width: 10em;
        height: 10em;
        background: #ddd;
      }

      .center {
        margin: auto;
        width: 100%;
      }

      .title {
        color: #222;
        font-size: 2rem;
        font-weight: 600;
        line-height: 2.5rem;
        padding: 0.25rem 0;
        white-space: nowrap;
        overflow-x: hidden;
        text-overflow: ellipsis;
        margin-top: 1rem;
        text-align: center;
      }

      .author {
        color: #555;
        font-size: 1rem;
        font-weight: 500;
        font-style: normal;
        line-height: 1rem;
        padding: 0.25rem 0 0.5rem 0;
        margin: 0;
        text-transform: capitalize;
      }

      .date {
        color: #555;
        font-size: 1.5rem;
        font-weight: 500;
        font-style: normal;
        line-height: 1rem;
        padding: 0.25rem 0 0.5rem 0;
        margin: 0;
        text-transform: capitalize;
      }

      .comments {
        text-align: right;
        margin: 0;
        font-size: 1.5em;
      }

      .flex-wrap {
        display: flex;
      }

      .submission-page-wrapper {
        padding: 0 1em;
      }

      .submission-page-card {
        width: 100%;
        margin: 0;
      }

       :host[edit-page] .submission-page {
        width: 100%;
      }

      .assignment {
        border: 2px dashed #444;
        padding: 1em;
      }

      .assignment h1 {
        font-size: 1.2em;
        color: #555;
      }

      #assignment-body {
        font-size: .8em;
        color: #888;
      }
      .image-dialog-header {
        display: flex;
      }
    </style>

    <div class="submission-page">
      <paper-card class="submission-page-card ferpa-protect">
        <div class="card-content">
            <lrndesign-avatar class="center" label="{{submission.relationships.author.data.name}}" src="{{submission.relationships.author.data.avatar}}"></lrndesign-avatar>
            <div class="author center">{{submission.relationships.author.data.display_name}}</div>
             <h2 class="title center">{{submission.attributes.title}}</h2>
             <h3 class="date center">Submitted:<moment-element output-format="MMM DD[,] YYYY" datetime="{{submission.meta.created}}"></h3>
            <!-- ----- Text Submission -----  -->
            <template is="dom-if" if="[[submission.attributes.body]]">
                <marked-element markdown="[[submission.attributes.body]]"></marked-element>
            </template>
            <!-- ----- Images Submission -----  -->
            <template is="dom-if" if="[[submission.attributes.images]]">
              <lrndesign-contentblock class="center">
                <template is="dom-repeat" items="[[_toArray(submission.attributes.images)]]" as="image">
                <lrnsys-dialog alt="View Image" body-append dynamic-images>
                  <span slot="header">
                    <div class="image-dialog-header">
                    	<lrnsys-button class="blue darken-4 white-text" icon="launch" href="[[image.url]]" target="_blank">Open in new window</lrnsys-button>
                      <lrnsys-button class="blue darken-4 white-text" icon="launch" href="[[submission.attributes.download_files]]" target="_blank">Download all images</lrnsys-button>
                    </div>
                  </span>
                  <span slot="button">
                    <iron-image style="width:200px; height:200px; background-color: lightgray;" sizing="contain" class="contain" src="[[image.thumbnail]]" preload fade></iron-image>
                  </span>
                  <div style="width: 60%; margin:0 auto;">
                  	<iron-image prevent-load style="width:100%; height:100%; background-color: lightgray;" src="[[image.url]]" preload fade></iron-image>
                  </div>
                </lrnsys-dialog>
              </template>
            </lrndesign-contentblock>
          </template>
          <!-- ----- Video Submission -----  -->
          <template is="dom-if" if="[[submission.attributes.video]]">
            <lrndesign-contentblock class="center">
              <template is="dom-repeat" items="[[_toArray(submission.attributes.video)]]" as="video">
                <iframe width="460" height="249" src="[[video.video_src]]"></iframe>
              </template>
            </lrndesign-contentblock>
          </template>
          <!-- ----- Links Submission -----  -->
          <template is="dom-if" if="[[submission.attributes.links]]">
            <lrndesign-contentblock>
              <template is="dom-repeat" items="[[_toArray(submission.attributes.links)]]" as="link">
                <p><strong>[[link.title]]:</strong>
                  <a class="link" href="[[link.url]]" target="_blank">[[link.url]]</a></p>
              </template>
            </lrndesign-contentblock>
          </template>
          <!-- ----- Files Submission -----  -->
          <template is="dom-if" if="[[submission.attributes.files]]">
            <lrndesign-contentblock title="Files Submitted">
              <template is="dom-repeat" items="[[_toArray(submission.attributes.files)]]" as="file">
                <p><strong>[[file.filename]]:</strong>
                  <a class="link" href="[[file.url]]" target="_blank">[[file.url]]</a></p>
              </template>
            </lrndesign-contentblock>
          </template>
        </div>
      </paper-card>
    </div>

  </template>
  <script>
    Polymer({
      is: 'lrnapp-studio-submission-display',
      properties: {
        submission: {
          type: Object,
          notify: true
        }
      },
      /**
       * Simple way to convert from object to array.
       */
      _toArray: function (obj) {
        if (typeof obj === 'object' && obj !== null) {
          return Object.keys(obj).map(function (key) {
            return obj[key];
          });
        }
        return [];
      },
      toggle: function() {
        this.$.collapse.toggle();
      },
    });
  </script>
</dom-module>