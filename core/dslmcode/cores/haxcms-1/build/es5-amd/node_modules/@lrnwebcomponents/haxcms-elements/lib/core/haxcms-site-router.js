define(["exports", "../../../../@vaadin/router/dist/vaadin-router.js", "../../../../mobx/dist/mobx.esm.js", "./haxcms-site-store.js"], function (_exports, _vaadinRouter, _mobxEsm, _haxcmsSiteStore) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.HAXCMSSiteRouter = void 0;

  function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = babelHelpers.getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = babelHelpers.getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return babelHelpers.possibleConstructorReturn(this, result); }; }

  function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

  /**
   * `haxcms-site-router`
   * `front-end router for haxcms`
   */
  var HAXCMSSiteRouter = /*#__PURE__*/function (_HTMLElement) {
    babelHelpers.inherits(HAXCMSSiteRouter, _HTMLElement);

    var _super = _createSuper(HAXCMSSiteRouter);

    /**
     * ready life cycle
     */
    function HAXCMSSiteRouter() {
      var _this;

      babelHelpers.classCallCheck(this, HAXCMSSiteRouter);
      _this = _super.call(this); // create router

      var options = {};

      if (_this.baseURI) {
        options.baseUrl = _this.baseURI;
      }

      _this.router = new _vaadinRouter.Router(babelHelpers.assertThisInitialized(_this), options);
      /**
       * Subscribe to changes in the manifest
       */

      _this.__disposer = (0, _mobxEsm.autorun)(function () {
        _this._updateRouter(_haxcmsSiteStore.store.routerManifest);
      });
      window.addEventListener("vaadin-router-location-changed", _this._routerLocationChanged.bind(babelHelpers.assertThisInitialized(_this)));
      window.addEventListener("haxcms-site-router-add", _this.addRoutesEvent.bind(babelHelpers.assertThisInitialized(_this)));
      return _this;
    }
    /**
     * Detached life cycle
     */


    babelHelpers.createClass(HAXCMSSiteRouter, [{
      key: "baseURI",
      get: function get() {
        return this.getAttribute("base-uri");
      },
      set: function set($value) {
        this.setAttribute("base-uri", $value);
      }
      /**
       * Store the tag name to make it easier to obtain directly.
       */

    }, {
      key: "disconnectedCallback",
      value: function disconnectedCallback() {
        this.__disposer.dispose();

        window.removeEventListener("vaadin-router-location-changed", this._routerLocationChanged.bind(this));
        window.removeEventListener("haxcms-site-router-add", this.addRoutesEvent.bind(this));
        babelHelpers.get(babelHelpers.getPrototypeOf(HAXCMSSiteRouter.prototype), "disconnectedCallback", this).call(this);
      }
    }, {
      key: "addRoutesEvent",
      value: function addRoutesEvent(e) {
        this.addRoutes(e.detail);
      }
    }, {
      key: "addRoutes",
      value: function addRoutes(pathAry) {
        this.router.addRoutes(pathAry);
      }
      /**
       * Update the router based on a manifest.
       * This should not be called directly. Use the store to change store.routerManifest
       *
       * @param {object} routerManifest
       */

    }, {
      key: "_updateRouter",
      value: function _updateRouter(routerManifest) {
        if (!routerManifest || typeof routerManifest.items === "undefined") return;
        var routerItems = routerManifest.items.map(function (i) {
          return {
            path: i.slug,
            name: i.id,
            component: "fake-".concat(i.id, "-e")
          };
        });
        this.router.setRoutes([].concat(babelHelpers.toConsumableArray(routerItems), [{
          path: "/",
          component: "fake-home-e",
          name: "home"
        }, {
          path: "/(.*)",
          component: "fake-404-e",
          name: "404"
        }]));
      }
      /**
       * React to page changes in the vaadin router and convert it
       * to a change in the mobx store.
       * @param {event} e
       */

    }, {
      key: "_routerLocationChanged",
      value: function _routerLocationChanged(e) {
        _haxcmsSiteStore.store.location = e.detail.location;
      }
    }], [{
      key: "tag",
      get: function get() {
        return "haxcms-site-router";
      }
    }]);
    return HAXCMSSiteRouter;
  }( /*#__PURE__*/babelHelpers.wrapNativeSuper(HTMLElement));

  _exports.HAXCMSSiteRouter = HAXCMSSiteRouter;
  customElements.define(HAXCMSSiteRouter.tag, HAXCMSSiteRouter);
});