define(["exports", "../../../@polymer/polymer/polymer-element.js", "../../../@polymer/polymer/lib/utils/render-status.js", "../../dropdown-select/dropdown-select.js", "../../../@polymer/paper-item/paper-item.js", "../../../@polymer/polymer/lib/elements/dom-repeat.js", "../../../@polymer/polymer/lib/elements/dom-if.js", "../../simple-colors/simple-colors.js", "../../responsive-utility/lib/responsive-utility-behaviors.js", "./editable-table-behaviors.js", "./editable-table-sort.js", "./editable-table-filter.js", "./editable-table-styles.js"], function (_exports, _polymerElement, _renderStatus, _dropdownSelect, _paperItem, _domRepeat, _domIf, _simpleColors, _responsiveUtilityBehaviors, _editableTableBehaviors, _editableTableSort, _editableTableFilter, _editableTableStyles) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.EditableTableDisplay = void 0;

  function _templateObject_342570b0b49011e9ae0d876050e9d419() {
    var data = babelHelpers.taggedTemplateLiteral(["\n      <style is=\"custom-style\" include=\"editable-table-styles simple-colors\">\n        :host([dark]) .caption {\n          padding: 4px 4px 0;\n        }\n        :host([bordered]) .table .th,\n        :host([bordered]) .table .td {\n          border: 1px solid var(--editable-table-border-color);\n        }\n        :host([striped]) .table .tbody .tr:nth-child(2n) .th,\n        :host([striped]) .table .tbody .tr:nth-child(2n) .td {\n          @apply --editable-table-style-stripe;\n        }\n        :host([column-header]) .table .thead .tr .th {\n          @apply --editable-table-style-column-header;\n        }\n        :host([row-header]) .table .tbody .tr .th {\n          @apply --editable-table-style-row-header;\n        }\n        :host([footer]) .table .tfoot .tr .th,\n        :host([footer]) .table .tfoot .tr .td {\n          @apply --editable-table-style-footer;\n        }\n      </style>\n      <table id=\"table\" class=\"table\" default-xs-display=\"\">\n        <caption class=\"caption\">\n          <div>\n            <div>[[caption]]</div>\n            <dropdown-select id=\"column\" label$=\"[[tables.0.label]]\" value=\"1\">\n              <template\n                is=\"dom-repeat\"\n                items=\"[[thead.0]]\"\n                as=\"col\"\n                index-as=\"index\"\n              >\n                <template is=\"dom-if\" if=\"[[columnHeader]]\">\n                  <paper-item id$=\"[[index]]\" value$=\"[[index]]\"\n                    >[[col]]</paper-item\n                  >\n                </template>\n                <template is=\"dom-if\" if=\"[[!columnHeader]]\">\n                  <paper-item id$=\"[[index]]\">Column [[index]]</paper-item>\n                </template>\n              </template>\n            </dropdown-select>\n          </div>\n        </caption>\n        <thead class=\"thead\" hidden=\"[[!columnHeader]]\">\n          <tr class=\"tr\">\n            <template\n              is=\"dom-repeat\"\n              items=\"[[thead.0]]\"\n              as=\"th\"\n              index-as=\"index\"\n            >\n              <th\n                class=\"th\"\n                scope=\"col\"\n                numeric$=\"[[_isNumericColumn(index)]]\"\n              >\n                <template is=\"dom-if\" if=\"[[sort]]\" restamp=\"\">\n                  <editable-table-sort\n                    sort-column$=\"[[sortColumn]]\"\n                    column-number=\"[[index]]\"\n                    text$=\"[[th]]\"\n                  ></editable-table-sort>\n                </template>\n                <template is=\"dom-if\" if=\"[[!sort]]\" restamp=\"\"\n                  >[[th]]</template\n                >\n              </th>\n            </template>\n          </tr>\n        </thead>\n        <tbody id=\"tbody\" class=\"tbody\">\n          <template\n            is=\"dom-repeat\"\n            items=\"[[tbody]]\"\n            as=\"tr\"\n            filter=\"{{filterRows(filterColumn,filterText)}}\"\n            restamp=\"\"\n          >\n            <tr class=\"tr\">\n              <template\n                is=\"dom-repeat\"\n                items=\"[[tr]]\"\n                as=\"cell\"\n                index-as=\"index\"\n                restamp=\"\"\n              >\n                <template\n                  is=\"dom-if\"\n                  if=\"[[_isRowHeader(rowHeader,index)]]\"\n                  restamp=\"\"\n                >\n                  <th\n                    class=\"th\"\n                    scope=\"row\"\n                    numeric$=\"[[_isNumericColumn(index)]]\"\n                  >\n                    [[cell]]\n                  </th>\n                </template>\n                <template\n                  is=\"dom-if\"\n                  if=\"[[!_isRowHeader(rowHeader,index)]]\"\n                  restamp=\"\"\n                >\n                  <td\n                    class=\"td\"\n                    numeric$=\"[[_isNumericColumn(index)]]\"\n                    negative$=\"[[_isNegative(cell)]]\"\n                  >\n                    <template is=\"dom-if\" if=\"[[filter]]\" restamp=\"\">\n                      <editable-table-filter\n                        column-number=\"[[index]]\"\n                        text$=\"[[cell]]\"\n                        filtered$=\"[[_isFiltered(index,filterColumn,filtered)]]\"\n                      ></editable-table-filter>\n                    </template>\n                    <template is=\"dom-if\" if=\"[[!filter]]\" restamp=\"\"\n                      ><span class=\"cell\">[[cell]]</span></template\n                    >\n                  </td>\n                </template>\n              </template>\n            </tr>\n          </template>\n        </tbody>\n        <template is=\"dom-if\" if=\"[[footer]]\">\n          <tfoot class=\"tfoot\">\n            <tr class=\"tr\">\n              <template\n                is=\"dom-repeat\"\n                items=\"[[__tfoot.0]]\"\n                as=\"cell\"\n                index-as=\"index\"\n              >\n                <template is=\"dom-if\" if=\"[[_isRowHeader(rowHeader,index)]]\">\n                  <th\n                    class=\"th\"\n                    scope=\"row\"\n                    numeric$=\"[[_isNumericColumn(index)]]\"\n                  >\n                    [[cell]]\n                  </th>\n                </template>\n                <template is=\"dom-if\" if=\"[[!_isRowHeader(rowHeader,index)]]\">\n                  <td\n                    class=\"td\"\n                    numeric$=\"[[_isNumericColumn(index)]]\"\n                    negative$=\"[[_isNegative(cell)]]\"\n                  >\n                    [[cell]]\n                  </td>\n                </template>\n              </template>\n            </tr>\n          </tfoot>\n        </template>\n      </table>\n    "], ["\n      <style is=\"custom-style\" include=\"editable-table-styles simple-colors\">\n        :host([dark]) .caption {\n          padding: 4px 4px 0;\n        }\n        :host([bordered]) .table .th,\n        :host([bordered]) .table .td {\n          border: 1px solid var(--editable-table-border-color);\n        }\n        :host([striped]) .table .tbody .tr:nth-child(2n) .th,\n        :host([striped]) .table .tbody .tr:nth-child(2n) .td {\n          @apply --editable-table-style-stripe;\n        }\n        :host([column-header]) .table .thead .tr .th {\n          @apply --editable-table-style-column-header;\n        }\n        :host([row-header]) .table .tbody .tr .th {\n          @apply --editable-table-style-row-header;\n        }\n        :host([footer]) .table .tfoot .tr .th,\n        :host([footer]) .table .tfoot .tr .td {\n          @apply --editable-table-style-footer;\n        }\n      </style>\n      <table id=\"table\" class=\"table\" default-xs-display=\"\">\n        <caption class=\"caption\">\n          <div>\n            <div>[[caption]]</div>\n            <dropdown-select id=\"column\" label\\$=\"[[tables.0.label]]\" value=\"1\">\n              <template\n                is=\"dom-repeat\"\n                items=\"[[thead.0]]\"\n                as=\"col\"\n                index-as=\"index\"\n              >\n                <template is=\"dom-if\" if=\"[[columnHeader]]\">\n                  <paper-item id\\$=\"[[index]]\" value\\$=\"[[index]]\"\n                    >[[col]]</paper-item\n                  >\n                </template>\n                <template is=\"dom-if\" if=\"[[!columnHeader]]\">\n                  <paper-item id\\$=\"[[index]]\">Column [[index]]</paper-item>\n                </template>\n              </template>\n            </dropdown-select>\n          </div>\n        </caption>\n        <thead class=\"thead\" hidden=\"[[!columnHeader]]\">\n          <tr class=\"tr\">\n            <template\n              is=\"dom-repeat\"\n              items=\"[[thead.0]]\"\n              as=\"th\"\n              index-as=\"index\"\n            >\n              <th\n                class=\"th\"\n                scope=\"col\"\n                numeric\\$=\"[[_isNumericColumn(index)]]\"\n              >\n                <template is=\"dom-if\" if=\"[[sort]]\" restamp=\"\">\n                  <editable-table-sort\n                    sort-column\\$=\"[[sortColumn]]\"\n                    column-number=\"[[index]]\"\n                    text\\$=\"[[th]]\"\n                  ></editable-table-sort>\n                </template>\n                <template is=\"dom-if\" if=\"[[!sort]]\" restamp=\"\"\n                  >[[th]]</template\n                >\n              </th>\n            </template>\n          </tr>\n        </thead>\n        <tbody id=\"tbody\" class=\"tbody\">\n          <template\n            is=\"dom-repeat\"\n            items=\"[[tbody]]\"\n            as=\"tr\"\n            filter=\"{{filterRows(filterColumn,filterText)}}\"\n            restamp=\"\"\n          >\n            <tr class=\"tr\">\n              <template\n                is=\"dom-repeat\"\n                items=\"[[tr]]\"\n                as=\"cell\"\n                index-as=\"index\"\n                restamp=\"\"\n              >\n                <template\n                  is=\"dom-if\"\n                  if=\"[[_isRowHeader(rowHeader,index)]]\"\n                  restamp=\"\"\n                >\n                  <th\n                    class=\"th\"\n                    scope=\"row\"\n                    numeric\\$=\"[[_isNumericColumn(index)]]\"\n                  >\n                    [[cell]]\n                  </th>\n                </template>\n                <template\n                  is=\"dom-if\"\n                  if=\"[[!_isRowHeader(rowHeader,index)]]\"\n                  restamp=\"\"\n                >\n                  <td\n                    class=\"td\"\n                    numeric\\$=\"[[_isNumericColumn(index)]]\"\n                    negative\\$=\"[[_isNegative(cell)]]\"\n                  >\n                    <template is=\"dom-if\" if=\"[[filter]]\" restamp=\"\">\n                      <editable-table-filter\n                        column-number=\"[[index]]\"\n                        text\\$=\"[[cell]]\"\n                        filtered\\$=\"[[_isFiltered(index,filterColumn,filtered)]]\"\n                      ></editable-table-filter>\n                    </template>\n                    <template is=\"dom-if\" if=\"[[!filter]]\" restamp=\"\"\n                      ><span class=\"cell\">[[cell]]</span></template\n                    >\n                  </td>\n                </template>\n              </template>\n            </tr>\n          </template>\n        </tbody>\n        <template is=\"dom-if\" if=\"[[footer]]\">\n          <tfoot class=\"tfoot\">\n            <tr class=\"tr\">\n              <template\n                is=\"dom-repeat\"\n                items=\"[[__tfoot.0]]\"\n                as=\"cell\"\n                index-as=\"index\"\n              >\n                <template is=\"dom-if\" if=\"[[_isRowHeader(rowHeader,index)]]\">\n                  <th\n                    class=\"th\"\n                    scope=\"row\"\n                    numeric\\$=\"[[_isNumericColumn(index)]]\"\n                  >\n                    [[cell]]\n                  </th>\n                </template>\n                <template is=\"dom-if\" if=\"[[!_isRowHeader(rowHeader,index)]]\">\n                  <td\n                    class=\"td\"\n                    numeric\\$=\"[[_isNumericColumn(index)]]\"\n                    negative\\$=\"[[_isNegative(cell)]]\"\n                  >\n                    [[cell]]\n                  </td>\n                </template>\n              </template>\n            </tr>\n          </tfoot>\n        </template>\n      </table>\n    "]);

    _templateObject_342570b0b49011e9ae0d876050e9d419 = function _templateObject_342570b0b49011e9ae0d876050e9d419() {
      return data;
    };

    return data;
  }

  /**
  `editable-table-display`
  
  Displays a table with theming, styling, sorting, resonsive, and 
  filtering features.  (See editable-table-behaviors.html 
  for more information.)
  
  * @demo demo/index.html
  
  @microcopy - the mental model for this element
  <editable-table-display 
    accent-color="indigo"     //Optional accent color for column headers and border. Default is none. (See https://lrnwebcomponents.github.io/simple-colors/components/simple-colors/)
    bordered                  //Adds borders to table. Default is no border.
    caption="..."             //The caption or title for the table.
    column-header             //Does the table use the first row as a column-header? Default is false.
    condensed                 //Condense the padding above and below the table? Default is false.
    dark                      //Optional dark theme. Default is light theme. (See https://lrnwebcomponents.github.io/simple-colors/components/simple-colors/)
    data='[                   //Table data as an array. For example:
      [ ["..."], ["..."] ],     //This line represents a row with two columns
      [ ["..."], ["..."] ],     //This line represents another row with two columns
      [ ["..."], ["..."] ]      //This line represents a third row with two columns
    ]'
    edit-mode                 //Is the editor in edit mode? Default is false which places the table in display mode. 
    filter                    //Allow table to toggle filtering? When a cell is toggled, only rows that have the same value as that cell will be shown. Default is no filter.
    footer                    //Does the table use the last row as a footer? Default is false.
    row-header                //Does the table use the first column as a row header? Default is false.
    scroll                    //Does the table use scrolling to fit when it is too wide?  Default is false: a responsive layout where only two columns are shown and a dropdown menu controls which column to display.
    sort                      //Does the table allow sorting by column where column headers become sort buttons? Default is false.
    striped                   //Does the table have alternating stipes of shading for its body rows? Default is false.
    summary="...">            //An accessible description of the table, what each row reporesents, and what each column represents.
  </editable-table-display>
  
  */
  var EditableTableDisplay =
  /*#__PURE__*/
  function (_displayBehaviors) {
    babelHelpers.inherits(EditableTableDisplay, _displayBehaviors);

    function EditableTableDisplay() {
      babelHelpers.classCallCheck(this, EditableTableDisplay);
      return babelHelpers.possibleConstructorReturn(this, babelHelpers.getPrototypeOf(EditableTableDisplay).apply(this, arguments));
    }

    babelHelpers.createClass(EditableTableDisplay, [{
      key: "_getTbody",

      /**
       * Geth the rows in <tbody>
       */
      value: function _getTbody(data, columnHeader, footer) {
        if (data !== undefined && data !== null && data.length > 0) {
          var ch = columnHeader ? 1 : 0,
              tbody;

          if (footer) {
            tbody = data.slice(ch, data.length - 1);
            this.__tfoot = data.slice(data.length - 1);
          } else {
            tbody = data.slice(ch, data.length);
            this.__tfoot = [];
          }

          return tbody;
        }

        return [];
      }
      /**
       * Get the columns in <thead>
       */

    }, {
      key: "_getThead",
      value: function _getThead(data, columnHeader) {
        var root = this;

        if (data !== undefined && data !== null && data.length > 0 && columnHeader) {
          return data.slice(0, 1);
        }

        return [];
      }
      /**
       * sets a column's cells to filtered when in filtered mode so that filter can toggle
       */

    }, {
      key: "_isFiltered",
      value: function _isFiltered(column, filterColumn, filtered) {
        return filterColumn !== null && filterColumn === column && filtered;
      }
      /**
       * sets a cell's numeric style
       */

    }, {
      key: "_isNegative",
      value: function _isNegative(cell) {
        return this._isNumeric(cell) && cell.trim().indexOf("-") === 0;
      }
      /**
       * sets a cell's numeric style
       */

    }, {
      key: "_isNumeric",
      value: function _isNumeric(cell) {
        return cell !== null && !isNaN(cell.trim().replace(/\$/g, ""));
      }
      /**
       * sets a cell's numeric style
       */

    }, {
      key: "_isNumericColumn",
      value: function _isNumericColumn(col) {
        var numeric = true;

        for (var i = 0; i < this.tbody.length; i++) {
          if (!this._isNumeric(this.tbody[i][col])) numeric = false;
        }

        return numeric;
      }
      /**
       * Calculate if the cell is a th or td
       */

    }, {
      key: "_isRowHeader",
      value: function _isRowHeader(rowHeader, index) {
        return index === 0 && rowHeader;
      }
      /**
       * Handle column dropdown-select change
       */

    }, {
      key: "_onColumnChange",
      value: function _onColumnChange(e) {
        this.selected = e.detail.value;

        this._updateCols(parseInt(e.detail.value));
      }
      /**
       * Handle sort button click
       */

    }, {
      key: "_changeSortMode",
      value: function _changeSortMode(e) {
        if (this.sortColumn === e.detail.columnNumber && this.sortMode === "asc") {
          this.sortMode = "desc";
        } else if (this.sortColumn === e.detail.columnNumber && this.sortMode === "desc") {
          this.sortMode = "none";
        } else {
          this.sortMode = "asc";
          this.sortColumn = e.detail.columnNumber;
        }

        e.detail.setSortMode(this.sortMode);
        this.sortData(this.sortMode, e.detail.columnNumber);
      }
      /**
       * update the responsive columns menu
       */

    }, {
      key: "_updateCols",
      value: function _updateCols(selected) {
        this.$.table.removeAttribute("default-xs-display");
        var cols = this.$.table.querySelectorAll("th,td");
        this.$.table.setAttribute("transition", true);
        setTimeout(function () {
          for (var i = 0; i < cols.length; i++) {
            var col = cols[i],
                index = col.cellIndex,
                delay = void 0;

            if (index === 0 || index === selected) {
              col.removeAttribute("xs-hidden");
            } else {
              col.setAttribute("xs-hidden", true);
            }
          }
        }, 200);
        this.$.table.removeAttribute("transition");
      }
      /**
       * Handle filter based on collumn and text of cell that is clicked
       */

    }, {
      key: "filterRows",
      value: function filterRows(filterColumn, filterText) {
        if (filterText !== undefined && filterText !== null) {
          return function (tr) {
            return tr[filterColumn].toLowerCase().trim() === filterText.toLowerCase().trim();
          };
        } else {
          return null;
        }
      }
      /**
       * initialize the responsive columns menu
       */

    }, {
      key: "sortData",
      value: function sortData(type, column) {
        if (type !== "none" && type !== false) {
          var temp = this.tbody.slice();

          for (var i = 0; i < temp.length; i++) {
            temp[i].unshift(temp[i][column]);
          }

          if (type === "asc") {
            temp.sort();
          } else {
            temp.reverse();
          }

          for (var _i = 0; _i < temp.length; _i++) {
            this.set("tbody." + _i, []);
            this.set("tbody." + _i, temp[_i].slice(1));
          }
        } else {
          var _temp = this.tbody.slice();

          for (var _i2 = 0; _i2 < _temp.length; _i2++) {
            this.set("data." + (_i2 + 1), []);
            this.set("data." + (_i2 + 1), _temp[_i2].slice());
          }
        }
      }
      /**
       * Handle filter button click
       */

    }, {
      key: "toggleFilter",
      value: function toggleFilter(e) {
        if (e === undefined || this.filterColumn == e.detail.columnNumber && this.filtered) {
          this.filtered = false;
          this.filterText = null;
          this.filterColumn = null;
        } else {
          this.filterText = e.detail.text;
          this.filterColumn = e.detail.columnNumber;
          this.filtered = true;
        }
      }
    }, {
      key: "connectedCallback",
      value: function connectedCallback() {
        babelHelpers.get(babelHelpers.getPrototypeOf(EditableTableDisplay.prototype), "connectedCallback", this).call(this);
        (0, _renderStatus.afterNextRender)(this, function () {
          this.addEventListener("change-sort-mode", this._changeSortMode.bind(this));
          this.addEventListener("toggle-filter", this.toggleFilter.bind(this));
          this.addEventListener("dropdown-select-changed", this._onColumnChange.bind(this));
        });
      }
    }, {
      key: "disconnectedCallback",
      value: function disconnectedCallback() {
        this.removeEventListener("change-sort-mode", this._changeSortMode.bind(this));
        this.removeEventListener("toggle-filter", this.toggleFilter.bind(this));
        this.removeEventListener("dropdown-select-changed", this._onColumnChange.bind(this));
        babelHelpers.get(babelHelpers.getPrototypeOf(EditableTableDisplay.prototype), "disconnectedCallback", this).call(this);
      }
    }], [{
      key: "template",
      get: function get() {
        return (0, _polymerElement.html)(_templateObject_342570b0b49011e9ae0d876050e9d419());
      }
    }, {
      key: "tag",
      get: function get() {
        return "editable-table-display";
      }
    }, {
      key: "properties",
      get: function get() {
        return {
          /**
           * Is the table in edit mode?
           */
          editMode: {
            type: Boolean,
            value: false
          },

          /**
           * Column for filtering
           */
          filterColumn: {
            type: Number,
            value: null
          },

          /**
           * Is the table filtered
           */
          filtered: {
            type: Boolean,
            value: false
          },

          /**
           * Text for Filtering
           */
          filterText: {
            type: String,
            value: null
          },

          /**
           * Hide edit mode?
           */
          hideEditMode: {
            type: Boolean,
            value: false
          },

          /**
           * The selected table
           */
          selected: {
            type: Number,
            value: 1
          },

          /**
           * Sort mode: ascending, descending or none
           */
          sortMode: {
            type: String,
            value: "none"
          },

          /**
           * The index of the current sort column
           */
          sortColumn: {
            type: Number,
            value: -1
          },

          /**
           * columns in <thead>
           */
          thead: {
            type: Array,
            computed: "_getThead(data,columnHeader)"
          },

          /**
           * rows in <tbody>
           */
          tbody: {
            type: Array,
            computed: "_getTbody(data,columnHeader,footer)"
          }
        };
      }
    }]);
    return EditableTableDisplay;
  }((0, _editableTableBehaviors.displayBehaviors)((0, _responsiveUtilityBehaviors.ResponsiveUtilityBehaviors)(_polymerElement.PolymerElement)));

  _exports.EditableTableDisplay = EditableTableDisplay;
  window.customElements.define(EditableTableDisplay.tag, EditableTableDisplay);
});