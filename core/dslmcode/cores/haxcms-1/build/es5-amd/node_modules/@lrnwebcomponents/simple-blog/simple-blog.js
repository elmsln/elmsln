define(["exports", "require", "../../lit/index.js", "../haxcms-elements/lib/core/HAXCMSLitElementTheme.js", "../haxcms-elements/lib/core/haxcms-site-store.js", "../../mobx/dist/mobx.esm.js", "../simple-colors/simple-colors.js", "./lib/simple-blog-post.js", "../../@polymer/iron-pages/iron-pages.js", "../anchor-behaviors/anchor-behaviors.js", "../simple-icon/simple-icon.js", "../simple-icon/lib/simple-icons.js", "../simple-icon/lib/simple-icon-button.js"], function (_exports, _require, _index, _HAXCMSLitElementTheme, _haxcmsSiteStore, _mobxEsm, _simpleColors, _simpleBlogPost, _ironPages, _anchorBehaviors, _simpleIcon, _simpleIcons, _simpleIconButton) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.SimpleBlog = void 0;
  _require = _interopRequireWildcard(_require);

  var _templateObject_acb17a908e0011ed99ce491205e67b1d, _templateObject2_acb17a908e0011ed99ce491205e67b1d;

  function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

  function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || babelHelpers.typeof(obj) !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

  function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

  function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { babelHelpers.defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

  function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = babelHelpers.getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = babelHelpers.getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return babelHelpers.possibleConstructorReturn(this, result); }; }

  function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

  /**
   * `simple-blog`
   * `A simple blog and associated elements`
   * @demo demo/index.html
   * @element simple-blog
   */
  var SimpleBlog = /*#__PURE__*/function (_SimpleColorsSuper) {
    babelHelpers.inherits(SimpleBlog, _SimpleColorsSuper);

    var _super = _createSuper(SimpleBlog);

    function SimpleBlog() {
      var _this;

      babelHelpers.classCallCheck(this, SimpleBlog);
      _this = _super.call(this);
      _this.__disposer = [];
      _this.selectedPage = 0;
      setTimeout(function () {
        new Promise(function (res, rej) {
          return _require.default(["./lib/simple-blog-header.js"], res, rej);
        });
        new Promise(function (res, rej) {
          return _require.default(["./lib/simple-blog-footer.js"], res, rej);
        });
        new Promise(function (res, rej) {
          return _require.default(["./lib/simple-blog-listing.js"], res, rej);
        });
      }, 0);
      return _this;
    }
    /**
     * LitElement ready
     */


    babelHelpers.createClass(SimpleBlog, [{
      key: "render",
      value: // render function
      function render() {
        return (0, _index.html)(_templateObject_acb17a908e0011ed99ce491205e67b1d || (_templateObject_acb17a908e0011ed99ce491205e67b1d = babelHelpers.taggedTemplateLiteral(["\n      <iron-pages .selected=\"", "\">\n        <header>\n          <simple-blog-header></simple-blog-header>\n          <simple-blog-listing></simple-blog-listing>\n        </header>\n        <main>\n          <simple-icon-button\n            id=\"backbutton\"\n            icon=\"icons:arrow-back\"\n            @click=\"", "\"\n          ></simple-icon-button>\n          <simple-tooltip\n            for=\"backbutton\"\n            position=\"right\"\n            offset=\"14\"\n            animation-delay=\"0\"\n            >Back to listing\n          </simple-tooltip>\n          <article>\n            <simple-blog-post ?edit-mode=\"", "\"\n              ><slot></slot\n            ></simple-blog-post>\n          </article>\n          <footer>\n            <simple-blog-footer id=\"footer\"></simple-blog-footer>\n          </footer>\n        </main>\n      </iron-pages>\n    "])), this.selectedPage, this._goBack, this.editMode);
      }
      /**
       * Mix in an opened status
       */

    }, {
      key: "firstUpdated",
      value: function firstUpdated(changedProperties) {
        var _this2 = this;

        if (babelHelpers.get(babelHelpers.getPrototypeOf(SimpleBlog.prototype), "firstUpdated", this)) {
          babelHelpers.get(babelHelpers.getPrototypeOf(SimpleBlog.prototype), "firstUpdated", this).call(this, changedProperties);
        } // bc of async rendering and this being in a shadow of a shadow
        // we need to pause to ensure its painted


        setTimeout(function () {
          _this2.contentContainer = _this2.shadowRoot.querySelector("simple-blog-post").shadowRoot.querySelector("#contentcontainer");
        }, 0);
      }
      /**
       * attached life cycle
       */

    }, {
      key: "connectedCallback",
      value: function connectedCallback() {
        var _this3 = this;

        babelHelpers.get(babelHelpers.getPrototypeOf(SimpleBlog.prototype), "connectedCallback", this).call(this);
        (0, _mobxEsm.autorun)(function (reaction) {
          _this3.activeId = (0, _mobxEsm.toJS)(_haxcmsSiteStore.store.activeId);

          _this3.__disposer.push(reaction);
        });
        (0, _mobxEsm.autorun)(function (reaction) {
          var location = (0, _mobxEsm.toJS)(_haxcmsSiteStore.store.location);

          _this3._locationChanged(location);

          _this3.__disposer.push(reaction);
        });
      }
      /**
       * detatched life cycle
       */

    }, {
      key: "disconnectedCallback",
      value: function disconnectedCallback() {
        // clean up state
        for (var i in this.__disposer) {
          this.__disposer[i].dispose();
        }

        babelHelpers.get(babelHelpers.getPrototypeOf(SimpleBlog.prototype), "disconnectedCallback", this).call(this);
      }
      /**
       * Listen for router location changes
       */

    }, {
      key: "_locationChanged",
      value: function _locationChanged(location) {
        if (!location || typeof location.route === "undefined") return;
        var name = location.route.name;

        if (name === "home" || name === "404") {
          this.selectedPage = 0;
        } else {
          window.scrollTo({
            top: 0,
            left: 0
          });
          this.selectedPage = 1; // @todo hacky timing thing

          setTimeout(function () {
            // try scrolling to the target ID after content gets imported
            window.AnchorBehaviors.getTarget(_haxcmsSiteStore.store.themeElement);
          }, 1000);
        }

        setTimeout(function () {
          window.dispatchEvent(new Event("resize"));
        }, 50);
      }
      /**
       * Reset the active item to reset state
       */

    }, {
      key: "_goBack",
      value: function _goBack(e) {
        var _this4 = this;

        var prevActiveItemId = _haxcmsSiteStore.store.activeId;
        window.history.pushState(null, null, _haxcmsSiteStore.store.location.baseUrl);
        window.dispatchEvent(new PopStateEvent("popstate")); // should help account for starting on a page where popstate isn't set
        // and also generate data model mirroring

        if (prevActiveItemId) {
          setTimeout(function () {
            var active = _this4.shadowRoot.querySelector("simple-blog-listing").shadowRoot.querySelector('simple-blog-overview[item-id="' + prevActiveItemId + '"]');

            if (active) {
              active.scrollIntoView(true);
              active.focus();
            }
          }, 100);
        } else {
          window.scrollTo({
            top: 0,
            left: 0
          });
        }

        var evt = new CustomEvent("json-outline-schema-active-item-changed", {
          bubbles: true,
          cancelable: true,
          composed: true,
          detail: {}
        });
        this.dispatchEvent(evt);
        this.selectedPage = 0;
      }
    }], [{
      key: "styles",
      get:
      /**
       * LitElement constructable styles enhancement
       */
      function get() {
        return [].concat(babelHelpers.toConsumableArray(babelHelpers.get(babelHelpers.getPrototypeOf(SimpleBlog), "styles", this)), [(0, _index.css)(_templateObject2_acb17a908e0011ed99ce491205e67b1d || (_templateObject2_acb17a908e0011ed99ce491205e67b1d = babelHelpers.taggedTemplateLiteral(["\n        html,\n        body {\n          background-color: #fafafa;\n        }\n        :host {\n          display: block;\n          font-family: \"Roboto\", \"Noto\", sans-serif;\n          -webkit-font-smoothing: antialiased;\n          font-size: 14px;\n          background-color: #fafafa;\n          font-family: \"Open Sans\", \"MundoSans\", helvetica neue, Arial,\n            Helvetica, sans-serif;\n          margin: 0;\n          padding: 0;\n          text-rendering: optimizeLegibility;\n          -webkit-font-smoothing: antialiased;\n          -moz-font-feature-settings: \"liga=1, dlig=1\";\n          -ms-font-feature-settings: \"liga\", \"dlig\";\n          -webkit-font-feature-settings: \"liga\", \"dlig\";\n          -o-font-feature-settings: \"liga\", \"dlig\";\n          font-feature-settings: \"liga\", \"dlig\";\n        }\n        #backbutton {\n          position: fixed;\n          top: 0px;\n          left: 0px;\n          padding: 2px;\n          width: 40px;\n          height: 40px;\n          margin: 8px;\n          z-index: 1000;\n          color: black;\n          background-color: rgba(250, 250, 250, 0.5);\n          opacity: 0.5;\n          border-radius: 50%;\n          transition: all 0.6s linear;\n        }\n        #backbutton:focus,\n        #backbutton:hover {\n          opacity: 1;\n          color: white;\n          background-color: var(--haxcms-color, black);\n        }\n        iron-pages,\n        iron-pages section {\n          width: 100vw;\n          height: 100vh;\n        }\n        simple-blog-post {\n          transition: all 0.6s ease-in-out;\n          visibility: hidden;\n        }\n        :host([selected-page=\"0\"]) simple-blog-post {\n          opacity: 0;\n          visibility: hidden;\n        }\n        :host([selected-page=\"1\"]) simple-blog-post {\n          visibility: visible;\n          opacity: 1;\n        }\n        a,\n        a:active,\n        a:hover,\n        a:focus {\n          color: inherit;\n        }\n      "])))]);
      }
      /**
       * Store the tag name to make it easier to obtain directly.
       * @notice function name must be here for tooling to operate correctly
       */

    }, {
      key: "tag",
      get: function get() {
        return "simple-blog";
      }
    }, {
      key: "properties",
      get: function get() {
        return _objectSpread(_objectSpread({}, babelHelpers.get(babelHelpers.getPrototypeOf(SimpleBlog), "properties", this)), {}, {
          selectedPage: {
            type: Number,
            reflect: true,
            attribute: "selected-page"
          }
        });
      }
    }]);
    return SimpleBlog;
  }((0, _simpleColors.SimpleColorsSuper)(_HAXCMSLitElementTheme.HAXCMSLitElementTheme));

  _exports.SimpleBlog = SimpleBlog;
  customElements.define(SimpleBlog.tag, SimpleBlog);
});