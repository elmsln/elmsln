define(["exports", "../../../../lit-element/lit-element.js"], function (_exports, _litElement) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.MonacoElement = void 0;

  function _templateObject2_8f76df70864111ea89c13be6dda9e306() {
    var data = babelHelpers.taggedTemplateLiteral(["\n      <iframe id=\"iframe\" frameborder=\"0\"></iframe>\n    "]);

    _templateObject2_8f76df70864111ea89c13be6dda9e306 = function _templateObject2_8f76df70864111ea89c13be6dda9e306() {
      return data;
    };

    return data;
  }

  function _templateObject_8f76df70864111ea89c13be6dda9e306() {
    var data = babelHelpers.taggedTemplateLiteral(["\n        :host {\n          display: block;\n        }\n        iframe {\n          border: none;\n          width: 100%;\n          height: 100%;\n          padding: 0;\n          margin: 0;\n        }\n      "]);

    _templateObject_8f76df70864111ea89c13be6dda9e306 = function _templateObject_8f76df70864111ea89c13be6dda9e306() {
      return data;
    };

    return data;
  }

  /**
   * `monaco-element`
   * Webcomponent wrapper for the monaco editor.
   *
   * Sets value, language and theme.
   * Offers a value-changed event.
   *
   * Partly influenced by https://github.com/PolymerVis/monaco-editor
   *
   * @element monaco-element
   */
  var MonacoElement =
  /*#__PURE__*/
  function (_LitElement) {
    babelHelpers.inherits(MonacoElement, _LitElement);
    babelHelpers.createClass(MonacoElement, null, [{
      key: "styles",

      /**
       * LitElement constructable styles enhancement
       */
      get: function get() {
        return [(0, _litElement.css)(_templateObject_8f76df70864111ea89c13be6dda9e306())];
      }
    }]);

    function MonacoElement() {
      var _this;

      babelHelpers.classCallCheck(this, MonacoElement);
      _this = babelHelpers.possibleConstructorReturn(this, babelHelpers.getPrototypeOf(MonacoElement).call(this));
      _this.iframe = null;
      _this.value = "";
      _this.fontSize = 16;
      _this.tabSize = 2;
      _this.readOnly = false;
      _this.eventTypes = {
        ready: "ready",
        focus: "focus",
        blur: "blur",
        valueChanged: "valueChanged",
        languageChanged: "languageChanged",
        themeChanged: "themeChanged"
      };
      _this.language = "javascript";
      _this.theme = "vs-dark";
      _this.libPath = "node_modules/monaco-editor/min/vs";
      _this.autofocus = false;
      _this.hideLineNumbers = false;
      _this.editorReference = _this.generateUUID();
      return _this;
    }
    /**
     * LitElement
     */


    babelHelpers.createClass(MonacoElement, [{
      key: "render",
      value: function render() {
        return (0, _litElement.html)(_templateObject2_8f76df70864111ea89c13be6dda9e306());
      }
      /**
       * LitElement / popular convention
       */

    }, {
      key: "generateUUID",

      /**
       * Generate a UUID
       */
      value: function generateUUID() {
        return "ss-s-s-s-sss".replace(/s/g, this._uuidPart);
      }
    }, {
      key: "_uuidPart",
      value: function _uuidPart() {
        return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
      }
    }, {
      key: "updated",
      value: function updated(changedProperties) {
        var _this2 = this;

        changedProperties.forEach(function (oldValue, propName) {
          if (propName == "value") {
            _this2.monacoValueChanged(_this2[propName]);
          }

          if (propName == "language") {
            _this2.monacoLanguageChanged(_this2[propName]);
          }

          if (propName == "theme") {
            _this2.monacoThemeChanged(_this2[propName]);
          }
        });
      }
    }, {
      key: "connectedCallback",
      value: function connectedCallback() {
        var _this3 = this;

        babelHelpers.get(babelHelpers.getPrototypeOf(MonacoElement.prototype), "connectedCallback", this).call(this);
        window.addEventListener("message", function (message) {
          _this3.handleMessage(message);
        });
        setTimeout(function () {
          if (!_this3.__init) {
            _this3.initIFrame();
          }
        }, 500);
      }
    }, {
      key: "disconnectedCallback",
      value: function disconnectedCallback() {
        var _this4 = this;

        window.removeEventListener("message", function (message) {
          _this4.handleMessage(message);
        });
        this.__init = false;
        babelHelpers.get(babelHelpers.getPrototypeOf(MonacoElement.prototype), "disconnectedCallback", this).call(this);
      }
    }, {
      key: "initIFrame",
      value: function initIFrame() {
        var _this5 = this;

        this.iframe = this.shadowRoot.querySelector("#iframe");

        if (this.document && !this.__init) {
          this.__init = true;
          var div = document.createElement("div");
          div.id = "container";
          this.document.body.appendChild(div);
          var iframeScript = "\n  var eventTypes = {\n    ready: 'ready',\n    focus: 'focus',\n    blur: \"blur\",\n    valueChanged: 'valueChanged',\n    languageChanged: 'languageChanged',\n    themeChanged: 'themeChanged',\n  };\n\n  class MonacoEditor {\n    constructor(editorReference) {\n      this._editorReference_ = editorReference;\n      this.language = 'javascript';\n      this.value = '';\n      this.editor = null;\n      this.setupEventListener('message', this.handleMessage.bind(this));\n      this.setupEditor();\n    }\n\n    setupEditor() {\n      require.config({ paths: { vs: '".concat(this.libPath, "' } });\n      require(['vs/editor/editor.main'], () => {\n        this.editor = monaco.editor.create(document.getElementById('container'), {\n          value: this.value,\n          language: '").concat(this.language, "',\n          scrollBeyondLastLine: false,\n          automaticLayout: true,\n          ").concat(this.hideLineNumbers ? "lineNumbers: 'false'," : "", "\n          fontSize: ").concat(this.fontSize, ",\n          readOnly: ").concat(this.readOnly, ",\n          minimap: {\n            enabled: true\n          },\n          tabSize: ").concat(this.tabSize, ",\n          autoIndent: true,\n        });\n        const model = this.editor.getModel();\n        model.onDidChangeContent(() => {\n          const value = model.getValue();\n          this.onValueChanged(value);\n        });\n\n        this.ready();\n        if(").concat(this.autofocus, ") this.editor.focus();\n        this.editor.onDidFocusEditorText(e=>{\n          this.postMessage(eventTypes.focus, null);\n        });\n        this.editor.onDidBlurEditorText(e=>{\n          this.postMessage(eventTypes.blur, null);\n        });\n      });\n    }\n\n    ready() {\n      setTimeout(() => {\n        this.postMessage(eventTypes.ready, null);\n        this.setupEventListener(\n          eventTypes.valueChanged,\n          this.onValueChanged.bind(this)\n        );\n      }, 100);\n    }\n\n    _handleMessage(data) {\n      switch (data.event) {\n        case eventTypes.valueChanged:\n          this.onInputValueChanged(data.payload);\n          break;\n        case eventTypes.languageChanged:\n          this.onLanguageChanged(data.payload);\n          break;\n        case eventTypes.themeChanged:\n          this.onThemeChanged(data.payload);\n          break;\n        default:\n          break;\n      }\n    }\n\n    handleMessage(message) {\n      try {\n        const data = JSON.parse(message.data);\n        this._handleMessage(data);\n      } catch (error) {\n        console.warn(error);\n        return;\n      }\n    }\n\n    postMessage(event, payload) {\n      var msg = {\n        event: event,\n        payload: payload,\n        editorReference: this._editorReference_\n      }\n      window.parent.postMessage(msg, window.parent.location.href);\n    }\n\n    setupEventListener(type, callback) {\n      window.addEventListener(type, data => {\n        callback(data);\n      });\n    }\n\n    onInputValueChanged(newValue) {\n      if (newValue !== this.value) {\n        this.value = newValue;\n        this.editor.getModel().setValue(newValue);\n        this.postMessage(eventTypes.valueChanged, newValue);\n      }\n    } \n\n    onValueChanged(newValue) {\n      if (newValue !== this.value) {\n        this.value = newValue;\n        this.postMessage(eventTypes.valueChanged, newValue);\n      }\n    }\n\n    onLanguageChanged(newLang) {\n      monaco.editor.setModelLanguage(this.editor.getModel(), newLang);\n    }\n\n    onThemeChanged(newValue) {\n      monaco.editor.setTheme(newValue);\n    }\n  }\n\n  new MonacoEditor(\"").concat(this.editorReference, "\");");
          this.insertScriptElement({
            src: "".concat(this.libPath, "/loader.js"),
            onload: function onload() {
              _this5.insertScriptElement({
                text: iframeScript
              });

              _this5.insertStyle();
            }
          });
        }

        if (this.autofocus) this.iframe.focus();
      }
    }, {
      key: "handleMessage",
      value: function handleMessage(message) {
        try {
          var data = message.data;

          if (typeof message.data === "string") {
            data = JSON.parse(message.data);
          }

          this._handleMessage(data);
        } catch (error) {
          console.warn("[monaco-element] Error while parsing message:", error);
          return;
        }
      }
    }, {
      key: "_handleMessage",
      value: function _handleMessage(data) {
        // bail if we don't have a valid editor reference
        if (data.editorReference !== this.editorReference) return;

        if (data.event === this.eventTypes.valueChanged) {
          var evt = new CustomEvent("value-changed", {
            bubbles: true,
            cancelable: true,
            detail: data.payload
          });
          this.dispatchEvent(evt);
        } else if (data.event === this.eventTypes.ready) {
          this.onIFrameReady();
        } else if (data.event === this.eventTypes.focus) {
          this.onIFrameFocus();
        } else if (data.event === this.eventTypes.blur) {
          this.onIFrameBlur();
        }
      }
    }, {
      key: "onIFrameFocus",
      value: function onIFrameFocus() {
        this.dispatchEvent(new CustomEvent("code-editor-focus", {
          bubbles: true,
          composed: true,
          cancelable: true,
          detail: true
        }));
      }
    }, {
      key: "onIFrameBlur",
      value: function onIFrameBlur() {
        this.dispatchEvent(new CustomEvent("code-editor-blur", {
          bubbles: true,
          composed: true,
          cancelable: true,
          detail: true
        }));
      }
    }, {
      key: "onIFrameReady",
      value: function onIFrameReady() {
        var _this6 = this;

        this.monacoValueChanged(this.value);
        this.monacoLanguageChanged(this.language);
        this.monacoThemeChanged(this.theme); // fire when we're ready

        setTimeout(function () {
          _this6.dispatchEvent(new CustomEvent("monaco-element-ready", {
            bubbles: true,
            composed: true,
            cancelable: true,
            detail: true
          }));
        }, 100);
      }
    }, {
      key: "monacoValueChanged",
      value: function monacoValueChanged(value) {
        this.postMessage(this.eventTypes.valueChanged, value);
      }
    }, {
      key: "monacoLanguageChanged",
      value: function monacoLanguageChanged(value) {
        this.postMessage(this.eventTypes.languageChanged, value);
      }
    }, {
      key: "monacoThemeChanged",
      value: function monacoThemeChanged(value) {
        this.postMessage(this.eventTypes.themeChanged, value);
      }
    }, {
      key: "postMessage",
      value: function postMessage(event, payload) {
        if (!this.iframe) {
          return;
        }

        if (this.iframe.contentWindow != null) {
          this.iframe.contentWindow.postMessage(JSON.stringify({
            event: event,
            payload: payload
          }), window.location.href);
        }
      }
    }, {
      key: "insertScriptElement",
      value: function insertScriptElement(_ref) {
        var src = _ref.src,
            text = _ref.text,
            onload = _ref.onload;
        var ele = this.document.createElement("script");
        if (src) ele.src = src;
        if (text) ele.text = text;
        if (onload) ele.onload = onload;
        this.document.head.appendChild(ele);
      }
    }, {
      key: "insertStyle",
      value: function insertStyle() {
        var css = "\n    body {\n      height: 100vh;\n      overflow: hidden;\n      margin: 0;\n    }    \n    #container {\n      width: 100%;\n      height: 100%;\n    }\n    .debug-red {\n      background : red;\n    }\n    .debug-green {\n      background : green;\n    }\n    html,body {\n      margin : 0px;\n    }";
        var head = this.document.head;
        var style = this.document.createElement("style");
        style.type = "text/css";

        if (style.styleSheet) {
          style.styleSheet.cssText = css;
        } else {
          style.appendChild(this.document.createTextNode(css));
        }

        head.appendChild(style);
      }
    }, {
      key: "document",
      get: function get() {
        if (this.iframe.contentWindow) {
          return this.iframe.contentWindow.document;
        }
      }
    }], [{
      key: "properties",
      get: function get() {
        return {
          value: {
            type: String
          },
          fontSize: {
            type: Number,
            attribute: "font-size"
          },
          readOnly: {
            type: Boolean,
            attribute: "read-only"
          },

          /**
           * THIS MAKES MULTIPLES EDITORS WORK BECAUSE OF EVENTS
           * DO NOT MESS WITH THIS AND IT HAS TO BE SET
           */
          uniqueKey: {
            type: String,
            attribute: "unique-key"
          },
          eventTypes: {
            type: Object
          },
          language: {
            type: String
          },
          theme: {
            type: String
          },
          libPath: {
            type: String,
            attribute: "lib-path"
          },
          editorReference: {
            type: String,
            reflect: true,
            attribute: "editor-reference"
          },

          /**
           * automatically set focus on the iframe
           */
          autofocus: {
            type: Boolean,
            reflect: true
          },

          /**
           * hide line numbers
           */
          hideLineNumbers: {
            type: Boolean,
            attribute: "hide-line-numbers"
          },
          tabSize: {
            type: Number,
            attribute: "tab-size"
          }
        };
      }
    }]);
    return MonacoElement;
  }(_litElement.LitElement);

  _exports.MonacoElement = MonacoElement;
  window.customElements.define("monaco-element", MonacoElement);
  window.MonacoData = window.MonacoData || {};
});