!function(T){"object"==typeof exports&&"undefined"!=typeof module?module.exports=T():"function"==typeof define&&define.amd?define([],T):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PouchDB=T()}((function(){return function o(T,N,W){function c(z,G){if(!N[z]){if(!T[z]){var F="function"==typeof require&&require;if(!G&&F)return F(z,!0);if(U)return U(z,!0);var K=new Error("Cannot find module '"+z+"'");throw K.code="MODULE_NOT_FOUND",K}var J=N[z]={exports:{}};T[z][0].call(J.exports,(function(N){return c(T[z][1][N]||N)}),J,J.exports,o,T,N,W)}return N[z].exports}for(var U="function"==typeof require&&require,z=0;z<W.length;z++)c(W[z]);return c}({1:[function(T,N,W){"use strict";N.exports=function(T){return function(){var N=arguments.length;if(N){for(var W=[],U=-1;++U<N;)W[U]=arguments[U];return T.call(this,W)}return T.call(this,[])}}},{}],2:[function(T,N,W){var U=Object.create||function(T){var t=function(){};return t.prototype=T,new t},z=Object.keys||function(T){var N=[];for(var W in T)Object.prototype.hasOwnProperty.call(T,W)&&N.push(W);return W},G=Function.prototype.bind||function(T){var N=this;return function(){return N.apply(T,arguments)}};function r(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=U(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((N.exports=r).EventEmitter=r).prototype._events=void 0,r.prototype._maxListeners=void 0;var F,K=10;try{var J={};Object.defineProperty&&Object.defineProperty(J,"x",{value:0}),F=0===J.x}catch(T){F=!1}function f(T){return void 0===T._maxListeners?r.defaultMaxListeners:T._maxListeners}function l(T,N,W,z){var G,F,K;if("function"!=typeof W)throw new TypeError('"listener" argument must be a function');if((F=T._events)?(F.newListener&&(T.emit("newListener",N,W.listener?W.listener:W),F=T._events),K=F[N]):(F=T._events=U(null),T._eventsCount=0),K){if("function"==typeof K?K=F[N]=z?[W,K]:[K,W]:z?K.unshift(W):K.push(W),!K.warned&&(G=f(T))&&0<G&&K.length>G){K.warned=!0;var J=new Error("Possible EventEmitter memory leak detected. "+K.length+' "'+String(N)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');J.name="MaxListenersExceededWarning",J.emitter=T,J.type=N,J.count=K.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",J.name,J.message)}}else K=F[N]=W,++T._eventsCount;return T}function d(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var T=new Array(arguments.length),N=0;N<T.length;++N)T[N]=arguments[N];this.listener.apply(this.target,T)}}function h(T,N,W){var U={fired:!1,wrapFn:void 0,target:T,type:N,listener:W},z=G.call(d,U);return z.listener=W,U.wrapFn=z}function p(T,N,W){var U=T._events;if(!U)return[];var z=U[N];return z?"function"==typeof z?W?[z.listener||z]:[z]:W?function(T){for(var N=new Array(T.length),W=0;W<N.length;++W)N[W]=T[W].listener||T[W];return N}(z):y(z,z.length):[]}function v(T){var N=this._events;if(N){var W=N[T];if("function"==typeof W)return 1;if(W)return W.length}return 0}function y(T,N){for(var W=new Array(N),U=0;U<N;++U)W[U]=T[U];return W}F?Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return K},set:function(T){if("number"!=typeof T||T<0||T!=T)throw new TypeError('"defaultMaxListeners" must be a positive number');K=T}}):r.defaultMaxListeners=K,r.prototype.setMaxListeners=function(T){if("number"!=typeof T||T<0||isNaN(T))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=T,this},r.prototype.getMaxListeners=function(){return f(this)},r.prototype.emit=function(T){var N,W,U,z,G,F,K="error"===T;if(F=this._events)K=K&&null==F.error;else if(!K)return!1;if(K){if(1<arguments.length&&(N=arguments[1]),N instanceof Error)throw N;var J=new Error('Unhandled "error" event. ('+N+")");throw J.context=N,J}if(!(W=F[T]))return!1;var Q="function"==typeof W;switch(U=arguments.length){case 1:!function(T,N,W){if(N)T.call(W);else for(var U=T.length,z=y(T,U),G=0;G<U;++G)z[G].call(W)}(W,Q,this);break;case 2:!function(T,N,W,U){if(N)T.call(W,U);else for(var z=T.length,G=y(T,z),F=0;F<z;++F)G[F].call(W,U)}(W,Q,this,arguments[1]);break;case 3:!function(T,N,W,U,z){if(N)T.call(W,U,z);else for(var G=T.length,F=y(T,G),K=0;K<G;++K)F[K].call(W,U,z)}(W,Q,this,arguments[1],arguments[2]);break;case 4:!function(T,N,W,U,z,G){if(N)T.call(W,U,z,G);else for(var F=T.length,K=y(T,F),J=0;J<F;++J)K[J].call(W,U,z,G)}(W,Q,this,arguments[1],arguments[2],arguments[3]);break;default:for(z=new Array(U-1),G=1;G<U;G++)z[G-1]=arguments[G];!function(T,N,W,U){if(N)T.apply(W,U);else for(var z=T.length,G=y(T,z),F=0;F<z;++F)G[F].apply(W,U)}(W,Q,this,z)}return!0},r.prototype.on=r.prototype.addListener=function(T,N){return l(this,T,N,!1)},r.prototype.prependListener=function(T,N){return l(this,T,N,!0)},r.prototype.once=function(T,N){if("function"!=typeof N)throw new TypeError('"listener" argument must be a function');return this.on(T,h(this,T,N)),this},r.prototype.prependOnceListener=function(T,N){if("function"!=typeof N)throw new TypeError('"listener" argument must be a function');return this.prependListener(T,h(this,T,N)),this},r.prototype.removeListener=function(T,N){var W,z,G,F,K;if("function"!=typeof N)throw new TypeError('"listener" argument must be a function');if(!(z=this._events))return this;if(!(W=z[T]))return this;if(W===N||W.listener===N)0==--this._eventsCount?this._events=U(null):(delete z[T],z.removeListener&&this.emit("removeListener",T,W.listener||N));else if("function"!=typeof W){for(G=-1,F=W.length-1;0<=F;F--)if(W[F]===N||W[F].listener===N){K=W[F].listener,G=F;break}if(G<0)return this;0===G?W.shift():function(T,N){for(var W=N,U=W+1,z=T.length;U<z;W+=1,U+=1)T[W]=T[U];T.pop()}(W,G),1===W.length&&(z[T]=W[0]),z.removeListener&&this.emit("removeListener",T,K||N)}return this},r.prototype.removeAllListeners=function(T){var N,W,G;if(!(W=this._events))return this;if(!W.removeListener)return 0===arguments.length?(this._events=U(null),this._eventsCount=0):W[T]&&(0==--this._eventsCount?this._events=U(null):delete W[T]),this;if(0===arguments.length){var F,K=z(W);for(G=0;G<K.length;++G)"removeListener"!==(F=K[G])&&this.removeAllListeners(F);return this.removeAllListeners("removeListener"),this._events=U(null),this._eventsCount=0,this}if("function"==typeof(N=W[T]))this.removeListener(T,N);else if(N)for(G=N.length-1;0<=G;G--)this.removeListener(T,N[G]);return this},r.prototype.listeners=function(T){return p(this,T,!0)},r.prototype.rawListeners=function(T){return p(this,T,!1)},r.listenerCount=function(T,N){return"function"==typeof T.listenerCount?T.listenerCount(N):v.call(T,N)},r.prototype.listenerCount=v,r.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],3:[function(T,N,W){(function(T){"use strict";var W,U,z=T.MutationObserver||T.WebKitMutationObserver;if(z){var G=0,F=new z(c),K=T.document.createTextNode("");F.observe(K,{characterData:!0}),W=function(){K.data=G=++G%2}}else if(T.setImmediate||void 0===T.MessageChannel)W="document"in T&&"onreadystatechange"in T.document.createElement("script")?function(){var N=T.document.createElement("script");N.onreadystatechange=function(){c(),N.onreadystatechange=null,N.parentNode.removeChild(N),N=null},T.document.documentElement.appendChild(N)}:function(){setTimeout(c,0)};else{var J=new T.MessageChannel;J.port1.onmessage=c,W=function(){J.port2.postMessage(0)}}var Q=[];function c(){var T,N;U=!0;for(var W=Q.length;W;){for(N=Q,Q=[],T=-1;++T<W;)N[T]();W=Q.length}U=!1}N.exports=function(T){1!==Q.push(T)||U||W()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(T,N,W){"function"==typeof Object.create?N.exports=function(T,N){T.super_=N,T.prototype=Object.create(N.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}})}:N.exports=function(T,N){T.super_=N;var n=function(){};n.prototype=N.prototype,T.prototype=new n,T.prototype.constructor=T}},{}],5:[function(T,N,W){var U,z,G=N.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function u(N){if(U===setTimeout)return setTimeout(N,0);if((U===s||!U)&&setTimeout)return U=setTimeout,setTimeout(N,0);try{return U(N,0)}catch(T){try{return U.call(null,N,0)}catch(T){return U.call(this,N,0)}}}!function(){try{U="function"==typeof setTimeout?setTimeout:s}catch(T){U=s}try{z="function"==typeof clearTimeout?clearTimeout:a}catch(T){z=a}}();var F,K=[],J=!1,Q=-1;function h(){J&&F&&(J=!1,F.length?K=F.concat(K):Q=-1,K.length&&p())}function p(){if(!J){var T=u(h);J=!0;for(var N=K.length;N;){for(F=K,K=[];++Q<N;)F&&F[Q].run();Q=-1,N=K.length}F=null,J=!1,function(N){if(z===clearTimeout)return clearTimeout(N);if((z===a||!z)&&clearTimeout)return z=clearTimeout,clearTimeout(N);try{z(N)}catch(T){try{return z.call(null,N)}catch(T){return z.call(this,N)}}}(T)}}function v(T,N){this.fun=T,this.array=N}function y(){}G.nextTick=function(T){var N=new Array(arguments.length-1);if(1<arguments.length)for(var W=1;W<arguments.length;W++)N[W-1]=arguments[W];K.push(new v(T,N)),1!==K.length||J||u(p)},v.prototype.run=function(){this.fun.apply(null,this.array)},G.title="browser",G.browser=!0,G.env={},G.argv=[],G.version="",G.versions={},G.on=y,G.addListener=y,G.once=y,G.off=y,G.removeListener=y,G.removeAllListeners=y,G.emit=y,G.prependListener=y,G.prependOnceListener=y,G.listeners=function(T){return[]},G.binding=function(T){throw new Error("process.binding is not supported")},G.cwd=function(){return"/"},G.chdir=function(T){throw new Error("process.chdir is not supported")},G.umask=function(){return 0}},{}],6:[function(T,N,W){!function(T){if("object"==typeof W)N.exports=T();else{var U;try{U=window}catch(T){U=self}U.SparkMD5=T()}}((function(T){"use strict";var N=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function c(T,N){var W=T[0],U=T[1],z=T[2],G=T[3];U=((U+=((z=((z+=((G=((G+=((W=((W+=(U&z|~U&G)+N[0]-680876936|0)<<7|W>>>25)+U|0)&U|~W&z)+N[1]-389564586|0)<<12|G>>>20)+W|0)&W|~G&U)+N[2]+606105819|0)<<17|z>>>15)+G|0)&G|~z&W)+N[3]-1044525330|0)<<22|U>>>10)+z|0,U=((U+=((z=((z+=((G=((G+=((W=((W+=(U&z|~U&G)+N[4]-176418897|0)<<7|W>>>25)+U|0)&U|~W&z)+N[5]+1200080426|0)<<12|G>>>20)+W|0)&W|~G&U)+N[6]-1473231341|0)<<17|z>>>15)+G|0)&G|~z&W)+N[7]-45705983|0)<<22|U>>>10)+z|0,U=((U+=((z=((z+=((G=((G+=((W=((W+=(U&z|~U&G)+N[8]+1770035416|0)<<7|W>>>25)+U|0)&U|~W&z)+N[9]-1958414417|0)<<12|G>>>20)+W|0)&W|~G&U)+N[10]-42063|0)<<17|z>>>15)+G|0)&G|~z&W)+N[11]-1990404162|0)<<22|U>>>10)+z|0,U=((U+=((z=((z+=((G=((G+=((W=((W+=(U&z|~U&G)+N[12]+1804603682|0)<<7|W>>>25)+U|0)&U|~W&z)+N[13]-40341101|0)<<12|G>>>20)+W|0)&W|~G&U)+N[14]-1502002290|0)<<17|z>>>15)+G|0)&G|~z&W)+N[15]+1236535329|0)<<22|U>>>10)+z|0,U=((U+=((z=((z+=((G=((G+=((W=((W+=(U&G|z&~G)+N[1]-165796510|0)<<5|W>>>27)+U|0)&z|U&~z)+N[6]-1069501632|0)<<9|G>>>23)+W|0)&U|W&~U)+N[11]+643717713|0)<<14|z>>>18)+G|0)&W|G&~W)+N[0]-373897302|0)<<20|U>>>12)+z|0,U=((U+=((z=((z+=((G=((G+=((W=((W+=(U&G|z&~G)+N[5]-701558691|0)<<5|W>>>27)+U|0)&z|U&~z)+N[10]+38016083|0)<<9|G>>>23)+W|0)&U|W&~U)+N[15]-660478335|0)<<14|z>>>18)+G|0)&W|G&~W)+N[4]-405537848|0)<<20|U>>>12)+z|0,U=((U+=((z=((z+=((G=((G+=((W=((W+=(U&G|z&~G)+N[9]+568446438|0)<<5|W>>>27)+U|0)&z|U&~z)+N[14]-1019803690|0)<<9|G>>>23)+W|0)&U|W&~U)+N[3]-187363961|0)<<14|z>>>18)+G|0)&W|G&~W)+N[8]+1163531501|0)<<20|U>>>12)+z|0,U=((U+=((z=((z+=((G=((G+=((W=((W+=(U&G|z&~G)+N[13]-1444681467|0)<<5|W>>>27)+U|0)&z|U&~z)+N[2]-51403784|0)<<9|G>>>23)+W|0)&U|W&~U)+N[7]+1735328473|0)<<14|z>>>18)+G|0)&W|G&~W)+N[12]-1926607734|0)<<20|U>>>12)+z|0,U=((U+=((z=((z+=((G=((G+=((W=((W+=(U^z^G)+N[5]-378558|0)<<4|W>>>28)+U|0)^U^z)+N[8]-2022574463|0)<<11|G>>>21)+W|0)^W^U)+N[11]+1839030562|0)<<16|z>>>16)+G|0)^G^W)+N[14]-35309556|0)<<23|U>>>9)+z|0,U=((U+=((z=((z+=((G=((G+=((W=((W+=(U^z^G)+N[1]-1530992060|0)<<4|W>>>28)+U|0)^U^z)+N[4]+1272893353|0)<<11|G>>>21)+W|0)^W^U)+N[7]-155497632|0)<<16|z>>>16)+G|0)^G^W)+N[10]-1094730640|0)<<23|U>>>9)+z|0,U=((U+=((z=((z+=((G=((G+=((W=((W+=(U^z^G)+N[13]+681279174|0)<<4|W>>>28)+U|0)^U^z)+N[0]-358537222|0)<<11|G>>>21)+W|0)^W^U)+N[3]-722521979|0)<<16|z>>>16)+G|0)^G^W)+N[6]+76029189|0)<<23|U>>>9)+z|0,U=((U+=((z=((z+=((G=((G+=((W=((W+=(U^z^G)+N[9]-640364487|0)<<4|W>>>28)+U|0)^U^z)+N[12]-421815835|0)<<11|G>>>21)+W|0)^W^U)+N[15]+530742520|0)<<16|z>>>16)+G|0)^G^W)+N[2]-995338651|0)<<23|U>>>9)+z|0,U=((U+=((G=((G+=(U^((W=((W+=(z^(U|~G))+N[0]-198630844|0)<<6|W>>>26)+U|0)|~z))+N[7]+1126891415|0)<<10|G>>>22)+W|0)^((z=((z+=(W^(G|~U))+N[14]-1416354905|0)<<15|z>>>17)+G|0)|~W))+N[5]-57434055|0)<<21|U>>>11)+z|0,U=((U+=((G=((G+=(U^((W=((W+=(z^(U|~G))+N[12]+1700485571|0)<<6|W>>>26)+U|0)|~z))+N[3]-1894986606|0)<<10|G>>>22)+W|0)^((z=((z+=(W^(G|~U))+N[10]-1051523|0)<<15|z>>>17)+G|0)|~W))+N[1]-2054922799|0)<<21|U>>>11)+z|0,U=((U+=((G=((G+=(U^((W=((W+=(z^(U|~G))+N[8]+1873313359|0)<<6|W>>>26)+U|0)|~z))+N[15]-30611744|0)<<10|G>>>22)+W|0)^((z=((z+=(W^(G|~U))+N[6]-1560198380|0)<<15|z>>>17)+G|0)|~W))+N[13]+1309151649|0)<<21|U>>>11)+z|0,U=((U+=((G=((G+=(U^((W=((W+=(z^(U|~G))+N[4]-145523070|0)<<6|W>>>26)+U|0)|~z))+N[11]-1120210379|0)<<10|G>>>22)+W|0)^((z=((z+=(W^(G|~U))+N[2]+718787259|0)<<15|z>>>17)+G|0)|~W))+N[9]-343485551|0)<<21|U>>>11)+z|0,T[0]=W+T[0]|0,T[1]=U+T[1]|0,T[2]=z+T[2]|0,T[3]=G+T[3]|0}function l(T){var N,W=[];for(N=0;N<64;N+=4)W[N>>2]=T.charCodeAt(N)+(T.charCodeAt(N+1)<<8)+(T.charCodeAt(N+2)<<16)+(T.charCodeAt(N+3)<<24);return W}function d(T){var N,W=[];for(N=0;N<64;N+=4)W[N>>2]=T[N]+(T[N+1]<<8)+(T[N+2]<<16)+(T[N+3]<<24);return W}function i(T){var N,W,U,z,G,F,K=T.length,J=[1732584193,-271733879,-1732584194,271733878];for(N=64;N<=K;N+=64)c(J,l(T.substring(N-64,N)));for(W=(T=T.substring(N-64)).length,U=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],N=0;N<W;N+=1)U[N>>2]|=T.charCodeAt(N)<<(N%4<<3);if(U[N>>2]|=128<<(N%4<<3),55<N)for(c(J,U),N=0;N<16;N+=1)U[N]=0;return z=(z=8*K).toString(16).match(/(.*?)(.{0,8})$/),G=parseInt(z[2],16),F=parseInt(z[1],16)||0,U[14]=G,U[15]=F,c(J,U),J}function n(T){var W,U="";for(W=0;W<4;W+=1)U+=N[T>>8*W+4&15]+N[T>>8*W&15];return U}function s(T){var N;for(N=0;N<T.length;N+=1)T[N]=n(T[N]);return T.join("")}function o(T){return/[\u0080-\uFFFF]/.test(T)&&(T=unescape(encodeURIComponent(T))),T}function a(T){var N,W=[],U=T.length;for(N=0;N<U-1;N+=2)W.push(parseInt(T.substr(N,2),16));return String.fromCharCode.apply(String,W)}function u(){this.reset()}return s(i("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function c(T,N){return(T=0|T||0)<0?Math.max(T+N,0):Math.min(T,N)}ArrayBuffer.prototype.slice=function(N,W){var U,z,G,F,K=this.byteLength,J=c(N,K),Q=K;return W!==T&&(Q=c(W,K)),Q<J?new ArrayBuffer(0):(U=Q-J,z=new ArrayBuffer(U),G=new Uint8Array(z),F=new Uint8Array(this,J,U),G.set(F),z)}}(),u.prototype.append=function(T){return this.appendBinary(o(T)),this},u.prototype.appendBinary=function(T){this._buff+=T,this._length+=T.length;var N,W=this._buff.length;for(N=64;N<=W;N+=64)c(this._hash,l(this._buff.substring(N-64,N)));return this._buff=this._buff.substring(N-64),this},u.prototype.end=function(T){var N,W,U=this._buff,z=U.length,G=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(N=0;N<z;N+=1)G[N>>2]|=U.charCodeAt(N)<<(N%4<<3);return this._finish(G,z),W=s(this._hash),T&&(W=a(W)),this.reset(),W},u.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},u.prototype.setState=function(T){return this._buff=T.buff,this._length=T.length,this._hash=T.hash,this},u.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},u.prototype._finish=function(T,N){var W,U,z,G=N;if(T[G>>2]|=128<<(G%4<<3),55<G)for(c(this._hash,T),G=0;G<16;G+=1)T[G]=0;W=(W=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),U=parseInt(W[2],16),z=parseInt(W[1],16)||0,T[14]=U,T[15]=z,c(this._hash,T)},u.hash=function(T,N){return u.hashBinary(o(T),N)},u.hashBinary=function(T,N){var W=s(i(T));return N?a(W):W},(u.ArrayBuffer=function(){this.reset()}).prototype.append=function(T){var N,W,U,z,G=(W=this._buff.buffer,U=T,!0,(z=new Uint8Array(W.byteLength+U.byteLength)).set(new Uint8Array(W)),z.set(new Uint8Array(U),W.byteLength),z),F=G.length;for(this._length+=T.byteLength,N=64;N<=F;N+=64)c(this._hash,d(G.subarray(N-64,N)));return this._buff=N-64<F?new Uint8Array(G.buffer.slice(N-64)):new Uint8Array(0),this},u.ArrayBuffer.prototype.end=function(T){var N,W,U=this._buff,z=U.length,G=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(N=0;N<z;N+=1)G[N>>2]|=U[N]<<(N%4<<3);return this._finish(G,z),W=s(this._hash),T&&(W=a(W)),this.reset(),W},u.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.ArrayBuffer.prototype.getState=function(){var T,N=u.prototype.getState.call(this);return N.buff=(T=N.buff,String.fromCharCode.apply(null,new Uint8Array(T))),N},u.ArrayBuffer.prototype.setState=function(T){return T.buff=function(T,N){var W,U=T.length,z=new ArrayBuffer(U),G=new Uint8Array(z);for(W=0;W<U;W+=1)G[W]=T.charCodeAt(W);return G}(T.buff),u.prototype.setState.call(this,T)},u.ArrayBuffer.prototype.destroy=u.prototype.destroy,u.ArrayBuffer.prototype._finish=u.prototype._finish,u.ArrayBuffer.hash=function(T,N){var W=s(function(T){var N,W,U,z,G,F,K=T.length,J=[1732584193,-271733879,-1732584194,271733878];for(N=64;N<=K;N+=64)c(J,d(T.subarray(N-64,N)));for(W=(T=N-64<K?T.subarray(N-64):new Uint8Array(0)).length,U=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],N=0;N<W;N+=1)U[N>>2]|=T[N]<<(N%4<<3);if(U[N>>2]|=128<<(N%4<<3),55<N)for(c(J,U),N=0;N<16;N+=1)U[N]=0;return z=(z=8*K).toString(16).match(/(.*?)(.{0,8})$/),G=parseInt(z[2],16),F=parseInt(z[1],16)||0,U[14]=G,U[15]=F,c(J,U),J}(new Uint8Array(T)));return N?a(W):W},u}))},{}],7:[function(T,N,W){var U=T(10),z=T(11),G=z;G.v1=U,G.v4=z,N.exports=G},{10:10,11:11}],8:[function(T,N,W){for(var U=[],z=0;z<256;++z)U[z]=(z+256).toString(16).substr(1);N.exports=function(T,N){var W=N||0,z=U;return z[T[W++]]+z[T[W++]]+z[T[W++]]+z[T[W++]]+"-"+z[T[W++]]+z[T[W++]]+"-"+z[T[W++]]+z[T[W++]]+"-"+z[T[W++]]+z[T[W++]]+"-"+z[T[W++]]+z[T[W++]]+z[T[W++]]+z[T[W++]]+z[T[W++]]+z[T[W++]]}},{}],9:[function(T,N,W){var U="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(U){var z=new Uint8Array(16);N.exports=function(){return U(z),z}}else{var G=new Array(16);N.exports=function(){for(var T,N=0;N<16;N++)0==(3&N)&&(T=4294967296*Math.random()),G[N]=T>>>((3&N)<<3)&255;return G}}},{}],10:[function(T,N,W){var U,z,G=T(9),F=T(8),K=0,J=0;N.exports=function(T,N,W){var Q=N&&W||0,V=N||[],ie=(T=T||{}).node||U,oe=void 0!==T.clockseq?T.clockseq:z;if(null==ie||null==oe){var se=G();null==ie&&(ie=U=[1|se[0],se[1],se[2],se[3],se[4],se[5]]),null==oe&&(oe=z=16383&(se[6]<<8|se[7]))}var ae=void 0!==T.msecs?T.msecs:(new Date).getTime(),me=void 0!==T.nsecs?T.nsecs:J+1,be=ae-K+(me-J)/1e4;if(be<0&&void 0===T.clockseq&&(oe=oe+1&16383),(be<0||K<ae)&&void 0===T.nsecs&&(me=0),1e4<=me)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");K=ae,z=oe;var Ae=(1e4*(268435455&(ae+=122192928e5))+(J=me))%4294967296;V[Q++]=Ae>>>24&255,V[Q++]=Ae>>>16&255,V[Q++]=Ae>>>8&255,V[Q++]=255&Ae;var Ye=ae/4294967296*1e4&268435455;V[Q++]=Ye>>>8&255,V[Q++]=255&Ye,V[Q++]=Ye>>>24&15|16,V[Q++]=Ye>>>16&255,V[Q++]=oe>>>8|128,V[Q++]=255&oe;for(var Ze=0;Ze<6;++Ze)V[Q+Ze]=ie[Ze];return N||F(V)}},{8:8,9:9}],11:[function(T,N,W){var U=T(9),z=T(8);N.exports=function(T,N,W){var G=N&&W||0;"string"==typeof T&&(N="binary"===T?new Array(16):null,T=null);var F=(T=T||{}).random||(T.rng||U)();if(F[6]=15&F[6]|64,F[8]=63&F[8]|128,N)for(var K=0;K<16;++K)N[G+K]=F[K];return N||z(F)}},{8:8,9:9}],12:[function(T,N,W){"use strict";function h(T,N,W){var U=W[W.length-1];T===U.element&&(W.pop(),U=W[W.length-1]);var z=U.element,G=U.index;Array.isArray(z)?z.push(T):G===N.length-2?z[N.pop()]=T:N.push(T)}W.stringify=function(T){var N=[];N.push({obj:T});for(var W,U,z,G,F,K,J,Q,V,ie,oe="";W=N.pop();)if(U=W.obj,oe+=W.prefix||"",z=W.val||"")oe+=z;else if("object"!=typeof U)oe+=void 0===U?null:JSON.stringify(U);else if(null===U)oe+="null";else if(Array.isArray(U)){for(N.push({val:"]"}),G=U.length-1;0<=G;G--)F=0===G?"":",",N.push({obj:U[G],prefix:F});N.push({val:"["})}else{for(J in K=[],U)U.hasOwnProperty(J)&&K.push(J);for(N.push({val:"}"}),G=K.length-1;0<=G;G--)V=U[Q=K[G]],ie=0<G?",":"",ie+=JSON.stringify(Q)+":",N.push({obj:V,prefix:ie});N.push({val:"{"})}return oe},W.parse=function(T){for(var N,W,U,z,G,F,K,J,Q,V=[],ie=[],oe=0;;)if("}"!==(N=T[oe++])&&"]"!==N&&void 0!==N)switch(N){case" ":case"\t":case"\n":case":":case",":break;case"n":oe+=3,h(null,V,ie);break;case"t":oe+=3,h(!0,V,ie);break;case"f":oe+=4,h(!1,V,ie);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(W="",oe--;;){if(U=T[oe++],!/[\d\.\-e\+]/.test(U)){oe--;break}W+=U}h(parseFloat(W),V,ie);break;case'"':for(z="",G=void 0,F=0;'"'!==(K=T[oe++])||"\\"===G&&F%2==1;)z+=K,"\\"===(G=K)?F++:F=0;h(JSON.parse('"'+z+'"'),V,ie);break;case"[":J={element:[],index:V.length},V.push(J.element),ie.push(J);break;case"{":Q={element:{},index:V.length},V.push(Q.element),ie.push(Q);break;default:throw new Error("unexpectedly reached end of input: "+N)}else{if(1===V.length)return V.pop();h(V.pop(),V,ie)}}},{}],13:[function(T,N,W){(function(W,U){"use strict";function t(T){return T&&"object"==typeof T&&"default"in T?T.default:T}var z=t(T(1)),G=t(T(3)),F=T(2),K=t(T(4)),J=t(T(6)),Q=t(T(7)),V=t(T(12));var ie,oe,se=Function.prototype.toString,ae=se.call(Object);function R(T){var N,W,U,z;if(!T||"object"!=typeof T)return T;if(Array.isArray(T)){for(N=[],W=0,U=T.length;W<U;W++)N[W]=R(T[W]);return N}if(T instanceof Date)return T.toISOString();if(z=T,"undefined"!=typeof ArrayBuffer&&z instanceof ArrayBuffer||"undefined"!=typeof Blob&&z instanceof Blob)return function s(T){if(T instanceof ArrayBuffer)return function(T){if("function"==typeof T.slice)return T.slice(0);var N=new ArrayBuffer(T.byteLength),W=new Uint8Array(N),U=new Uint8Array(T);return W.set(U),N}(T);var N=T.size,W=T.type;return"function"==typeof T.slice?T.slice(0,N,W):T.webkitSlice(0,N,W)}(T);if(!function(T){var N=Object.getPrototypeOf(T);if(null===N)return!0;var W=N.constructor;return"function"==typeof W&&W instanceof W&&se.call(W)==ae}(T))return T;for(W in N={},T)if(Object.prototype.hasOwnProperty.call(T,W)){var G=R(T[W]);void 0!==G&&(N[W]=G)}return N}function l(T){var N=!1;return z((function(W){if(N)throw new Error("once called more than once");N=!0,T.apply(this,W)}))}function v(T){return z((function(N){N=R(N);var W=this,U="function"==typeof N[N.length-1]&&N.pop(),z=new Promise((function(U,z){var G;try{var F=l((function(T,N){T?z(T):U(N)}));N.push(F),(G=T.apply(W,N))&&"function"==typeof G.then&&U(G)}catch(G){z(G)}}));return U&&z.then((function(T){U(null,T)}),U),z}))}function h(T,N){return v(z((function(W){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var U=this;return function(T,N,W){if(T.constructor.listeners("debug").length){for(var U=["api",T.name,N],z=0;z<W.length-1;z++)U.push(W[z]);T.constructor.emit("debug",U);var G=W[W.length-1];W[W.length-1]=function(W,U){var z=["api",T.name,N];z=z.concat(W?["error",W]:["success",U]),T.constructor.emit("debug",z),G(W,U)}}}(U,T,W),this.taskqueue.isReady?N.apply(this,W):new Promise((function(N,z){U.taskqueue.addTask((function(G){G?z(G):N(U[T].apply(U,W))}))}))})))}function p(T){return"$"+T}function y(){this._store={}}function n(T){if(this._store=new y,T&&Array.isArray(T))for(var N=0,W=T.length;N<W;N++)this.add(T[N])}function m(T,N){for(var W={},U=0,z=N.length;U<z;U++){var G=N[U];G in T&&(W[G]=T[G])}return W}y.prototype.get=function(T){var N=p(T);return this._store[N]},y.prototype.set=function(T,N){var W=p(T);return this._store[W]=N,!0},y.prototype.has=function(T){return p(T)in this._store},y.prototype.delete=function(T){var N=p(T),W=N in this._store;return delete this._store[N],W},y.prototype.forEach=function(T){for(var N=Object.keys(this._store),W=0,U=N.length;W<U;W++){var z=N[W];T(this._store[z],z=z.substring(1))}},Object.defineProperty(y.prototype,"size",{get:function(){return Object.keys(this._store).length}}),n.prototype.add=function(T){return this._store.set(T,!0)},n.prototype.has=function(T){return this._store.has(T)},n.prototype.forEach=function(T){this._store.forEach((function(N,W){T(W)}))},Object.defineProperty(n.prototype,"size",{get:function(){return this._store.size}}),function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var T=Object.getOwnPropertyDescriptor(Map,Symbol.species);return T&&"get"in T&&Map[Symbol.species]===Map}()?(ie=Set,oe=Map):(ie=n,oe=y);var me;function b(T){return T}function w(T){return[{ok:T}]}function k(T,N,W){var U=N.docs,z=new oe;U.forEach((function(T){z.has(T.id)?z.get(T.id).push(T):z.set(T.id,[T])}));var G=z.size,F=0,K=new Array(G);function l(){var T;++F===G&&(T=[],K.forEach((function(N){N.docs.forEach((function(W){T.push({id:N.id,docs:[W]})}))})),W(null,{results:T}))}var J=[];z.forEach((function(T,N){J.push(N)}));var Q=0;!function d(){if(!(Q>=J.length)){var W,U=Math.min(Q+6,J.length),G=J.slice(Q,U);W=Q,G.forEach((function(U,G){var F=W+G,J=z.get(U),Q=m(J[0],["atts_since","attachments"]);Q.open_revs=J.map((function(T){return T.rev})),Q.open_revs=Q.open_revs.filter(b);var V=b;0===Q.open_revs.length&&(delete Q.open_revs,V=w),["revs","attachments","binary","ajax","latest"].forEach((function(T){T in N&&(Q[T]=N[T])})),T.get(U,Q,(function(T,N){var W,z,G;W=T?[{error:T}]:V(N),z=U,G=W,K[F]={id:z,docs:G},l(),d()}))})),Q+=G.length}}()}try{localStorage.setItem("_pouch_check_localstorage",1),me=!!localStorage.getItem("_pouch_check_localstorage")}catch(U){me=!1}function j(){return me}function A(){var T;F.EventEmitter.call(this),this._listeners={},T=this,j()&&addEventListener("storage",(function(N){T.emit(N.key)}))}function E(T){if("undefined"!=typeof console&&"function"==typeof console[T]){var N=Array.prototype.slice.call(arguments,1);console[T].apply(console,N)}}function M(T){var N,W,U=0;return T||(U=2e3),N=T,W=U,N=parseInt(N,10)||0,(W=parseInt(W,10))!=W||W<=N?W=(N||1)<<1:W+=1,6e5<W&&(N=3e5,W=6e5),~~((W-N)*Math.random()+N)}function S(T,N){E("info","The above "+T+" is totally normal. "+N)}K(A,F.EventEmitter),A.prototype.addListener=function(T,N,W,U){if(!this._listeners[N]){var z=this,F=!1;this._listeners[N]=s,this.on(T,s)}function s(){if(z._listeners[N])if(F)F="waiting";else{F=!0;var T=m(U,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);W.changes(T).on("change",(function(T){T.seq>U.since&&!U.cancelled&&(U.since=T.seq,U.onChange(T))})).on("complete",(function(){"waiting"===F&&G(s),F=!1})).on("error",(function(){F=!1}))}}},A.prototype.removeListener=function(T,N){N in this._listeners&&(F.EventEmitter.prototype.removeListener.call(this,T,this._listeners[N]),delete this._listeners[N])},A.prototype.notifyLocalWindows=function(T){j()&&(localStorage[T]="a"===localStorage[T]?"b":"a")},A.prototype.notify=function(T){this.emit(T),this.notifyLocalWindows(T)};var be="function"==typeof Object.assign?Object.assign:function(T){for(var N=Object(T),W=1;W<arguments.length;W++){var U=arguments[W];if(null!=U)for(var z in U)Object.prototype.hasOwnProperty.call(U,z)&&(N[z]=U[z])}return N};function P(T,N,W){Error.call(this,W),this.status=T,this.name=N,this.message=W,this.error=!0}K(P,Error),P.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})},new P(401,"unauthorized","Name or password is incorrect.");var Ae=new P(400,"bad_request","Missing JSON list of 'docs'"),Ye=new P(404,"not_found","missing"),Ze=new P(409,"conflict","Document update conflict"),He=new P(400,"bad_request","_id field must contain a string"),Xe=new P(412,"missing_id","_id is required for puts"),nt=new P(400,"bad_request","Only reserved document ids may start with underscore."),st=(new P(412,"precondition_failed","Database not open"),new P(500,"unknown_error","Database encountered an unknown error")),at=new P(500,"badarg","Some query argument is invalid"),ut=(new P(400,"invalid_request","Request was invalid"),new P(400,"query_parse_error","Some query parameter is invalid")),kt=new P(500,"doc_validation","Bad special document member"),xt=new P(400,"bad_request","Something wrong with the request"),Ct=new P(400,"bad_request","Document must be a JSON object"),Rt=(new P(404,"not_found","Database not found"),new P(500,"indexed_db_went_bad","unknown")),Tt=(new P(500,"web_sql_went_bad","unknown"),new P(500,"levelDB_went_went_bad","unknown"),new P(403,"forbidden","Forbidden by design doc validate_doc_update function"),new P(400,"bad_request","Invalid rev format")),Nt=(new P(412,"file_exists","The database could not be created, the file already exists."),new P(412,"missing_stub","A pre-existing attachment stub wasn't found"));function Y(T,N){function t(N){for(var W in T)"function"!=typeof T[W]&&(this[W]=T[W]);void 0!==N&&(this.reason=N)}return t.prototype=P.prototype,new t(N)}function H(T){if("object"!=typeof T){var N=T;(T=st).data=N}return"error"in T&&"conflict"===T.error&&(T.name="conflict",T.status=409),"name"in T||(T.name=T.error||"unknown"),"status"in T||(T.status=500),"message"in T||(T.message=T.message||T.reason),T}function X(T){var N={},W=T.filter&&"function"==typeof T.filter;return N.query=T.query_params,function(U){U.doc||(U.doc={});var z=W&&function(T,N,W){try{return!T(N,W)}catch(T){var U="Filter function threw: "+T.toString();return Y(xt,U)}}(T.filter,U.doc,N);if("object"==typeof z)return z;if(z)return!1;if(T.include_docs){if(!T.attachments)for(var G in U.doc._attachments)U.doc._attachments.hasOwnProperty(G)&&(U.doc._attachments[G].stub=!0)}else delete U.doc;return!0}}function Z(T){for(var N=[],W=0,U=T.length;W<U;W++)N=N.concat(T[W]);return N}function ee(T){var N;if(T?"string"!=typeof T?N=Y(He):/^_/.test(T)&&!/^_(design|local)/.test(T)&&(N=Y(nt)):N=Y(Xe),N)throw N}function te(T){return"boolean"==typeof T._remote?T._remote:"function"==typeof T.type&&(E("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===T.type())}function ne(T){if(!T)return null;var N=T.split("/");return 2===N.length?N:1===N.length?[T,T]:null}function re(T){var N=ne(T);return N?N.join("/"):null}new P(413,"invalid_url","Provided URL is invalid");var Mt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Ut="queryKey",Ft=/(?:^|&)([^&=]*)=?([^&]*)/g,Kt=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function ue(T){for(var N=Kt.exec(T),W={},U=14;U--;){var z=Mt[U],G=N[U]||"",F=-1!==["user","password"].indexOf(z);W[z]=F?decodeURIComponent(G):G}return W[Ut]={},W[Mt[12]].replace(Ft,(function(T,N,U){N&&(W[Ut][N]=U)})),W}function ce(T,N){var W=[],U=[];for(var z in N)N.hasOwnProperty(z)&&(W.push(z),U.push(N[z]));return W.push(T),Function.apply(null,W).apply(null,U)}function fe(T,N,W){return new Promise((function(U,z){T.get(N,(function(G,F){if(G){if(404!==G.status)return z(G);F={}}var K,J,Q,V=F._rev,ie=W(F);if(!ie)return U({updated:!1,rev:V});ie._id=N,ie._rev=V,U((J=ie,Q=W,(K=T).put(J).then((function(T){return{updated:!0,rev:T.rev}}),(function(T){if(409!==T.status)throw T;return fe(K,J._id,Q)}))))}))}))}var le=function(T){return atob(T)},de=function(T){return btoa(T)};function he(T,N){T=T||[],N=N||{};try{return new Blob(T,N)}catch(U){if("TypeError"!==U.name)throw U;for(var W=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),z=0;z<T.length;z+=1)W.append(T[z]);return W.getBlob(N.type)}}function pe(T,N){return he([function(T){for(var N=T.length,W=new ArrayBuffer(N),U=new Uint8Array(W),z=0;z<N;z++)U[z]=T.charCodeAt(z);return W}(T)],{type:N})}function ve(T,N){return pe(le(T),N)}function ye(T,N){var W=new FileReader,U="function"==typeof W.readAsBinaryString;W.onloadend=function(T){var W=T.target.result||"";if(U)return N(W);N(function(T){for(var N="",W=new Uint8Array(T),U=W.byteLength,z=0;z<U;z++)N+=String.fromCharCode(W[z]);return N}(W))},U?W.readAsBinaryString(T):W.readAsArrayBuffer(T)}function _e(T,N){ye(T,(function(T){N(T)}))}function ge(T,N){_e(T,(function(T){N(de(T))}))}var Jt=U.setImmediate||U.setTimeout;function we(T,N,W,U,z){var G,F,K,J,Q,V;(0<W||U<N.size)&&(F=W,K=U,N=(G=N).webkitSlice?G.webkitSlice(F,K):G.slice(F,K)),J=N,Q=function(N){T.append(N),z()},(V=new FileReader).onloadend=function(T){var N=T.target.result||new ArrayBuffer(0);Q(N)},V.readAsArrayBuffer(J)}function ke(T,N,W,U,z){(0<W||U<N.length)&&(N=N.substring(W,U)),T.appendBinary(N),z()}function je(T,N){var W="string"==typeof T,U=W?T.length:T.size,z=Math.min(32768,U),G=Math.ceil(U/z),F=0,K=W?new J:new J.ArrayBuffer,Q=W?ke:we;function c(){Jt(l)}function f(){var T=K.end(!0),W=de(T);N(W),K.destroy()}function l(){var N=F*z;Q(K,T,N,N+z,++F<G?c:f)}l()}function Oe(T){return J.hash(T)}function qe(T,N){var W=R(T);return N?(delete W._rev_tree,Oe(JSON.stringify(W))):Q.v4().replace(/-/g,"").toLowerCase()}var en=Q.v4;function Ee(T){for(var N,W,U,z,G=T.rev_tree.slice();z=G.pop();){var F=z.ids,K=F[2],J=z.pos;if(K.length)for(var Q=0,V=K.length;Q<V;Q++)G.push({pos:J+1,ids:K[Q]});else{var ie=!!F[1].deleted,oe=F[0];N&&!(U!==ie?U:W!==J?W<J:N<oe)||(N=oe,W=J,U=ie)}}return W+"-"+N}function Se(T,N){for(var W,U=T.slice();W=U.pop();)for(var z=W.pos,G=W.ids,F=G[2],K=N(0===F.length,z,G[0],W.ctx,G[1]),J=0,Q=F.length;J<Q;J++)U.push({pos:z+1,ids:F[J],ctx:K})}function xe(T,N){return T.pos-N.pos}function Ce(T){var N=[];Se(T,(function(T,W,U,z,G){T&&N.push({rev:W+"-"+U,pos:W,opts:G})})),N.sort(xe).reverse();for(var W=0,U=N.length;W<U;W++)delete N[W].pos;return N}function Pe(T){for(var N=Ee(T),W=Ce(T.rev_tree),U=[],z=0,G=W.length;z<G;z++){var F=W[z];F.rev===N||F.opts.deleted||U.push(F.rev)}return U}function Le(T){for(var N,W=[],U=T.slice();N=U.pop();){var z=N.pos,G=N.ids,F=G[0],K=G[1],J=G[2],Q=0===J.length,V=N.history?N.history.slice():[];V.push({id:F,opts:K}),Q&&W.push({pos:z+1-V.length,ids:V});for(var ie=0,oe=J.length;ie<oe;ie++)U.push({pos:z+1,ids:J[ie],history:V})}return W.reverse()}function De(T,N){return T.pos-N.pos}function $e(T,N){for(var W,U,z=N,G=T.length;z<G;z++){var F=T[z],K=[F.id,F.opts,[]];U?(U[2].push(K),U=K):W=U=K}return W}function Ie(T,N){return T[0]<N[0]?-1:1}function Be(T,N){for(var W,U,z,G=[{tree1:T,tree2:N}],F=!1;0<G.length;){var K=G.pop(),J=K.tree1,Q=K.tree2;(J[1].status||Q[1].status)&&(J[1].status="available"===J[1].status||"available"===Q[1].status?"available":"missing");for(var V=0;V<Q[2].length;V++)if(J[2][0]){for(var ie=!1,oe=0;oe<J[2].length;oe++)J[2][oe][0]===Q[2][V][0]&&(G.push({tree1:J[2][oe],tree2:Q[2][V]}),ie=!0);ie||(F="new_branch",z=function(T,N,W){for(var U,z=0,G=T.length;z<G;)W(T[U=z+G>>>1],N)<0?z=U+1:G=U;return z}(W=J[2],U=Q[2][V],Ie),W.splice(z,0,U))}else F="new_leaf",J[2][0]=Q[2][V]}return{conflicts:F,tree:T}}function Te(T,N,W){var U,z=[],G=!1,F=!1;if(!T.length)return{tree:[N],conflicts:"new_leaf"};for(var K=0,J=T.length;K<J;K++){var Q=T[K];if(Q.pos===N.pos&&Q.ids[0]===N.ids[0])U=Be(Q.ids,N.ids),z.push({pos:Q.pos,ids:U.tree}),G=G||U.conflicts,F=!0;else if(!0!==W){var V=Q.pos<N.pos?Q:N,ie=Q.pos<N.pos?N:Q,oe=ie.pos-V.pos,se=[],ae=[];for(ae.push({ids:V.ids,diff:oe,parent:null,parentIdx:null});0<ae.length;){var me=ae.pop();if(0!==me.diff)for(var be=me.ids[2],Ae=0,Ye=be.length;Ae<Ye;Ae++)ae.push({ids:be[Ae],diff:me.diff-1,parent:me.ids,parentIdx:Ae});else me.ids[0]===ie.ids[0]&&se.push(me)}var Ze=se[0];Ze?(U=Be(Ze.ids,ie.ids),Ze.parent[2][Ze.parentIdx]=U.tree,z.push({pos:V.pos,ids:V.ids}),G=G||U.conflicts,F=!0):z.push(Q)}else z.push(Q)}return F||z.push(N),z.sort(De),{tree:z,conflicts:G||"internal_node"}}function Re(T,N,W){var U=Te(T,N),z=function(T,N){for(var W,U,z=Le(T),G=0,F=z.length;G<F;G++){var K,J=z[G],Q=J.ids;if(Q.length>N){W||(W={});var V=Q.length-N;K={pos:J.pos+V,ids:$e(Q,V)};for(var ie=0;ie<V;ie++){var oe=J.pos+ie+"-"+Q[ie].id;W[oe]=!0}}else K={pos:J.pos,ids:$e(Q,0)};U=U?Te(U,K,!0).tree:[K]}return W&&Se(U,(function(T,N,U){delete W[N+"-"+U]})),{tree:U,revs:W?Object.keys(W):[]}}(U.tree,W);return{tree:z.tree,stemmedRevs:z.revs,conflicts:U.conflicts}}function Me(T){return T.ids}function Ne(T,N){N||(N=Ee(T));for(var W,U=N.substring(N.indexOf("-")+1),z=T.rev_tree.map(Me);W=z.pop();){if(W[0]===U)return!!W[1].deleted;z=z.concat(W[2])}}function Ue(T){return/^_local/.test(T)}function Fe(T,N,W){F.EventEmitter.call(this);var U=this;this.db=T;var z=(N=N?R(N):{}).complete=l((function(N,W){var z,G;N?(G="error",0<("listenerCount"in(z=U)?z.listenerCount(G):F.EventEmitter.listenerCount(z,G))&&U.emit("error",N)):U.emit("complete",W),U.removeAllListeners(),T.removeListener("destroyed",s)}));function s(){U.cancel()}W&&(U.on("complete",(function(T){W(null,T)})),U.on("error",W)),T.once("destroyed",s),N.onChange=function(T,N,W){U.isCancelled||function(T,N,W,U){try{T.emit("change",N,W,U)}catch(T){E("error",'Error in .on("change", function):',T)}}(U,T,N,W)};var G=new Promise((function(T,W){N.complete=function(N,U){N?W(N):T(U)}}));U.once("cancel",(function(){T.removeListener("destroyed",s),N.complete(null,{status:"cancelled"})})),this.then=G.then.bind(G),this.catch=G.catch.bind(G),this.then((function(T){z(null,T)}),z),T.taskqueue.isReady?U.validateChanges(N):T.taskqueue.addTask((function(T){T?N.complete(T):U.isCancelled?U.emit("cancel"):U.validateChanges(N)}))}function Ke(T,N,W){var U=[{rev:T._rev}];"all_docs"===W.style&&(U=Ce(N.rev_tree).map((function(T){return{rev:T.rev}})));var z={id:N.id,changes:U,doc:T};return Ne(N,T._rev)&&(z.deleted=!0),W.conflicts&&(z.doc._conflicts=Pe(N),z.doc._conflicts.length||delete z.doc._conflicts),z}function Je(T,N){return T<N?-1:N<T?1:0}function ze(T,N){return function(W,U){W||U[0]&&U[0].error?((W=W||U[0]).docId=N,T(W)):T(null,U.length?U[0]:U)}}function Ve(T,N){var W=Je(T._id,N._id);return 0!==W?W:Je(T._revisions?T._revisions.start:0,N._revisions?N._revisions.start:0)}function Ge(){for(var T in F.EventEmitter.call(this),Ge.prototype)"function"==typeof this[T]&&(this[T]=this[T].bind(this))}function Qe(){this.isReady=!1,this.failed=!1,this.queue=[]}function We(T,N){if(!(this instanceof We))return new We(T,N);var W=this;if(N=N||{},T&&"object"==typeof T&&(T=(N=T).name,delete N.name),void 0===N.deterministic_revs&&(N.deterministic_revs=!0),this.__opts=N=R(N),W.auto_compaction=N.auto_compaction,W.prefix=We.prefix,"string"!=typeof T)throw new Error("Missing/invalid DB name");var U=function(T,N){var W=T.match(/([a-z-]*):\/\/(.*)/);if(W)return{name:/https?/.test(W[1])?W[1]+"://"+W[2]:W[2],adapter:W[1]};var U=We.adapters,z=We.preferredAdapters,G=We.prefix,F=N.adapter;if(!F)for(var K=0;K<z.length&&"idb"===(F=z[K])&&"websql"in U&&j()&&localStorage["_pouch__websqldb_"+G+T];++K)E("log",'PouchDB is downgrading "'+T+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');var J=U[F];return{name:J&&"use_prefix"in J&&!J.use_prefix?T:G+T,adapter:F}}((N.prefix||"")+T,N);if(N.name=U.name,N.adapter=N.adapter||U.adapter,W.name=T,W._adapter=N.adapter,We.emit("debug",["adapter","Picked adapter: ",N.adapter]),!We.adapters[N.adapter]||!We.adapters[N.adapter].valid())throw new Error("Invalid Adapter: "+N.adapter);Ge.call(W),W.taskqueue=new Qe,W.adapter=N.adapter,We.adapters[N.adapter].call(W,N,(function(T){if(T)return W.taskqueue.fail(T);!function(T){function e(N){T.removeListener("closed",n),N||T.constructor.emit("destroyed",T.name)}function n(){T.removeListener("destroyed",e),T.constructor.emit("unref",T)}T.once("destroyed",e),T.once("closed",n),T.constructor.emit("ref",T)}(W),W.emit("created",W),We.emit("created",W.name),W.taskqueue.ready(W)}))}K(Fe,F.EventEmitter),Fe.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},Fe.prototype.validateChanges=function(T){var N=T.complete,W=this;We._changesFilterPlugin?We._changesFilterPlugin.validate(T,(function(U){if(U)return N(U);W.doChanges(T)})):W.doChanges(T)},Fe.prototype.doChanges=function(T){var N=this,W=T.complete;if("live"in(T=R(T))&&!("continuous"in T)&&(T.continuous=T.live),T.processChange=Ke,"latest"===T.since&&(T.since="now"),T.since||(T.since=0),"now"!==T.since){if(We._changesFilterPlugin){if(We._changesFilterPlugin.normalize(T),We._changesFilterPlugin.shouldFilter(this,T))return We._changesFilterPlugin.filter(this,T)}else["doc_ids","filter","selector","view"].forEach((function(N){N in T&&E("warn",'The "'+N+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')}));"descending"in T||(T.descending=!1),T.limit=0===T.limit?1:T.limit,T.complete=W;var U=this.db._changes(T);if(U&&"function"==typeof U.cancel){var G=N.cancel;N.cancel=z((function(T){U.cancel(),G.apply(this,T)}))}}else this.db.info().then((function(U){N.isCancelled?W(null,{status:"cancelled"}):(T.since=U.update_seq,N.doChanges(T))}),W)},K(Ge,F.EventEmitter),Ge.prototype.post=h("post",(function(T,N,W){if("function"==typeof N&&(W=N,N={}),"object"!=typeof T||Array.isArray(T))return W(Y(Ct));this.bulkDocs({docs:[T]},N,ze(W,T._id))})),Ge.prototype.put=h("put",(function(T,N,W){if("function"==typeof N&&(W=N,N={}),"object"!=typeof T||Array.isArray(T))return W(Y(Ct));if(ee(T._id),Ue(T._id)&&"function"==typeof this._putLocal)return T._deleted?this._removeLocal(T,W):this._putLocal(T,W);var U,z,G,F,K=this;function u(W){"function"==typeof K._put&&!1!==N.new_edits?K._put(T,N,W):K.bulkDocs({docs:[T]},N,ze(W,T._id))}N.force&&T._rev?(z=(U=T._rev.split("-"))[1],G=parseInt(U[0],10)+1,F=qe(),T._revisions={start:G,ids:[F,z]},T._rev=G+"-"+F,N.new_edits=!1,u((function(N){var U=N?null:{ok:!0,id:T._id,rev:T._rev};W(N,U)}))):u(W)})),Ge.prototype.putAttachment=h("putAttachment",(function(T,N,W,U,z){var G=this;function a(T){var W="_rev"in T?parseInt(T._rev,10):0;return T._attachments=T._attachments||{},T._attachments[N]={content_type:z,data:U,revpos:++W},G.put(T)}return"function"==typeof z&&(z=U,U=W,W=null),void 0===z&&(z=U,U=W,W=null),z||E("warn","Attachment",N,"on document",T,"is missing content_type"),G.get(T).then((function(T){if(T._rev!==W)throw Y(Ze);return a(T)}),(function(N){if(N.reason===Ye.message)return a({_id:T});throw N}))})),Ge.prototype.removeAttachment=h("removeAttachment",(function(T,N,W,U){var z=this;z.get(T,(function(T,G){if(T)U(T);else if(G._rev===W){if(!G._attachments)return U();delete G._attachments[N],0===Object.keys(G._attachments).length&&delete G._attachments,z.put(G,U)}else U(Y(Ze))}))})),Ge.prototype.remove=h("remove",(function(T,N,W,U){var z;"string"==typeof N?(z={_id:T,_rev:N},"function"==typeof W&&(U=W,W={})):(z=T,"function"==typeof N?(U=N,W={}):(U=W,W=N)),(W=W||{}).was_delete=!0;var G={_id:z._id,_rev:z._rev||W.rev,_deleted:!0};if(Ue(G._id)&&"function"==typeof this._removeLocal)return this._removeLocal(z,U);this.bulkDocs({docs:[G]},W,ze(U,G._id))})),Ge.prototype.revsDiff=h("revsDiff",(function(T,N,W){"function"==typeof N&&(W=N,N={});var U=Object.keys(T);if(!U.length)return W(null,{});var z=0,G=new oe;function d(T,N){G.has(T)||G.set(T,{missing:[]}),G.get(T).missing.push(N)}U.map((function(N){this._getRevisionTree(N,(function(F,K){if(F&&404===F.status&&"missing"===F.message)G.set(N,{missing:T[N]});else{if(F)return W(F);Q=K,V=T[J=N].slice(0),Se(Q,(function(T,N,W,U,z){var G=N+"-"+W,F=V.indexOf(G);-1!==F&&(V.splice(F,1),"available"!==z.status&&d(J,G))})),V.forEach((function(T){d(J,T)}))}var J,Q,V;if(++z===U.length){var ie={};return G.forEach((function(T,N){ie[N]=T})),W(null,ie)}}))}),this)})),Ge.prototype.bulkGet=h("bulkGet",(function(T,N){k(this,T,N)})),Ge.prototype.compactDocument=h("compactDocument",(function(T,N,W){var U=this;this._getRevisionTree(T,(function(z,G){if(z)return W(z);var F,K,J=(F={},K=[],Se(G,(function(T,N,W,U){var z=N+"-"+W;return T&&(F[z]=0),void 0!==U&&K.push({from:U,to:z}),z})),K.reverse(),K.forEach((function(T){void 0===F[T.from]?F[T.from]=1+F[T.to]:F[T.from]=Math.min(F[T.from],1+F[T.to])})),F),Q=[],V=[];Object.keys(J).forEach((function(T){J[T]>N&&Q.push(T)})),Se(G,(function(T,N,W,U,z){var G=N+"-"+W;"available"===z.status&&-1!==Q.indexOf(G)&&V.push(G)})),U._doCompaction(T,V,W)}))})),Ge.prototype.compact=h("compact",(function(T,N){"function"==typeof T&&(N=T,T={});var W=this;T=T||{},W._compactionQueue=W._compactionQueue||[],W._compactionQueue.push({opts:T,callback:N}),1===W._compactionQueue.length&&function n(T){var N=T._compactionQueue[0],W=N.opts,U=N.callback;T.get("_local/compaction").catch((function(){return!1})).then((function(N){N&&N.last_seq&&(W.last_seq=N.last_seq),T._compact(W,(function(N,W){N?U(N):U(null,W),G((function(){T._compactionQueue.shift(),T._compactionQueue.length&&n(T)}))}))}))}(W)})),Ge.prototype._compact=function(T,N){var W=this,U={return_docs:!1,last_seq:T.last_seq||0},z=[];W.changes(U).on("change",(function(T){z.push(W.compactDocument(T.id,0))})).on("complete",(function(T){var U=T.last_seq;Promise.all(z).then((function(){return fe(W,"_local/compaction",(function(T){return(!T.last_seq||T.last_seq<U)&&(T.last_seq=U,T)}))})).then((function(){N(null,{ok:!0})})).catch(N)})).on("error",N)},Ge.prototype.get=h("get",(function(T,N,W){if("function"==typeof N&&(W=N,N={}),"string"!=typeof T)return W(Y(He));if(Ue(T)&&"function"==typeof this._getLocal)return this._getLocal(T,W);var U=[],z=this;function r(){var G=[],F=U.length;if(!F)return W(null,G);U.forEach((function(U){z.get(T,{rev:U,revs:N.revs,latest:N.latest,attachments:N.attachments,binary:N.binary},(function(T,N){if(T)G.push({missing:U});else{for(var z,K=0,J=G.length;K<J;K++)if(G[K].ok&&G[K].ok._rev===N._rev){z=!0;break}z||G.push({ok:N})}--F||W(null,G)}))}))}if(!N.open_revs)return this._get(T,N,(function(U,G){if(U)return U.docId=T,W(U);var F=G.doc,K=G.metadata,J=G.ctx;if(N.conflicts){var Q=Pe(K);Q.length&&(F._conflicts=Q)}if(Ne(K,F._rev)&&(F._deleted=!0),N.revs||N.revs_info){for(var V=F._rev.split("-"),ie=parseInt(V[0],10),oe=V[1],se=Le(K.rev_tree),ae=null,me=0;me<se.length;me++){var be=se[me],Ae=be.ids.map((function(T){return T.id})).indexOf(oe);(Ae===ie-1||!ae&&-1!==Ae)&&(ae=be)}var Ye=ae.ids.map((function(T){return T.id})).indexOf(F._rev.split("-")[1])+1,Ze=ae.ids.length-Ye;if(ae.ids.splice(Ye,Ze),ae.ids.reverse(),N.revs&&(F._revisions={start:ae.pos+ae.ids.length-1,ids:ae.ids.map((function(T){return T.id}))}),N.revs_info){var He=ae.pos+ae.ids.length;F._revs_info=ae.ids.map((function(T){return{rev:--He+"-"+T.id,status:T.opts.status}}))}}if(N.attachments&&F._attachments){var Xe=F._attachments,nt=Object.keys(Xe).length;if(0===nt)return W(null,F);Object.keys(Xe).forEach((function(T){this._getAttachment(F._id,T,Xe[T],{rev:F._rev,binary:N.binary,ctx:J},(function(N,U){var z=F._attachments[T];z.data=U,delete z.stub,delete z.length,--nt||W(null,F)}))}),z)}else{if(F._attachments)for(var st in F._attachments)F._attachments.hasOwnProperty(st)&&(F._attachments[st].stub=!0);W(null,F)}}));if("all"===N.open_revs)this._getRevisionTree(T,(function(T,N){if(T)return W(T);U=Ce(N).map((function(T){return T.rev})),r()}));else{if(!Array.isArray(N.open_revs))return W(Y(st,"function_clause"));U=N.open_revs;for(var G=0;G<U.length;G++){var F=U[G];if("string"!=typeof F||!/^\d+-/.test(F))return W(Y(Tt))}r()}})),Ge.prototype.getAttachment=h("getAttachment",(function(T,N,W,U){var z=this;W instanceof Function&&(U=W,W={}),this._get(T,W,(function(G,F){return G?U(G):F.doc._attachments&&F.doc._attachments[N]?(W.ctx=F.ctx,W.binary=!0,void z._getAttachment(T,N,F.doc._attachments[N],W,U)):U(Y(Ye))}))})),Ge.prototype.allDocs=h("allDocs",(function(T,N){if("function"==typeof T&&(N=T,T={}),T.skip=void 0!==T.skip?T.skip:0,T.start_key&&(T.startkey=T.start_key),T.end_key&&(T.endkey=T.end_key),"keys"in T){if(!Array.isArray(T.keys))return N(new TypeError("options.keys must be an array"));var W=["startkey","endkey","key"].filter((function(N){return N in T}))[0];if(W)return void N(Y(ut,"Query parameter `"+W+"` is not compatible with multi-get"));if(!te(this)&&(z="limit"in(U=T)?U.keys.slice(U.skip,U.limit+U.skip):0<U.skip?U.keys.slice(U.skip):U.keys,U.keys=z,U.skip=0,delete U.limit,U.descending&&(z.reverse(),U.descending=!1),0===T.keys.length))return this._allDocs({limit:0},N)}var U,z;return this._allDocs(T,N)})),Ge.prototype.changes=function(T,N){return"function"==typeof T&&(N=T,T={}),(T=T||{}).return_docs="return_docs"in T?T.return_docs:!T.live,new Fe(this,T,N)},Ge.prototype.close=h("close",(function(T){return this._closed=!0,this.emit("closed"),this._close(T)})),Ge.prototype.info=h("info",(function(T){var N=this;this._info((function(W,U){if(W)return T(W);U.db_name=U.db_name||N.name,U.auto_compaction=!(!N.auto_compaction||te(N)),U.adapter=N.adapter,T(null,U)}))})),Ge.prototype.id=h("id",(function(T){return this._id(T)})),Ge.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},Ge.prototype.bulkDocs=h("bulkDocs",(function(T,N,W){if("function"==typeof N&&(W=N,N={}),N=N||{},Array.isArray(T)&&(T={docs:T}),!T||!T.docs||!Array.isArray(T.docs))return W(Y(Ae));for(var U=0;U<T.docs.length;++U)if("object"!=typeof T.docs[U]||Array.isArray(T.docs[U]))return W(Y(Ct));var z;if(T.docs.forEach((function(T){T._attachments&&Object.keys(T._attachments).forEach((function(N){var W;z=z||"_"===(W=N).charAt(0)&&W+" is not a valid attachment name, attachment names cannot start with '_'",T._attachments[N].content_type||E("warn","Attachment",N,"on document",T._id,"is missing content_type")}))})),z)return W(Y(xt,z));"new_edits"in N||(N.new_edits=!("new_edits"in T)||T.new_edits);var G=this;N.new_edits||te(G)||T.docs.sort(Ve),function(T){for(var N=0;N<T.length;N++){var W=T[N];if(W._deleted)delete W._attachments;else if(W._attachments)for(var U=Object.keys(W._attachments),z=0;z<U.length;z++){var G=U[z];W._attachments[G]=m(W._attachments[G],["data","digest","content_type","length","revpos","stub"])}}}(T.docs);var F=T.docs.map((function(T){return T._id}));return this._bulkDocs(T,N,(function(T,U){if(T)return W(T);if(N.new_edits||(U=U.filter((function(T){return T.error}))),!te(G))for(var z=0,K=U.length;z<K;z++)U[z].id=U[z].id||F[z];W(null,U)}))})),Ge.prototype.registerDependentDatabase=h("registerDependentDatabase",(function(T,N){var W=new this.constructor(T,this.__opts);fe(this,"_local/_pouch_dependentDbs",(function(N){return N.dependentDbs=N.dependentDbs||{},!N.dependentDbs[T]&&(N.dependentDbs[T]=!0,N)})).then((function(){N(null,{db:W})})).catch(N)})),Ge.prototype.destroy=h("destroy",(function(T,N){"function"==typeof T&&(N=T,T={});var W=this,U=!("use_prefix"in W)||W.use_prefix;function u(){W._destroy(T,(function(T,U){if(T)return N(T);W._destroyed=!0,W.emit("destroyed"),N(null,U||{ok:!0})}))}if(te(W))return u();W.get("_local/_pouch_dependentDbs",(function(T,z){if(T)return 404!==T.status?N(T):u();var G=z.dependentDbs,F=W.constructor,K=Object.keys(G).map((function(T){var N=U?T.replace(new RegExp("^"+F.prefix),""):T;return new F(N,W.__opts).destroy()}));Promise.all(K).then(u,N)}))})),Qe.prototype.execute=function(){var T;if(this.failed)for(;T=this.queue.shift();)T(this.failed);else for(;T=this.queue.shift();)T()},Qe.prototype.fail=function(T){this.failed=T,this.execute()},Qe.prototype.ready=function(T){this.isReady=!0,this.db=T,this.execute()},Qe.prototype.addTask=function(T){this.queue.push(T),this.failed&&this.execute()},K(We,Ge);var on="undefined"!=typeof AbortController?AbortController:function(){return{abort:function(){}}},sn=fetch,cn=Headers;We.adapters={},We.preferredAdapters=[],We.prefix="_pouch_";var fn=new F.EventEmitter;function et(T,N){for(var W=T,U=0,z=N.length;U<z&&(W=W[N[U]]);U++);return W}function tt(T){for(var N=[],W="",U=0,z=T.length;U<z;U++){var G=T[U];"."===G?0<U&&"\\"===T[U-1]?W=W.substring(0,W.length-1)+".":(N.push(W),W=""):W+=G}return N.push(W),N}!function(T){Object.keys(F.EventEmitter.prototype).forEach((function(N){"function"==typeof F.EventEmitter.prototype[N]&&(T[N]=fn[N].bind(fn))}));var N=T._destructionListeners=new oe;T.on("ref",(function(T){N.has(T.name)||N.set(T.name,[]),N.get(T.name).push(T)})),T.on("unref",(function(T){if(N.has(T.name)){var W=N.get(T.name),U=W.indexOf(T);U<0||(W.splice(U,1),1<W.length?N.set(T.name,W):N.delete(T.name))}})),T.on("destroyed",(function(T){if(N.has(T)){var W=N.get(T);N.delete(T),W.forEach((function(T){T.emit("destroyed",!0)}))}}))}(We),We.adapter=function(T,N,W){N.valid()&&(We.adapters[T]=N,W&&We.preferredAdapters.push(T))},We.plugin=function(T){if("function"==typeof T)T(We);else{if("object"!=typeof T||0===Object.keys(T).length)throw new Error('Invalid plugin: got "'+T+'", expected an object or a function');Object.keys(T).forEach((function(N){We.prototype[N]=T[N]}))}return this.__defaults&&(We.__defaults=be({},this.__defaults)),We},We.defaults=function(T){function n(T,N){if(!(this instanceof n))return new n(T,N);N=N||{},T&&"object"==typeof T&&(T=(N=T).name,delete N.name),N=be({},n.__defaults,N),We.call(this,T,N)}return K(n,We),n.preferredAdapters=We.preferredAdapters.slice(),Object.keys(We).forEach((function(T){T in n||(n[T]=We[T])})),n.__defaults=be({},this.__defaults,T),n},We.fetch=function(T,N){return sn(T,N)};var ln=["$or","$nor","$not"];function rt(T){return-1<ln.indexOf(T)}function it(T){return Object.keys(T)[0]}function ot(T){var N={};return T.forEach((function(T){Object.keys(T).forEach((function(W){var U=T[W];if("object"!=typeof U&&(U={$eq:U}),rt(W))N[W]=U instanceof Array?U.map((function(T){return ot([T])})):ot([U]);else{var z=N[W]=N[W]||{};Object.keys(U).forEach((function(T){var N,W,G,F,K=U[T];return"$gt"===T||"$gte"===T?function(T,N,W){void 0===W.$eq&&(void 0!==W.$gte?"$gte"===T?N>W.$gte&&(W.$gte=N):N>=W.$gte&&(delete W.$gte,W.$gt=N):void 0!==W.$gt?"$gte"===T?N>W.$gt&&(delete W.$gt,W.$gte=N):N>W.$gt&&(W.$gt=N):W[T]=N)}(T,K,z):"$lt"===T||"$lte"===T?function(T,N,W){void 0===W.$eq&&(void 0!==W.$lte?"$lte"===T?N<W.$lte&&(W.$lte=N):N<=W.$lte&&(delete W.$lte,W.$lt=N):void 0!==W.$lt?"$lte"===T?N<W.$lt&&(delete W.$lt,W.$lte=N):N<W.$lt&&(W.$lt=N):W[T]=N)}(T,K,z):"$ne"===T?(G=K,void("$ne"in(F=z)?F.$ne.push(G):F.$ne=[G])):"$eq"===T?(N=K,delete(W=z).$gt,delete W.$gte,delete W.$lt,delete W.$lte,delete W.$ne,void(W.$eq=N)):void(z[T]=K)}))}}))})),N}function ct(T,N){if(T===N)return 0;T=ft(T),N=ft(N);var W,U,z=vt(T),G=vt(N);if(z-G!=0)return z-G;switch(typeof T){case"number":return T-N;case"boolean":return T<N?-1:1;case"string":return(W=T)===(U=N)?0:U<W?1:-1}return Array.isArray(T)?function(T,N){for(var W=Math.min(T.length,N.length),U=0;U<W;U++){var z=ct(T[U],N[U]);if(0!==z)return z}return T.length===N.length?0:T.length>N.length?1:-1}(T,N):function(T,N){for(var W=Object.keys(T),U=Object.keys(N),z=Math.min(W.length,U.length),G=0;G<z;G++){var F=ct(W[G],U[G]);if(0!==F)return F;if(0!==(F=ct(T[W[G]],N[U[G]])))return F}return W.length===U.length?0:W.length>U.length?1:-1}(T,N)}function ft(T){switch(typeof T){case"undefined":return null;case"number":return T===1/0||T===-1/0||isNaN(T)?null:T;case"object":var N=T;if(Array.isArray(T)){var W=T.length;T=new Array(W);for(var U=0;U<W;U++)T[U]=ft(N[U])}else{if(T instanceof Date)return T.toJSON();if(null!==T)for(var z in T={},N)if(N.hasOwnProperty(z)){var G=N[z];void 0!==G&&(T[z]=ft(G))}}}return T}function dt(T){return vt(T=ft(T))+""+function lt(T){if(null!==T)switch(typeof T){case"boolean":return T?1:0;case"number":return function(T){if(0===T)return"1";var N,W=T.toExponential().split(/e\+?/),U=parseInt(W[1],10),z=T<0,G=z?"0":"2";G+=""+("0",3,function(T,N,W){for(var U="",z=3-T.length;U.length<z;)U+="0";return U}(N=((z?-U:U)- -324).toString())+N);var F=Math.abs(parseFloat(W[0]));z&&(F=10-F);var K=F.toFixed(20);return G+""+(K=K.replace(/\.?0+$/,""))}(T);case"string":return T.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var N=Array.isArray(T),W=N?T:Object.keys(T),U=-1,z=W.length,G="";if(N)for(;++U<z;)G+=dt(W[U]);else for(;++U<z;){var F=W[U];G+=dt(F)+dt(T[F])}return G}return""}(T)+"\0"}function ht(T,N){var W,U=N;if("1"===T[N])W=0,N++;else{var z="0"===T[N];N++;var G="",F=T.substring(N,N+3),K=parseInt(F,10)+-324;for(z&&(K=-K),N+=3;;){var J=T[N];if("\0"===J)break;G+=J,N++}W=1===(G=G.split(".")).length?parseInt(G,10):parseFloat(G[0]+"."+G[1]),z&&(W-=10),0!==K&&(W=parseFloat(W+"e"+K))}return{num:W,length:N-U}}function pt(T,N){var W=T.pop();if(N.length){var U=N[N.length-1];W===U.element&&(N.pop(),U=N[N.length-1]);var z=U.element,G=U.index;Array.isArray(z)?z.push(W):G===T.length-2?z[T.pop()]=W:T.push(W)}}function vt(T){var N=["boolean","number","string","object"].indexOf(typeof T);return~N?null===T?1:Array.isArray(T)?5:N<3?N+2:N+3:Array.isArray(T)?5:void 0}function _t(T,N,W){return W.every((function(W){var U=N[W],z=tt(W),G=et(T,z);return rt(W)?function(T,N,W){return"$or"===T?N.some((function(T){return _t(W,T,Object.keys(T))})):"$not"===T?!_t(W,N,Object.keys(N)):!N.find((function(T){return _t(W,T,Object.keys(T))}))}(W,U,T):gt(U,T,z,G)}))}function gt(T,N,W,U){return!T||Object.keys(T).every((function(z){var G=T[z];return function(T,N,W,U,z){if(!hn[T])throw new Error('unknown operator "'+T+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return hn[T](N,W,U,z)}(z,N,G,W,U)}))}function mt(T){return null!=T}function bt(T){return void 0!==T}function wt(T,N){return N.some((function(N){return T instanceof Array?-1<T.indexOf(N):T===N}))}var hn={$elemMatch:function(T,N,W,U){return!!Array.isArray(U)&&0!==U.length&&("object"==typeof U[0]?U.some((function(T){return _t(T,N,Object.keys(N))})):U.some((function(U){return gt(N,T,W,U)})))},$allMatch:function(T,N,W,U){return!!Array.isArray(U)&&0!==U.length&&("object"==typeof U[0]?U.every((function(T){return _t(T,N,Object.keys(N))})):U.every((function(U){return gt(N,T,W,U)})))},$eq:function(T,N,W,U){return bt(U)&&0===ct(U,N)},$gte:function(T,N,W,U){return bt(U)&&0<=ct(U,N)},$gt:function(T,N,W,U){return bt(U)&&0<ct(U,N)},$lte:function(T,N,W,U){return bt(U)&&ct(U,N)<=0},$lt:function(T,N,W,U){return bt(U)&&ct(U,N)<0},$exists:function(T,N,W,U){return N?bt(U):!bt(U)},$mod:function(T,N,W,U){return mt(U)&&function(T,N){var W=N[0],U=N[1];if(0===W)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(W,10)!==W)throw new Error("Divisor is not an integer");if(parseInt(U,10)!==U)throw new Error("Modulus is not an integer");return parseInt(T,10)===T&&T%W===U}(U,N)},$ne:function(T,N,W,U){return N.every((function(T){return 0!==ct(U,T)}))},$in:function(T,N,W,U){return mt(U)&&wt(U,N)},$nin:function(T,N,W,U){return mt(U)&&!wt(U,N)},$size:function(T,N,W,U){return mt(U)&&(z=N,U.length===z);var z},$all:function(T,N,W,U){return Array.isArray(U)&&(z=U,N.every((function(T){return-1<z.indexOf(T)})));var z},$regex:function(T,N,W,U){return mt(U)&&(z=U,new RegExp(N).test(z));var z},$type:function(T,N,W,U){return function(T,N){switch(N){case"null":return null===T;case"boolean":return"boolean"==typeof T;case"number":return"number"==typeof T;case"string":return"string"==typeof T;case"array":return T instanceof Array;case"object":return"[object Object]"==={}.toString.call(T)}throw new Error(N+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}(U,N)}};function jt(T,N){if("object"!=typeof N)throw new Error("Selector error: expected a JSON object");var W=function yt(T,N,W){if(T=T.filter((function(T){return _t(T.doc,N.selector,W)})),N.sort){var U=function(T){function o(N){return T.map((function(T){var W=tt(it(T));return et(N,W)}))}return function(T,N){var W,U,z=ct(o(T.doc),o(N.doc));return 0!==z?z:(W=T.doc._id)<(U=N.doc._id)?-1:U<W?1:0}}(N.sort);T=T.sort(U),"string"!=typeof N.sort[0]&&"desc"===(z=N.sort[0])[it(z)]&&(T=T.reverse())}var z;if("limit"in N||"skip"in N){var G=N.skip||0,F=("limit"in N?N.limit:T.length)+G;T=T.slice(G,F)}return T}([{doc:T}],{selector:N=function(T){var N=R(T),W=!1;"$and"in N&&(N=ot(N.$and),W=!0),["$or","$nor"].forEach((function(T){T in N&&N[T].forEach((function(T){for(var N=Object.keys(T),W=0;W<N.length;W++){var U=N[W],z=T[U];"object"==typeof z&&null!==z||(T[U]={$eq:z})}}))})),"$not"in N&&(N.$not=ot([N.$not]));for(var U=Object.keys(N),z=0;z<U.length;z++){var G=U[z],F=N[G];"object"!=typeof F||null===F?F={$eq:F}:"$ne"in F&&!W&&(F.$ne=[F.$ne]),N[G]=F}return N}(N)},Object.keys(N));return W&&1===W.length}function Ot(T,N){if(T.selector&&T.filter&&"_selector"!==T.filter){var W="string"==typeof T.filter?T.filter:"function";return N(new Error('selector invalid for filter "'+W+'"'))}N()}function qt(T){T.view&&!T.filter&&(T.filter="_view"),T.selector&&!T.filter&&(T.filter="_selector"),T.filter&&"string"==typeof T.filter&&("_view"===T.filter?T.view=re(T.view):T.filter=re(T.filter))}function At(T,N){return N.filter&&"string"==typeof N.filter&&!N.doc_ids&&!te(T.db)}function Et(T,N){var W=N.complete;if("_view"===N.filter){if(!N.view||"string"!=typeof N.view){var U=Y(xt,"`view` filter parameter not found or invalid.");return W(U)}var z=ne(N.view);T.db.get("_design/"+z[0],(function(U,G){if(T.isCancelled)return W(null,{status:"cancelled"});if(U)return W(H(U));var F=G&&G.views&&G.views[z[1]]&&G.views[z[1]].map;if(!F)return W(Y(Ye,G.views?"missing json key: "+z[1]:"missing json key: views"));N.filter=ce(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+F+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{}),T.doChanges(N)}))}else if(N.selector)N.filter=function(T){return jt(T,N.selector)},T.doChanges(N);else{var G=ne(N.filter);T.db.get("_design/"+G[0],(function(U,z){if(T.isCancelled)return W(null,{status:"cancelled"});if(U)return W(H(U));var F=z&&z.filters&&z.filters[G[1]];if(!F)return W(Y(Ye,z&&z.filters?"missing json key: "+G[1]:"missing json key: filters"));N.filter=ce('"use strict";\nreturn '+F+";",{}),T.doChanges(N)}))}}function St(T){return T.reduce((function(T,N){return T[N]=!0,T}),{})}We.plugin((function(T){T._changesFilterPlugin={validate:Ot,normalize:qt,shouldFilter:At,filter:Et}})),We.version="7.0.0";var pn=St(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),vn=St(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Pt(T){if(!/^\d+-./.test(T))return Y(Tt);var N=T.indexOf("-"),W=T.substring(0,N),U=T.substring(N+1);return{prefix:parseInt(W,10),id:U}}function Lt(T,N,W){var U,z,G;W||(W={deterministic_revs:!0});var F={status:"available"};if(T._deleted&&(F.deleted=!0),N)if(T._id||(T._id=en()),z=qe(T,W.deterministic_revs),T._rev){if((G=Pt(T._rev)).error)return G;T._rev_tree=[{pos:G.prefix,ids:[G.id,{status:"missing"},[[z,F,[]]]]}],U=G.prefix+1}else T._rev_tree=[{pos:1,ids:[z,F,[]]}],U=1;else if(T._revisions&&(T._rev_tree=function(T,N){for(var W=T.start-T.ids.length+1,U=T.ids,z=[U[0],N,[]],G=1,F=U.length;G<F;G++)z=[U[G],{status:"missing"},[z]];return[{pos:W,ids:z}]}(T._revisions,F),U=T._revisions.start,z=T._revisions.ids[0]),!T._rev_tree){if((G=Pt(T._rev)).error)return G;U=G.prefix,z=G.id,T._rev_tree=[{pos:U,ids:[z,F,[]]}]}ee(T._id),T._rev=U+"-"+z;var K={metadata:{},data:{}};for(var J in T)if(Object.prototype.hasOwnProperty.call(T,J)){var Q="_"===J[0];if(Q&&!pn[J]){var V=Y(kt,J);throw V.message=kt.message+": "+J,V}Q&&!vn[J]?K.metadata[J.slice(1)]=T[J]:K.data[J]=T[J]}return K}function $t(T,N,W){if(T.stub)return W();var U,z,G;"string"==typeof T.data?function Dt(T,N,W){var U=function(T){try{return le(T)}catch(T){return{error:Y(at,"Attachment is not a valid base64 string")}}}(T.data);if(U.error)return W(U.error);T.length=U.length,T.data="blob"===N?pe(U,T.content_type):"base64"===N?de(U):U,je(U,(function(N){T.digest="md5-"+N,W()}))}(T,N,W):(z=N,G=W,je((U=T).data,(function(T){U.digest="md5-"+T,U.length=U.data.size||U.data.length||0,"binary"===z?_e(U.data,(function(T){U.data=T,G()})):"base64"===z?ge(U.data,(function(T){U.data=T,G()})):G()})))}function Bt(T,N,W,U,z,G,F,K,J){T=T||1e3;var Q=K.new_edits,V=new oe,ie=0,se=N.length;function p(){++ie===se&&J&&J()}N.forEach((function(T,N){if(T._id&&Ue(T._id)){var U=T._deleted?"_removeLocal":"_putLocal";W[U](T,{ctx:z},(function(T,W){G[N]=T||W,p()}))}else{var F=T.metadata.id;V.has(F)?(se--,V.get(F).push([T,N])):V.set(F,[[T,N]])}})),V.forEach((function(N,W){var z=0;function a(){++z<N.length?e():p()}function e(){var J=N[z],V=J[0],ie=J[1];if(U.has(W))!function It(T,N,W,U,z,G,F,K){if(function(T,N){for(var W,U=T.slice(),z=N.split("-"),G=parseInt(z[0],10),F=z[1];W=U.pop();){if(W.pos===G&&W.ids[0]===F)return!0;for(var K=W.ids[2],J=0,Q=K.length;J<Q;J++)U.push({pos:W.pos+1,ids:K[J]})}return!1}(N.rev_tree,W.metadata.rev)&&!K)return U[z]=W,G();var J=N.winningRev||Ee(N),Q="deleted"in N?N.deleted:Ne(N,J),V="deleted"in W.metadata?W.metadata.deleted:Ne(W.metadata),ie=/^1-/.test(W.metadata.rev);if(Q&&!V&&K&&ie){var oe=W.data;oe._rev=J,oe._id=W.metadata.id,W=Lt(oe,K)}var se=Re(N.rev_tree,W.metadata.rev_tree[0],T);if(K&&(Q&&V&&"new_leaf"!==se.conflicts||!Q&&"new_leaf"!==se.conflicts||Q&&!V&&"new_branch"===se.conflicts)){var ae=Y(Ze);return U[z]=ae,G()}var me=W.metadata.rev;W.metadata.rev_tree=se.tree,W.stemmedRevs=se.stemmedRevs||[],N.rev_map&&(W.metadata.rev_map=N.rev_map);var be=Ee(W.metadata),Ae=Ne(W.metadata,be),Ye=Q===Ae?0:Q<Ae?-1:1;F(W,be,Ae,me===be?Ae:Ne(W.metadata,me),!0,Ye,z,G)}(T,U.get(W),V,G,ie,a,F,Q);else{var oe=Re([],V.metadata.rev_tree[0],T);V.metadata.rev_tree=oe.tree,V.stemmedRevs=oe.stemmedRevs||[],function(T,N,W){var U=Ee(T.metadata),z=Ne(T.metadata,U);if("was_delete"in K&&z)return G[N]=Y(Ye,"deleted"),W();if(Q&&"missing"===T.metadata.rev_tree[0].ids[1].status){var J=Y(Ze);return G[N]=J,W()}F(T,U,z,z,!1,z?0:1,N,W)}(V,ie,a)}}e()}))}var yn="document-store",_n="by-sequence",Bn="attach-store",In="attach-seq-store",Tn="meta-store",Wn="local-store",Gn="detect-blob-support";function zt(T){return function(N){var W="unknown_error";N.target&&N.target.error&&(W=N.target.error.name||N.target.error.message),T(Y(Rt,W,N.type))}}function Vt(T,N,W){return{data:function(N){try{return JSON.stringify(N)}catch(T){return V.stringify(N)}}(T),winningRev:N,deletedOrLocal:W?"1":"0",seq:T.seq,id:T.id}}function Gt(T){if(!T)return null;var N=function(N){try{return JSON.parse(N)}catch(T){return V.parse(N)}}(T.data);return N.winningRev=T.winningRev,N.deleted="1"===T.deletedOrLocal,N.seq=T.seq,N}function Qt(T){if(!T)return T;var N=T._doc_id_rev.lastIndexOf(":");return T._id=T._doc_id_rev.substring(0,N-1),T._rev=T._doc_id_rev.substring(N+1),delete T._doc_id_rev,T}function Wt(T,N,W,U){W?U(T?"string"!=typeof T?T:ve(T,N):he([""],{type:N})):T?"string"!=typeof T?ye(T,(function(T){U(de(T))})):U(T):U("")}function Yt(T,N,W,U){var z=Object.keys(T._attachments||{});if(!z.length)return U&&U();var G=0;function a(){++G===z.length&&U&&U()}z.forEach((function(U){var z,G,F;N.attachments&&N.include_docs?(z=U,F=(G=T._attachments[z]).digest,W.objectStore(Bn).get(F).onsuccess=function(T){G.body=T.target.result.body,a()}):(T._attachments[U].stub=!0,a())}))}function Ht(T,N){return Promise.all(T.map((function(T){if(T.doc&&T.doc._attachments){var W=Object.keys(T.doc._attachments);return Promise.all(W.map((function(W){var U=T.doc._attachments[W];if("body"in U){var z=U.body,G=U.content_type;return new Promise((function(F){Wt(z,G,N,(function(N){T.doc._attachments[W]=be(m(U,["digest","content_type"]),{data:N}),F()}))}))}})))}})))}function Xt(T,N,W){var U=[],z=W.objectStore(_n),G=W.objectStore(Bn),F=W.objectStore(In),K=T.length;function u(){--K||U.length&&U.forEach((function(T){F.index("digestSeq").count(IDBKeyRange.bound(T+"::",T+"::",!1,!1)).onsuccess=function(N){N.target.result||G.delete(T)}}))}T.forEach((function(T){var W=z.index("_doc_id_rev"),G=N+"::"+T;W.getKey(G).onsuccess=function(T){var N=T.target.result;if("number"!=typeof N)return u();z.delete(N),F.index("seq").openCursor(IDBKeyRange.only(N)).onsuccess=function(T){var N=T.target.result;if(N){var W=N.value.digestSeq.split("::")[0];U.push(W),F.delete(N.primaryKey),N.continue()}else u()}}}))}function Zt(T,N,W){try{return{txn:T.transaction(N,W)}}catch(T){return{error:T}}}var Fn=new A;function nn(T,N,W,U,z){var G,F,K;function u(T){F=T.target.result,G&&z(G,F,K)}function c(T){G=T.target.result,F&&z(G,F,K)}function f(T){var N=T.target.result;if(!N)return z();z([N.key],[N.value],N)}-1===U&&(U=1e3),"function"==typeof T.getAll&&"function"==typeof T.getAllKeys&&1<U&&!W?(K={continue:function(){if(!G.length)return z();var W,K=G[G.length-1];if(N&&N.upper)try{W=IDBKeyRange.bound(K,N.upper,!0,N.upperOpen)}catch(W){if("DataError"===W.name&&0===W.code)return z()}else W=IDBKeyRange.lowerBound(K,!0);N=W,F=G=null,T.getAll(N,U).onsuccess=u,T.getAllKeys(N,U).onsuccess=c}},T.getAll(N,U).onsuccess=u,T.getAllKeys(N,U).onsuccess=c):W?T.openCursor(N,"prev").onsuccess=f:T.openCursor(N).onsuccess=f}var Kn=!1,Jn=[];function an(){!Kn&&Jn.length&&(Kn=!0,Jn.shift()())}var Qn,Zn=new oe,er=new oe;function dn(T,N){var W,U,z,F=this;W=function(N){!function(T,N,W){var U=N.name,z=null;function s(T,N){var W=T.objectStore(yn);W.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),W.openCursor().onsuccess=function(T){var U=T.target.result;if(U){var z=U.value,G=Ne(z);z.deletedOrLocal=G?"1":"0",W.put(z),U.continue()}else N()}}function a(T,N){var W=T.objectStore(Wn),U=T.objectStore(yn),z=T.objectStore(_n);U.openCursor().onsuccess=function(T){var G=T.target.result;if(G){var F=G.value,K=F.id,J=Ue(K),Q=Ee(F);if(J){var V=K+"::"+Q,ie=K+"::",oe=K+"::~",se=z.index("_doc_id_rev"),ae=IDBKeyRange.bound(ie,oe,!1,!1),me=se.openCursor(ae);me.onsuccess=function(T){if(me=T.target.result){var N=me.value;N._doc_id_rev===V&&W.put(N),z.delete(me.primaryKey),me.continue()}else U.delete(G.primaryKey),G.continue()}}else G.continue()}else N&&N()}}function u(T,N){var W=T.objectStore(_n),U=T.objectStore(Bn),z=T.objectStore(In);U.count().onsuccess=function(T){if(!T.target.result)return N();W.openCursor().onsuccess=function(T){var W=T.target.result;if(!W)return N();for(var U=W.value,G=W.primaryKey,F=Object.keys(U._attachments||{}),K={},J=0;J<F.length;J++){K[U._attachments[F[J]].digest]=!0}var Q=Object.keys(K);for(J=0;J<Q.length;J++){var V=Q[J];z.put({seq:G,digestSeq:V+"::"+G})}W.continue()}}}function c(T){var N=T.objectStore(_n),W=T.objectStore(yn);W.openCursor().onsuccess=function(T){var U=T.target.result;if(U){var z,G,F,K,J=function(T){return T.data?Gt(T):(T.deleted="1"===T.deletedOrLocal,T)}(U.value);if(J.winningRev=J.winningRev||Ee(J),J.seq)return a();z=J.id+"::",G=J.id+"::",F=N.index("_doc_id_rev").openCursor(IDBKeyRange.bound(z,G)),K=0,F.onsuccess=function(T){var N=T.target.result;if(!N)return J.seq=K,a();var W=N.primaryKey;K<W&&(K=W),N.continue()}}function a(){var T=Vt(J,J.winningRev,J.deleted);W.put(T).onsuccess=function(){U.continue()}}}}T._meta=null,T._remote=!1,T.type=function(){return"idb"},T._id=v((function(N){N(null,T._meta.instanceId)})),T._bulkDocs=function(W,U,G){!function tn(T,N,W,U,z,G){for(var F,K,J,Q,V,ie,se,ae,me=N.docs,be=0,Ae=me.length;be<Ae;be++){var Ye=me[be];Ye._id&&Ue(Ye._id)||(Ye=me[be]=Lt(Ye,W.new_edits,T)).error&&!se&&(se=Ye)}if(se)return G(se);var Ze=!1,He=0,Xe=new Array(me.length),nt=new oe,st=!1,at=U._meta.blobSupport?"blob":"base64";function O(){Ze=!0,q()}function q(){ae&&Ze&&(ae.docCount+=He,ie.put(ae))}function A(){st||(Fn.notify(U._meta.name),G(null,Xe))}function E(T,N,W,U,z,G,F,K){T.metadata.winningRev=N,T.metadata.deleted=W;var J=T.data;if(J._id=T.metadata.id,J._rev=T.metadata.rev,U&&(J._deleted=!0),J._attachments&&Object.keys(J._attachments).length)return function(T,N,W,U,z,G){var F=T.data,K=0,J=Object.keys(F._attachments);function f(){K===J.length&&S(T,N,W,U,z,G)}function l(){K++,f()}J.forEach((function(W){var U,z,G,F=T.data._attachments[W];if(F.stub)K++,f();else{var J=F.data;delete F.data,F.revpos=parseInt(N,10);var V=F.digest;U=V,z=J,G=l,Q.count(U).onsuccess=function(T){if(T.target.result)return G();var N={digest:U,body:z};Q.put(N).onsuccess=G}}}))}(T,N,W,z,F,K);He+=G,q(),S(T,N,W,z,F,K)}function S(T,N,W,z,G,Q){var ie=T.data,oe=T.metadata;function r(G){var J,Q,V=T.stemmedRevs||[];z&&U.auto_compaction&&(V=V.concat((J=T.metadata,Q=[],Se(J.rev_tree,(function(T,N,W,U,z){"available"!==z.status||T||(Q.push(N+"-"+W),z.status="missing")})),Q))),V&&V.length&&Xt(V,T.metadata.id,F),oe.seq=G.target.result;var ie=Vt(oe,N,W);K.put(ie).onsuccess=f}function f(){Xe[G]={ok:!0,id:oe.id,rev:oe.rev},nt.set(T.metadata.id,T.metadata),function(T,N,W){var U=0,z=Object.keys(T.data._attachments||{});if(!z.length)return W();function o(){++U===z.length&&W()}function s(W){var U=T.data._attachments[W].digest,z=V.put({seq:N,digestSeq:U+"::"+N});z.onsuccess=o,z.onerror=function(T){T.preventDefault(),T.stopPropagation(),o()}}for(var G=0;G<z.length;G++)s(z[G])}(T,oe.seq,Q)}ie._doc_id_rev=oe.id+"::"+oe.rev,delete ie._id,delete ie._rev;var se=J.put(ie);se.onsuccess=r,se.onerror=function(T){T.preventDefault(),T.stopPropagation(),J.index("_doc_id_rev").getKey(ie._doc_id_rev).onsuccess=function(T){J.put(ie,T.target.result).onsuccess=r}}}!function(T,N,W){if(!T.length)return W();var U,z=0;function a(){z++,T.length===z&&(U?W(U):W())}T.forEach((function(T){var W=T.data&&T.data._attachments?Object.keys(T.data._attachments):[],z=0;if(!W.length)return a();function r(T){U=T,++z===W.length&&a()}for(var G in T.data._attachments)T.data._attachments.hasOwnProperty(G)&&$t(T.data._attachments[G],N,r)}))}(me,at,(function(N){if(N)return G(N);!function(){var N=Zt(z,[yn,_n,Bn,Wn,In,Tn],"readwrite");if(N.error)return G(N.error);(F=N.txn).onabort=zt(G),F.ontimeout=zt(G),F.oncomplete=A,K=F.objectStore(yn),J=F.objectStore(_n),Q=F.objectStore(Bn),V=F.objectStore(In),(ie=F.objectStore(Tn)).get(Tn).onsuccess=function(T){ae=T.target.result,q()},function(T){var N=[];if(me.forEach((function(T){T.data&&T.data._attachments&&Object.keys(T.data._attachments).forEach((function(W){var U=T.data._attachments[W];U.stub&&N.push(U.digest)}))})),!N.length)return T();var W,U=0;N.forEach((function(z){var G,F;G=z,F=function(z){z&&!W&&(W=z),++U===N.length&&T(W)},Q.get(G).onsuccess=function(T){if(T.target.result)F();else{var N=Y(Nt,"unknown stub attachment with digest "+G);N.status=412,F(N)}}}))}((function(N){if(N)return st=!0,G(N);!function(){if(me.length)for(var N=0,z=0,G=me.length;z<G;z++){var J=me[z];if(J._id&&Ue(J._id))n();else K.get(J.metadata.id).onsuccess=t}function n(){++N===me.length&&Bt(T.revs_limit,me,U,nt,F,Xe,E,W,O)}function t(T){var N=Gt(T.target.result);N&&nt.set(N.id,N),n()}}()}))}()}))}(N,W,U,T,z,G)},T._get=function(T,N,W){var U,G,F,K=N.ctx;if(!K){var J=Zt(z,[yn,_n,Bn],"readonly");if(J.error)return W(J.error);K=J.txn}function f(){W(F,{doc:U,metadata:G,ctx:K})}K.objectStore(yn).get(T).onsuccess=function(T){if(!(G=Gt(T.target.result)))return F=Y(Ye,"missing"),f();var W;if(N.rev)W=N.latest?function(T,N){for(var W,U=N.rev_tree.slice();W=U.pop();){var z=W.pos,G=W.ids,F=G[0],K=G[1],J=G[2],Q=0===J.length,V=W.history?W.history.slice():[];if(V.push({id:F,pos:z,opts:K}),Q)for(var ie=0,oe=V.length;ie<oe;ie++){var se=V[ie];if(se.pos+"-"+se.id===T)return z+"-"+F}for(var ae=0,me=J.length;ae<me;ae++)U.push({pos:z+1,ids:J[ae],history:V})}throw new Error("Unable to resolve latest revision for id "+N.id+", rev "+T)}(N.rev,G):N.rev;else if(W=G.winningRev,Ne(G))return F=Y(Ye,"deleted"),f();var z=K.objectStore(_n),J=G.id+"::"+W;z.index("_doc_id_rev").get(J).onsuccess=function(T){if((U=T.target.result)&&(U=Qt(U)),!U)return F=Y(Ye,"missing"),f();f()}}},T._getAttachment=function(T,N,W,U,G){var F;if(U.ctx)F=U.ctx;else{var K=Zt(z,[yn,_n,Bn],"readonly");if(K.error)return G(K.error);F=K.txn}var J=W.digest,Q=W.content_type;F.objectStore(Bn).get(J).onsuccess=function(T){Wt(T.target.result.body,Q,U.binary,(function(T){G(null,T)}))}},T._info=function(N){var W,U,G=Zt(z,[Tn,_n],"readonly");if(G.error)return N(G.error);var F=G.txn;F.objectStore(Tn).get(Tn).onsuccess=function(T){U=T.target.result.docCount},F.objectStore(_n).openCursor(null,"prev").onsuccess=function(T){var N=T.target.result;W=N?N.key:0},F.oncomplete=function(){N(null,{doc_count:U,update_seq:W,idb_attachment_format:T._meta.blobSupport?"binary":"base64"})}},T._allDocs=function(T,N){!function rn(T,N,W){var U,z,G="startkey"in T&&T.startkey,F="endkey"in T&&T.endkey,K="key"in T&&T.key,J="keys"in T&&T.keys,Q=T.skip||0,V="number"==typeof T.limit?T.limit:-1,ie=!1!==T.inclusive_end;if(!J&&(z=(U=function(T,N,W,U,z){try{if(T&&N)return z?IDBKeyRange.bound(N,T,!W,!1):IDBKeyRange.bound(T,N,!1,!W);if(T)return z?IDBKeyRange.upperBound(T):IDBKeyRange.lowerBound(T);if(N)return z?IDBKeyRange.lowerBound(N,!W):IDBKeyRange.upperBound(N,!W);if(U)return IDBKeyRange.only(U)}catch(T){return{error:T}}return null}(G,F,ie,K,T.descending))&&U.error)&&("DataError"!==z.name||0!==z.code))return W(Y(Rt,z.name,z.message));var oe=[yn,_n,Tn];T.attachments&&oe.push(Bn);var se=Zt(N,oe,"readonly");if(se.error)return W(se.error);var ae=se.txn;ae.oncomplete=function(){T.attachments?Ht(xt,T.binary).then(P):P()},ae.onabort=zt(W);var me,be,Ae,Ye,Ze,He,Xe,nt,st=ae.objectStore(yn),at=ae.objectStore(_n),ut=ae.objectStore(Tn),kt=at.index("_doc_id_rev"),xt=[];function S(N,W){var U,z,G,F,K={id:W.id,key:W.id,value:{rev:N}};W.deleted?J&&(xt.push(K),K.value.deleted=!0,K.doc=null):Q--<=0&&(xt.push(K),T.include_docs&&(z=K,G=N,F=(U=W).id+"::"+G,kt.get(F).onsuccess=function(N){if(z.doc=Qt(N.target.result)||{},T.conflicts){var W=Pe(U);W.length&&(z.doc._conflicts=W)}Yt(z.doc,T,ae)}))}function x(T){for(var N=0,W=T.length;N<W&&xt.length!==V;N++){var U=T[N];if(U.error&&J)xt.push(U);else{var z=Gt(U);S(z.winningRev,z)}}}function C(T,N,W){W&&(x(N),xt.length<V&&W.continue())}function P(){var N={total_rows:me,offset:T.skip,rows:xt};T.update_seq&&void 0!==be&&(N.update_seq=be),W(null,N)}return ut.get(Tn).onsuccess=function(T){me=T.target.result.docCount},T.update_seq&&(Ae=function(T){T.target.result&&0<T.target.result.length&&(be=T.target.result[0])},at.openCursor(null,"prev").onsuccess=function(T){var N=T.target.result,W=void 0;return N&&N.key&&(W=N.key),Ae({target:{result:[W]}})}),z||0===V?void 0:J?(Ye=T.keys,Ze=st,He=C,Xe=new Array(Ye.length),nt=0,void Ye.forEach((function(T,N){Ze.get(T).onsuccess=function(W){W.target.result?Xe[N]=W.target.result:Xe[N]={key:T,error:"not_found"},++nt===Ye.length&&He(Ye,Xe,{})}}))):-1===V?function(T,N,W){if("function"!=typeof T.getAll){var U=[];T.openCursor(N).onsuccess=function(T){var N=T.target.result;N?(U.push(N.value),N.continue()):W({target:{result:U}})}}else T.getAll(N).onsuccess=W}(st,U,(function(N){var W=N.target.result;T.descending&&(W=W.reverse()),x(W)})):void nn(st,U,T.descending,V+Q,C)}(T,z,N)},T._changes=function(N){return function un(T,N,W,U){if((T=R(T)).continuous){var z=W+":"+en();return Fn.addListener(W,z,N,T),Fn.notify(W),{cancel:function(){Fn.removeListener(W,z)}}}var G=T.doc_ids&&new ie(T.doc_ids);T.since=T.since||0;var F=T.since,K="limit"in T?T.limit:-1;0===K&&(K=1);var J,Q,V,se,ae=[],me=0,be=X(T),Ae=new oe;function m(T,N,W,U){if(W.seq!==N)return U();if(W.winningRev===T._rev)return U(W,T);var z=T._id+"::"+W.winningRev;se.get(z).onsuccess=function(T){U(W,Qt(T.target.result))}}function s(){T.complete(null,{results:ae,last_seq:F})}var Ye=[yn,_n];T.attachments&&Ye.push(Bn);var Ze=Zt(U,Ye,"readonly");if(Ze.error)return T.complete(Ze.error);(J=Ze.txn).onabort=zt(T.complete),J.oncomplete=function(){!T.continuous&&T.attachments?Ht(ae).then(s):s()},Q=J.objectStore(_n),V=J.objectStore(yn),se=Q.index("_doc_id_rev"),nn(Q,T.since&&!T.descending?IDBKeyRange.lowerBound(T.since,!0):null,T.descending,K,(function(N,W,U){if(U&&N.length){var z=new Array(N.length),Q=new Array(N.length),ie=0;W.forEach((function(W,F){!function(T,N,W){if(G&&!G.has(T._id))return W();var U=Ae.get(T._id);if(U)return m(T,N,U,W);V.get(T._id).onsuccess=function(z){U=Gt(z.target.result),Ae.set(T._id,U),m(T,N,U,W)}}(Qt(W),N[F],(function(W,G){Q[F]=W,z[F]=G,++ie===N.length&&function(){for(var N=[],W=0,G=z.length;W<G&&me!==K;W++){var F=z[W];if(F){var J=Q[W];N.push(u(J,F))}}Promise.all(N).then((function(N){for(var W=0,U=N.length;W<U;W++)N[W]&&T.onChange(N[W])})).catch(T.complete),me!==K&&U.continue()}()}))}))}function u(N,W){var U=T.processChange(W,N,T);F=U.seq=N.seq;var z=be(U);return"object"==typeof z?Promise.reject(z):z?(me++,T.return_docs&&ae.push(U),T.attachments&&T.include_docs?new Promise((function(N){Yt(W,T,J,(function(){Ht([U],T.binary).then((function(){N(U)}))}))})):Promise.resolve(U)):Promise.resolve()}}))}(N,T,U,z)},T._close=function(T){z.close(),Zn.delete(U),T()},T._getRevisionTree=function(T,N){var W=Zt(z,[yn],"readonly");if(W.error)return N(W.error);W.txn.objectStore(yn).get(T).onsuccess=function(T){var W=Gt(T.target.result);W?N(null,W.rev_tree):N(Y(Ye))}},T._doCompaction=function(T,N,W){var U=Zt(z,[yn,_n,Bn,In],"readwrite");if(U.error)return W(U.error);var G=U.txn;G.objectStore(yn).get(T).onsuccess=function(W){var U=Gt(W.target.result);Se(U.rev_tree,(function(T,W,U,z,G){var F=W+"-"+U;-1!==N.indexOf(F)&&(G.status="missing")})),Xt(N,T,G);var z=U.winningRev,F=U.deleted;G.objectStore(yn).put(Vt(U,z,F))},G.onabort=zt(W),G.oncomplete=function(){W()}},T._getLocal=function(T,N){var W=Zt(z,[Wn],"readonly");if(W.error)return N(W.error);var U=W.txn.objectStore(Wn).get(T);U.onerror=zt(N),U.onsuccess=function(T){var W=T.target.result;W?(delete W._doc_id_rev,N(null,W)):N(Y(Ye))}},T._putLocal=function(T,N,W){"function"==typeof N&&(W=N,N={}),delete T._revisions;var U=T._rev,G=T._id;T._rev=U?"0-"+(parseInt(U.split("-")[1],10)+1):"0-1";var F,K=N.ctx;if(!K){var J=Zt(z,[Wn],"readwrite");if(J.error)return W(J.error);(K=J.txn).onerror=zt(W),K.oncomplete=function(){F&&W(null,F)}}var Q,V=K.objectStore(Wn);U?(Q=V.get(G)).onsuccess=function(z){var G=z.target.result;G&&G._rev===U?V.put(T).onsuccess=function(){F={ok:!0,id:T._id,rev:T._rev},N.ctx&&W(null,F)}:W(Y(Ze))}:((Q=V.add(T)).onerror=function(T){W(Y(Ze)),T.preventDefault(),T.stopPropagation()},Q.onsuccess=function(){F={ok:!0,id:T._id,rev:T._rev},N.ctx&&W(null,F)})},T._removeLocal=function(T,N,W){"function"==typeof N&&(W=N,N={});var U,G=N.ctx;if(!G){var F=Zt(z,[Wn],"readwrite");if(F.error)return W(F.error);(G=F.txn).oncomplete=function(){U&&W(null,U)}}var K=T._id,J=G.objectStore(Wn),Q=J.get(K);Q.onerror=zt(W),Q.onsuccess=function(z){var G=z.target.result;G&&G._rev===T._rev?(J.delete(K),U={ok:!0,id:K,rev:"0-0"},N.ctx&&W(null,U)):W(Y(Ye))}},T._destroy=function(T,N){Fn.removeAllListeners(U);var W=er.get(U);W&&W.result&&(W.result.close(),Zn.delete(U));var z=indexedDB.deleteDatabase(U);z.onsuccess=function(){er.delete(U),j()&&U in localStorage&&delete localStorage[U],N(null,{ok:!0})},z.onerror=zt(N)};var F=Zn.get(U);if(F)return z=F.idb,T._meta=F.global,G((function(){W(null,T)}));var K=indexedDB.open(U,5);er.set(U,K),K.onupgradeneeded=function(T){var N=T.target.result;if(T.oldVersion<1)return function(T){var N=T.createObjectStore(yn,{keyPath:"id"});T.createObjectStore(_n,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),T.createObjectStore(Bn,{keyPath:"digest"}),T.createObjectStore(Tn,{keyPath:"id",autoIncrement:!1}),T.createObjectStore(Gn),N.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),T.createObjectStore(Wn,{keyPath:"_id"});var W=T.createObjectStore(In,{autoIncrement:!0});W.createIndex("seq","seq"),W.createIndex("digestSeq","digestSeq",{unique:!0})}(N);var W,U=T.currentTarget.transaction;T.oldVersion<3&&N.createObjectStore(Wn,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),T.oldVersion<4&&((W=N.createObjectStore(In,{autoIncrement:!0})).createIndex("seq","seq"),W.createIndex("digestSeq","digestSeq",{unique:!0}));var z=[s,a,u,c],G=T.oldVersion;!function e(){var T=z[G-1];G++,T&&T(U,e)}()},K.onsuccess=function(N){(z=N.target.result).onversionchange=function(){z.close(),Zn.delete(U)},z.onabort=function(T){E("error","Database has a global failure",T.target.error),z.close(),Zn.delete(U)};var G,F,K,J,Q,V,ie=z.transaction([Tn,Gn,yn],"readwrite"),oe=!1;function c(){void 0!==K&&oe&&(T._meta={name:U,instanceId:J,blobSupport:K},Zn.set(U,{idb:z,global:T._meta}),W(null,T))}function f(){if(void 0!==F&&void 0!==G){var T=U+"_id";T in G?J=G[T]:G[T]=J=en(),G.docCount=F,ie.objectStore(Tn).put(G)}}ie.objectStore(Tn).get(Tn).onsuccess=function(T){G=T.target.result||{id:Tn},f()},Q=function(T){F=T,f()},ie.objectStore(yn).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(T){Q(T.target.result)},Qn||(V=ie,Qn=new Promise((function(T){var N=he([""]),W=V.objectStore(Gn).put(N,"key");W.onsuccess=function(){var N=navigator.userAgent.match(/Chrome\/(\d+)/),W=navigator.userAgent.match(/Edge\//);T(W||!N||43<=parseInt(N[1],10))},W.onerror=V.onabort=function(N){N.preventDefault(),N.stopPropagation(),T(!1)}})).catch((function(){return!1}))),Qn.then((function(T){K=T,c()})),ie.oncomplete=function(){oe=!0,c()},ie.onabort=zt(W)},K.onerror=function(){var T="Failed to open indexedDB, are you in private browsing mode?";E("error",T),W(Y(Rt,T))}}(F,T,N)},U=N,z=F.constructor,Jn.push((function(){W((function(T,N){!function(T,N,W,U){try{T(N,W)}catch(N){U.emit("error",N)}}(U,T,N,z),Kn=!1,G((function(){an()}))}))})),an()}dn.valid=function(){try{return"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(U){return!1}};var tr={};function gn(T){var N=(T.doc||T.ok)._attachments;N&&Object.keys(N).forEach((function(T){var W=N[T];W.data=ve(W.data,W.content_type)}))}function mn(T){return/^_design/.test(T)?"_design/"+encodeURIComponent(T.slice(8)):/^_local/.test(T)?"_local/"+encodeURIComponent(T.slice(7)):encodeURIComponent(T)}function bn(T){return T._attachments&&Object.keys(T._attachments)?Promise.all(Object.keys(T._attachments).map((function(N){var W=T._attachments[N];if(W.data&&"string"!=typeof W.data)return new Promise((function(T){ge(W.data,T)})).then((function(T){W.data=T}))}))):Promise.resolve()}function kn(T,N){return jn(T,T.db+"/"+N)}function jn(T,N){var W=T.path?"/":"";return T.protocol+"://"+T.host+(T.port?":"+T.port:"")+"/"+T.path+W+N}function On(T){return"?"+Object.keys(T).map((function(N){return N+"="+encodeURIComponent(T[N])})).join("&")}function qn(T,N){var U=this,F=function wn(T,N){if(function(T){if(!T.prefix)return!1;var N=ue(T.prefix).protocol;return"http"===N||"https"===N}(N)){var W=N.name.substr(N.prefix.length);T=N.prefix.replace(/\/?$/,"/")+encodeURIComponent(W)}var U=ue(T);(U.user||U.password)&&(U.auth={username:U.user,password:U.password});var z=U.path.replace(/(^\/|\/$)/g,"").split("/");return U.db=z.pop(),-1===U.db.indexOf("%")&&(U.db=encodeURIComponent(U.db)),U.path=z.join("/"),U}(T.name,T),K=kn(F,"");T=R(T);var J,a=function(N,W){if((W=W||{}).headers=W.headers||new cn,T.auth||F.auth){var U=T.auth||F.auth,z=U.username+":"+U.password,G=de(unescape(encodeURIComponent(z)));W.headers.set("Authorization","Basic "+G)}var K,J,Q,V,ie,oe,se=T.headers||{};return Object.keys(se).forEach((function(T){W.headers.append(T,se[T])})),K=W,Q=-1!==(J="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"").indexOf("msie"),V=-1!==J.indexOf("trident"),ie=-1!==J.indexOf("edge"),oe=!("method"in K)||"GET"===K.method,(Q||V||ie)&&oe&&(N+=(-1===N.indexOf("?")?"?":"&")+"_nonce="+Date.now()),(T.fetch||sn)(N,W)};function i(T,N){return h(T,z((function(T){g().then((function(){return N.apply(this,T)})).catch((function(N){T.pop()(N)}))}))).bind(U)}function _(T,N,W){var U={};return(N=N||{}).headers=N.headers||new cn,N.headers.get("Content-Type")||N.headers.set("Content-Type","application/json"),N.headers.get("Accept")||N.headers.set("Accept","application/json"),a(T,N).then((function(T){return U.ok=T.ok,U.status=T.status,T.json()})).then((function(T){if(U.data=T,!U.ok){U.data.status=U.status;var N=H(U.data);if(W)return W(N);throw N}if(Array.isArray(U.data)&&(U.data=U.data.map((function(T){return T.error||T.missing?H(T):T}))),!W)return U;W(null,U.data)}))}function g(){return T.skip_setup?Promise.resolve():J||((J=_(K).catch((function(T){return T&&T.status&&404===T.status?(S(404,"PouchDB is just detecting if the remote exists."),_(K,{method:"PUT"})):Promise.reject(T)})).catch((function(T){return!(!T||!T.status||412!==T.status)||Promise.reject(T)}))).catch((function(){J=null})),J)}function c(T){return T.split("/").map(encodeURIComponent).join("/")}G((function(){N(null,U)})),U._remote=!0,U.type=function(){return"http"},U.id=i("id",(function(T){a(jn(F,"")).then((function(T){return T.json()})).then((function(N){var W=N&&N.uuid?N.uuid+F.db:kn(F,"");T(null,W)})).catch((function(N){T(N)}))})),U.compact=i("compact",(function(T,N){"function"==typeof T&&(N=T,T={}),T=R(T),_(kn(F,"_compact"),{method:"POST"}).then((function(){!function n(){U.info((function(W,U){U&&!U.compact_running?N(null,{ok:!0}):setTimeout(n,T.interval||200)}))}()}))})),U.bulkGet=h("bulkGet",(function(T,N){var W=this;function e(N){var W={};T.revs&&(W.revs=!0),T.attachments&&(W.attachments=!0),T.latest&&(W.latest=!0),_(kn(F,"_bulk_get"+On(W)),{method:"POST",body:JSON.stringify({docs:T.docs})}).then((function(W){T.attachments&&T.binary&&W.data.results.forEach((function(T){T.docs.forEach(gn)})),N(null,W.data)})).catch(N)}function n(){var U=Math.ceil(T.docs.length/50),z=0,G=new Array(U);function t(T){return function(W,F){G[T]=F.results,++z===U&&N(null,{results:Z(G)})}}for(var F=0;F<U;F++){var K=m(T,["revs","attachments","binary","latest"]);K.docs=T.docs.slice(50*F,Math.min(T.docs.length,50*(F+1))),k(W,K,t(F))}}var U=jn(F,""),z=tr[U];"boolean"!=typeof z?e((function(T,W){T?(tr[U]=!1,S(T.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),n()):(tr[U]=!0,N(null,W))})):z?e(N):n()})),U._info=function(T){g().then((function(){return a(kn(F,""))})).then((function(T){return T.json()})).then((function(N){N.host=kn(F,""),T(null,N)})).catch(T)},U.fetch=function(T,N){return g().then((function(){return a(kn(F,T),N)}))},U.get=i("get",(function(T,N,U){"function"==typeof N&&(U=N,N={});var z={};function r(T){var U=T._attachments,z=U&&Object.keys(U);if(U&&z.length){var G,K=z.map((function(z){return function(){return K=U[G=z],J=mn(T._id)+"/"+c(G)+"?rev="+T._rev,a(kn(F,J)).then((function(T){return void 0===W||W.browser?T.blob():T.buffer()})).then((function(T){return N.binary?(void 0===W||W.browser||(T.type=K.content_type),T):new Promise((function(N){ge(T,N)}))})).then((function(T){delete K.stub,delete K.length,K.data=T}));var G,K,J}}));return G=K,5,new Promise((function(T,N){var W,U=0,z=0,F=0,K=G.length;function a(){++F===K?W?N(W):T():f()}function u(){U--,a()}function c(T){U--,W=W||T,a()}function f(){for(;U<5&&z<K;)U++,G[z++]().then(u,c)}f()}))}}(N=R(N)).revs&&(z.revs=!0),N.revs_info&&(z.revs_info=!0),N.latest&&(z.latest=!0),N.open_revs&&("all"!==N.open_revs&&(N.open_revs=JSON.stringify(N.open_revs)),z.open_revs=N.open_revs),N.rev&&(z.rev=N.rev),N.conflicts&&(z.conflicts=N.conflicts),N.update_seq&&(z.update_seq=N.update_seq),T=mn(T),_(kn(F,T+On(z))).then((function(T){return Promise.resolve().then((function(){if(N.attachments)return W=T.data,Array.isArray(W)?Promise.all(W.map((function(T){if(T.ok)return r(T.ok)}))):r(W);var W})).then((function(){U(null,T.data)}))})).catch((function(N){N.docId=T,U(N)}))})),U.remove=i("remove",(function(T,N,W,U){var z;"string"==typeof N?(z={_id:T,_rev:N},"function"==typeof W&&(U=W,W={})):(z=T,"function"==typeof N?(U=N,W={}):(U=W,W=N));var G=z._rev||W.rev;_(kn(F,mn(z._id))+"?rev="+G,{method:"DELETE"},U).catch(U)})),U.getAttachment=i("getAttachment",(function(T,N,U,z){"function"==typeof U&&(z=U,U={});var G,K=U.rev?"?rev="+U.rev:"",J=kn(F,mn(T))+"/"+c(N)+K;a(J,{method:"GET"}).then((function(T){if(G=T.headers.get("content-type"),T.ok)return void 0===W||W.browser?T.blob():T.buffer();throw T})).then((function(T){void 0===W||W.browser||(T.type=G),z(null,T)})).catch((function(T){z(T)}))})),U.removeAttachment=i("removeAttachment",(function(T,N,W,U){_(kn(F,mn(T)+"/"+c(N))+"?rev="+W,{method:"DELETE"},U).catch(U)})),U.putAttachment=i("putAttachment",(function(T,N,W,U,z,G){"function"==typeof z&&(G=z,z=U,U=W,W=null);var K=mn(T)+"/"+c(N),J=kn(F,K);if(W&&(J+="?rev="+W),"string"==typeof U){var Q;try{Q=le(U)}catch(T){return G(Y(at,"Attachment is not a valid base64 string"))}U=Q?pe(Q,z):""}_(J,{headers:new cn({"Content-Type":z}),method:"PUT",body:U},G).catch(G)})),U._bulkDocs=function(T,N,W){T.new_edits=N.new_edits,g().then((function(){return Promise.all(T.docs.map(bn))})).then((function(){return _(kn(F,"_bulk_docs"),{method:"POST",body:JSON.stringify(T)},W)})).catch(W)},U._put=function(T,N,W){g().then((function(){return bn(T)})).then((function(){return _(kn(F,mn(T._id)),{method:"PUT",body:JSON.stringify(T)})})).then((function(T){W(null,T.data)})).catch((function(N){N.docId=T&&T._id,W(N)}))},U.allDocs=i("allDocs",(function(T,N){"function"==typeof T&&(N=T,T={});var W,U={},z="GET";(T=R(T)).conflicts&&(U.conflicts=!0),T.update_seq&&(U.update_seq=!0),T.descending&&(U.descending=!0),T.include_docs&&(U.include_docs=!0),T.attachments&&(U.attachments=!0),T.key&&(U.key=JSON.stringify(T.key)),T.start_key&&(T.startkey=T.start_key),T.startkey&&(U.startkey=JSON.stringify(T.startkey)),T.end_key&&(T.endkey=T.end_key),T.endkey&&(U.endkey=JSON.stringify(T.endkey)),void 0!==T.inclusive_end&&(U.inclusive_end=!!T.inclusive_end),void 0!==T.limit&&(U.limit=T.limit),void 0!==T.skip&&(U.skip=T.skip);var G=On(U);void 0!==T.keys&&(z="POST",W={keys:T.keys}),_(kn(F,"_all_docs"+G),{method:z,body:JSON.stringify(W)}).then((function(W){T.include_docs&&T.attachments&&T.binary&&W.data.rows.forEach(gn),N(null,W.data)})).catch(N)})),U._changes=function(T){var N="batch_size"in T?T.batch_size:25;!(T=R(T)).continuous||"heartbeat"in T||(T.heartbeat=1e4);var W="timeout"in T?T.timeout:3e4;"timeout"in T&&T.timeout&&W-T.timeout<5e3&&(W=T.timeout+5e3),"heartbeat"in T&&T.heartbeat&&W-T.heartbeat<5e3&&(W=T.heartbeat+5e3);var U={};"timeout"in T&&T.timeout&&(U.timeout=T.timeout);var z=void 0!==T.limit&&T.limit,K=z;if(T.style&&(U.style=T.style),(T.include_docs||T.filter&&"function"==typeof T.filter)&&(U.include_docs=!0),T.attachments&&(U.attachments=!0),T.continuous&&(U.feed="longpoll"),T.seq_interval&&(U.seq_interval=T.seq_interval),T.conflicts&&(U.conflicts=!0),T.descending&&(U.descending=!0),T.update_seq&&(U.update_seq=!0),"heartbeat"in T&&T.heartbeat&&(U.heartbeat=T.heartbeat),T.filter&&"string"==typeof T.filter&&(U.filter=T.filter),T.view&&"string"==typeof T.view&&(U.filter="_view",U.view=T.view),T.query_params&&"object"==typeof T.query_params)for(var J in T.query_params)T.query_params.hasOwnProperty(J)&&(U[J]=T.query_params[J]);var Q,V="GET";T.doc_ids?(U.filter="_doc_ids",V="POST",Q={doc_ids:T.doc_ids}):T.selector&&(U.filter="_selector",V="POST",Q={selector:T.selector});var ie,oe=new on,h=function(W,G){if(!T.aborted){U.since=W,"object"==typeof U.since&&(U.since=JSON.stringify(U.since)),T.descending?z&&(U.limit=K):U.limit=!z||N<K?N:K;var J=kn(F,"_changes"+On(U)),se={signal:oe.signal,method:V,body:JSON.stringify(Q)};ie=W,T.aborted||g().then((function(){return _(J,se,G)})).catch(G)}},se={results:[]},v=function(W,U){if(!T.aborted){var F=0;if(U&&U.results){F=U.results.length,se.last_seq=U.last_seq;var J=null,Q=null;"number"==typeof U.pending&&(J=U.pending),"string"!=typeof se.last_seq&&"number"!=typeof se.last_seq||(Q=se.last_seq),T.query_params,U.results=U.results.filter((function(N){K--;var W=X(T)(N);return W&&(T.include_docs&&T.attachments&&T.binary&&gn(N),T.return_docs&&se.results.push(N),T.onChange(N,J,Q)),W}))}else if(W)return T.aborted=!0,void T.complete(W);U&&U.last_seq&&(ie=U.last_seq);var V=z&&K<=0||U&&F<N||T.descending;(!T.continuous||z&&K<=0)&&V?T.complete(null,se):G((function(){h(ie,v)}))}};return h(T.since||0,v),{cancel:function(){T.aborted=!0,oe.abort()}}},U.revsDiff=i("revsDiff",(function(T,N,W){"function"==typeof N&&(W=N,N={}),_(kn(F,"_revs_diff"),{method:"POST",body:JSON.stringify(T)},W).catch(W)})),U._close=function(T){T()},U._destroy=function(T,N){_(kn(F,""),{method:"DELETE"}).then((function(T){N(null,T)})).catch((function(T){404===T.status?N(null,{ok:!0}):N(T)}))}}function An(T){this.status=400,this.name="query_parse_error",this.message=T,this.error=!0;try{Error.captureStackTrace(this,An)}catch(T){}}function En(T){this.status=404,this.name="not_found",this.message=T,this.error=!0;try{Error.captureStackTrace(this,En)}catch(T){}}function Sn(T){this.status=500,this.name="invalid_value",this.message=T,this.error=!0;try{Error.captureStackTrace(this,Sn)}catch(T){}}function xn(T,N){return N&&T.then((function(T){G((function(){N(null,T)}))}),(function(T){G((function(){N(T)}))})),T}function Cn(T,N){return function(){var W=arguments,U=this;return T.add((function(){return N.apply(U,W)}))}}function Pn(T){var N=new ie(T),W=new Array(N.size),U=-1;return N.forEach((function(T){W[++U]=T})),W}function Ln(T){var N=new Array(T.size),W=-1;return T.forEach((function(T,U){N[++W]=U})),N}function Dn(T){return new Sn("builtin "+T+" function requires map values to be numbers or number arrays")}function $n(T){for(var N=0,W=0,U=T.length;W<U;W++){var z=T[W];if("number"!=typeof z){if(!Array.isArray(z))throw Dn("_sum");N="number"==typeof N?[N]:N;for(var G=0,F=z.length;G<F;G++){var K=z[G];if("number"!=typeof K)throw Dn("_sum");void 0===N[G]?N.push(K):N[G]+=K}}else"number"==typeof N?N+=z:N[0]+=z}return N}qn.valid=function(){return!0},K(An,Error),K(En,Error),K(Sn,Error);var nr=E.bind(null,"log"),or=Array.isArray,ur=JSON.parse;function Rn(T,N){return ce("return ("+T.replace(/;\s*$/,"")+");",{emit:N,sum:$n,log:nr,isArray:or,toJSON:ur})}function Mn(){this.promise=new Promise((function(T){T()}))}function Nn(T){if(!T)return"undefined";switch(typeof T){case"function":case"string":return T.toString();default:return JSON.stringify(T)}}function Un(T,N,W,U,z,G){var F,K,J=(F=U,Nn(W)+Nn(F)+"undefined");if(!z&&(K=T._cachedViews=T._cachedViews||{})[J])return K[J];var Q=T.info().then((function(F){var Q=F.db_name+"-mrview-"+(z?"temp":Oe(J));return fe(T,"_local/"+G,(function(T){T.views=T.views||{};var W=N;-1===W.indexOf("/")&&(W=N+"/"+N);var U=T.views[W]=T.views[W]||{};if(!U[Q])return U[Q]=!0,T})).then((function(){return T.registerDependentDatabase(Q).then((function(N){var z=N.db;z.auto_compaction=!0;var G={name:Q,db:z,sourceDB:T,adapter:T.adapter,mapFun:W,reduceFun:U};return G.db.get("_local/lastSeq").catch((function(T){if(404!==T.status)throw T})).then((function(T){return G.seq=T?T.seq:0,K&&G.db.once("destroyed",(function(){delete K[J]})),G}))}))}))}));return K&&(K[J]=Q),Q}Mn.prototype.add=function(T){return this.promise=this.promise.catch((function(){})).then((function(){return T()})),this.promise},Mn.prototype.finish=function(){return this.promise};var yr={},_r=new Mn;function zn(T){return-1===T.indexOf("/")?[T,T]:T.split("/")}function Vn(T,N){try{T.emit("error",N)}catch(T){E("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),E("error",N)}}var Gn__sum=function(T,N){return $n(N)},Gn__count=function(T,N){return N.length},Gn__stats=function(T,N){return{sum:$n(N),min:Math.min.apply(null,N),max:Math.max.apply(null,N),count:N.length,sumsqr:function(T){for(var N=0,W=0,U=T.length;W<U;W++){var z=T[W];N+=z*z}return N}(N)}},gr=function(T,N,W,U){function d(T,N,W){try{N(W)}catch(N){Vn(T,N)}}function y(T,N,W,U,z){try{return{output:N(W,U,z)}}catch(N){return Vn(T,N),{error:N}}}function h(T,N){var W=ct(T.key,N.key);return 0!==W?W:ct(T.value,N.value)}function _(T){var N=T.value;return N&&"object"==typeof N&&N._id||T.id}function p(T){return function(N){return T.include_docs&&T.attachments&&T.binary&&N.rows.forEach((function(T){var N=T.doc&&T.doc._attachments;N&&Object.keys(N).forEach((function(T){var W=N[T];N[T].data=ve(W.data,W.content_type)}))})),N}}function g(T,N,W,U){var z=N[T];void 0!==z&&(U&&(z=encodeURIComponent(JSON.stringify(z))),W.push(T+"="+z))}function s(T){if(void 0!==T){var N=Number(T);return isNaN(N)||N!==parseInt(T,10)?T:N}}function m(T,N){var W=T.descending?"endkey":"startkey",U=T.descending?"startkey":"endkey";if(void 0!==T[W]&&void 0!==T[U]&&0<ct(T[W],T[U]))throw new An("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(N.reduce&&!1!==T.reduce){if(T.include_docs)throw new An("{include_docs:true} is invalid for reduce");if(T.keys&&1<T.keys.length&&!T.group&&!T.group_level)throw new An("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach((function(N){var W=function(T){if(T){if("number"!=typeof T)return new An('Invalid value for integer: "'+T+'"');if(T<0)return new An('Invalid value for positive integer: "'+T+'"')}}(T[N]);if(W)throw W}))}function b(T){return function(N){if(404===N.status)return T;throw N}}function r(T){var N="string"==typeof T?T:T.name,W=yr[N];return W||(W=yr[N]=new Mn),W}function k(T){return Cn(r(T),(function(){return function(T){var N,W,U=function(T,N){if("function"==typeof T&&2===T.length){var W=T;return function(T){return W(T,N)}}return Rn(T.toString(),N)}(T.mapFun,(function(T,U){var z={id:W._id,key:ft(T)};null!=U&&(z.value=ft(U)),N.push(z)})),z=T.seq||0;function r(N,W){return function(){return z=N,G=W,F="_local/lastSeq",(U=T).db.get(F).catch(b({_id:F,seq:0})).then((function(T){var N=Ln(z);return Promise.all(N.map((function(T){return function w(T,N,W){var U,z="_local/doc_"+T,G={_id:z,keys:[]},F=W.get(T),K=F[0];return(1===(U=F[1]).length&&/^1-/.test(U[0].rev)?Promise.resolve(G):N.db.get(z).catch(b(G))).then((function(T){return(W=T,W.keys.length?N.db.allDocs({keys:W.keys,include_docs:!0}):Promise.resolve({rows:[]})).then((function(N){return function(T,N){for(var W=[],U=new ie,z=0,G=N.rows.length;z<G;z++){var F=N.rows[z].doc;if(F&&(W.push(F),U.add(F._id),F._deleted=!K.has(F._id),!F._deleted)){var J=K.get(F._id);"value"in J&&(F.value=J.value)}}var Q=Ln(K);return Q.forEach((function(T){if(!U.has(T)){var N={_id:T},z=K.get(T);"value"in z&&(N.value=z.value),W.push(N)}})),T.keys=Pn(Q.concat(T.keys)),W.push(T),W}(T,N)}));var W}))}(T,U,z)}))).then((function(N){var W=Z(N);return T.seq=G,W.push(T),U.db.bulkDocs({docs:W})}))}));var U,z,G,F}}var G=new Mn;function o(){return T.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:z,limit:50}).then(e)}function e(F){var K=F.results;if(K.length){var J=function(G){for(var F=new oe,K=0,J=G.length;K<J;K++){var Q=G[K];if("_"!==Q.doc._id[0]){N=[],(W=Q.doc)._deleted||d(T.sourceDB,U,W),N.sort(h);var V=l(N);F.set(Q.doc._id,[V,Q.changes])}z=Q.seq}return F}(K);if(G.add(r(J,z)),!(K.length<50))return o()}}function l(T){for(var N,W=new oe,U=0,z=T.length;U<z;U++){var G=T[U],F=[G.key,G.id];0<U&&0===ct(G.key,N)&&F.push(U),W.set(dt(F),G),N=G.key}return W}return o().then((function(){return G.finish()})).then((function(){T.seq=z}))}(T)}))()}function j(T,N){return Cn(r(T),(function(){return function(T,N){var W,U=T.reduceFun&&!1!==N.reduce,z=N.skip||0;function n(N){return N.include_docs=!0,T.db.allDocs(N).then((function(T){return W=T.total_rows,T.rows.map((function(T){if("value"in T.doc&&"object"==typeof T.doc.value&&null!==T.doc.value){var N=Object.keys(T.doc.value).sort(),W=["id","key","value"];if(!(N<W||W<N))return T.doc.value}var U=function(T){for(var N=[],W=[],U=0;;){var z=T[U++];if("\0"!==z)switch(z){case"1":N.push(null);break;case"2":N.push("1"===T[U]),U++;break;case"3":var G=ht(T,U);N.push(G.num),U+=G.length;break;case"4":for(var F="";;){var K=T[U];if("\0"===K)break;F+=K,U++}F=F.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),N.push(F);break;case"5":var J={element:[],index:N.length};N.push(J.element),W.push(J);break;case"6":var Q={element:{},index:N.length};N.push(Q.element),W.push(Q);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+z)}else{if(1===N.length)return N.pop();pt(N,W)}}}(T.doc._id);return{key:U[0],id:U[1],value:"value"in T.doc?T.doc.value:null}}))}))}function e(G){var F;if(F=U?function(T,N,W){0===W.group_level&&delete W.group_level;var U,z,G,F=W.group||W.group_level,K=function(T){var N=T.toString();return function(T){if(/^_sum/.test(T))return Gn__sum;if(/^_count/.test(T))return Gn__count;if(/^_stats/.test(T))return Gn__stats;if(/^_/.test(T))throw new Error(T+" is not a supported reduce function.")}(N)||Rn(N)}(T.reduceFun),J=[],Q=isNaN(W.group_level)?Number.POSITIVE_INFINITY:W.group_level;N.forEach((function(T){var N=J[J.length-1],W=F?T.key:null;if(F&&Array.isArray(W)&&(W=W.slice(0,Q)),N&&0===ct(N.groupKey,W))return N.keys.push([T.key,T.id]),void N.values.push(T.value);J.push({keys:[[T.key,T.id]],values:[T.value],groupKey:W})})),N=[];for(var V=0,ie=J.length;V<ie;V++){var oe=J[V],se=y(T.sourceDB,K,oe.keys,oe.values,!1);if(se.error&&se.error instanceof Sn)throw se.error;N.push({value:se.error?null:se.output,key:oe.groupKey})}return{rows:(U=N,z=W.limit,G=W.skip,G=G||0,"number"==typeof z?U.slice(G,z+G):0<G?U.slice(G):U)}}(T,G,N):{total_rows:W,offset:z,rows:G},N.update_seq&&(F.update_seq=T.seq),N.include_docs){var K=Pn(G.map(_));return T.sourceDB.allDocs({keys:K,include_docs:!0,conflicts:N.conflicts,attachments:N.attachments,binary:N.binary}).then((function(T){var N=new oe;return T.rows.forEach((function(T){N.set(T.id,T.doc)})),G.forEach((function(T){var W=_(T),U=N.get(W);U&&(T.doc=U)})),F}))}return F}if(void 0===N.keys||N.keys.length||(N.limit=0,delete N.keys),void 0!==N.keys){var G=N.keys.map((function(T){var W={startkey:dt([T]),endkey:dt([T,{}])};return N.update_seq&&(W.update_seq=!0),n(W)}));return Promise.all(G).then(Z).then(e)}var F,K,J={descending:N.descending};if(N.update_seq&&(J.update_seq=!0),"start_key"in N&&(F=N.start_key),"startkey"in N&&(F=N.startkey),"end_key"in N&&(K=N.end_key),"endkey"in N&&(K=N.endkey),void 0!==F&&(J.startkey=N.descending?dt([F,{}]):dt([F])),void 0!==K){var Q=!1!==N.inclusive_end;N.descending&&(Q=!Q),J.endkey=dt(Q?[K,{}]:[K])}if(void 0!==N.key){var V=dt([N.key]),ie=dt([N.key,{}]);J.descending?(J.endkey=V,J.startkey=ie):(J.startkey=V,J.endkey=ie)}return U||("number"==typeof N.limit&&(J.limit=N.limit),J.skip=z),n(J).then(e)}(T,N)}))()}function a(N,W,U){if("function"==typeof N._query)return z=N,F=W,K=U,new Promise((function(T,N){z._query(F,K,(function(W,U){if(W)return N(W);T(U)}))}));var z,F,K;if(te(N))return function(T,N,W){var U,z,G,F=[],K="GET";if(g("reduce",W,F),g("include_docs",W,F),g("attachments",W,F),g("limit",W,F),g("descending",W,F),g("group",W,F),g("group_level",W,F),g("skip",W,F),g("stale",W,F),g("conflicts",W,F),g("startkey",W,F,!0),g("start_key",W,F,!0),g("endkey",W,F,!0),g("end_key",W,F,!0),g("inclusive_end",W,F),g("key",W,F,!0),g("update_seq",W,F),F=""===(F=F.join("&"))?"":"?"+F,void 0!==W.keys){var J="keys="+encodeURIComponent(JSON.stringify(W.keys));J.length+F.length+1<=2e3?F+=("?"===F[0]?"&":"?")+J:(K="POST","string"==typeof N?U={keys:W.keys}:N.keys=W.keys)}if("string"==typeof N){var Q=zn(N);return T.fetch("_design/"+Q[0]+"/_view/"+Q[1]+F,{headers:new cn({"Content-Type":"application/json"}),method:K,body:JSON.stringify(U)}).then((function(T){return z=T.ok,G=T.status,T.json()})).then((function(T){if(!z)throw T.status=G,H(T);return T.rows.forEach((function(T){if(T.value&&T.value.error&&"builtin_reduce_error"===T.value.error)throw new Error(T.reason)})),T})).then(p(W))}return U=U||{},Object.keys(N).forEach((function(T){Array.isArray(N[T])?U[T]=N[T]:U[T]=N[T].toString()})),T.fetch("_temp_view"+F,{headers:new cn({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(U)}).then((function(T){return z=T.ok,G=T.status,T.json()})).then((function(T){if(!z)throw T.status=G,H(T);return T})).then(p(W))}(N,W,U);if("string"!=typeof W)return m(U,W),_r.add((function(){return Un(N,"temp_view/temp_view",W.map,W.reduce,!0,T).then((function(T){return N=k(T).then((function(){return j(T,U)})),W=function(){return T.db.destroy()},N.then((function(T){return W().then((function(){return T}))}),(function(T){return W().then((function(){throw T}))}));var N,W}))})),_r.finish();var J=W,Q=zn(J),V=Q[0],ie=Q[1];return N.get("_design/"+V).then((function(W){var z=W.views&&W.views[ie];if(!z)throw new En("ddoc "+W._id+" has no view named "+ie);return function(T,N){var W=T.views&&T.views[N];if("string"!=typeof W.map)throw new En("ddoc "+T._id+" has no string view named "+N+", instead found object of type: "+typeof W.map)}(W,ie),m(U,z),Un(N,J,z.map,z.reduce,!1,T).then((function(T){return"ok"===U.stale||"update_after"===U.stale?("update_after"===U.stale&&G((function(){k(T)})),j(T,U)):k(T).then((function(){return j(T,U)}))}))}))}var F;return{query:function(T,N,W){var U,z=this;"function"==typeof N&&(W=N,N={}),N=N?((U=N).group_level=s(U.group_level),U.limit=s(U.limit),U.skip=s(U.skip),U):{},"function"==typeof T&&(T={map:T});var G=Promise.resolve().then((function(){return a(z,T,N)}));return xn(G,W),G},viewCleanup:(F=function(){var N,W,U=this;return"function"==typeof U._viewCleanup?(N=U,new Promise((function(T,W){N._viewCleanup((function(N,U){if(N)return W(N);T(U)}))}))):te(U)?U.fetch("_view_cleanup",{headers:new cn({"Content-Type":"application/json"}),method:"POST"}).then((function(T){return T.json()})):(W=U).get("_local/"+T).then((function(T){var N=new oe;Object.keys(T.views).forEach((function(T){var W=zn(T),U="_design/"+W[0],z=W[1],G=N.get(U);G||(G=new ie,N.set(U,G)),G.add(z)}));var U={keys:Ln(N),include_docs:!0};return W.allDocs(U).then((function(U){var z={};U.rows.forEach((function(W){var U=W.key.substring(8);N.get(W.key).forEach((function(N){var G=U+"/"+N;T.views[G]||(G=N);var F=Object.keys(T.views[G]),K=W.doc&&W.doc.views&&W.doc.views[N];F.forEach((function(T){z[T]=z[T]||K}))}))}));var G=Object.keys(z).filter((function(T){return!z[T]})).map((function(T){return Cn(r(T),(function(){return new W.constructor(T,W.__opts).destroy()}))()}));return Promise.all(G).then((function(){return{ok:!0}}))}))}),b({ok:!0}))},z((function(T){var N=T.pop(),W=F.apply(this,T);return"function"==typeof N&&xn(W,N),W})))}}("mrviews"),mr={query:function(T,N,W){return gr.query.call(this,T,N,W)},viewCleanup:function(T){return gr.viewCleanup.call(this,T)}};function Yn(T){return/^1-/.test(T)}function Hn(T,N){var W=Object.keys(N._attachments);return Promise.all(W.map((function(W){return T.getAttachment(N._id,W,{rev:N._rev})})))}function Xn(T,N,W,U){W=R(W);var z=[],G=!0;return Promise.resolve().then((function(){var N=Object.keys(W).filter((function(T){var N=W[T].missing;return 1===N.length&&Yn(N[0])}));if(0<N.length)return function t(N){return T.allDocs({keys:N,include_docs:!0,conflicts:!0}).then((function(T){if(U.cancelled)throw new Error("cancelled");T.rows.forEach((function(T){var N,U;T.deleted||!T.doc||!Yn(T.value.rev)||(U=T.doc)._attachments&&0<Object.keys(U._attachments).length||(N=T.doc)._conflicts&&0<N._conflicts.length||(T.doc._conflicts&&delete T.doc._conflicts,z.push(T.doc),delete W[T.id])}))}))}(N)})).then((function(){var F,K,J=(F=W,K=[],Object.keys(F).forEach((function(T){F[T].missing.forEach((function(N){K.push({id:T,rev:N})}))})),{docs:K,revs:!0,latest:!0});if(J.docs.length)return T.bulkGet(J).then((function(W){if(U.cancelled)throw new Error("cancelled");return Promise.all(W.results.map((function(W){return Promise.all(W.docs.map((function(W){var U,z,F,K,J,Q=W.ok;return W.error&&(G=!1),Q&&Q._attachments?(U=N,z=T,F=Q,K=te(z)&&!te(U),J=Object.keys(F._attachments),K?U.get(F._id).then((function(T){return Promise.all(J.map((function(N){return G=F,K=N,(W=T)._attachments&&W._attachments[K]&&W._attachments[K].digest===G._attachments[K].digest?U.getAttachment(T._id,N):z.getAttachment(F._id,N);var W,G,K})))})).catch((function(T){if(404!==T.status)throw T;return Hn(z,F)})):Hn(z,F)).then((function(T){var N=Object.keys(Q._attachments);return T.forEach((function(T,W){var U=Q._attachments[N[W]];delete U.stub,delete U.length,U.data=T})),Q})):Q})))}))).then((function(T){z=z.concat(Z(T).filter(Boolean))}))}))})).then((function(){return{ok:G,docs:z}}))}var br="pouchdb";function rr(T,N,W,U,z){return T.get(N).catch((function(W){if(404===W.status)return"http"!==T.adapter&&"https"!==T.adapter||S(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:U,_id:N,history:[],replicator:br,version:1};throw W})).then((function(G){if(!z.cancelled&&G.last_seq!==W)return G.history=(G.history||[]).filter((function(T){return T.session_id!==U})),G.history.unshift({last_seq:W,session_id:U}),G.history=G.history.slice(0,5),G.version=1,G.replicator=br,G.session_id=U,G.last_seq=W,T.put(G).catch((function(G){if(409===G.status)return rr(T,N,W,U,z);throw G}))}))}function ir(T,N,W,U,z){this.src=T,this.target=N,this.id=W,this.returnValue=U,this.opts=z||{}}ir.prototype.writeCheckpoint=function(T,N){var W=this;return this.updateTarget(T,N).then((function(){return W.updateSource(T,N)}))},ir.prototype.updateTarget=function(T,N){return this.opts.writeTargetCheckpoint?rr(this.target,this.id,T,N,this.returnValue):Promise.resolve(!0)},ir.prototype.updateSource=function(T,N){if(this.opts.writeSourceCheckpoint){var W=this;return rr(this.src,this.id,T,N,this.returnValue).catch((function(T){if(ar(T))return!(W.opts.writeSourceCheckpoint=!1);throw T}))}return Promise.resolve(!0)};var wr={undefined:function(T,N){return 0===ct(T.last_seq,N.last_seq)?N.last_seq:0},1:function(T,N){return function(T,N){return T.session_id===N.session_id?{last_seq:T.last_seq,history:T.history}:function e(T,N){var W=T[0],U=T.slice(1),z=N[0],G=N.slice(1);return W&&0!==N.length?sr(W.session_id,N)?{last_seq:W.last_seq,history:T}:sr(z.session_id,U)?{last_seq:z.last_seq,history:G}:e(U,G):{last_seq:0,history:[]}}(T.history,N.history)}(N,T).last_seq}};function sr(T,N){var W=N[0],U=N.slice(1);return!(!T||0===N.length)&&(T===W.session_id||sr(T,U))}function ar(T){return"number"==typeof T.status&&4===Math.floor(T.status/100)}ir.prototype.getCheckpoint=function(){var T=this;return T.opts&&T.opts.writeSourceCheckpoint&&!T.opts.writeTargetCheckpoint?T.src.get(T.id).then((function(T){return T.last_seq||0})).catch((function(T){if(404!==T.status)throw T;return 0})):T.target.get(T.id).then((function(N){return T.opts&&T.opts.writeTargetCheckpoint&&!T.opts.writeSourceCheckpoint?N.last_seq||0:T.src.get(T.id).then((function(T){return N.version!==T.version?0:(W=N.version?N.version.toString():"undefined")in wr?wr[W](N,T):0;var W}),(function(W){if(404===W.status&&N.last_seq)return T.src.put({_id:T.id,last_seq:0}).then((function(){return 0}),(function(W){return ar(W)?(T.opts.writeSourceCheckpoint=!1,N.last_seq):0}));throw W}))})).catch((function(T){if(404!==T.status)throw T;return 0}))};function fr(T,N,W,U,z){var F,K,J,Q=[],V={seq:0,changes:[],docs:[]},ie=!1,oe=!1,se=!1,ae=0,me=W.continuous||W.live||!1,be=W.batch_size||100,Ae=W.batches_limit||10,Ye=!1,Ze=W.doc_ids,He=W.selector,Xe=[],nt=en();z=z||{ok:!0,start_time:(new Date).toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var st={};function e(){return J?Promise.resolve():function cr(T,N,W){var U,z=W.doc_ids?W.doc_ids.sort(ct):"",G=W.filter?W.filter.toString():"",F="",K="",J="";return W.selector&&(J=JSON.stringify(W.selector)),W.filter&&W.query_params&&(F=JSON.stringify((U=W.query_params,Object.keys(U).sort(ct).reduce((function(T,N){return T[N]=U[N],T}),{})))),W.filter&&"_view"===W.filter&&(K=W.view.toString()),Promise.all([T.id(),N.id()]).then((function(T){var N=T[0]+T[1]+G+K+F+z+J;return new Promise((function(T){je(N,T)}))})).then((function(T){return"_local/"+T.replace(/\//g,".").replace(/\+/g,"_")}))}(T,N,W).then((function(z){K=z;var G;G=!1===W.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===W.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===W.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},J=new ir(T,N,K,U,G)}))}function O(){if(Xe=[],0!==F.docs.length){var T=F.docs,G={timeout:W.timeout};return N.bulkDocs({docs:T,new_edits:!1},G).then((function(N){if(U.cancelled)throw C(),new Error("cancelled");var W=Object.create(null);N.forEach((function(T){T.error&&(W[T.id]=T)}));var G=Object.keys(W).length;z.doc_write_failures+=G,z.docs_written+=T.length-G,T.forEach((function(T){var N=W[T._id];if(N){z.errors.push(N);var G=(N.name||"").toLowerCase();if("unauthorized"!==G&&"forbidden"!==G)throw N;U.emit("denied",R(N))}else Xe.push(T)}))}),(function(N){throw z.doc_write_failures+=T.length,N}))}}function q(){if(F.error)throw new Error("There was a problem getting docs.");z.last_seq=ae=F.seq;var T=R(z);return Xe.length&&(T.docs=Xe,"number"==typeof F.pending&&(T.pending=F.pending,delete F.pending),U.emit("change",T)),ie=!0,J.writeCheckpoint(F.seq,nt).then((function(){if(ie=!1,U.cancelled)throw C(),new Error("cancelled");F=void 0,$()})).catch((function(T){throw B(T),T}))}function A(){return Xn(T,N,F.diffs,U).then((function(T){F.error=!T.ok,T.docs.forEach((function(T){delete F.diffs[T._id],z.docs_read++,F.docs.push(T)}))}))}function E(){var T;U.cancelled||F||(0!==Q.length?(F=Q.shift(),(T={},F.changes.forEach((function(N){"_user/"!==N.id&&(T[N.id]=N.changes.map((function(T){return T.rev})))})),N.revsDiff(T).then((function(T){if(U.cancelled)throw C(),new Error("cancelled");F.diffs=T}))).then(A).then(O).then(q).then(E).catch((function(T){x("batch processing terminated with error",T)}))):S(!0))}function S(T){0!==V.changes.length?(T||oe||V.changes.length>=be)&&(Q.push(V),V={seq:0,changes:[],docs:[]},"pending"!==U.state&&"stopped"!==U.state||(U.state="active",U.emit("active")),E()):0!==Q.length||F||((me&&st.live||oe)&&(U.state="pending",U.emit("paused")),oe&&C())}function x(T,N){se||(N.message||(N.message=T),z.ok=!1,z.status="aborting",Q=[],V={seq:0,changes:[],docs:[]},C(N))}function C(G){if(!(se||U.cancelled&&(z.status="cancelled",ie)))if(z.status=z.status||"complete",z.end_time=(new Date).toISOString(),z.last_seq=ae,se=!0,G){(G=Y(G)).result=z;var F=(G.name||"").toLowerCase();"unauthorized"===F||"forbidden"===F?(U.emit("error",G),U.removeAllListeners()):function(T,N,W,U){if(!1===T.retry)return N.emit("error",W),N.removeAllListeners();if("function"!=typeof T.back_off_function&&(T.back_off_function=M),N.emit("requestError",W),"active"===N.state||"pending"===N.state){N.emit("paused",W),N.state="stopped";var i=function(){T.current_back_off=0};N.once("paused",(function(){N.removeListener("active",i)})),N.once("active",i)}T.current_back_off=T.current_back_off||0,T.current_back_off=T.back_off_function(T.current_back_off),setTimeout(U,T.current_back_off)}(W,U,G,(function(){fr(T,N,W,U)}))}else U.emit("complete",z),U.removeAllListeners()}function P(T,N,z){if(U.cancelled)return C();"number"==typeof N&&(V.pending=N),X(W)(T)&&(V.seq=T.seq||z,V.changes.push(T),G((function(){S(0===Q.length&&st.live)})))}function L(T){if(Ye=!1,U.cancelled)return C();if(0<T.results.length)st.since=T.results[T.results.length-1].seq,$(),S(!0);else{var t=function(){me?(st.live=!0,$()):oe=!0,S(!0)};F||0!==T.results.length?t():(ie=!0,J.writeCheckpoint(T.last_seq,nt).then((function(){ie=!1,z.last_seq=ae=T.last_seq,t()})).catch(B))}}function D(T){if(Ye=!1,U.cancelled)return C();x("changes rejected",T)}function $(){if(!Ye&&!oe&&Q.length<Ae){Ye=!0,U._changes&&(U.removeListener("cancel",U._abortChanges),U._changes.cancel()),U.once("cancel",t);var N=T.changes(st).on("change",P);N.then(n,n),N.then(L).catch(D),W.retry&&(U._changes=N,U._abortChanges=t)}function t(){N.cancel()}function n(){U.removeListener("cancel",t)}}function I(){e().then((function(){if(!U.cancelled)return J.getCheckpoint().then((function(T){st={since:ae=T,limit:be,batch_size:be,style:"all_docs",doc_ids:Ze,selector:He,return_docs:!0},W.filter&&("string"!=typeof W.filter?st.include_docs=!0:st.filter=W.filter),"heartbeat"in W&&(st.heartbeat=W.heartbeat),"timeout"in W&&(st.timeout=W.timeout),W.query_params&&(st.query_params=W.query_params),W.view&&(st.view=W.view),$()}));C()})).catch((function(T){x("getCheckpoint rejected with ",T)}))}function B(T){ie=!1,x("writeCheckpoint completed with error",T)}U.ready(T,N),U.cancelled?C():(U._addedListeners||(U.once("cancel",C),"function"==typeof W.complete&&(U.once("error",W.complete),U.once("complete",(function(T){W.complete(null,T)}))),U._addedListeners=!0),void 0===W.since?I():e().then((function(){return ie=!0,J.writeCheckpoint(W.since,nt)})).then((function(){ie=!1,U.cancelled?C():(ae=W.since,I())})).catch(B))}function lr(){F.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var T=this,N=new Promise((function(N,W){T.once("complete",N),T.once("error",W)}));T.then=function(T,W){return N.then(T,W)},T.catch=function(T){return N.catch(T)},T.catch((function(){}))}function dr(T,N){var W=N.PouchConstructor;return"string"==typeof T?new W(T,N):T}function hr(T,N,W,U){if("function"==typeof W&&(U=W,W={}),void 0===W&&(W={}),W.doc_ids&&!Array.isArray(W.doc_ids))throw Y(xt,"`doc_ids` filter parameter is not a list.");W.complete=U,(W=R(W)).continuous=W.continuous||W.live,W.retry="retry"in W&&W.retry,W.PouchConstructor=W.PouchConstructor||this;var z=new lr(W);return fr(dr(T,W),dr(N,W),W,z),z}function pr(T,N,W,U){return"function"==typeof W&&(U=W,W={}),void 0===W&&(W={}),(W=R(W)).PouchConstructor=W.PouchConstructor||this,new vr(T=dr(T,W),N=dr(N,W),W,U)}function vr(T,N,W,U){var z=this;this.canceled=!1;var G=W.push?be({},W,W.push):W,F=W.pull?be({},W,W.pull):W;function a(T){z.emit("change",{direction:"pull",change:T})}function u(T){z.emit("change",{direction:"push",change:T})}function c(T){z.emit("denied",{direction:"push",doc:T})}function f(T){z.emit("denied",{direction:"pull",doc:T})}function l(){z.pushPaused=!0,z.pullPaused&&z.emit("paused")}function d(){z.pullPaused=!0,z.pushPaused&&z.emit("paused")}function h(){z.pushPaused=!1,z.pullPaused&&z.emit("active",{direction:"push"})}function p(){z.pullPaused=!1,z.pushPaused&&z.emit("active",{direction:"pull"})}this.push=hr(T,N,G),this.pull=hr(N,T,F),this.pushPaused=!0,this.pullPaused=!0;var K={};function y(T){return function(N,W){("change"===N&&(W===a||W===u)||"denied"===N&&(W===f||W===c)||"paused"===N&&(W===d||W===l)||"active"===N&&(W===p||W===h))&&(N in K||(K[N]={}),K[N][T]=!0,2===Object.keys(K[N]).length&&z.removeAllListeners(N))}}function _(T,N,W){-1==T.listeners(N).indexOf(W)&&T.on(N,W)}W.live&&(this.push.on("complete",z.pull.cancel.bind(z.pull)),this.pull.on("complete",z.push.cancel.bind(z.push))),this.on("newListener",(function(T){"change"===T?(_(z.pull,"change",a),_(z.push,"change",u)):"denied"===T?(_(z.pull,"denied",f),_(z.push,"denied",c)):"active"===T?(_(z.pull,"active",p),_(z.push,"active",h)):"paused"===T&&(_(z.pull,"paused",d),_(z.push,"paused",l))})),this.on("removeListener",(function(T){"change"===T?(z.pull.removeListener("change",a),z.push.removeListener("change",u)):"denied"===T?(z.pull.removeListener("denied",f),z.push.removeListener("denied",c)):"active"===T?(z.pull.removeListener("active",p),z.push.removeListener("active",h)):"paused"===T&&(z.pull.removeListener("paused",d),z.push.removeListener("paused",l))})),this.pull.on("removeListener",y("pull")),this.push.on("removeListener",y("push"));var J=Promise.all([this.push,this.pull]).then((function(T){var N={push:T[0],pull:T[1]};return z.emit("complete",N),U&&U(null,N),z.removeAllListeners(),N}),(function(T){if(z.cancel(),U?U(T):z.emit("error",T),z.removeAllListeners(),U)throw T}));this.then=function(T,N){return J.then(T,N)},this.catch=function(T){return J.catch(T)}}K(lr,F.EventEmitter),lr.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},lr.prototype.ready=function(T,N){var W=this;function r(){W.cancel()}W._readyCalled||(W._readyCalled=!0,T.once("destroyed",r),N.once("destroyed",r),W.once("complete",(function(){T.removeListener("destroyed",r),N.removeListener("destroyed",r)})))},K(vr,F.EventEmitter),vr.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},We.plugin((function(T){T.adapter("idb",dn,!0)})).plugin((function(T){T.adapter("http",qn,!1),T.adapter("https",qn,!1)})).plugin(mr).plugin((function(T){T.replicate=hr,T.sync=pr,Object.defineProperty(T.prototype,"replicate",{get:function(){var T=this;return void 0===this.replicateMethods&&(this.replicateMethods={from:function(N,W,U){return T.constructor.replicate(N,T,W,U)},to:function(N,W,U){return T.constructor.replicate(T,N,W,U)}}),this.replicateMethods}}),T.prototype.sync=function(T,N,W){return this.constructor.sync(this,T,N,W)}})),N.exports=We}).call(this,T(5),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,12:12,2:2,3:3,4:4,5:5,6:6,7:7}]},{},[13])(13)}));