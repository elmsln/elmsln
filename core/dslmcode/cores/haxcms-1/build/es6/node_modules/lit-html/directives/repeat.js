import{noChange as e}from"../lit-html.js";import{directive as t,Directive as s,PartType as r}from"../directive.js";import{getCommittedValue as i,setChildPartValue as l,insertPart as o,removePart as n,setCommittedValue as a}from"../directive-helpers.js";
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Jt=(e,t,s)=>{const r=new Map;for(let i=t;i<=s;i++)r.set(e[i],i);return r},u=t(class extends s{constructor(e){if(super(e),e.type!==r.CHILD)throw Error("repeat() can only be used in text expressions")}dt(e,t,s){let r;void 0===s?s=t:void 0!==t&&(r=t);const i=[],l=[];let o=0;for(const t of e)i[o]=r?r(t,o):o,l[o]=s(t,o),o++;return{values:l,keys:i}}render(e,t,s){return this.dt(e,t,s).values}update(t,[s,r,u]){const f=i(t),{values:c,keys:d}=this.dt(s,r,u);if(!Array.isArray(f))return this.ut=d,c;const h=this.ut??=[],p=[];let m,v,y=0,g=f.length-1,C=0,x=c.length-1;for(;y<=g&&C<=x;)if(null===f[y])y++;else if(null===f[g])g--;else if(h[y]===d[C])p[C]=l(f[y],c[C]),y++,C++;else if(h[g]===d[x])p[x]=l(f[g],c[x]),g--,x--;else if(h[y]===d[x])p[x]=l(f[y],c[x]),o(t,p[x+1],f[y]),y++,x--;else if(h[g]===d[C])p[C]=l(f[g],c[C]),o(t,f[y],f[g]),g--,C++;else if(void 0===m&&(m=Jt(d,C,x),v=Jt(h,y,g)),m.has(h[y]))if(m.has(h[g])){const e=v.get(d[C]),s=void 0!==e?f[e]:null;if(null===s){const e=o(t,f[y]);l(e,c[C]),p[C]=e}else p[C]=l(s,c[C]),o(t,f[y],s),f[e]=null;C++}else n(f[g]),g--;else n(f[y]),y++;for(;C<=x;){const e=o(t,p[x+1]);l(e,c[C]),p[C++]=e}for(;y<=g;){const e=f[y++];null!==e&&n(e)}return this.ut=d,a(t,p),e}});export{u as repeat};