import{LitElement as e,html as t,css as i}from"../../../../lit/index.js";import"../../../simple-tooltip/simple-tooltip.js";import"../../../simple-icon/lib/simple-icons.js";import"../../../simple-icon/lib/simple-icon-lite.js";import{store as a}from"./AppHaxStore.js";import"./app-hax-use-case.js";import"./app-hax-search-results.js";import"./app-hax-filter-tag.js";import"./app-hax-scroll-button.js";import"./app-hax-site-creation-modal.js";export class AppHaxUseCaseFilter extends e{static get tag(){return"app-hax-use-case-filter"}constructor(){super(),this.windowControllers=new AbortController,this.searchTerm="",this.disabled=!1,this.showSearch=!1,this.items=[],this.filteredItems=[],this.filteredSites=[],this.activeFilters=[],this.filters=[],this.searchQuery="",this.demoLink="",this.errorMessage="",this.loading=!1,this.selectedCardIndex=null,this.returningSites=[],this.allFilters=new Set,this.dark=!1,this.isLoggedIn=!1,this.sortOption="az",void 0!==a&&import("../../../../mobx/dist/mobx.esm.js").then((({autorun:e,toJS:t})=>{e((()=>{this.dark=t(a.darkMode)}));let i=!1;e((()=>{const e=t(a.appReady),s=t(a.isLoggedIn);this.isLoggedIn=s,e&&s&&!i&&(i=!0,this.updateSkeletonResults(),this.updateSiteResults())})),e((()=>{const e=t(a.manifest);e&&e.items&&e.items.length>0&&this.updateSiteResults()}))}))}static get properties(){return{searchTerm:{type:String},showSearch:{type:Boolean,reflect:!0,attribute:"show-search"},showFilter:{type:Boolean,reflect:!0,attribute:"show-filter"},disabled:{type:Boolean,reflect:!0},items:{type:Array},filteredItems:{type:Array},filteredSites:{type:Array},activeFilters:{type:Array},filters:{type:Array},searchQuery:{type:String},demoLink:{type:String},errorMessage:{type:String},loading:{type:Boolean},selectedCardIndex:{type:Number},returningSites:{type:Array},allFilters:{attribute:!1},dark:{type:Boolean,reflect:!0},isLoggedIn:{type:Boolean},sortOption:{type:String,attribute:"sort-option"}}}static get styles(){return[i`
        :host {
          overflow: hidden;
          display: block;
          max-width: 100%;
          font-family: var(--ddd-font-primary, sans-serif);
        }
        .contentSection {
          display: flex;
          align-items: flex-start;
          justify-content: flex-start;
          gap: var(--ddd-spacing-12, 48px);
          width: 100%;
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }
        .leftSection,
        .rightSection {
          display: flex;
          flex-direction: column;
          flex: 1 1 0;
        }
        .leftSection {
          width: 240px;
          min-width: 200px;
          max-width: 260px;
          margin-left: 0;
          margin-right: var(--ddd-spacing-1, 4px);
          padding-top: 0;
          box-sizing: border-box;
          align-self: flex-start;
        }
        .rightSection {
          flex: 1;
          min-width: 0;
          box-sizing: border-box;
          display: flex;
          flex-direction: column;
          overflow: visible;
        }
        .template-results {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
          width: 100%;
          min-height: 330px;
          box-sizing: border-box;
          gap: var(--ddd-spacing-2, 16px);
        }
        #returnToSection {
          width: 100%;
        }
        #returnToSection app-hax-search-results {
          width: 100%;
          min-height: 280px;
          box-sizing: border-box;
          height: 300px;
        }
        :host(:not([show-filter])) app-hax-search-results {
          width: 100%;
        }

        h2,
        .returnTo h2,
        .startNew h2 {
          font-family: var(--ddd-font-primary, sans-serif);
          font-size: var(--ddd-font-size-l, 24px);
          color: var(--app-hax-accent-color, var(--accent-color));
          margin: 0 0 var(--ddd-spacing-4, 16px) 0;
        }
        .startNew,
        .returnTo {
          position: relative;
          display: flex;
          flex-direction: column;
          justify-content: flex-start;
          align-items: flex-start;
          margin: 0;
        }
        .upper-filter {
          margin-bottom: var(--ddd-spacing-4, 16px);
          position: relative;
          display: inline-block;
          width: 100%;
        }
        input[type="text"] {
          width: 100%;
          padding: var(--ddd-spacing-2, 8px) var(--ddd-spacing-2, 8px)
            var(--ddd-spacing-2, 8px) var(--ddd-spacing-8, 32px);
          font-size: var(--ddd-font-size-xs, 12px);
          border-radius: var(--ddd-radius-sm, 4px);
          border: var(--ddd-border-xs, 1px solid);
          border-color: var(--ddd-theme-default-slateGray, #666);
          background: var(--ddd-theme-default-white, white);
          color: var(--ddd-theme-default-coalyGray, #222);
          transition: all 0.2s ease;
          box-sizing: border-box;
          font-family: var(--ddd-font-primary, sans-serif);
          margin: 0;
          min-height: var(--ddd-spacing-8, 32px);
        }
        :host([dark]) input[type="text"],
        body.dark-mode input[type="text"] {
          background: var(--ddd-theme-default-coalyGray, #333);
          color: var(--ddd-theme-default-white, white);
          border-color: var(--ddd-theme-default-slateGray, #666);
        }
        input[type="text"]:focus {
          border: var(--ddd-border-md, 2px solid);
          border-color: var(--ddd-theme-default-keystoneYellow, #ffd100);
          background: var(--ddd-theme-default-white, white);
          outline: none;
        }
        :host([dark]) input[type="text"]:focus,
        body.dark-mode input[type="text"]:focus {
          background: var(--ddd-theme-default-coalyGray, #333);
          border-color: var(--ddd-theme-default-keystoneYellow, #ffd100);
        }
        .search-icon {
          position: absolute;
          left: var(--ddd-spacing-2, 8px);
          top: 50%;
          transform: translateY(-50%);
          font-size: var(--ddd-font-size-xs, 14px);
          color: var(--ddd-theme-default-nittanyNavy, #001e44);
          pointer-events: none;
          z-index: 1;
          --simple-icon-width: var(--ddd-icon-3xs, 20px);
          --simple-icon-height: var(--ddd-icon-3xs, 20px);
        }
        :host([dark]) .search-icon,
        body.dark-mode .search-icon {
          color: var(--ddd-theme-default-white, white);
        }
        .filter {
          position: relative;
          top: 0;
          display: flex;
          flex-direction: column;
          gap: var(--ddd-spacing-5, 20px);
          background: var(--ddd-theme-default-white, white);
          border-radius: var(--ddd-radius-lg, 12px);
          box-shadow: var(--ddd-boxShadow-lg);
          border: var(--ddd-border-xs, 1px solid);
          border-color: var(--ddd-theme-default-slateGray, #666);
          padding: var(--ddd-spacing-6, 24px);
          margin-top: 0;
          margin-bottom: 0;
          box-sizing: border-box;
          font-family: var(--ddd-font-primary, sans-serif);
          transition: box-shadow 0.2s ease;
        }
        :host([dark]) .filter,
        body.dark-mode .filter {
          background: var(--ddd-theme-default-coalyGray, #222);
          border-color: var(--ddd-theme-default-slateGray, #666);
          color: var(--ddd-theme-default-white, white);
        }
        .filter:hover {
          box-shadow: var(--ddd-boxShadow-xl);
        }
        .filterButtons {
          display: flex;
          flex-direction: column;
          gap: var(--ddd-spacing-3, 12px);
          margin-top: 0;
          border: none;
          padding: 0;
          margin: 0;
        }
        .filter-btn {
          display: flex;
          align-items: center;
          justify-content: flex-start;
          gap: var(--ddd-spacing-1, 4px);
          padding: var(--ddd-spacing-2, 8px) var(--ddd-spacing-3, 12px);
          border-radius: var(--ddd-radius-sm, 4px);
          border: var(--ddd-border-xs, 1px solid) transparent;
          background: var(--ddd-theme-default-limestoneGray, #f5f5f5);
          color: var(--ddd-theme-default-nittanyNavy, #001e44);
          font-size: var(--ddd-font-size-3xs, 11px);
          font-family: var(--ddd-font-primary, sans-serif);
          font-weight: var(--ddd-font-weight-medium, 500);
          cursor: pointer;
          box-shadow: var(--ddd-boxShadow-sm);
          transition: all 0.2s ease;
          outline: none;
          min-height: var(--ddd-spacing-7, 28px);
          text-align: left;
        }
        :host([dark]) .filter-btn,
        body.dark-mode .filter-btn {
          background: var(--ddd-theme-default-slateGray, #444);
          color: var(--ddd-theme-default-white, white);
        }
        .filter-btn.active,
        .filter-btn:active {
          background: var(--ddd-theme-default-nittanyNavy, #001e44);
          color: var(--ddd-theme-default-white, white);
          border-color: var(--ddd-theme-default-keystoneYellow, #ffd100);
          box-shadow: var(--ddd-boxShadow-md);
        }
        :host([dark]) .filter-btn.active,
        :host([dark]) .filter-btn:active,
        body.dark-mode .filter-btn.active,
        body.dark-mode .filter-btn:active {
          background: var(--ddd-theme-default-keystoneYellow, #ffd100);
          color: var(--ddd-theme-default-nittanyNavy, #001e44);
          border-color: var(--ddd-theme-default-white, white);
        }
        .filter-btn:hover,
        .filter-btn:focus {
          background: var(--ddd-theme-default-slateGray, #666);
          color: var(--ddd-theme-default-white, white);
          transform: translateY(-1px);
        }
        .filter-btn:focus {
          outline: var(--ddd-border-md, 2px solid)
            var(--ddd-theme-default-keystoneYellow, #ffd100);
          outline-offset: var(--ddd-spacing-1, 2px);
        }
        :host([dark]) .filter-btn:hover,
        :host([dark]) .filter-btn:focus,
        body.dark-mode .filter-btn:hover,
        body.dark-mode .filter-btn:focus {
          background: var(--ddd-theme-default-limestoneGray, #f5f5f5);
          color: var(--ddd-theme-default-nittanyNavy, #001e44);
        }
        .filter-btn .icon {
          font-size: var(--ddd-font-size-3xs, 12px);
          color: inherit;
          display: flex;
          align-items: center;
          flex-shrink: 0;
          width: var(--ddd-icon-3xs, 20px);
          height: var(--ddd-icon-3xs, 20px);
        }
        .filter-btn .icon simple-icon-lite {
          color: inherit;
          --simple-icon-width: var(--ddd-icon-3xs, 20px);
          --simple-icon-height: var(--ddd-icon-3xs, 20px);
        }
        .filter-btn.active .icon,
        .filter-btn.active .icon simple-icon-lite {
          color: inherit;
        }
        :host([dark]) .filter-btn.active .icon,
        :host([dark]) .filter-btn.active .icon simple-icon-lite,
        body.dark-mode .filter-btn.active .icon,
        body.dark-mode .filter-btn.active .icon simple-icon-lite {
          color: inherit;
        }
        .filter-btn:hover .icon simple-icon-lite,
        .filter-btn:focus .icon simple-icon-lite {
          color: inherit;
        }
        input[type="checkbox"] {
          display: none;
        }
        .sort-control {
          margin-top: var(--ddd-spacing-2, 8px);
          margin-bottom: var(--ddd-spacing-3, 12px);
          display: flex;
          flex-direction: column;
          gap: var(--ddd-spacing-1, 4px);
        }
        .sort-label {
          font-family: var(--ddd-font-primary, sans-serif);
          font-size: var(--ddd-font-size-3xs, 11px);
          color: var(--ddd-theme-default-coalyGray, #222);
        }
        :host([dark]) .sort-label,
        body.dark-mode .sort-label {
          color: var(--ddd-theme-default-limestoneGray, #f5f5f5);
        }
        .sort-select {
          width: 100%;
          padding: var(--ddd-spacing-1, 4px) var(--ddd-spacing-2, 8px);
          font-size: var(--ddd-font-size-3xs, 11px);
          border-radius: var(--ddd-radius-sm, 4px);
          border: var(--ddd-border-xs, 1px solid)
            var(--ddd-theme-default-slateGray, #666);
          background: var(--ddd-theme-default-white, white);
          color: var(--ddd-theme-default-coalyGray, #222);
          font-family: var(--ddd-font-primary, sans-serif);
          box-sizing: border-box;
        }
        :host([dark]) .sort-select,
        body.dark-mode .sort-select {
          background: var(--ddd-theme-default-coalyGray, #333);
          color: var(--ddd-theme-default-white, white);
          border-color: var(--ddd-theme-default-slateGray, #666);
        }
        .sort-select:focus {
          outline: var(--ddd-border-md, 2px solid)
            var(--ddd-theme-default-keystoneYellow, #ffd100);
          outline-offset: var(--ddd-spacing-1, 2px);
        }
        .reset-button {
          margin-top: var(--ddd-spacing-1, 4px);
          background: var(--ddd-theme-default-original87Pink, #e4007c);
          border: var(--ddd-border-xs, 1px solid) transparent;
          color: var(--ddd-theme-default-white, white);
          border-radius: var(--ddd-radius-sm, 4px);
          font-size: var(--ddd-font-size-3xs, 11px);
          font-family: var(--ddd-font-primary, sans-serif);
          font-weight: var(--ddd-font-weight-medium, 500);
          padding: var(--ddd-spacing-2, 8px) var(--ddd-spacing-3, 12px);
          display: flex;
          align-items: center;
          justify-content: center;
          gap: var(--ddd-spacing-1, 4px);
          box-shadow: var(--ddd-boxShadow-sm);
          cursor: pointer;
          transition: all 0.2s ease;
          min-height: var(--ddd-spacing-7, 28px);
        }
        .reset-button:hover,
        .reset-button:focus {
          background: var(--ddd-theme-default-beaver70, #c85c2c);
          transform: translateY(-1px);
        }
        .reset-button:focus {
          outline: var(--ddd-border-md, 2px solid)
            var(--ddd-theme-default-keystoneYellow, #ffd100);
          outline-offset: var(--ddd-spacing-1, 2px);
        }
        :host([dark]) .reset-button,
        body.dark-mode .reset-button {
          background: var(--ddd-theme-default-beaver70, #c85c2c);
        }
        :host([dark]) .reset-button:hover,
        :host([dark]) .reset-button:focus,
        body.dark-mode .reset-button:hover,
        body.dark-mode .reset-button:focus {
          background: var(--ddd-theme-default-original87Pink, #e4007c);
        }
        .collapseFilter {
          display: none;
        }

        /* Visually hidden content for screen readers */
        .visually-hidden {
          position: absolute !important;
          width: 1px !important;
          height: 1px !important;
          padding: 0 !important;
          margin: -1px !important;
          overflow: hidden !important;
          clip: rect(0, 0, 0, 0) !important;
          white-space: nowrap !important;
          border: 0 !important;
        }

        /* Loading and fallback messages */
        .loading-message,
        .no-results {
          grid-column: 1 / -1;
          text-align: center;
          padding: var(--ddd-spacing-8, 32px);
          font-size: var(--ddd-font-size-s, 16px);
          color: var(--ddd-theme-default-slateGray, #666);
          font-family: var(--ddd-font-primary, sans-serif);
        }
        :host([dark]) .loading-message,
        :host([dark]) .no-results,
        body.dark-mode .loading-message,
        body.dark-mode .no-results {
          color: var(--ddd-theme-default-limestoneGray, #ccc);
        }
        .fallback-message {
          grid-column: 1 / -1;
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: var(--ddd-spacing-4, 16px);
        }
        .fallback-message .no-results {
          padding: var(--ddd-spacing-4, 16px) 0;
        }
        .fallback-message app-hax-use-case {
          max-width: 300px;
        }

        @media (max-width: 780px) {
          .contentSection {
            display: block;
          }
          .leftSection {
            width: 100%;
            max-width: 100%;
            margin-bottom: var(--ddd-spacing-4, 16px);
            position: relative;
          }
          .rightSection {
            width: 100%;
          }
          :host([show-filter]) .filter {
            display: flex;
            width: 250px;
            max-width: 20vw;
          }
          :host .collapseFilter {
            display: flex;
          }
          h4,
          .returnTo h4,
          .startNew h4 {
            font-size: var(--ddd-font-size-m, 20px);
          }
          .template-results {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--ddd-spacing-3, 12px);
          }
        }

        @media (max-width: 600px) {
          .contentSection {
            display: block;
            margin: 0 var(--ddd-spacing-2, 8px);
            padding-right: var(--ddd-spacing-2, 8px);
          }
          .leftSection {
            width: 100%;
            max-width: 100%;
            margin-bottom: var(--ddd-spacing-3, 12px);
            position: relative;
          }
          .rightSection {
            width: 100%;
          }
          :host([show-filter]) .filter {
            display: flex;
            width: 200px;
            max-width: 20vw;
          }
          :host .collapseFilter {
            display: flex;
          }
          h4,
          .returnTo h4,
          .startNew h4 {
            font-size: var(--ddd-font-size-s, 18px);
          }
          .template-results {
            grid-template-columns: 1fr;
            gap: var(--ddd-spacing-2, 8px);
          }
        }

        @media (max-width: 480px) {
          .contentSection {
            margin: 0 var(--ddd-spacing-1, 4px);
            padding-right: var(--ddd-spacing-1, 4px);
          }
          h4,
          .returnTo h4,
          .startNew h4 {
            font-size: var(--ddd-font-size-s, 16px);
            margin: 0 0 var(--ddd-spacing-3, 12px) 0;
          }
          .template-results {
            grid-template-columns: 1fr;
            gap: var(--ddd-spacing-2, 8px);
          }
          #returnToSection app-hax-search-results {
            min-width: 100%;
          }
        }
        .no-results {
          font-size: var(--ddd-font-size-s, 16px);
          color: light-dark(
            var(--ddd-theme-default-coalyGray, #222),
            var(--ddd-theme-default-white, white)
          );
        }
      `]}testKeydown(e){"Escape"!==e.key&&"Enter"!==e.key||this.toggleSearch()}toggleFilterVisibility(){this.showFilter=!this.showFilter}handleFilterKeydown(e,t){" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),this.toggleFilterByButton(t))}render(){return t`
      <div class="contentSection">
        <div class="leftSection">
          <div
            class="filter"
            role="search"
            aria-label="Filter and search site templates"
          >
            <!-- Search bar -->
            <div class="upper-filter">
              <label for="searchField" class="visually-hidden"
                >Filter Sites</label
              >
              <slot>
                <simple-icon-lite
                  class="search-icon"
                  icon="icons:search"
                  aria-hidden="true"
                ></simple-icon-lite>
              </slot>
              <input
                id="searchField"
                @input="${this.handleSearch}"
                @keydown="${this.testKeydown}"
                type="text"
                placeholder="Filter Sites"
                aria-label="Filter Sites"
                aria-describedby="search-help"
              />
              <div id="search-help" class="visually-hidden">
                Type to search for site templates and existing sites. Press
                Escape to clear.
              </div>
            </div>
            <!-- Sort options for returning sites -->
            <div class="sort-control">
              <label id="site-sort-label" class="sort-label" for="siteSort">
                Sort sites
              </label>
              <select
                id="siteSort"
                class="sort-select"
                @change=${this.handleSortChange}
                aria-labelledby="site-sort-label"
              >
                <option value="az" ?selected=${"az"===this.sortOption}>
                  Title A–Z
                </option>
                <option value="za" ?selected=${"za"===this.sortOption}>
                  Title Z–A
                </option>
                <option
                  value="newest"
                  ?selected=${"newest"===this.sortOption}
                >
                  Newest first
                </option>
                <option
                  value="oldest"
                  ?selected=${"oldest"===this.sortOption}
                >
                  Oldest first
                </option>
                <option
                  value="theme"
                  ?selected=${"theme"===this.sortOption}
                >
                  Theme name
                </option>
              </select>
            </div>
            <!-- Filter Buttons -->
            <fieldset class="filterButtons">
              <legend class="visually-hidden">
                Filter templates by category
              </legend>
              ${this.filters.map(((e,i)=>t`
                  <input
                    type="checkbox"
                    id="filter-${i}"
                    class="filter-checkbox"
                    .checked=${this.activeFilters.includes(e)}
                    @change=${()=>this.toggleFilterByButton(e)}
                    aria-describedby="filter-${i}-description"
                  />
                  <label
                    for="filter-${i}"
                    class="filter-btn ${this.activeFilters.includes(e)?"active":""}"
                    aria-pressed=${this.activeFilters.includes(e)}
                    role="button"
                    tabindex="0"
                    @keydown=${t=>this.handleFilterKeydown(t,e)}
                  >
                    <span class="icon" aria-hidden="true">
                      <simple-icon-lite
                        icon="${this.iconForFilter(e)}"
                      ></simple-icon-lite>
                    </span>
                    ${e}
                  </label>
                  <div id="filter-${i}-description" class="visually-hidden">
                    Filter to show only ${e} templates
                  </div>
                `))}
            </fieldset>
            <button
              class="reset-button"
              @click="${this.resetFilters}"
              aria-describedby="reset-help"
            >
              Reset Filters
            </button>
            <div id="reset-help" class="visually-hidden">
              Clear all active filters and search terms
            </div>
          </div>
        </div>
        <!-- Content Section -->
        <div class="rightSection">
          <!-- Returning Sites -->
          <section
            id="returnToSection"
            class="returnTo"
            aria-labelledby="return-to-heading"
          >
            <h2 id="return-to-heading">Return to...</h2>
            <div
              role="region"
              aria-label="Previously created sites"
              aria-live="polite"
            >
              <app-hax-search-results
                .displayItems=${this.filteredSites}
                .searchTerm=${this.searchTerm}
                .sortOption=${this.sortOption}
                ?dark="${this.dark}"
              >
              </app-hax-search-results>
            </div>
          </section>

          <!-- Templates -->
          <section
            id="startJourneySection"
            class="startNew"
            aria-labelledby="create-site-heading"
          >
            <h2 id="create-site-heading">Create New Site</h2>
            <div
              class="template-results"
              role="grid"
              aria-label="Available site templates"
              aria-live="polite"
              aria-describedby="template-count"
            >
              <div id="template-count" class="visually-hidden">
                ${this.filteredItems.length} templates available
              </div>
              ${this.filteredItems.length>0?this.filteredItems.map(((e,i)=>t`
                      <div
                        role="gridcell"
                        aria-rowindex="${i+1}"
                        aria-colindex="1"
                      >
                        <app-hax-use-case
                          .source=${e.useCaseImage||""}
                          .title=${e.useCaseTitle||""}
                          .description=${e.useCaseDescription||""}
                          .demoLink=${e.demoLink||""}
                          .iconImage=${e.useCaseIcon||[]}
                          .isSelected=${e.isSelected||!1}
                          .showContinue=${e.showContinue||!1}
                          ?dark="${this.dark}"
                          aria-label="Template: ${e.useCaseTitle}"
                          @toggle-display=${e=>this.toggleDisplay(i,e)}
                          @continue-action=${()=>this.continueAction(i)}
                        ></app-hax-use-case>
                      </div>
                    `)):this.loading?t`<p
                      role="status"
                      class="loading-message"
                      aria-live="polite"
                    >
                      Loading templates...
                    </p>`:this.items&&this.items.length>0?t`<p
                        role="status"
                        class="no-results"
                        aria-live="polite"
                      >
                        No templates match your current filters. Reset filters to
                        see more options.
                      </p>`:t`
                        <div class="fallback-message">
                          <p
                            role="status"
                            class="no-results"
                            aria-live="polite"
                          >
                            ${this.errorMessage||"No templates available. You can still create a blank site."}
                          </p>
                          <app-hax-use-case
                            .source=""
                            .title="Blank Site"
                            .description="Create a blank site using the clean-one theme"
                            .demoLink="#"
                            .iconImage=${[{icon:"icons:build",tooltip:"Blank site"}]}
                            .isSelected=${-1===this.selectedCardIndex}
                            .showContinue=${-1===this.selectedCardIndex}
                            ?dark="${this.dark}"
                            aria-label="Template: Blank Site"
                            @toggle-display=${e=>this.toggleDisplay(-1,e)}
                            @continue-action=${()=>this.continueAction(-1)}
                          ></app-hax-use-case>
                        </div>
                      `}
            </div>
          </section>
        </div>
      </div>

      <!-- Site Creation Modal -->
      <app-hax-site-creation-modal
        id="siteCreationModal"
        @modal-closed=${this.handleModalClosed}
      ></app-hax-site-creation-modal>
    `}iconForFilter(e){switch(e.toLowerCase()){case"blog":return"lrn:write";case"brochure":return"icons:description";case"course":return"hax:lesson";case"portfolio":return"icons:perm-identity";case"blank":return"hax:bricks";default:return"icons:label"}}toggleFilterByButton(e){this.activeFilters.includes(e)?this.activeFilters=this.activeFilters.filter((t=>t!==e)):this.activeFilters=[...this.activeFilters,e],this.applyFilters(),this.requestUpdate()}connectedCallback(){super.connectedCallback(),globalThis.addEventListener("jwt-logged-in",this._jwtLoggedIn.bind(this),{signal:this.windowControllers.signal})}disconnectedCallback(){this.windowControllers.abort(),super.disconnectedCallback()}_jwtLoggedIn(e){!0===e.detail?(this.isLoggedIn=!0,this.updateSkeletonResults(),this.updateSiteResults()):!1===e.detail&&(this.isLoggedIn=!1)}firstUpdated(){super.firstUpdated()}updated(e){(e.has("searchQuery")||e.has("activeFilters")||e.has("items"))&&this.applyFilters()}toggleSearch(){this.disabled||(this.shadowRoot.querySelector("#searchField").value="",a.appEl.playSound("click"),this.showSearch=!this.showSearch,setTimeout((()=>{this.shadowRoot.querySelector("#searchField").focus()}),300))}toggleSelection(e){this.activeUseCase===e?this.activeUseCase=!1:this.activeUseCase=e,this.requestUpdate()}handleSearch(e){const t=e.target.value.toLowerCase();this.searchTerm=t,a.searchTerm=t,this.applyFilters()}handleSortChange(e){const t=e&&e.target&&e.target.value?e.target.value:"az";this.sortOption=t,this.requestUpdate()}toggleFilter(e){const t=e.target.value;this.activeFilters.includes(t)?this.activeFilters=[...this.activeFilters.filter((e=>e!==t))]:this.activeFilters=[...this.activeFilters,t],this.applyFilters()}applyFilters(){const e=this.searchTerm.toLowerCase();this.filteredItems=[...this.items.filter((t=>{if("skeleton"!==t.dataType&&"blank"!==t.dataType)return!1;const i=""===e||t.useCaseTitle.toLowerCase().includes(e)||t.useCaseTag&&t.useCaseTag.some((t=>t.toLowerCase().includes(e))),a=0===this.activeFilters.length||t.useCaseTag&&this.activeFilters.some((e=>t.useCaseTag.includes(e)));return i&&a}))],this.filteredSites=[...this.returningSites.filter((t=>{if("site"!==t.dataType)return!1;const i=t.originalData||{},a=(i.metadata||{}).site||{};let s=void 0!==a.category&&null!==a.category?a.category:t.useCaseTag||[];const r=(i.title||"").toLowerCase(),d=(i.description||"").toLowerCase(),o=(i.author||"").toLowerCase(),l=(i.slug||"").toLowerCase(),n=t.useCaseTag||[],c=""===e||-1!==r.indexOf(e)||-1!==d.indexOf(e)||-1!==o.indexOf(e)||-1!==l.indexOf(e)||n.some((t=>-1!==t.toLowerCase().indexOf(e)))||"string"==typeof s&&-1!==s.toLowerCase().indexOf(e)||Array.isArray(s)&&s.some((t=>"string"==typeof t&&-1!==t.toLowerCase().indexOf(e))),h=0===this.activeFilters.length||this.activeFilters.some((e=>"string"==typeof s?s===e:!!Array.isArray(s)&&-1!==s.indexOf(e)));return c&&h}))]}removeFilter(e){const t=e.detail;this.activeFilters=this.activeFilters.filter((e=>e!==t)),this.applyFilters(),this.requestUpdate()}resetFilters(){this.searchTerm="",a.searchTerm="",this.activeFilters=[],this.filteredItems=[...this.items.filter((e=>"skeleton"===e.dataType||"blank"===e.dataType))],this.filteredSites=[...this.returningSites],this.shadowRoot.querySelector("#searchField").value="",this.shadowRoot.querySelectorAll('input[type="checkbox"]').forEach((e=>e.checked=!1)),this.requestUpdate()}updateSkeletonResults(){if(this.loading=!0,this.errorMessage="",!a.appSettings||!a.appSettings.skeletonsList)return this.errorMessage="Skeletons endpoint not configured",void(this.loading=!1);const e=a.AppHaxAPI&&a.AppHaxAPI.makeCall?a.AppHaxAPI.makeCall("skeletonsList"):Promise.reject(new Error("API not available"));let t;if(a.appSettings&&a.appSettings.themes&&Object.keys(a.appSettings.themes).length>0)t=Promise.resolve(a.appSettings.themes);else{const e=new URL("../../../haxcms-elements/lib/themes.json",import.meta.url).href;t=fetch(e).then((e=>{if(!e.ok)throw new Error(`Failed Themes (${e.status})`);return e.json()})).catch((e=>(console.warn("Failed to load themes.json, using minimal fallback:",e),{"clean-one":{element:"clean-one",name:"Clean One",description:"A clean, simple theme",category:["Blank"],hidden:!1}})))}Promise.allSettled([e,t]).then((([e,t])=>{const i=(e.value&&e.value.data&&Array.isArray(e.value.data)?e.value.data:[]).map((e=>{let t=[];Array.isArray(e.category)?t=e.category.filter((e=>"string"==typeof e&&""!==e.trim())):"string"==typeof e.category&&""!==e.category.trim()&&(t=[e.category.trim()]),0===t.length&&(t=["Empty"]),t.forEach((e=>this.allFilters.add(e)));const i=Array.isArray(e.attributes)?e.attributes.map((e=>({icon:e.icon||"",tooltip:e.tooltip||""}))):[];let a=e.image||"";if(a&&a.startsWith("@haxtheweb/")){a=new URL("../../../../"+a,import.meta.url).href}return{dataType:"skeleton",useCaseTitle:e.title||"Untitled Template",useCaseImage:a||"",useCaseDescription:e.description||"",useCaseIcon:i,useCaseTag:t,demoLink:e["demo-url"]||"#",skeletonUrl:e["skeleton-url"]||"",originalData:e}}))||[],a=t.value||{},s=Object.entries(a).filter((([,e])=>!e.hidden)).map((([e,t])=>{let i=[];Array.isArray(t.category)?i=t.category.filter((e=>"string"==typeof e&&""!==e.trim())):"string"==typeof t.category&&""!==t.category.trim()&&(i=[t.category.trim()]),0===i.length&&(i=["Blank"]),i.forEach((e=>this.allFilters.add(e)));let a=t.thumbnail||"";if(a&&a.startsWith("@haxtheweb/")){a=new URL("../../../../"+a,import.meta.url).href}return{dataType:"blank",useCaseTitle:t.name||"Untitled Theme",useCaseImage:a||"",useCaseDescription:t.description||"Start with a blank site using this theme",useCaseIcon:[{icon:"icons:build",tooltip:"Customizable"}],useCaseTag:i,demoLink:`https://playground.hax.cloud/site.html?theme=${e}`,originalData:t}}));this.items=[...i,...s],this.filters=Array.from(this.allFilters).sort(),0!==this.items.length||this.errorMessage||(this.errorMessage="No Templates Found"),this.resetFilters()})).catch((e=>{this.errorMessage=`Failed to load data: ${e.message}`,this.items=[],this.filters=[]})).finally((()=>{this.loading=!1}))}updateSiteResults(){this.loading=!0,this.errorMessage="";try{const e=a.manifest;if(!e||!e.items)throw new Error("No manifest data available");const t=Array.isArray(e.items)?e.items.map((e=>{let t=e.metadata&&e.metadata.site?e.metadata.site.category:null,i=[];Array.isArray(t)?i=t.filter((e=>"string"==typeof e&&""!==e.trim())):"string"==typeof t&&""!==t.trim()&&(i=[t.trim()]);let a=null;return e.build&&e.build.type?a=e.build.type:e.metadata&&e.metadata.build&&e.metadata.build.type&&(a=e.metadata.build.type),"string"==typeof a&&""!==a.trim()&&i.push(a.trim()),i=[...new Set(i.filter((e=>"string"==typeof e&&""!==e.trim())))],0===i.length&&(i=["Website"]),i.forEach((e=>this.allFilters.add(e))),{dataType:"site",useCaseTag:i,originalData:e,...e}})):[];this.returningSites=[...t],this.filters=Array.from(this.allFilters).sort(),this.filteredSites=[...t],0!==t.length||this.errorMessage||(this.errorMessage="No Sites Found"),this.requestUpdate(),this.loading=!1}catch(e){this.errorMessage=`Failed to load data: ${e.message}`,this.returningSites=[],this.filteredSites=[],this.filters=[],this.loading=!1}}toggleDisplay(e,t){const i=t.detail.isSelected;null!==this.selectedCardIndex&&this.selectedCardIndex!==e&&-1!==this.selectedCardIndex&&this.filteredItems[this.selectedCardIndex]&&(this.filteredItems[this.selectedCardIndex].isSelected=!1,this.filteredItems[this.selectedCardIndex].showContinue=!1),this.selectedCardIndex=i?e:null,-1!==e&&this.filteredItems[e]&&(this.filteredItems[e].isSelected=i,this.filteredItems[e].showContinue=i),this.requestUpdate()}async continueAction(e){const t=this.shadowRoot.querySelector("#siteCreationModal");if(t){if(-1===e)return t.title="Blank Site",t.description="Create a blank site using the clean-one theme",t.source="",t.template="Blank Site",t.themeElement="clean-one",t.skeletonData={meta:{name:"clean-one",type:"skeleton"},site:{name:"clean-one",theme:"clean-one"},build:{type:"skeleton",structure:"from-skeleton",items:[{id:"item-home-clean-one",title:"Home",slug:"home",order:0,parent:null,indent:0,content:"<p>Edit this page to get started on your HAX site!</p>",metadata:{published:!0,hideInMenu:!1,tags:[]}}],files:[]},theme:{}},t.siteName=t.title,void t.openModal();const i=this.filteredItems[e];if(!i)return void console.warn("No template found at index:",e);if(t.title=i.useCaseTitle,t.description=i.useCaseDescription,t.source=i.useCaseImage,t.template=i.useCaseTitle,"skeleton"===i.dataType&&i.skeletonUrl)try{const e=i.skeletonUrl||"";if(!e.startsWith("/"))return void console.warn("Refusing to load skeleton from non-root-relative URL:",e);const a=await fetch(e);if(a.ok){const e=await a.json();t.skeletonData=e.data||e,t.themeElement=t.skeletonData.site&&t.skeletonData.site.theme||"clean-one"}else console.warn(`Failed to load skeleton from ${e}`),t.themeElement="clean-one"}catch(e){console.warn("Error loading skeleton:",e),t.themeElement="clean-one"}else"blank"===i.dataType&&i.originalData.element?(t.themeElement=i.originalData.element,t.skeletonData={meta:{name:i.originalData.element,type:"skeleton"},site:{name:i.originalData.element,theme:i.originalData.element},build:{type:"skeleton",structure:"from-skeleton",items:[{id:`item-home-${i.originalData.element}`,title:"Home",slug:"home",order:0,parent:null,indent:0,content:"<p>Edit this page to get started on your HAX site!</p>",metadata:{published:!0,hideInMenu:!1,tags:[]}}],files:[]},theme:{}}):t.themeElement="clean-one";t.siteName=i.useCaseTitle||t.title||"New site",t.openModal()}}handleModalClosed(e){e.detail&&e.detail.cancelled&&null!==this.selectedCardIndex&&this.filteredItems[this.selectedCardIndex]&&(this.filteredItems[this.selectedCardIndex].isSelected=!1,this.filteredItems[this.selectedCardIndex].showContinue=!1,this.selectedCardIndex=null,this.requestUpdate())}}customElements.define("app-hax-use-case-filter",AppHaxUseCaseFilter);