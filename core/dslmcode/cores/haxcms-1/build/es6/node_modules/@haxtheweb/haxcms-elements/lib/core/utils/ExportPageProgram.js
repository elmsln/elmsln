import{MicroFrontendRegistry as t}from"../../../../micro-frontend-registry/micro-frontend-registry.js";import{HAXStore as o}from"../../../../hax-body/lib/hax-store.js";import{b64toBlob as e}from"../../../../utils/utils.js";export function createExportPageProgram(t){return async(o,e)=>{let a=[];return[{title:"Export as HTML",icon:"hax:file-html",format:"html",description:"Download current page as HTML file"},{title:"Export as Markdown",icon:"hax:format-textblock",format:"markdown",description:"Download current page as Markdown (.md) file"},{title:"Export as DOCX",icon:"hax:file-docx",format:"docx",description:"Download current page as Word document"},{title:"Export as PDF",icon:"lrn:pdf",format:"pdf",description:"Download current page as PDF file"},{title:"Export as HAXSchema",icon:"hax:code-json",format:"haxschema",description:"Copy HAXSchema JSON to clipboard"}].forEach((e=>{(""===o||e.title.toLowerCase().includes(o.toLowerCase())||e.format.includes(o.toLowerCase()))&&a.push({title:e.title,icon:e.icon,tags:["export","page",e.format],more:e.description,value:{target:t,method:"exportPageAs",args:[e.format]},eventName:"super-daemon-element-method",path:`CMS/export/page/${e.format}`,context:["CMS","HAX"]})})),a}}export async function exportPageAs(t){try{const e=o.activeHaxBody;if(!e)return void o.toast("No HAX body found for export",3e3,"fit-bottom");const a=await e.haxToContent(),r=globalThis.document.title||"page";switch(t){case"html":await this._exportPageAsHTML(a,r);break;case"markdown":await this._exportPageAsMarkdown(a,r);break;case"docx":await this._exportPageAsDOCX(a,r);break;case"pdf":await this._exportPageAsPDF(a,r);break;case"haxschema":await this._exportPageAsHAXSchema();break;default:o.toast(`Export format "${t}" not supported`,3e3,"fit-bottom")}}catch(t){console.error("Export error:",t),o.toast(`Export failed: ${t.message}`,3e3,"fit-bottom")}}export async function _exportPageAsHTML(t,e){const a=`<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <meta charset="utf-8">\n    <title>${e}</title>\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n    <script>globalThis.WCGlobalCDNPath="https://cdn.webcomponents.psu.edu/cdn/";<\/script>\n    <script src="https://cdn.webcomponents.psu.edu/cdn/build.js"><\/script>\n    <style>\n      body { padding: 32px; font-family: system-ui, sans-serif; }\n    </style>\n  </head>\n  <body>\n    ${t}\n  </body>\n</html>`;this._downloadFile(a,`${e}.html`,"text/html"),o.toast("HTML file downloaded successfully",3e3,"fit-bottom")}export async function _exportPageAsMarkdown(e,a){try{const r=await t.call("@core/htmlToMd",{html:e});if(200!==r.status||!r.data)throw new Error("Failed to convert to Markdown");this._downloadFile(r.data,`${a}.md`,"text/markdown"),o.toast("Markdown file downloaded successfully",3e3,"fit-bottom")}catch(t){console.error("Markdown export error:",t),o.toast("Markdown export service not available",3e3,"fit-bottom")}}export async function _exportPageAsDOCX(a,r){try{const n=await t.call("@core/htmlToDocx",{html:a});if(200!==n.status||!n.data)throw new Error("Failed to convert to DOCX");{const t=e(n.data,"application/vnd.openxmlformats-officedocument.wordprocessingml.document");this._downloadBlob(t,`${r}.docx`),o.toast("DOCX file downloaded successfully",3e3,"fit-bottom")}}catch(t){console.error("DOCX export error:",t),o.toast("DOCX export service not available",3e3,"fit-bottom")}}export async function _exportPageAsPDF(a,r){try{const n=globalThis.document.querySelector("base"),i=n&&n.href||globalThis.location.origin,s=await t.call("@core/htmlToPdf",{base:i,html:a});if(200!==s.status||!s.data)throw new Error("Failed to convert to PDF");{const t=e(s.data,"application/pdf");this._downloadBlob(t,`${r}.pdf`),o.toast("PDF file downloaded successfully",3e3,"fit-bottom")}}catch(t){console.error("PDF export error:",t),o.toast("PDF export service not available",3e3,"fit-bottom")}}export async function _exportPageAsHAXSchema(){try{const t=await o.activeHaxBody.haxToContent(),e=await o.htmlToHaxElements(t);e.shift();const a=JSON.stringify(e,null,2);await navigator.clipboard.writeText(a),o.toast("HAXSchema copied to clipboard",3e3,"fit-bottom")}catch(t){console.error("HAXSchema export error:",t),o.toast("Failed to export HAXSchema",3e3,"fit-bottom")}}export function _downloadFile(t,o,e="text/plain"){const a=new Blob([t],{type:e});this._downloadBlob(a,o)}export function _downloadBlob(t,o){const e=globalThis.document.createElement("a");e.href=globalThis.URL.createObjectURL(t),e.download=o,e.target="_blank",globalThis.document.body.appendChild(e),e.click(),globalThis.document.body.removeChild(e),globalThis.URL.revokeObjectURL(e.href)}