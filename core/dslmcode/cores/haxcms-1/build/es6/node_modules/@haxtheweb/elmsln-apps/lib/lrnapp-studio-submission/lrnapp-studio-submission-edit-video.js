import{html as e,PolymerElement as i}from"../../../../@polymer/polymer/polymer-element.js";import{SecureRequestXhr as t}from"../../../secure-request/secure-request.js";import{dom as o}from"../../../../@polymer/polymer/lib/legacy/polymer.dom.js";import"../../../../@polymer/polymer/lib/elements/dom-repeat.js";import"../../../../@polymer/polymer/lib/elements/dom-if.js";import"../../../../@polymer/paper-dialog/paper-dialog.js";import"../../../../@polymer/paper-input/paper-input.js";import"../../../../@polymer/iron-ajax/iron-ajax.js";import"../../../secure-request/secure-request.js";import"./lrnapp-studio-submission-edit-add-asset.js";import"./lrnapp-studio-submission-media-editoverlay.js";import{normalizeEventPath as r}from"../../../utils/utils.js";class LrnappStudioSubmissionEditVideo extends(t(i)){static get template(){return e`
      <style>
        :host {
          display: flex;
          position: relative;
          align-items: stretch;
        }

        lrnapp-studio-submission-media-editoverlay,
        lrnapp-studio-submission-edit-add-asset {
          background: lightgray;
          display: flex;
          align-items: center;
          margin-right: 1em;
        }

        iframe {
          display: block;
        }

        .videosfield__create {
          display: block;
          height: 250px;
          width: 300px;
        }

        paper-dialog {
          width: 50%;
          width: 50vmax;
          padding: 1em;
        }
      </style>

      <dom-repeat items="[[videos]]" as="video">
        <template>
          <lrnapp-studio-submission-media-editoverlay
            on-deleted="_videoDelete"
            data-index$="[[index]]"
          >
            <iframe
              class="videosfield__iframe"
              src$="[[video.video_src]]"
            ></iframe>
          </lrnapp-studio-submission-media-editoverlay>
        </template>
      </dom-repeat>

      <lrnapp-studio-submission-edit-add-asset
        icon="av:video-library"
        on-click="_openDialog"
      ></lrnapp-studio-submission-edit-add-asset>

      <paper-dialog id="dialog">
        <h2>Add Video</h2>
        <div style="height:50vh;width:100%;overflow:scroll;">
          <paper-input label="Video URL" value="{{newvideo}}"></paper-input>
        </div>
        <div class="buttons">
          <button dialog-dismiss="">Cancel</button>
          <button dialog-confirm="" on-click="_addImage">Add Video</button>
        </div>
      </paper-dialog>

      <template is="dom-if" if="[[videoGenerateSourceUrl]]">
        <!-- Generate Video Source Url for preview -->
        <iron-ajax
          reject-with-request
          on-last-error-changed="lastErrorChanged"
          id="videoGenerateSourceUrl"
          url="[[videoGenerateSourceUrl]]"
          method="POST"
          body="[[newvideo]]"
          content-type="application/json"
          handle-as="json"
          on-response="_addImage"
        ></iron-ajax>
      </template>
    `}static get tag(){return"lrnapp-studio-submission-edit-video"}lastErrorChanged(e){if(e.detail.value){console.error(e);const i=r(e)[0];switch(parseInt(e.detail.value.status)){case 401:case 401:fetch(window.Drupal.settings.basePath,{mode:"no-cors"}).then((e=>{console.log(e),setTimeout((()=>{i.generateRequest()}),250)}))}}}static get properties(){return{videos:{type:Array,notify:!0},selectedPage:{type:String,value:"0"},newvideo:{type:String,value:""},videoGenerateSourceUrl:{type:String,value:null}}}_openDialog(e){this.$.dialog.open()}_addImage(e){this.newvideo;if("IRON-AJAX"===o(e).localTarget.tagName){var i=e.detail.response.data;"[object Array]"!=Object.prototype.toString.call(this.videos)&&(this.videos=[]),this.push("videos",{video_url:this.newvideo,video_src:i}),this.newvideo=""}else this.shadowRoot.querySelector("#videoGenerateSourceUrl").generateRequest()}_videoDelete(e){var i=o(e).localTarget.getAttribute("data-index");this.splice("videos",i,1)}ready(){super.ready();const e=this.generateUrl("/api/video/generate-source-url");this.set("videoGenerateSourceUrl",e)}}customElements.define(LrnappStudioSubmissionEditVideo.tag,LrnappStudioSubmissionEditVideo);export{LrnappStudioSubmissionEditVideo};