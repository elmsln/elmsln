/**
 * Copyright 2025 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{store as t}from"../haxcms-site-store.js";class HAXCMSKeyboardShortcuts{constructor(){this.shortcuts=new Map,this.enabled=!0,this._boundHandler=this._handleKeydown.bind(this)}register(t){const{key:e,ctrl:a=!1,shift:s=!1,alt:r=!1,meta:o=!1,callback:n,condition:i=()=>!0,description:c="",context:l="global"}=t,h=this._generateKey(e,a,s,r,o);this.shortcuts.set(h,{key:e,ctrl:a,shift:s,alt:r,meta:o,callback:n,condition:i,description:c,context:l})}unregister(t,e=!1,a=!1,s=!1,r=!1){const o=this._generateKey(t,e,a,s,r);this.shortcuts.delete(o)}_generateKey(t,e,a,s,r){const o=[];return e&&o.push("Ctrl"),s&&o.push("Alt"),a&&o.push("Shift"),r&&o.push("Meta"),o.push(t.toUpperCase()),o.join("+")}_normalizeKey(t){if(t.code&&t.code.startsWith("Digit"))return t.code.replace("Digit","");if(t.code&&t.code.startsWith("Numpad"))return t.code.replace("Numpad","");const e={BracketLeft:"[",BracketRight:"]",Slash:"/",Backslash:"\\",Semicolon:";",Quote:"'",Comma:",",Period:".",Minus:"-",Equal:"=",Backquote:"`"};return t.code&&e[t.code]?e[t.code]:t.key}_handleKeydown(t){if(!this.enabled)return;const e=globalThis.document.activeElement,a=e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.isContentEditable),s=e&&e.closest("hax-body");if(a&&!s)return;const r=this._normalizeKey(t),o=this._generateKey(r,t.ctrlKey,t.shiftKey,t.altKey,t.metaKey),n=this.shortcuts.get(o);n&&n.condition()&&(t.preventDefault(),n.callback(t))}enable(){this.enabled=!0,globalThis.document.addEventListener("keydown",this._boundHandler)}disable(){this.enabled=!1,globalThis.document.removeEventListener("keydown",this._boundHandler)}getShortcuts(){return Array.from(this.shortcuts.entries()).map((([t,e])=>({key:t,...e})))}getShortcutsByContext(t){return this.getShortcuts().filter((e=>e.context===t||"global"===e.context))}static generateLabel(t){const{key:e,ctrl:a=!1,shift:s=!1,alt:r=!1,meta:o=!1}=t,n=[];return a&&n.push("Ctrl"),r&&n.push("Alt"),o&&n.push("Meta"),s&&n.push("â‡§"),n.push(e.toUpperCase()),n.join("")}getShortcut(t,e=!1,a=!1,s=!1,r=!1){const o=this._generateKey(t,e,a,s,r),n=this.shortcuts.get(o);return n?{key:o,...n}:null}getShortcutLabel(t,e=!1,a=!1,s=!1,r=!1){const o=this.getShortcut(t,e,a,s,r);return o?HAXCMSKeyboardShortcuts.generateLabel({key:o.key,ctrl:o.ctrl,shift:o.shift,alt:o.alt,meta:o.meta}):null}getShortcutsForDisplay(){return this.getShortcuts().map((t=>({label:HAXCMSKeyboardShortcuts.generateLabel({key:t.key,ctrl:t.ctrl,shift:t.shift,alt:t.alt,meta:t.meta}),description:t.description,context:t.context,key:t.key})))}}globalThis.HAXCMSKeyboardShortcutsManager=globalThis.HAXCMSKeyboardShortcutsManager||{},globalThis.HAXCMSKeyboardShortcutsManager.requestAvailability=()=>(globalThis.HAXCMSKeyboardShortcutsManager.instance||(globalThis.HAXCMSKeyboardShortcutsManager.instance=new HAXCMSKeyboardShortcuts),globalThis.HAXCMSKeyboardShortcutsManager.instance);export const HAXCMSKeyboardShortcutsInstance=globalThis.HAXCMSKeyboardShortcutsManager.requestAvailability();