//! openseadragon 2.4.2
//! Built on 2020-03-05
//! Git commit: v2.4.2-0-c450749
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function OpenSeadragon(q){return new OpenSeadragon.Viewer(q)}var e,t,r,o,s,a,d,h,R,c,u,p,v;!function(q){q.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var Z,X={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},K=Object.prototype.toString,Y=Object.prototype.hasOwnProperty;q.isFunction=function(Z){return"function"===q.type(Z)},q.isArray=Array.isArray||function(Z){return"array"===q.type(Z)},q.isWindow=function(q){return q&&"object"==typeof q&&"setInterval"in q},q.type=function(q){return null==q?String(q):X[K.call(q)]||"object"},q.isPlainObject=function(Z){if(!Z||"object"!==OpenSeadragon.type(Z)||Z.nodeType||q.isWindow(Z))return!1;if(Z.constructor&&!Y.call(Z,"constructor")&&!Y.call(Z.constructor.prototype,"isPrototypeOf"))return!1;var X;for(var K in Z)X=K;return void 0===X||Y.call(Z,X)},q.isEmptyObject=function(q){for(var Z in q)return!1;return!0},q.freezeObject=function(Z){return Object.freeze?q.freezeObject=Object.freeze:q.freezeObject=function(q){return q},q.freezeObject(Z)},q.supportsCanvas=(Z=document.createElement("canvas"),!(!q.isFunction(Z.getContext)||!Z.getContext("2d"))),q.isCanvasTainted=function(q){var Z=!1;try{q.getContext("2d").getImageData(0,0,1,1)}catch(q){Z=!0}return Z},q.pixelDensityRatio=function(){if(q.supportsCanvas){var Z=document.createElement("canvas").getContext("2d"),X=window.devicePixelRatio||1,K=Z.webkitBackingStorePixelRatio||Z.mozBackingStorePixelRatio||Z.msBackingStorePixelRatio||Z.oBackingStorePixelRatio||Z.backingStorePixelRatio||1;return Math.max(X,1)/K}return 1}()}(OpenSeadragon),function($){$.extend=function(){var q,Z,X,K,Y,Q,J=arguments[0]||{},ee=arguments.length,te=!1,ie=1;for("boolean"==typeof J&&(te=J,J=arguments[1]||{},ie=2),"object"==typeof J||OpenSeadragon.isFunction(J)||(J={}),ee===ie&&(J=this,--ie);ie<ee;ie++)if(null!==(q=arguments[ie])||void 0!==q)for(Z in q)X=J[Z],J!==(K=q[Z])&&(te&&K&&(OpenSeadragon.isPlainObject(K)||(Y=OpenSeadragon.isArray(K)))?(Y?(Y=!1,Q=X&&OpenSeadragon.isArray(X)?X:[]):Q=X&&OpenSeadragon.isPlainObject(X)?X:{},J[Z]=OpenSeadragon.extend(te,Q,K)):void 0!==K&&(J[Z]=K));return J};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var q=navigator.userAgent;return"string"==typeof q&&(-1!==q.indexOf("iPhone")||-1!==q.indexOf("iPad")||-1!==q.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(q,Z){return function(){var X=arguments;return void 0===X&&(X=[]),Z.apply(q,X)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(q){return"string"==typeof q&&(q=document.getElementById(q)),q},getElementPosition:function(q){var Z,X,K=new $.Point;for(X=getOffsetParent(q=$.getElement(q),Z="fixed"==$.getElementStyle(q).position);X;)K.x+=q.offsetLeft,K.y+=q.offsetTop,Z&&(K=K.plus($.getPageScroll())),X=getOffsetParent(q=X,Z="fixed"==$.getElementStyle(q).position);return K},getElementOffset:function(q){var Z,X,K=(q=$.getElement(q))&&q.ownerDocument,Y={top:0,left:0};return K?(Z=K.documentElement,void 0!==q.getBoundingClientRect&&(Y=q.getBoundingClientRect()),X=K==K.window?K:9===K.nodeType&&(K.defaultView||K.parentWindow),new $.Point(Y.left+(X.pageXOffset||Z.scrollLeft)-(Z.clientLeft||0),Y.top+(X.pageYOffset||Z.scrollTop)-(Z.clientTop||0))):new $.Point},getElementSize:function(q){return q=$.getElement(q),new $.Point(q.clientWidth,q.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(q){return(q=$.getElement(q)).currentStyle}:function(q){return q=$.getElement(q),window.getComputedStyle(q,"")},getCssPropertyWithVendorPrefix:function(q){var Z={};return $.getCssPropertyWithVendorPrefix=function(q){if(void 0!==Z[q])return Z[q];var X=document.createElement("div").style,K=null;if(void 0!==X[q])K=q;else for(var Y=["Webkit","Moz","MS","O","webkit","moz","ms","o"],Q=$.capitalizeFirstLetter(q),J=0;J<Y.length;J++){var ee=Y[J]+Q;if(void 0!==X[ee]){K=ee;break}}return Z[q]=K},$.getCssPropertyWithVendorPrefix(q)},capitalizeFirstLetter:function(q){return q.charAt(0).toUpperCase()+q.slice(1)},positiveModulo:function(q,Z){var X=q%Z;return X<0&&(X+=Z),X},pointInElement:function(q,Z){q=$.getElement(q);var X=$.getElementOffset(q),K=$.getElementSize(q);return Z.x>=X.x&&Z.x<X.x+K.x&&Z.y<X.y+K.y&&Z.y>=X.y},getEvent:function(q){return $.getEvent=q?function(q){return q}:function(){return window.event},$.getEvent(q)},getMousePosition:function(q){if("number"==typeof q.pageX)$.getMousePosition=function(q){var Z=new $.Point;return q=$.getEvent(q),Z.x=q.pageX,Z.y=q.pageY,Z};else{if("number"!=typeof q.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(q){var Z=new $.Point;return q=$.getEvent(q),Z.x=q.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,Z.y=q.clientY+document.body.scrollTop+document.documentElement.scrollTop,Z}}return $.getMousePosition(q)},getPageScroll:function(){var q=document.documentElement||{},Z=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(Z.scrollLeft||Z.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!q.scrollLeft&&!q.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(q){if(void 0!==window.scrollTo)$.setPageScroll=function(q){window.scrollTo(q.x,q.y)};else{var Z=$.getPageScroll();if(Z.x===q.x&&Z.y===q.y)return;document.body.scrollLeft=q.x,document.body.scrollTop=q.y;var X=$.getPageScroll();if(X.x!==Z.x&&X.y!==Z.y)return void($.setPageScroll=function(q){document.body.scrollLeft=q.x,document.body.scrollTop=q.y});if(document.documentElement.scrollLeft=q.x,document.documentElement.scrollTop=q.y,(X=$.getPageScroll()).x!==Z.x&&X.y!==Z.y)return void($.setPageScroll=function(q){document.documentElement.scrollLeft=q.x,document.documentElement.scrollTop=q.y});$.setPageScroll=function(q){}}return $.setPageScroll(q)},getWindowSize:function(){var q=document.documentElement||{},Z=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(q.clientWidth||q.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!Z.clientWidth&&!Z.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(q){q=$.getElement(q);var Z=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(Z[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(Z[1].style,{display:"table-row"}),$.extend(Z[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),Z[0].appendChild(Z[1]),Z[1].appendChild(Z[2]),Z[2].appendChild(q),Z[0]},makeNeutralElement:function(q){var Z=document.createElement(q),X=Z.style;return X.background="transparent none",X.border="none",X.margin="0px",X.padding="0px",X.position="static",Z},now:function(){return Date.now?$.now=Date.now:$.now=function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(q){return $.makeTransparentImage=function(q){var Z=$.makeNeutralElement("img");return Z.src=q,Z},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(q){var Z=$.makeNeutralElement("img"),X=null;return(X=$.makeNeutralElement("span")).style.display="inline-block",Z.onload=function(){X.style.width=X.style.width||Z.width+"px",X.style.height=X.style.height||Z.height+"px",Z.onload=null,Z=null},Z.src=q,X.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+q+"', sizingMethod='scale')",X}),$.makeTransparentImage(q)},setElementOpacity:function(q,Z,X){var K;q=$.getElement(q),X&&!$.Browser.alpha&&(Z=Math.round(Z)),$.Browser.opacity?q.style.opacity=Z<1?Z:"":Z<1?(K="alpha(opacity="+Math.round(100*Z)+")",q.style.filter=K):q.style.filter=""},setElementTouchActionNone:function(q){void 0!==(q=$.getElement(q)).style.touchAction?q.style.touchAction="none":void 0!==q.style.msTouchAction&&(q.style.msTouchAction="none")},addClass:function(q,Z){(q=$.getElement(q)).className?-1===(" "+q.className+" ").indexOf(" "+Z+" ")&&(q.className+=" "+Z):q.className=Z},indexOf:function(q,Z,X){return Array.prototype.indexOf?this.indexOf=function(q,Z,X){return q.indexOf(Z,X)}:this.indexOf=function(q,Z,X){var K,Y,Q=X||0;if(!q)throw new TypeError;if(0===(Y=q.length)||Y<=Q)return-1;for(Q<0&&(Q=Y-Math.abs(Q)),K=Q;K<Y;K++)if(q[K]===Z)return K;return-1},this.indexOf(q,Z,X)},removeClass:function(q,Z){var X,K,Y=[];for(X=(q=$.getElement(q)).className.split(/\s+/),K=0;K<X.length;K++)X[K]&&X[K]!==Z&&Y.push(X[K]);q.className=Y.join(" ")},addEvent:function(){if(window.addEventListener)return function(q,Z,X,K){(q=$.getElement(q)).addEventListener(Z,X,K)};if(window.attachEvent)return function(q,Z,X,K){(q=$.getElement(q)).attachEvent("on"+Z,X)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(q,Z,X,K){(q=$.getElement(q)).removeEventListener(Z,X,K)};if(window.detachEvent)return function(q,Z,X,K){(q=$.getElement(q)).detachEvent("on"+Z,X)};throw new Error("No known event model.")}(),cancelEvent:function(q){(q=$.getEvent(q)).preventDefault?$.cancelEvent=function(q){q.preventDefault()}:$.cancelEvent=function(q){(q=$.getEvent(q)).cancel=!0,q.returnValue=!1},$.cancelEvent(q)},stopEvent:function(q){(q=$.getEvent(q)).stopPropagation?$.stopEvent=function(q){q.stopPropagation()}:$.stopEvent=function(q){(q=$.getEvent(q)).cancelBubble=!0},$.stopEvent(q)},createCallback:function(q,Z){var X,K=[];for(X=2;X<arguments.length;X++)K.push(arguments[X]);return function(){var X,Y=K.concat([]);for(X=0;X<arguments.length;X++)Y.push(arguments[X]);return Z.apply(q,Y)}},getUrlParameter:function(q){return URLPARAMS[q]||null},getUrlProtocol:function(q){var Z=q.match(/^([a-z]+:)\/\//i);return null===Z?window.location.protocol:Z[1].toLowerCase()},createAjaxRequest:function(q){var Z;try{Z=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(q){Z=!1}if(Z)window.XMLHttpRequest?$.createAjaxRequest=function(q){return q?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(q)},makeAjaxRequest:function(q,Z,X){var K,Y,Q;$.isPlainObject(q)&&(Z=q.success,X=q.error,K=q.withCredentials,Y=q.headers,Q=q.responseType||null,q=q.url);var J=$.getUrlProtocol(q),ee=$.createAjaxRequest("file:"===J);if(!$.isFunction(Z))throw new Error("makeAjaxRequest requires a success callback");ee.onreadystatechange=function(){4==ee.readyState&&(ee.onreadystatechange=function(){},200<=ee.status&&ee.status<300||0===ee.status&&"http:"!==J&&"https:"!==J?Z(ee):($.console.log("AJAX request returned %d: %s",ee.status,q),$.isFunction(X)&&X(ee)))};try{if(ee.open("GET",q,!0),Q&&(ee.responseType=Q),Y)for(var te in Y)Object.prototype.hasOwnProperty.call(Y,te)&&Y[te]&&ee.setRequestHeader(te,Y[te]);K&&(ee.withCredentials=!0),ee.send(null)}catch(K){var ie=K.message;if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10&&void 0!==K.number&&-2147024891==K.number&&(ie+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",K.name,ie),ee.onreadystatechange=function(){},window.XDomainRequest){var ne=new window.XDomainRequest;if(ne){ne.onload=function(q){$.isFunction(Z)&&Z({responseText:ne.responseText,status:200,statusText:"OK"})},ne.onerror=function(q){$.isFunction(X)&&X({responseText:ne.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{ne.open("GET",q),ne.send()}catch(q){$.isFunction(X)&&X(ee,K)}}}else $.isFunction(X)&&X(ee,K)}return ee},jsonp:function(q){var Z,X=q.url,K=document.head||document.getElementsByTagName("head")[0]||document.documentElement,Y=q.callbackName||"openseadragon"+$.now(),Q=window[Y],J="$1"+Y+"$2",ee=q.param||"callback",te=q.callback;X=X.replace(/(\=)\?(&|$)|\?\?/i,J),X+=(/\?/.test(X)?"&":"?")+ee+"="+Y,window[Y]=function(q){if(Q)window[Y]=Q;else try{delete window[Y]}catch(q){}te&&$.isFunction(te)&&te(q)},Z=document.createElement("script"),void 0===q.async&&!1===q.async||(Z.async="async"),q.scriptCharset&&(Z.charset=q.scriptCharset),Z.src=X,Z.onload=Z.onreadystatechange=function(q,X){(X||!Z.readyState||/loaded|complete/.test(Z.readyState))&&(Z.onload=Z.onreadystatechange=null,K&&Z.parentNode&&K.removeChild(Z),Z=void 0)},K.insertBefore(Z,K.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(q){if(window.DOMParser)$.parseXml=function(q){return(new DOMParser).parseFromString(q,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(q){var Z=null;return(Z=new ActiveXObject("Microsoft.XMLDOM")).async=!1,Z.loadXML(q),Z}}return $.parseXml(q)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(q){return!!FILEFORMATS[(q=q||"").toLowerCase()]}});var nullfunction=function(q){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};function getOffsetParent(q,Z){return Z&&q!=document.body?document.body:q.offsetParent}!function(){var q=navigator.appVersion,Z=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(Z.substring(Z.indexOf("MSIE")+5,Z.indexOf(";",Z.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(0<=Z.indexOf("Firefox")?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(Z.substring(Z.indexOf("Firefox")+8))):0<=Z.indexOf("Safari")?($.Browser.vendor=0<=Z.indexOf("Chrome")?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(Z.substring(Z.substring(0,Z.indexOf("Safari")).lastIndexOf("/")+1,Z.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(Z)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(q)}var X,K,Y,Q=window.location.search.substring(1).split("&");for(Y=0;Y<Q.length;Y++)if(0<(K=(X=Q[Y]).indexOf("="))){var J=X.substring(0,K),ee=X.substring(K+1);try{URLPARAMS[J]=decodeURIComponent(ee)}catch(q){$.console.error("Ignoring malformed URL parameter: %s=%s",J,ee)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)}(),function(q){var Z=q.requestAnimationFrame||q.mozRequestAnimationFrame||q.webkitRequestAnimationFrame||q.msRequestAnimationFrame,X=q.cancelAnimationFrame||q.mozCancelAnimationFrame||q.webkitCancelAnimationFrame||q.msCancelAnimationFrame;if(Z&&X)$.requestAnimationFrame=function(){return Z.apply(q,arguments)},$.cancelAnimationFrame=function(){return X.apply(q,arguments)};else{var K,Y=[],Q=[],J=0;$.requestAnimationFrame=function(q){return Y.push([++J,q]),K=K||setInterval((function(){if(Y.length){var q=$.now(),Z=Q;for(Q=Y,Y=Z;Q.length;)Q.shift()[1](q)}else clearInterval(K),K=void 0}),20),J},$.cancelAnimationFrame=function(q){var Z,X;for(Z=0,X=Y.length;Z<X;Z+=1)if(Y[Z][0]===q)return void Y.splice(Z,1);for(Z=0,X=Q.length;Z<X;Z+=1)if(Q[Z][0]===q)return void Q.splice(Z,1)}}}(window)}(OpenSeadragon),e=this,t=function(){return OpenSeadragon},"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.OpenSeadragon=t(),function(q){var Z={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(Z.supportsFullScreen=!0,Z.getFullScreenElement=function(){return document.fullscreenElement},Z.requestFullScreen=function(q){return q.requestFullscreen()},Z.exitFullScreen=function(){document.exitFullscreen()},Z.fullScreenEventName="fullscreenchange",Z.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(Z.supportsFullScreen=!0,Z.getFullScreenElement=function(){return document.msFullscreenElement},Z.requestFullScreen=function(q){return q.msRequestFullscreen()},Z.exitFullScreen=function(){document.msExitFullscreen()},Z.fullScreenEventName="MSFullscreenChange",Z.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(Z.supportsFullScreen=!0,Z.getFullScreenElement=function(){return document.webkitFullscreenElement},Z.requestFullScreen=function(q){return q.webkitRequestFullscreen()},Z.exitFullScreen=function(){document.webkitExitFullscreen()},Z.fullScreenEventName="webkitfullscreenchange",Z.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(Z.supportsFullScreen=!0,Z.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},Z.requestFullScreen=function(q){return q.webkitRequestFullScreen()},Z.exitFullScreen=function(){document.webkitCancelFullScreen()},Z.fullScreenEventName="webkitfullscreenchange",Z.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(Z.supportsFullScreen=!0,Z.getFullScreenElement=function(){return document.mozFullScreenElement},Z.requestFullScreen=function(q){return q.mozRequestFullScreen()},Z.exitFullScreen=function(){document.mozCancelFullScreen()},Z.fullScreenEventName="mozfullscreenchange",Z.fullScreenErrorEventName="mozfullscreenerror"),Z.isFullScreen=function(){return null!==Z.getFullScreenElement()},Z.cancelFullScreen=function(){q.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),Z.exitFullScreen()},q.extend(q,Z)}(OpenSeadragon),r=OpenSeadragon,r.EventSource=function(){this.events={}},r.EventSource.prototype={addOnceHandler:function(q,Z,X,K){var Y=this;K=K||1;var Q=0,s=function(X){++Q===K&&Y.removeHandler(q,s),Z(X)};this.addHandler(q,s,X)},addHandler:function(q,Z,X){var K=this.events[q];K||(this.events[q]=K=[]),Z&&r.isFunction(Z)&&(K[K.length]={handler:Z,userData:X||null})},removeHandler:function(q,Z){var X,K=this.events[q],Y=[];if(K&&r.isArray(K)){for(X=0;X<K.length;X++)K[X].handler!==Z&&Y.push(K[X]);this.events[q]=Y}},removeAllHandlers:function(q){if(q)this.events[q]=[];else for(var Z in this.events)this.events[Z]=[]},getHandler:function(q){var Z=this.events[q];return Z&&Z.length?(Z=1===Z.length?[Z[0]]:Array.apply(null,Z),function(q,X){var K,Y=Z.length;for(K=0;K<Y;K++)Z[K]&&(X.eventSource=q,X.userData=Z[K].userData,Z[K].handler(X))}):null},raiseEvent:function(q,Z){var X=this.getHandler(q);X&&X(this,Z=Z||{})}},function(q){var Z,X,K,Y,Q=[],J={};function r(q,Z){return q.hash.toString()+Z.type+Z.id.toString()}function n(){var X,Y,Q,J,ee,te,ie=Z.length,ne=q.now();for(J=ne-K,K=ne,X=0;X<ie;X++)(Q=(Y=Z[X]).gPoint).direction=Math.atan2(Q.currentPos.y-Y.lastPos.y,Q.currentPos.x-Y.lastPos.x),ee=Y.lastPos.distanceTo(Q.currentPos),Y.lastPos=Q.currentPos,te=1e3*ee/(1+J),Q.speed=.75*te+.25*Q.speed}function o(Z){var X,K=J[Z.hash],Y=K.activePointersLists.length;for(X=0;X<Y;X++)0<K.activePointersLists[X].captureCount&&(q.removeEvent(q.MouseTracker.captureElement,"mousemove",K.mousemovecaptured,!0),q.removeEvent(q.MouseTracker.captureElement,"mouseup",K.mouseupcaptured,!0),q.removeEvent(q.MouseTracker.captureElement,q.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",K.pointermovecaptured,!0),q.removeEvent(q.MouseTracker.captureElement,q.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",K.pointerupcaptured,!0),q.removeEvent(q.MouseTracker.captureElement,"touchmove",K.touchmovecaptured,!0),q.removeEvent(q.MouseTracker.captureElement,"touchend",K.touchendcaptured,!0),K.activePointersLists[X].captureCount=0);for(X=0;X<Y;X++)K.activePointersLists.pop()}function t(Z){var X,K,Y=J[Z.hash];if(Y.tracking){for(K=0;K<q.MouseTracker.subscribeEvents.length;K++)X=q.MouseTracker.subscribeEvents[K],q.removeEvent(Z.element,X,Y[X],!1);o(Z),Y.tracking=!1}}function a(Z,X){var K=J[Z.hash];if("pointerevent"===X)return{upName:q.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:K.pointerupcaptured,moveName:q.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:K.pointermovecaptured};if("mouse"===X)return{upName:"mouseup",upHandler:K.mouseupcaptured,moveName:"mousemove",moveHandler:K.mousemovecaptured};if("touch"===X)return{upName:"touchend",upHandler:K.touchendcaptured,moveName:"touchmove",moveHandler:K.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function u(Z,X,K){var Y,Q=Z.getActivePointersListByType(X);Q.captureCount+=K||1,1===Q.captureCount&&(q.Browser.vendor===q.BROWSERS.IE&&q.Browser.version<9?Z.element.setCapture(!0):(Y=a(Z,q.MouseTracker.havePointerEvents?"pointerevent":X),ee&&$(window.top)&&q.addEvent(window.top,Y.upName,Y.upHandler,!0),q.addEvent(q.MouseTracker.captureElement,Y.upName,Y.upHandler,!0),q.addEvent(q.MouseTracker.captureElement,Y.moveName,Y.moveHandler,!0)))}function d(Z,X,K){var Y,Q=Z.getActivePointersListByType(X);Q.captureCount-=K||1,0===Q.captureCount&&(q.Browser.vendor===q.BROWSERS.IE&&q.Browser.version<9?Z.element.releaseCapture():(Y=a(Z,q.MouseTracker.havePointerEvents?"pointerevent":X),ee&&$(window.top)&&q.removeEvent(window.top,Y.upName,Y.upHandler,!0),q.removeEvent(q.MouseTracker.captureElement,Y.moveName,Y.moveHandler,!0),q.removeEvent(q.MouseTracker.captureElement,Y.upName,Y.upHandler,!0)))}function p(Z){var X;if(q.MouseTracker.unprefixedPointerEvents)X=Z.pointerType;else switch(Z.pointerType){case 2:X="touch";break;case 3:X="pen";break;case 4:X="mouse";break;default:X=""}return X}function g(Z){return q.getMousePosition(Z)}function m(q,Z){return w(g(q),Z)}function w(Z,X){var K=q.getElementOffset(X);return Z.minus(K)}function y(Z,X){return new q.Point((Z.x+X.x)/2,(Z.y+X.y)/2)}function i(Z,X){var K={target:(X=q.getEvent(X)).target||X.srcElement,type:"wheel",shiftKey:X.shiftKey||!1,clientX:X.clientX,clientY:X.clientY,pageX:X.pageX?X.pageX:X.clientX,pageY:X.pageY?X.pageY:X.clientY,deltaMode:"MozMousePixelScroll"==X.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==q.MouseTracker.wheelEventName?K.deltaY=-X.wheelDelta/q.DEFAULT_SETTINGS.pixelsPerWheelLine:K.deltaY=X.detail,T(Z,K,X)}function T(Z,X,K){var Y;Y=X.deltaY<0?1:-1,Z.scrollHandler&&!1===Z.scrollHandler({eventSource:Z,pointerType:"mouse",position:m(X,Z.element),scroll:Y,shift:X.shiftKey,isTouchEvent:!1,originalEvent:K,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(K)}function x(q,Z){if(q===Z)return!1;for(;Z&&Z!==q;)Z=Z.parentNode;return Z===q}function S(Z,X){N(Z,X,[{id:q.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:g(X),currentTime:q.now()}])}function E(Z,X){W(Z,X,[{id:q.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:g(X),currentTime:q.now()}])}function P(Z){return q.Browser.vendor===q.BROWSERS.IE&&q.Browser.version<9?1===Z?0:2===Z?2:4===Z?1:-1:Z}function R(Z,X){U(Z,X=q.getEvent(X),[{id:q.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:g(X),currentTime:q.now()}],P(X.button))&&d(Z,"mouse")}function _(Z,X){j(Z,X=q.getEvent(X),[{id:q.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:g(X),currentTime:q.now()}])}function b(q,Z,X){var K,Y=X.getLength(),Q=[];if("touch"===X.type||0<X.contacts){for(K=0;K<Y;K++)Q.push(X.getByIndex(K));0<Q.length&&(U(q,Z,Q,0),X.captureCount=1,d(q,X.type),W(q,Z,Q))}}function C(Z,X){var K,Y,J,ee,te=X.changedTouches.length,ie=[];for(K=q.now(),Y=0;Y<te;Y++)ie.push({id:X.changedTouches[Y].identifier,type:"touch",currentPos:g(X.changedTouches[Y]),currentTime:K});for(U(Z,X,ie,0)&&d(Z,"touch",te),W(Z,X,ie),Y=0;Y<Q.length;Y++)if(Q[Y]!==Z&&Q[Y].isTracking()&&x(Q[Y].element,Z.element)){for(ee=[],J=0;J<te;J++)ee.push({id:X.changedTouches[J].identifier,type:"touch",currentPos:g(X.changedTouches[J]),currentTime:K});W(Q[Y],X,ee)}q.cancelEvent(X)}function O(Z,X){var K,Y=X.changedTouches.length,Q=[];for(K=0;K<Y;K++)Q.push({id:X.changedTouches[K].identifier,type:"touch",currentPos:g(X.changedTouches[K]),currentTime:q.now()});j(Z,X,Q),q.cancelEvent(X)}function I(Z,X){X.currentTarget===X.relatedTarget||x(X.currentTarget,X.relatedTarget)||N(Z,X,[{id:X.pointerId,type:p(X),isPrimary:X.isPrimary,currentPos:g(X),currentTime:q.now()}])}function k(Z,X){X.currentTarget===X.relatedTarget||x(X.currentTarget,X.relatedTarget)||W(Z,X,[{id:X.pointerId,type:p(X),isPrimary:X.isPrimary,currentPos:g(X),currentTime:q.now()}])}function B(Z,X){var K;V(Z,X,[K={id:X.pointerId,type:p(X),isPrimary:X.isPrimary,currentPos:g(X),currentTime:q.now()}],X.button)&&(q.stopEvent(X),u(Z,K.type)),(Z.clickHandler||Z.dblClickHandler||Z.pressHandler||Z.dragHandler||Z.dragEndHandler||Z.pinchHandler)&&q.cancelEvent(X)}function D(q,Z){M(q,Z)}function M(Z,X){var K;U(Z,X,[K={id:X.pointerId,type:p(X),isPrimary:X.isPrimary,currentPos:g(X),currentTime:q.now()}],X.button)&&d(Z,K.type)}function z(q,Z){H(q,Z)}function H(Z,X){j(Z,X,[{id:X.pointerId,type:p(X),isPrimary:X.isPrimary,currentPos:g(X),currentTime:q.now()}])}function F(q,Z){!function(q,Z,X){U(q,Z,X,0),W(q,Z,X)}(q,Z,[{id:Z.pointerId,type:p(Z)}])}function L(q,Z){return Object.prototype.hasOwnProperty.call(Z,"isPrimary")||(0===q.getLength()?Z.isPrimary=!0:Z.isPrimary=!1),Z.speed=0,Z.direction=0,Z.contactPos=Z.currentPos,Z.contactTime=Z.currentTime,Z.lastPos=Z.currentPos,Z.lastTime=Z.currentTime,q.add(Z)}function A(q,Z){var X,K;return q.getById(Z.id)?(X=q.removeById(Z.id),Object.prototype.hasOwnProperty.call(Z,"isPrimary")||(K=q.getPrimary())||(K=q.getByIndex(0))&&(K.isPrimary=!0)):X=q.getLength(),X}function N(Z,X,K){var Y,Q,J,ee=Z.getActivePointersListByType(K[0].type),te=K.length;for(Y=0;Y<te;Y++)Q=K[Y],(J=ee.getById(Q.id))?(J.insideElement=!0,J.lastPos=J.currentPos,J.lastTime=J.currentTime,J.currentPos=Q.currentPos,J.currentTime=Q.currentTime,Q=J):(Q.captured=!1,Q.insideElementPressed=!1,Q.insideElement=!0,L(ee,Q)),Z.enterHandler&&!1===Z.enterHandler({eventSource:Z,pointerType:Q.type,position:w(Q.currentPos,Z.element),buttons:ee.buttons,pointers:Z.getActivePointerCount(),insideElementPressed:Q.insideElementPressed,buttonDownAny:0!==ee.buttons,isTouchEvent:"touch"===Q.type,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X)}function W(Z,X,K){var Y,Q,J,ee=Z.getActivePointersListByType(K[0].type),te=K.length;for(Y=0;Y<te;Y++)Q=K[Y],(J=ee.getById(Q.id))&&(J.captured?(J.insideElement=!1,J.lastPos=J.currentPos,J.lastTime=J.currentTime,J.currentPos=Q.currentPos,J.currentTime=Q.currentTime):A(ee,J),Q=J),Z.exitHandler&&!1===Z.exitHandler({eventSource:Z,pointerType:Q.type,position:Q.currentPos&&w(Q.currentPos,Z.element),buttons:ee.buttons,pointers:Z.getActivePointerCount(),insideElementPressed:!!J&&J.insideElementPressed,buttonDownAny:0!==ee.buttons,isTouchEvent:"touch"===Q.type,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X)}function V(Z,X,K,Y){var Q,ee,te,ie=J[Z.hash],ne=Z.getActivePointersListByType(K[0].type),oe=K.length;void 0!==X.buttons?ne.buttons=X.buttons:q.Browser.vendor===q.BROWSERS.IE&&q.Browser.version<9?0===Y?ne.buttons+=1:1===Y?ne.buttons+=4:2===Y?ne.buttons+=2:3===Y?ne.buttons+=8:4===Y?ne.buttons+=16:5===Y&&(ne.buttons+=32):0===Y?ne.buttons|=1:1===Y?ne.buttons|=4:2===Y?ne.buttons|=2:3===Y?ne.buttons|=8:4===Y?ne.buttons|=16:5===Y&&(ne.buttons|=32);var re=Z.getActivePointersListsExceptType(K[0].type);for(Q=0;Q<re.length;Q++)b(Z,X,re[Q]);if(0!==Y)return Z.nonPrimaryPressHandler&&!1===Z.nonPrimaryPressHandler({eventSource:Z,pointerType:K[0].type,position:w(K[0].currentPos,Z.element),button:Y,buttons:ne.buttons,isTouchEvent:"touch"===K[0].type,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X),!1;for(Q=0;Q<oe;Q++)ee=K[Q],(te=ne.getById(ee.id))?(te.captured=!0,te.insideElementPressed=!0,te.insideElement=!0,te.contactPos=ee.currentPos,te.contactTime=ee.currentTime,te.lastPos=te.currentPos,te.lastTime=te.currentTime,te.currentPos=ee.currentPos,te.currentTime=ee.currentTime,ee=te):(ee.captured=!0,ee.insideElementPressed=!0,ee.insideElement=!0,L(ne,ee)),ne.addContact(),(Z.dragHandler||Z.dragEndHandler||Z.pinchHandler)&&q.MouseTracker.gesturePointVelocityTracker.addPoint(Z,ee),1===ne.contacts?Z.pressHandler&&!1===Z.pressHandler({eventSource:Z,pointerType:ee.type,position:w(ee.contactPos,Z.element),buttons:ne.buttons,isTouchEvent:"touch"===ee.type,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X):2===ne.contacts&&Z.pinchHandler&&"touch"===ee.type&&(ie.pinchGPoints=ne.asArray(),ie.lastPinchDist=ie.currentPinchDist=ie.pinchGPoints[0].currentPos.distanceTo(ie.pinchGPoints[1].currentPos),ie.lastPinchCenter=ie.currentPinchCenter=y(ie.pinchGPoints[0].currentPos,ie.pinchGPoints[1].currentPos));return!0}function U(Z,X,K,Y){var Q,ee,te,ie,ne,oe,re=J[Z.hash],se=Z.getActivePointersListByType(K[0].type),ae=K.length,le=!1,he=!1;if(void 0!==X.buttons?se.buttons=X.buttons:q.Browser.vendor===q.BROWSERS.IE&&q.Browser.version<9?0===Y?--se.buttons:1===Y?se.buttons-=4:2===Y?se.buttons-=2:3===Y?se.buttons-=8:4===Y?se.buttons-=16:5===Y&&(se.buttons-=32):0===Y?se.buttons^=-2:1===Y?se.buttons^=-5:2===Y?se.buttons^=-3:3===Y?se.buttons^=-9:4===Y?se.buttons^=-17:5===Y&&(se.buttons^=-33),0!==Y){Z.nonPrimaryReleaseHandler&&!1===Z.nonPrimaryReleaseHandler({eventSource:Z,pointerType:K[0].type,position:w(K[0].currentPos,Z.element),button:Y,buttons:se.buttons,isTouchEvent:"touch"===K[0].type,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X);var ce=Z.getActivePointersListByType("mouse");return b(Z,X,ce),!1}if(void 0===K[0].currentPos)return b(Z,X,se),!1;for(te=0;te<ae;te++)ie=K[te],(ne=se.getById(ie.id))&&(ne.captured&&(he=le=!(ne.captured=!1)),ne.lastPos=ne.currentPos,ne.lastTime=ne.currentTime,ne.currentPos=ie.currentPos,ne.currentTime=ie.currentTime,ne.insideElement||A(se,ne),Q=ne.currentPos,ee=ne.currentTime,he?(se.removeContact(),(Z.dragHandler||Z.dragEndHandler||Z.pinchHandler)&&q.MouseTracker.gesturePointVelocityTracker.removePoint(Z,ne),0===se.contacts?(Z.releaseHandler&&!1===Z.releaseHandler({eventSource:Z,pointerType:ne.type,position:w(Q,Z.element),buttons:se.buttons,insideElementPressed:ne.insideElementPressed,insideElementReleased:ne.insideElement,isTouchEvent:"touch"===ne.type,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X),Z.dragEndHandler&&!ne.currentPos.equals(ne.contactPos)&&!1===Z.dragEndHandler({eventSource:Z,pointerType:ne.type,position:w(ne.currentPos,Z.element),speed:ne.speed,direction:ne.direction,shift:X.shiftKey,isTouchEvent:"touch"===ne.type,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X),(Z.clickHandler||Z.dblClickHandler)&&ne.insideElement&&(oe=ee-ne.contactTime<=Z.clickTimeThreshold&&ne.contactPos.distanceTo(Q)<=Z.clickDistThreshold,Z.clickHandler&&!1===Z.clickHandler({eventSource:Z,pointerType:ne.type,position:w(ne.currentPos,Z.element),quick:oe,shift:X.shiftKey,isTouchEvent:"touch"===ne.type,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X),Z.dblClickHandler&&oe&&(se.clicks++,1===se.clicks?(re.lastClickPos=Q,re.dblClickTimeOut=setTimeout((function(){se.clicks=0}),Z.dblClickTimeThreshold)):2===se.clicks&&(clearTimeout(re.dblClickTimeOut),se.clicks=0,re.lastClickPos.distanceTo(Q)<=Z.dblClickDistThreshold&&!1===Z.dblClickHandler({eventSource:Z,pointerType:ne.type,position:w(ne.currentPos,Z.element),shift:X.shiftKey,isTouchEvent:"touch"===ne.type,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X),re.lastClickPos=null)))):2===se.contacts&&Z.pinchHandler&&"touch"===ne.type&&(re.pinchGPoints=se.asArray(),re.lastPinchDist=re.currentPinchDist=re.pinchGPoints[0].currentPos.distanceTo(re.pinchGPoints[1].currentPos),re.lastPinchCenter=re.currentPinchCenter=y(re.pinchGPoints[0].currentPos,re.pinchGPoints[1].currentPos))):Z.releaseHandler&&!1===Z.releaseHandler({eventSource:Z,pointerType:ne.type,position:w(Q,Z.element),buttons:se.buttons,insideElementPressed:ne.insideElementPressed,insideElementReleased:ne.insideElement,isTouchEvent:"touch"===ne.type,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X));return le}function j(Z,X,K){var Y,Q,ee,te,ie,ne=J[Z.hash],oe=Z.getActivePointersListByType(K[0].type),re=K.length;for(void 0!==X.buttons&&(oe.buttons=X.buttons),Y=0;Y<re;Y++)Q=K[Y],(ee=oe.getById(Q.id))?(Object.prototype.hasOwnProperty.call(Q,"isPrimary")&&(ee.isPrimary=Q.isPrimary),ee.lastPos=ee.currentPos,ee.lastTime=ee.currentTime,ee.currentPos=Q.currentPos,ee.currentTime=Q.currentTime):(Q.captured=!1,Q.insideElementPressed=!1,Q.insideElement=!0,L(oe,Q));Z.stopHandler&&"mouse"===K[0].type&&(clearTimeout(Z.stopTimeOut),Z.stopTimeOut=setTimeout((function(){var q,Y,Q;q=Z,Y=X,Q=K[0].type,q.stopHandler&&q.stopHandler({eventSource:q,pointerType:Q,position:m(Y,q.element),buttons:q.getActivePointersListByType(Q).buttons,isTouchEvent:"touch"===Q,originalEvent:Y,preventDefaultAction:!1,userData:q.userData})}),Z.stopDelay)),0===oe.contacts?Z.moveHandler&&!1===Z.moveHandler({eventSource:Z,pointerType:K[0].type,position:w(K[0].currentPos,Z.element),buttons:oe.buttons,isTouchEvent:"touch"===K[0].type,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X):1===oe.contacts?(Z.moveHandler&&(ee=oe.asArray()[0],!1===Z.moveHandler({eventSource:Z,pointerType:ee.type,position:w(ee.currentPos,Z.element),buttons:oe.buttons,isTouchEvent:"touch"===ee.type,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X)),Z.dragHandler&&(ie=(ee=oe.asArray()[0]).currentPos.minus(ee.lastPos),!1===Z.dragHandler({eventSource:Z,pointerType:ee.type,position:w(ee.currentPos,Z.element),buttons:oe.buttons,delta:ie,speed:ee.speed,direction:ee.direction,shift:X.shiftKey,isTouchEvent:"touch"===ee.type,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X))):2===oe.contacts&&(Z.moveHandler&&(te=oe.asArray(),!1===Z.moveHandler({eventSource:Z,pointerType:te[0].type,position:w(y(te[0].currentPos,te[1].currentPos),Z.element),buttons:oe.buttons,isTouchEvent:"touch"===te[0].type,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X)),Z.pinchHandler&&"touch"===K[0].type&&(ie=ne.pinchGPoints[0].currentPos.distanceTo(ne.pinchGPoints[1].currentPos))!=ne.currentPinchDist&&(ne.lastPinchDist=ne.currentPinchDist,ne.currentPinchDist=ie,ne.lastPinchCenter=ne.currentPinchCenter,ne.currentPinchCenter=y(ne.pinchGPoints[0].currentPos,ne.pinchGPoints[1].currentPos),!1===Z.pinchHandler({eventSource:Z,pointerType:"touch",gesturePoints:ne.pinchGPoints,lastCenter:w(ne.lastPinchCenter,Z.element),center:w(ne.currentPinchCenter,Z.element),lastDistance:ne.lastPinchDist,distance:ne.currentPinchDist,shift:X.shiftKey,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X)))}q.MouseTracker=function(Z){Q.push(this);var X=arguments;q.isPlainObject(Z)||(Z={element:X[0],clickTimeThreshold:X[1],clickDistThreshold:X[2]}),this.hash=Math.random(),this.element=q.getElement(Z.element),this.clickTimeThreshold=Z.clickTimeThreshold||q.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=Z.clickDistThreshold||q.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=Z.dblClickTimeThreshold||q.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=Z.dblClickDistThreshold||q.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=Z.userData||null,this.stopDelay=Z.stopDelay||50,this.enterHandler=Z.enterHandler||null,this.exitHandler=Z.exitHandler||null,this.pressHandler=Z.pressHandler||null,this.nonPrimaryPressHandler=Z.nonPrimaryPressHandler||null,this.releaseHandler=Z.releaseHandler||null,this.nonPrimaryReleaseHandler=Z.nonPrimaryReleaseHandler||null,this.moveHandler=Z.moveHandler||null,this.scrollHandler=Z.scrollHandler||null,this.clickHandler=Z.clickHandler||null,this.dblClickHandler=Z.dblClickHandler||null,this.dragHandler=Z.dragHandler||null,this.dragEndHandler=Z.dragEndHandler||null,this.pinchHandler=Z.pinchHandler||null,this.stopHandler=Z.stopHandler||null,this.keyDownHandler=Z.keyDownHandler||null,this.keyUpHandler=Z.keyUpHandler||null,this.keyHandler=Z.keyHandler||null,this.focusHandler=Z.focusHandler||null,this.blurHandler=Z.blurHandler||null;var K=this;J[this.hash]={click:function(Z){var X;X=Z,K.clickHandler&&q.cancelEvent(X)},dblclick:function(Z){var X;X=Z,K.dblClickHandler&&q.cancelEvent(X)},keydown:function(Z){!function(Z,X){Z.keyDownHandler&&(X=q.getEvent(X),Z.keyDownHandler({eventSource:Z,keyCode:X.keyCode?X.keyCode:X.charCode,ctrl:X.ctrlKey,shift:X.shiftKey,alt:X.altKey,meta:X.metaKey,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})||q.cancelEvent(X))}(K,Z)},keyup:function(Z){!function(Z,X){Z.keyUpHandler&&(X=q.getEvent(X),Z.keyUpHandler({eventSource:Z,keyCode:X.keyCode?X.keyCode:X.charCode,ctrl:X.ctrlKey,shift:X.shiftKey,alt:X.altKey,meta:X.metaKey,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})||q.cancelEvent(X))}(K,Z)},keypress:function(Z){!function(Z,X){Z.keyHandler&&(X=q.getEvent(X),Z.keyHandler({eventSource:Z,keyCode:X.keyCode?X.keyCode:X.charCode,ctrl:X.ctrlKey,shift:X.shiftKey,alt:X.altKey,meta:X.metaKey,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})||q.cancelEvent(X))}(K,Z)},focus:function(Z){!function(Z,X){Z.focusHandler&&(X=q.getEvent(X),!1===Z.focusHandler({eventSource:Z,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X))}(K,Z)},blur:function(Z){!function(Z,X){Z.blurHandler&&(X=q.getEvent(X),!1===Z.blurHandler({eventSource:Z,originalEvent:X,preventDefaultAction:!1,userData:Z.userData})&&q.cancelEvent(X))}(K,Z)},wheel:function(q){var Z;T(K,Z=q,Z)},mousewheel:function(q){i(K,q)},DOMMouseScroll:function(q){i(K,q)},MozMousePixelScroll:function(q){i(K,q)},mouseenter:function(Z){!function(Z,X){S(Z,X=q.getEvent(X))}(K,Z)},mouseleave:function(Z){!function(Z,X){E(Z,X=q.getEvent(X))}(K,Z)},mouseover:function(Z){!function(Z,X){(X=q.getEvent(X)).currentTarget===X.relatedTarget||x(X.currentTarget,X.relatedTarget)||S(Z,X)}(K,Z)},mouseout:function(Z){!function(Z,X){(X=q.getEvent(X)).currentTarget===X.relatedTarget||x(X.currentTarget,X.relatedTarget)||E(Z,X)}(K,Z)},mousedown:function(Z){!function(Z,X){V(Z,X=q.getEvent(X),[{id:q.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:g(X),currentTime:q.now()}],P(X.button))&&(q.stopEvent(X),u(Z,"mouse")),(Z.clickHandler||Z.dblClickHandler||Z.pressHandler||Z.dragHandler||Z.dragEndHandler)&&q.cancelEvent(X)}(K,Z)},mouseup:function(q){R(K,q)},mouseupcaptured:function(Z){!function(Z,X){R(Z,X),q.stopEvent(X)}(K,Z)},mousemove:function(q){_(K,q)},mousemovecaptured:function(Z){!function(Z,X){_(Z,X),q.stopEvent(X)}(K,Z)},touchstart:function(Z){!function(Z,X){var K,Y,J,ee,te=X.changedTouches.length,ie=[],ne=Z.getActivePointersListByType("touch");for(K=q.now(),ne.getLength()>X.touches.length-te&&(q.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),b(Z,X,ne)),Y=0;Y<te;Y++)ie.push({id:X.changedTouches[Y].identifier,type:"touch",currentPos:g(X.changedTouches[Y]),currentTime:K});for(N(Z,X,ie),Y=0;Y<Q.length;Y++)if(Q[Y]!==Z&&Q[Y].isTracking()&&x(Q[Y].element,Z.element)){for(ee=[],J=0;J<te;J++)ee.push({id:X.changedTouches[J].identifier,type:"touch",currentPos:g(X.changedTouches[J]),currentTime:K});N(Q[Y],X,ee)}V(Z,X,ie,0)&&(q.stopEvent(X),u(Z,"touch",te)),q.cancelEvent(X)}(K,Z)},touchend:function(q){C(K,q)},touchendcaptured:function(Z){!function(Z,X){C(Z,X),q.stopEvent(X)}(K,Z)},touchmove:function(q){O(K,q)},touchmovecaptured:function(Z){!function(Z,X){O(Z,X),q.stopEvent(X)}(K,Z)},touchcancel:function(q){var Z,X,Y;X=q,Y=(Z=K).getActivePointersListByType("touch"),b(Z,X,Y)},gesturestart:function(q){!function(q){q.stopPropagation(),q.preventDefault()}(q)},gesturechange:function(q){!function(q){q.stopPropagation(),q.preventDefault()}(q)},pointerover:function(q){I(K,q)},MSPointerOver:function(q){I(K,q)},pointerout:function(q){k(K,q)},MSPointerOut:function(q){k(K,q)},pointerdown:function(q){B(K,q)},MSPointerDown:function(q){B(K,q)},pointerup:function(q){D(K,q)},MSPointerUp:function(q){D(K,q)},pointermove:function(q){z(K,q)},MSPointerMove:function(q){z(K,q)},pointercancel:function(q){F(K,q)},MSPointerCancel:function(q){F(K,q)},pointerupcaptured:function(Z){!function(Z,X){Z.getActivePointersListByType(p(X)).getById(X.pointerId)&&M(Z,X),q.stopEvent(X)}(K,Z)},pointermovecaptured:function(Z){!function(Z,X){Z.getActivePointersListByType(p(X)).getById(X.pointerId)&&H(Z,X),q.stopEvent(X)}(K,Z)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},Z.startDisabled||this.setTracking(!0)},q.MouseTracker.prototype={destroy:function(){var q;for(t(this),this.element=null,q=0;q<Q.length;q++)if(Q[q]===this){Q.splice(q,1);break}J[this.hash]=null,delete J[this.hash]},isTracking:function(){return J[this.hash].tracking},setTracking:function(Z){return(Z?function(Z){var X,K,Y=J[Z.hash];if(!Y.tracking){for(K=0;K<q.MouseTracker.subscribeEvents.length;K++)X=q.MouseTracker.subscribeEvents[K],q.addEvent(Z.element,X,Y[X],!1);o(Z),Y.tracking=!0}}:t)(this),this},getActivePointersListsExceptType:function(q){for(var Z=J[this.hash],X=[],K=0;K<Z.activePointersLists.length;++K)Z.activePointersLists[K].type!==q&&X.push(Z.activePointersLists[K]);return X},getActivePointersListByType:function(Z){var X,K,Y=J[this.hash],Q=Y.activePointersLists.length;for(X=0;X<Q;X++)if(Y.activePointersLists[X].type===Z)return Y.activePointersLists[X];return K=new q.MouseTracker.GesturePointList(Z),Y.activePointersLists.push(K),K},getActivePointerCount:function(){var q,Z=J[this.hash],X=Z.activePointersLists.length,K=0;for(q=0;q<X;q++)K+=Z.activePointersLists[q].getLength();return K},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},q.MouseTracker.resetAllMouseTrackers=function(){for(var q=0;q<Q.length;q++)Q[q].isTracking()&&(Q[q].setTracking(!1),Q[q].setTracking(!0))},q.MouseTracker.gesturePointVelocityTracker=(Z=[],K=X=0,{addPoint:function(Y,Q){var J=r(Y,Q);Z.push({guid:J,gPoint:Q,lastPos:Q.currentPos}),1===Z.length&&(K=q.now(),X=window.setInterval(n,50))},removePoint:function(q,K){var Y,Q=r(q,K),J=Z.length;for(Y=0;Y<J;Y++)if(Z[Y].guid===Q){Z.splice(Y,1),0==--J&&window.clearInterval(X);break}}}),q.MouseTracker.captureElement=document,q.MouseTracker.wheelEventName=q.Browser.vendor==q.BROWSERS.IE&&8<q.Browser.version||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",q.MouseTracker.supportsMouseCapture=(Y=document.createElement("div"),q.isFunction(Y.setCapture)&&q.isFunction(Y.releaseCapture)),q.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",q.MouseTracker.wheelEventName],"DOMMouseScroll"==q.MouseTracker.wheelEventName&&q.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||q.Browser.vendor!==q.BROWSERS.IE)?(q.MouseTracker.havePointerEvents=!0,q.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),q.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?q.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:q.MouseTracker.maxTouchPoints=0,q.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(q.MouseTracker.havePointerEvents=!0,q.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),q.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?q.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:q.MouseTracker.maxTouchPoints=0,q.MouseTracker.haveMouseEnter=!1):(q.MouseTracker.havePointerEvents=!1,q.Browser.vendor===q.BROWSERS.IE&&q.Browser.version<9?(q.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),q.MouseTracker.haveMouseEnter=!0):(q.MouseTracker.subscribeEvents.push("mouseover","mouseout"),q.MouseTracker.haveMouseEnter=!1),q.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&q.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&q.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),q.MouseTracker.mousePointerId="legacy-mouse",q.MouseTracker.maxTouchPoints=10),q.MouseTracker.GesturePointList=function(q){this._gPoints=[],this.type=q,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},q.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(q){return this._gPoints.push(q)},removeById:function(q){var Z,X=this._gPoints.length;for(Z=0;Z<X;Z++)if(this._gPoints[Z].id===q){this._gPoints.splice(Z,1);break}return this._gPoints.length},getByIndex:function(q){return q<this._gPoints.length?this._gPoints[q]:null},getById:function(q){var Z,X=this._gPoints.length;for(Z=0;Z<X;Z++)if(this._gPoints[Z].id===q)return this._gPoints[Z];return null},getPrimary:function(q){var Z,X=this._gPoints.length;for(Z=0;Z<X;Z++)if(this._gPoints[Z].isPrimary)return this._gPoints[Z];return null},addContact:function(){++this.contacts,1<this.contacts&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};var ee=function(){try{return window.self!==window.top}catch(q){return!0}}();function $(q){try{return q.addEventListener&&q.removeEventListener}catch(q){return!1}}}(OpenSeadragon),o=OpenSeadragon,o.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},o.Control=function(q,Z,X){var K=q.parentNode;"number"==typeof Z&&(o.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),Z={anchor:Z}),Z.attachToViewer=void 0===Z.attachToViewer||Z.attachToViewer,this.autoFade=void 0===Z.autoFade||Z.autoFade,this.element=q,this.anchor=Z.anchor,this.container=X,this.anchor==o.ControlAnchor.ABSOLUTE?(this.wrapper=o.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof Z.top?Z.top+"px":Z.top,this.wrapper.style.left="number"==typeof Z.left?Z.left+"px":Z.left,this.wrapper.style.height="number"==typeof Z.height?Z.height+"px":Z.height,this.wrapper.style.width="number"==typeof Z.width?Z.width+"px":Z.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=o.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==o.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),Z.attachToViewer?this.anchor==o.ControlAnchor.TOP_RIGHT||this.anchor==o.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):K.appendChild(this.wrapper)},o.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(q){this.wrapper.style.display=q?this.anchor==o.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(q){this.element[o.SIGNAL]&&o.Browser.vendor==o.BROWSERS.IE?o.setElementOpacity(this.element,q,!0):o.setElementOpacity(this.wrapper,q,!0)}},function(q){function n(q,Z){var X,K=q.controls;for(X=K.length-1;0<=X;X--)if(K[X].element==Z)return X;return-1}q.ControlDock=function(Z){var X,K,Y=["topleft","topright","bottomright","bottomleft"];for(q.extend(!0,this,{id:"controldock-"+q.now()+"-"+Math.floor(1e6*Math.random()),container:q.makeNeutralElement("div"),controls:[]},Z),this.container.onsubmit=function(){return!1},this.element&&(this.element=q.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),K=0;K<Y.length;K++)X=Y[K],this.controls[X]=q.makeNeutralElement("div"),this.controls[X].style.position="absolute",X.match("left")&&(this.controls[X].style.left="0px"),X.match("right")&&(this.controls[X].style.right="0px"),X.match("top")&&(this.controls[X].style.top="0px"),X.match("bottom")&&(this.controls[X].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},q.ControlDock.prototype={addControl:function(Z,X){var K=null;if(!(0<=n(this,Z=q.getElement(Z)))){switch(X.anchor){case q.ControlAnchor.TOP_RIGHT:K=this.controls.topright,Z.style.position="relative",Z.style.paddingRight="0px",Z.style.paddingTop="0px";break;case q.ControlAnchor.BOTTOM_RIGHT:K=this.controls.bottomright,Z.style.position="relative",Z.style.paddingRight="0px",Z.style.paddingBottom="0px";break;case q.ControlAnchor.BOTTOM_LEFT:K=this.controls.bottomleft,Z.style.position="relative",Z.style.paddingLeft="0px",Z.style.paddingBottom="0px";break;case q.ControlAnchor.TOP_LEFT:K=this.controls.topleft,Z.style.position="relative",Z.style.paddingLeft="0px",Z.style.paddingTop="0px";break;case q.ControlAnchor.ABSOLUTE:default:case q.ControlAnchor.NONE:K=this.container,Z.style.margin="0px",Z.style.padding="0px"}this.controls.push(new q.Control(Z,X,K)),Z.style.display="inline-block"}},removeControl:function(Z){var X=n(this,Z=q.getElement(Z));return 0<=X&&(this.controls[X].destroy(),this.controls.splice(X,1)),this},clearControls:function(){for(;0<this.controls.length;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var q;for(q=this.controls.length-1;0<=q;q--)if(this.controls[q].isVisible())return!0;return!1},setControlsEnabled:function(q){var Z;for(Z=this.controls.length-1;0<=Z;Z--)this.controls[Z].setVisible(q);return this}}}(OpenSeadragon),OpenSeadragon.Placement=OpenSeadragon.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}}),function(q){var Z={},X=1;function u(Z){return Z=q.getElement(Z),new q.Point(0===Z.clientWidth?1:Z.clientWidth,0===Z.clientHeight?1:Z.clientHeight)}function d(Z,X){if(X instanceof q.Overlay)return X;var K=null;if(X.element)K=q.getElement(X.element);else{var Y=X.id?X.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());(K=q.getElement(X.id))||((K=document.createElement("a")).href="#/overlay/"+Y),K.id=Y,q.addClass(K,X.className?X.className:"openseadragon-overlay")}var Q=X.location,J=X.width,ee=X.height;if(!Q){var te=X.x,ie=X.y;if(void 0!==X.px){var ne=Z.viewport.imageToViewportRectangle(new q.Rect(X.px,X.py,J||0,ee||0));te=ne.x,ie=ne.y,J=void 0!==J?ne.width:void 0,ee=void 0!==ee?ne.height:void 0}Q=new q.Point(te,ie)}var oe=X.placement;return oe&&"string"===q.type(oe)&&(oe=q.Placement[X.placement.toUpperCase()]),new q.Overlay({element:K,location:Q,placement:oe,onDraw:X.onDraw,checkResize:X.checkResize,width:J,height:ee,rotationMode:X.rotationMode})}function s(q,Z){var X;for(X=q.length-1;0<=X;X--)if(q[X].element===Z)return X;return-1}function r(Z,X){return q.requestAnimationFrame((function(){X(Z)}))}function a(Z){q.requestAnimationFrame((function(){!function(Z){var X,K;if(Z.controlsShouldFade){for(X=1-(q.now()-Z.controlsFadeBeginTime)/Z.controlsFadeLength,X=Math.min(1,X),X=Math.max(0,X),K=Z.controls.length-1;0<=K;K--)Z.controls[K].autoFade&&Z.controls[K].setOpacity(X);0<X&&a(Z)}}(Z)}))}function p(Z){Z.autoHideControls&&(Z.controlsShouldFade=!0,Z.controlsFadeBeginTime=q.now()+Z.controlsFadeDelay,window.setTimeout((function(){a(Z)}),Z.controlsFadeDelay))}function g(q){var Z;for(q.controlsShouldFade=!1,Z=q.controls.length-1;0<=Z;Z--)q.controls[Z].setOpacity(1)}function v(){g(this)}function f(){p(this)}function l(Z){var X={originalEvent:Z.originalEvent,preventDefaultAction:Z.preventDefaultAction,preventVerticalPan:Z.preventVerticalPan,preventHorizontalPan:Z.preventHorizontalPan};if(this.raiseEvent("canvas-key",X),X.preventDefaultAction||Z.ctrl||Z.alt||Z.meta)return!0;switch(Z.keyCode){case 38:return X.preventVerticalPan||(Z.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new q.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return X.preventVerticalPan||(Z.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new q.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return X.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new q.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return X.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new q.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}}function h(Z){var X={originalEvent:Z.originalEvent,preventDefaultAction:Z.preventDefaultAction,preventVerticalPan:Z.preventVerticalPan,preventHorizontalPan:Z.preventHorizontalPan};if(this.raiseEvent("canvas-key",X),X.preventDefaultAction||Z.ctrl||Z.alt||Z.meta)return!0;switch(Z.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return X.preventVerticalPan||(Z.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new q.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return X.preventVerticalPan||(Z.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new q.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return X.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new q.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return X.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new q.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(q.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(q.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(q.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(q.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}}function w(q){var Z;document.activeElement==this.canvas||this.canvas.focus(),this.viewport.flipped&&(q.position.x=this.viewport.getContainerSize().x-q.position.x);var X={tracker:q.eventSource,position:q.position,quick:q.quick,shift:q.shift,originalEvent:q.originalEvent,preventDefaultAction:q.preventDefaultAction};this.raiseEvent("canvas-click",X),!X.preventDefaultAction&&this.viewport&&q.quick&&(Z=this.gestureSettingsByDeviceType(q.pointerType)).clickToZoom&&(this.viewport.zoomBy(q.shift?1/this.zoomPerClick:this.zoomPerClick,Z.zoomToRefPoint?this.viewport.pointFromPixel(q.position,!0):null),this.viewport.applyConstraints())}function y(q){var Z,X={tracker:q.eventSource,position:q.position,shift:q.shift,originalEvent:q.originalEvent,preventDefaultAction:q.preventDefaultAction};this.raiseEvent("canvas-double-click",X),!X.preventDefaultAction&&this.viewport&&(Z=this.gestureSettingsByDeviceType(q.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(q.shift?1/this.zoomPerClick:this.zoomPerClick,Z.zoomToRefPoint?this.viewport.pointFromPixel(q.position,!0):null),this.viewport.applyConstraints())}function T(q){var Z,X={tracker:q.eventSource,position:q.position,delta:q.delta,speed:q.speed,direction:q.direction,shift:q.shift,originalEvent:q.originalEvent,preventDefaultAction:q.preventDefaultAction};if(this.raiseEvent("canvas-drag",X),!X.preventDefaultAction&&this.viewport){if(Z=this.gestureSettingsByDeviceType(q.pointerType),this.panHorizontal||(q.delta.x=0),this.panVertical||(q.delta.y=0),this.viewport.flipped&&(q.delta.x=-q.delta.x),this.constrainDuringPan){var K=this.viewport.deltaPointsFromPixels(q.delta.negate());this.viewport.centerSpringX.target.value+=K.x,this.viewport.centerSpringY.target.value+=K.y;var Y=this.viewport.getBounds(),Q=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=K.x,this.viewport.centerSpringY.target.value-=K.y,Y.x!=Q.x&&(q.delta.x=0),Y.y!=Q.y&&(q.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(q.delta.negate()),Z.flickEnabled&&!this.constrainDuringPan)}}function x(Z){if(!Z.preventDefaultAction&&this.viewport){var X=this.gestureSettingsByDeviceType(Z.pointerType);if(X.flickEnabled&&Z.speed>=X.flickMinSpeed){var K=0;this.panHorizontal&&(K=X.flickMomentum*Z.speed*Math.cos(Z.direction));var Y=0;this.panVertical&&(Y=X.flickMomentum*Z.speed*Math.sin(Z.direction));var Q=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),J=this.viewport.pointFromPixel(new q.Point(Q.x-K,Q.y-Y));this.viewport.panTo(J,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:Z.eventSource,position:Z.position,speed:Z.speed,direction:Z.direction,shift:Z.shift,originalEvent:Z.originalEvent})}function S(q){this.raiseEvent("canvas-enter",{tracker:q.eventSource,pointerType:q.pointerType,position:q.position,buttons:q.buttons,pointers:q.pointers,insideElementPressed:q.insideElementPressed,buttonDownAny:q.buttonDownAny,originalEvent:q.originalEvent})}function E(Z){window.location!=window.parent.location&&q.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:Z.eventSource,pointerType:Z.pointerType,position:Z.position,buttons:Z.buttons,pointers:Z.pointers,insideElementPressed:Z.insideElementPressed,buttonDownAny:Z.buttonDownAny,originalEvent:Z.originalEvent})}function P(q){this.raiseEvent("canvas-press",{tracker:q.eventSource,pointerType:q.pointerType,position:q.position,insideElementPressed:q.insideElementPressed,insideElementReleased:q.insideElementReleased,originalEvent:q.originalEvent})}function R(q){this.raiseEvent("canvas-release",{tracker:q.eventSource,pointerType:q.pointerType,position:q.position,insideElementPressed:q.insideElementPressed,insideElementReleased:q.insideElementReleased,originalEvent:q.originalEvent})}function _(q){this.raiseEvent("canvas-nonprimary-press",{tracker:q.eventSource,position:q.position,pointerType:q.pointerType,button:q.button,buttons:q.buttons,originalEvent:q.originalEvent})}function b(q){this.raiseEvent("canvas-nonprimary-release",{tracker:q.eventSource,position:q.position,pointerType:q.pointerType,button:q.button,buttons:q.buttons,originalEvent:q.originalEvent})}function C(q){var Z,X,K;if(!q.preventDefaultAction&&this.viewport&&((Z=this.gestureSettingsByDeviceType(q.pointerType)).pinchToZoom&&(X=this.viewport.pointFromPixel(q.center,!0),K=this.viewport.pointFromPixel(q.lastCenter,!0).minus(X),this.panHorizontal||(K.x=0),this.panVertical||(K.y=0),this.viewport.zoomBy(q.distance/q.lastDistance,X,!0),Z.zoomToRefPoint&&this.viewport.panBy(K,!0),this.viewport.applyConstraints()),Z.pinchRotate)){var Y=Math.atan2(q.gesturePoints[0].currentPos.y-q.gesturePoints[1].currentPos.y,q.gesturePoints[0].currentPos.x-q.gesturePoints[1].currentPos.x),Q=Math.atan2(q.gesturePoints[0].lastPos.y-q.gesturePoints[1].lastPos.y,q.gesturePoints[0].lastPos.x-q.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(Y-Q)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:q.eventSource,gesturePoints:q.gesturePoints,lastCenter:q.lastCenter,center:q.center,lastDistance:q.lastDistance,distance:q.distance,shift:q.shift,originalEvent:q.originalEvent}),!1}function O(Z){var X,K,Y;if((Y=q.now())-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=Y,this.viewport.flipped&&(Z.position.x=this.viewport.getContainerSize().x-Z.position.x),!Z.preventDefaultAction&&this.viewport&&(X=this.gestureSettingsByDeviceType(Z.pointerType)).scrollToZoom&&(K=Math.pow(this.zoomPerScroll,Z.scroll),this.viewport.zoomBy(K,X.zoomToRefPoint?this.viewport.pointFromPixel(Z.position,!0):null),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:Z.eventSource,position:Z.position,scroll:Z.scroll,shift:Z.shift,originalEvent:Z.originalEvent}),X&&X.scrollToZoom)return!1}else if((X=this.gestureSettingsByDeviceType(Z.pointerType))&&X.scrollToZoom)return!1}function I(q){Z[this.hash].mouseInside=!0,g(this),this.raiseEvent("container-enter",{tracker:q.eventSource,position:q.position,buttons:q.buttons,pointers:q.pointers,insideElementPressed:q.insideElementPressed,buttonDownAny:q.buttonDownAny,originalEvent:q.originalEvent})}function k(q){q.pointers<1&&(Z[this.hash].mouseInside=!1,Z[this.hash].animating||p(this)),this.raiseEvent("container-exit",{tracker:q.eventSource,position:q.position,buttons:q.buttons,pointers:q.pointers,insideElementPressed:q.insideElementPressed,buttonDownAny:q.buttonDownAny,originalEvent:q.originalEvent})}function B(q){!function(q){if(!q._opening){if(q.autoResize){var X=u(q.container),K=Z[q.hash].prevContainerSize;if(!X.equals(K)){var Y=q.viewport;if(q.preserveImageSizeOnResize){var Q=K.x/X.x,J=Y.getZoom()*Q,ee=Y.getCenter();Y.resize(X,!1),Y.zoomTo(J,null,!0),Y.panTo(ee,!0)}else{var te=Y.getBounds();Y.resize(X,!0),Y.fitBoundsWithConstraints(te,!0)}Z[q.hash].prevContainerSize=X,Z[q.hash].forceRedraw=!0}}var ie=q.viewport.update(),ne=q.world.update()||ie;ie&&q.raiseEvent("viewport-change"),q.referenceStrip&&(ne=q.referenceStrip.update(q.viewport)||ne),!Z[q.hash].animating&&ne&&(q.raiseEvent("animation-start"),g(q)),(ne||Z[q.hash].forceRedraw||q.world.needsDraw())&&(!function(q){q.imageLoader.clear(),q.drawer.clear(),q.world.draw(),q.raiseEvent("update-viewport",{})}(q),q._drawOverlays(),q.navigator&&q.navigator.update(q.viewport),Z[q.hash].forceRedraw=!1,ne&&q.raiseEvent("animation")),Z[q.hash].animating&&!ne&&(q.raiseEvent("animation-finish"),Z[q.hash].mouseInside||p(q)),Z[q.hash].animating=ne}}(q),q.isOpen()?q._updateRequestId=r(q,B):q._updateRequestId=!1}function D(q,Z){return q?q+Z:Z}function M(){Z[this.hash].lastZoomTime=q.now(),Z[this.hash].zoomFactor=this.zoomPerSecond,Z[this.hash].zooming=!0,n(this)}function z(){Z[this.hash].lastZoomTime=q.now(),Z[this.hash].zoomFactor=1/this.zoomPerSecond,Z[this.hash].zooming=!0,n(this)}function H(){Z[this.hash].zooming=!1}function n(Z){q.requestAnimationFrame(q.delegate(Z,t))}function t(){var X,K,Y;Z[this.hash].zooming&&this.viewport&&(K=(X=q.now())-Z[this.hash].lastZoomTime,Y=Math.pow(Z[this.hash].zoomFactor,K/1e3),this.viewport.zoomBy(Y),this.viewport.applyConstraints(),Z[this.hash].lastZoomTime=X,n(this))}function F(){this.viewport&&(Z[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function L(){this.viewport&&(Z[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function A(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function N(){this.viewport&&this.viewport.goHome()}function W(){this.isFullPage()&&!q.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function V(){if(this.viewport){var Z=this.viewport.getRotation();Z=this.viewport.flipped?q.positiveModulo(Z+this.rotationIncrement,360):q.positiveModulo(Z-this.rotationIncrement,360),this.viewport.setRotation(Z)}}function U(){if(this.viewport){var Z=this.viewport.getRotation();Z=this.viewport.flipped?q.positiveModulo(Z-this.rotationIncrement,360):q.positiveModulo(Z+this.rotationIncrement,360),this.viewport.setRotation(Z)}}function j(){this.viewport.toggleFlip()}function G(){var q=this._sequenceIndex-1;this.navPrevNextWrap&&q<0&&(q+=this.tileSources.length),this.goToPage(q)}function $(){var q=this._sequenceIndex+1;this.navPrevNextWrap&&q>=this.tileSources.length&&(q=0),this.goToPage(q)}q.Viewer=function(K){var Y,Q=arguments,J=this;if(q.isPlainObject(K)||(K={id:Q[0],xmlPath:1<Q.length?Q[1]:void 0,prefixUrl:2<Q.length?Q[2]:void 0,controls:3<Q.length?Q[3]:void 0,overlays:4<Q.length?Q[4]:void 0}),K.config&&(q.extend(!0,K,K.config),delete K.config),q.extend(!0,this,{id:K.id,hash:K.hash||X++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},q.DEFAULT_SETTINGS,K),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==Z[this.hash]&&q.console.warn("Hash "+this.hash+" has already been used."),Z[this.hash]={fsBoundsDelta:new q.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=q.now(),q.EventSource.call(this),this.addHandler("open-failed",(function(Z){var X=q.getString("Errors.OpenFailed",Z.eventSource,Z.message);J._showMessage(X)})),q.ControlDock.call(this,K),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=q.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(q){q.width="100%",q.height="100%",q.overflow="hidden",q.position="absolute",q.top="0px",q.left="0px"}(this.canvas.style),q.setElementTouchActionNone(this.canvas),""!==K.tabIndex&&(this.canvas.tabIndex=void 0===K.tabIndex?0:K.tabIndex),this.container.className="openseadragon-container",function(q){q.width="100%",q.height="100%",q.position="relative",q.overflow="hidden",q.left="0px",q.top="0px",q.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new q.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:q.delegate(this,l),keyHandler:q.delegate(this,h),clickHandler:q.delegate(this,w),dblClickHandler:q.delegate(this,y),dragHandler:q.delegate(this,T),dragEndHandler:q.delegate(this,x),enterHandler:q.delegate(this,S),exitHandler:q.delegate(this,E),pressHandler:q.delegate(this,P),releaseHandler:q.delegate(this,R),nonPrimaryPressHandler:q.delegate(this,_),nonPrimaryReleaseHandler:q.delegate(this,b),scrollHandler:q.delegate(this,O),pinchHandler:q.delegate(this,C)}),this.outerTracker=new q.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:q.delegate(this,I),exitHandler:q.delegate(this,k)}),this.toolbar&&(this.toolbar=new q.ControlDock({element:this.toolbar})),this.bindStandardControls(),Z[this.hash].prevContainerSize=u(this.container),this.world=new q.World({viewer:this}),this.world.addHandler("add-item",(function(q){J.source=J.world.getItemAt(0).source,Z[J.hash].forceRedraw=!0,J._updateRequestId||(J._updateRequestId=r(J,B))})),this.world.addHandler("remove-item",(function(q){J.world.getItemCount()?J.source=J.world.getItemAt(0).source:J.source=null,Z[J.hash].forceRedraw=!0})),this.world.addHandler("metrics-change",(function(q){J.viewport&&J.viewport._setContentBounds(J.world.getHomeBounds(),J.world.getContentFactor())})),this.world.addHandler("item-index-change",(function(q){J.source=J.world.getItemAt(0).source})),this.viewport=new q.Viewport({containerSize:Z[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new q.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:K.timeout}),this.tileCache=new q.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new q.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=q.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(Y=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(Y,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(Y=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(Y,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new q.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),Y=0;Y<this.customControls.length;Y++)this.addControl(this.customControls[Y].id,{anchor:this.customControls[Y].anchor});q.requestAnimationFrame((function(){p(J)})),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},q.extend(q.Viewer.prototype,q.EventSource.prototype,q.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(Z){return q.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(Z)},openTileSource:function(Z){return q.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(Z)},open:function(Z,X){var K=this;if(this.close(),Z)if(this.sequenceMode&&q.isArray(Z))this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===X||isNaN(X)||(this.initialPage=X),this.tileSources=Z,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex);else if(q.isArray(Z)||(Z=[Z]),Z.length){this._opening=!0;var Y,Q=Z.length,J=0,ee=0;function l(){if(J+ee===Q)if(J){!K._firstOpen&&K.preserveViewport||(K.viewport.goHome(!0),K.viewport.update()),K._firstOpen=!1;var q=Z[0];if(q.tileSource&&(q=q.tileSource),K.overlays&&!K.preserveOverlays)for(var X=0;X<K.overlays.length;X++)K.currentOverlays[X]=d(K,K.overlays[X]);K._drawOverlays(),K._opening=!1,K.raiseEvent("open",{source:q})}else K._opening=!1,K.raiseEvent("open-failed",Y)}function t(Z){q.isPlainObject(Z)&&Z.tileSource||(Z={tileSource:Z}),void 0!==Z.index&&(q.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete Z.index),void 0===Z.collectionImmediately&&(Z.collectionImmediately=!0);var X=Z.success;Z.success=function(q){if(J++,Z.tileSource.overlays)for(var Y=0;Y<Z.tileSource.overlays.length;Y++)K.addOverlay(Z.tileSource.overlays[Y]);X&&X(q),l()};var Q=Z.error;Z.error=function(q){ee++,Y=Y||q,Q&&Q(q),l()},K.addTiledImage(Z)}for(var te=0;te<Z.length;te++)t(Z[te]);return this}},close:function(){return Z[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),Z[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(Z[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(q.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),Z[this.hash]=null,delete Z[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(q){return this.innerTracker.setTracking(q),this.outerTracker.setTracking(q),this.raiseEvent("mouse-enabled",{enabled:q}),this},areControlsEnabled:function(){var q,Z=this.controls.length;for(q=0;q<this.controls.length;q++)Z=Z&&this.controls[q].isVisible();return Z},setControlsEnabled:function(q){return(q?g:p)(this),this.raiseEvent("controls-enabled",{enabled:q}),this},setDebugMode:function(q){for(var Z=0;Z<this.world.getItemCount();Z++)this.world.getItemAt(Z).debugMode=q;this.debugMode=q,this.forceRedraw()},isFullPage:function(){return Z[this.hash].fullPage},setFullPage:function(X){var K,Y,Q=document.body,J=Q.style,ee=document.documentElement.style,te=this;if(X==this.isFullPage())return this;var ie={fullPage:X,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",ie),ie.preventDefaultAction)return this;if(X){for(this.elementSize=q.getElementSize(this.element),this.pageScroll=q.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=J.margin,this.docMargin=ee.margin,J.margin="0",ee.margin="0",this.bodyPadding=J.padding,this.docPadding=ee.padding,J.padding="0",ee.padding="0",this.bodyWidth=J.width,this.docWidth=ee.width,J.width="100%",ee.width="100%",this.bodyHeight=J.height,this.docHeight=ee.height,J.height="100%",ee.height="100%",this.previousBody=[],Z[this.hash].prevElementParent=this.element.parentNode,Z[this.hash].prevNextSibling=this.element.nextSibling,Z[this.hash].prevElementWidth=this.element.style.width,Z[this.hash].prevElementHeight=this.element.style.height,K=Q.childNodes.length,Y=0;Y<K;Y++)this.previousBody.push(Q.childNodes[0]),Q.removeChild(Q.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,Q.appendChild(this.toolbar.element),q.addClass(this.toolbar.element,"fullpage")),q.addClass(this.element,"fullpage"),Q.appendChild(this.element),this.element.style.height=q.getWindowSize().y+"px",this.element.style.width=q.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=q.getElementSize(this.element).y-q.getElementSize(this.toolbar.element).y+"px"),Z[this.hash].fullPage=!0,q.delegate(this,I)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,J.margin=this.bodyMargin,ee.margin=this.docMargin,J.padding=this.bodyPadding,ee.padding=this.docPadding,J.width=this.bodyWidth,ee.width=this.docWidth,J.height=this.bodyHeight,ee.height=this.docHeight,Q.removeChild(this.element),K=this.previousBody.length,Y=0;Y<K;Y++)Q.appendChild(this.previousBody.shift());q.removeClass(this.element,"fullpage"),Z[this.hash].prevElementParent.insertBefore(this.element,Z[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(Q.removeChild(this.toolbar.element),q.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=Z[this.hash].prevElementWidth,this.element.style.height=Z[this.hash].prevElementHeight;var ne=0,h=function(){q.setPageScroll(te.pageScroll);var Z=q.getPageScroll();++ne<10&&(Z.x!==te.pageScroll.x||Z.y!==te.pageScroll.y)&&q.requestAnimationFrame(h)};q.requestAnimationFrame(h),Z[this.hash].fullPage=!1,q.delegate(this,k)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:X}),this},setFullScreen:function(Z){var X=this;if(!q.supportsFullScreen)return this.setFullPage(Z);if(q.isFullScreen()===Z)return this;var K={fullScreen:Z,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",K),K.preventDefaultAction)return this;if(Z){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var n=function(){var Z=q.isFullScreen();Z||(q.removeEvent(document,q.fullScreenEventName,n),q.removeEvent(document,q.fullScreenErrorEventName,n),X.setFullPage(!1),X.isFullPage()&&(X.element.style.width=X.fullPageStyleWidth,X.element.style.height=X.fullPageStyleHeight)),X.navigator&&X.viewport&&setTimeout((function(){X.navigator.update(X.viewport)})),X.raiseEvent("full-screen",{fullScreen:Z})};q.addEvent(document,q.fullScreenEventName,n),q.addEvent(document,q.fullScreenErrorEventName,n),q.requestFullScreen(document.body)}else q.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(q){return this.container.style.visibility=q?"":"hidden",this.raiseEvent("visible",{visible:q}),this},addTiledImage:function(Z){q.console.assert(Z,"[Viewer.addTiledImage] options is required"),q.console.assert(Z.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),q.console.assert(!Z.replace||-1<Z.index&&Z.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var X=this;Z.replace&&(Z.replaceItem=X.world.getItemAt(Z.index)),this._hideMessage(),void 0===Z.placeholderFillStyle&&(Z.placeholderFillStyle=this.placeholderFillStyle),void 0===Z.opacity&&(Z.opacity=this.opacity),void 0===Z.preload&&(Z.preload=this.preload),void 0===Z.compositeOperation&&(Z.compositeOperation=this.compositeOperation),void 0===Z.crossOriginPolicy&&(Z.crossOriginPolicy=void 0!==Z.tileSource.crossOriginPolicy?Z.tileSource.crossOriginPolicy:this.crossOriginPolicy),void 0===Z.ajaxWithCredentials&&(Z.ajaxWithCredentials=this.ajaxWithCredentials),void 0===Z.loadTilesWithAjax&&(Z.loadTilesWithAjax=this.loadTilesWithAjax),void 0===Z.ajaxHeaders||null===Z.ajaxHeaders?Z.ajaxHeaders=this.ajaxHeaders:q.isPlainObject(Z.ajaxHeaders)&&q.isPlainObject(this.ajaxHeaders)&&(Z.ajaxHeaders=q.extend({},this.ajaxHeaders,Z.ajaxHeaders));var K={options:Z};function t(q){for(var Y=0;Y<X._loadQueue.length;Y++)if(X._loadQueue[Y]===K){X._loadQueue.splice(Y,1);break}0===X._loadQueue.length&&r(K),X.raiseEvent("add-item-failed",q),Z.error&&Z.error(q)}function r(q){X.collectionMode&&(X.world.arrange({immediately:q.options.collectionImmediately,rows:X.collectionRows,columns:X.collectionColumns,layout:X.collectionLayout,tileSize:X.collectionTileSize,tileMargin:X.collectionTileMargin}),X.world.setAutoRefigureSizes(!0))}function s(){for(var Z,K,Y;X._loadQueue.length&&(Z=X._loadQueue[0]).tileSource;){if(X._loadQueue.splice(0,1),Z.options.replace){var Q=X.world.getIndexOfItem(Z.options.replaceItem);-1!=Q&&(Z.options.index=Q),X.world.removeItem(Z.options.replaceItem)}K=new q.TiledImage({viewer:X,source:Z.tileSource,viewport:X.viewport,drawer:X.drawer,tileCache:X.tileCache,imageLoader:X.imageLoader,x:Z.options.x,y:Z.options.y,width:Z.options.width,height:Z.options.height,fitBounds:Z.options.fitBounds,fitBoundsPlacement:Z.options.fitBoundsPlacement,clip:Z.options.clip,placeholderFillStyle:Z.options.placeholderFillStyle,opacity:Z.options.opacity,preload:Z.options.preload,degrees:Z.options.degrees,compositeOperation:Z.options.compositeOperation,springStiffness:X.springStiffness,animationTime:X.animationTime,minZoomImageRatio:X.minZoomImageRatio,wrapHorizontal:X.wrapHorizontal,wrapVertical:X.wrapVertical,immediateRender:X.immediateRender,blendTime:X.blendTime,alwaysBlend:X.alwaysBlend,minPixelRatio:X.minPixelRatio,smoothTileEdgesMinZoom:X.smoothTileEdgesMinZoom,iOSDevice:X.iOSDevice,crossOriginPolicy:Z.options.crossOriginPolicy,ajaxWithCredentials:Z.options.ajaxWithCredentials,loadTilesWithAjax:Z.options.loadTilesWithAjax,ajaxHeaders:Z.options.ajaxHeaders,debugMode:X.debugMode}),X.collectionMode&&X.world.setAutoRefigureSizes(!1),X.world.addItem(K,{index:Z.options.index}),0===X._loadQueue.length&&r(Z),1!==X.world.getItemCount()||X.preserveViewport||X.viewport.goHome(!0),X.navigator&&(Y=q.extend({},Z.options,{replace:!1,originalTiledImage:K,tileSource:Z.tileSource}),X.navigator.addTiledImage(Y)),Z.options.success&&Z.options.success({item:K})}}q.isArray(Z.tileSource)?setTimeout((function(){t({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:Z.tileSource,options:Z})})):(this._loadQueue.push(K),function(Z,X,K,Y,Q){var J=Z;if("string"==q.type(X))if(X.match(/^\s*<.*>\s*$/))X=q.parseXml(X);else if(X.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var ee=q.parseJSON(X);X=ee}catch(ee){}function h(q,Z){q.ready?Y(q):(q.addHandler("ready",(function(){Y(q)})),q.addHandler("open-failed",(function(q){Q({message:q.message,source:Z})})))}setTimeout((function(){if("string"==q.type(X))(X=new q.TileSource({url:X,crossOriginPolicy:void 0!==K.crossOriginPolicy?K.crossOriginPolicy:Z.crossOriginPolicy,ajaxWithCredentials:Z.ajaxWithCredentials,ajaxHeaders:Z.ajaxHeaders,useCanvas:Z.useCanvas,success:function(q){Y(q.tileSource)}})).addHandler("open-failed",(function(q){Q(q)}));else if(q.isPlainObject(X)||X.nodeType)if(void 0!==X.crossOriginPolicy||void 0===K.crossOriginPolicy&&void 0===Z.crossOriginPolicy||(X.crossOriginPolicy=void 0!==K.crossOriginPolicy?K.crossOriginPolicy:Z.crossOriginPolicy),void 0===X.ajaxWithCredentials&&(X.ajaxWithCredentials=Z.ajaxWithCredentials),void 0===X.useCanvas&&(X.useCanvas=Z.useCanvas),q.isFunction(X.getTileUrl)){var ee=new q.TileSource(X);ee.getTileUrl=X.getTileUrl,Y(ee)}else{var te=q.TileSource.determineType(J,X);if(!te)return void Q({message:"Unable to load TileSource",source:X});var ie=te.prototype.configure.apply(J,[X]);h(new te(ie),X)}else h(X,X)}))}(this,Z.tileSource,Z,(function(q){K.tileSource=q,s()}),(function(q){q.options=Z,t(q),s()})))},addSimpleImage:function(Z){q.console.assert(Z,"[Viewer.addSimpleImage] options is required"),q.console.assert(Z.url,"[Viewer.addSimpleImage] options.url is required");var X=q.extend({},Z,{tileSource:{type:"image",url:Z.url}});delete X.url,this.addTiledImage(X)},addLayer:function(Z){var X=this;q.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var K=q.extend({},Z,{success:function(q){X.raiseEvent("add-layer",{options:Z,drawer:q.item})},error:function(q){X.raiseEvent("add-layer-failed",q)}});return this.addTiledImage(K),this},getLayerAtLevel:function(Z){return q.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(Z)},getLevelOfLayer:function(Z){return q.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(Z)},getLayersCount:function(){return q.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(Z,X){return q.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(Z,X)},removeLayer:function(Z){return q.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(Z)},forceRedraw:function(){return Z[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var Z=q.delegate(this,v),X=q.delegate(this,f),K=q.delegate(this,$),Y=q.delegate(this,G),Q=this.navImages,J=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(J=!1),this.previousButton=new q.Button({element:this.previousButton?q.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:q.getString("Tooltips.PreviousPage"),srcRest:D(this.prefixUrl,Q.previous.REST),srcGroup:D(this.prefixUrl,Q.previous.GROUP),srcHover:D(this.prefixUrl,Q.previous.HOVER),srcDown:D(this.prefixUrl,Q.previous.DOWN),onRelease:Y,onFocus:Z,onBlur:X}),this.nextButton=new q.Button({element:this.nextButton?q.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:q.getString("Tooltips.NextPage"),srcRest:D(this.prefixUrl,Q.next.REST),srcGroup:D(this.prefixUrl,Q.next.GROUP),srcHover:D(this.prefixUrl,Q.next.HOVER),srcDown:D(this.prefixUrl,Q.next.DOWN),onRelease:K,onFocus:Z,onBlur:X}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),J&&(this.paging=new q.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:q.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||q.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var Z=q.delegate(this,M),X=q.delegate(this,H),K=q.delegate(this,F),Y=q.delegate(this,z),Q=q.delegate(this,L),J=q.delegate(this,N),ee=q.delegate(this,W),te=q.delegate(this,V),ie=q.delegate(this,U),ne=q.delegate(this,j),oe=q.delegate(this,v),re=q.delegate(this,f),se=this.navImages,ae=[],le=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(le=!1),this.showZoomControl&&(ae.push(this.zoomInButton=new q.Button({element:this.zoomInButton?q.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:q.getString("Tooltips.ZoomIn"),srcRest:D(this.prefixUrl,se.zoomIn.REST),srcGroup:D(this.prefixUrl,se.zoomIn.GROUP),srcHover:D(this.prefixUrl,se.zoomIn.HOVER),srcDown:D(this.prefixUrl,se.zoomIn.DOWN),onPress:Z,onRelease:X,onClick:K,onEnter:Z,onExit:X,onFocus:oe,onBlur:re})),ae.push(this.zoomOutButton=new q.Button({element:this.zoomOutButton?q.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:q.getString("Tooltips.ZoomOut"),srcRest:D(this.prefixUrl,se.zoomOut.REST),srcGroup:D(this.prefixUrl,se.zoomOut.GROUP),srcHover:D(this.prefixUrl,se.zoomOut.HOVER),srcDown:D(this.prefixUrl,se.zoomOut.DOWN),onPress:Y,onRelease:X,onClick:Q,onEnter:Y,onExit:X,onFocus:oe,onBlur:re}))),this.showHomeControl&&ae.push(this.homeButton=new q.Button({element:this.homeButton?q.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:q.getString("Tooltips.Home"),srcRest:D(this.prefixUrl,se.home.REST),srcGroup:D(this.prefixUrl,se.home.GROUP),srcHover:D(this.prefixUrl,se.home.HOVER),srcDown:D(this.prefixUrl,se.home.DOWN),onRelease:J,onFocus:oe,onBlur:re})),this.showFullPageControl&&ae.push(this.fullPageButton=new q.Button({element:this.fullPageButton?q.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:q.getString("Tooltips.FullPage"),srcRest:D(this.prefixUrl,se.fullpage.REST),srcGroup:D(this.prefixUrl,se.fullpage.GROUP),srcHover:D(this.prefixUrl,se.fullpage.HOVER),srcDown:D(this.prefixUrl,se.fullpage.DOWN),onRelease:ee,onFocus:oe,onBlur:re})),this.showRotationControl&&(ae.push(this.rotateLeftButton=new q.Button({element:this.rotateLeftButton?q.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:q.getString("Tooltips.RotateLeft"),srcRest:D(this.prefixUrl,se.rotateleft.REST),srcGroup:D(this.prefixUrl,se.rotateleft.GROUP),srcHover:D(this.prefixUrl,se.rotateleft.HOVER),srcDown:D(this.prefixUrl,se.rotateleft.DOWN),onRelease:te,onFocus:oe,onBlur:re})),ae.push(this.rotateRightButton=new q.Button({element:this.rotateRightButton?q.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:q.getString("Tooltips.RotateRight"),srcRest:D(this.prefixUrl,se.rotateright.REST),srcGroup:D(this.prefixUrl,se.rotateright.GROUP),srcHover:D(this.prefixUrl,se.rotateright.HOVER),srcDown:D(this.prefixUrl,se.rotateright.DOWN),onRelease:ie,onFocus:oe,onBlur:re}))),this.showFlipControl&&ae.push(this.flipButton=new q.Button({element:this.flipButton?q.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:q.getString("Tooltips.Flip"),srcRest:D(this.prefixUrl,se.flip.REST),srcGroup:D(this.prefixUrl,se.flip.GROUP),srcHover:D(this.prefixUrl,se.flip.HOVER),srcDown:D(this.prefixUrl,se.flip.DOWN),onRelease:ne,onFocus:oe,onBlur:re})),le&&(this.buttons=new q.ButtonGroup({buttons:ae,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",q.delegate(this,A)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||q.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||q.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(q){return this.tileSources&&0<=q&&q<this.tileSources.length&&(this._sequenceIndex=q,this._updateSequenceButtons(q),this.open(this.tileSources[q]),this.referenceStrip&&this.referenceStrip.setFocus(q),this.raiseEvent("page",{page:q})),this},addOverlay:function(Z,X,K,Y){var Q;if(Q=q.isPlainObject(Z)?Z:{element:Z,location:X,placement:K,onDraw:Y},Z=q.getElement(Q.element),0<=s(this.currentOverlays,Z))return this;var J=d(this,Q);return this.currentOverlays.push(J),J.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:Z,location:Q.location,placement:Q.placement}),this},updateOverlay:function(X,K,Y){var Q;return X=q.getElement(X),0<=(Q=s(this.currentOverlays,X))&&(this.currentOverlays[Q].update(K,Y),Z[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:X,location:K,placement:Y})),this},removeOverlay:function(X){var K;return X=q.getElement(X),0<=(K=s(this.currentOverlays,X))&&(this.currentOverlays[K].destroy(),this.currentOverlays.splice(K,1),Z[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:X})),this},clearOverlays:function(){for(;0<this.currentOverlays.length;)this.currentOverlays.pop().destroy();return Z[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(Z){var X;return Z=q.getElement(Z),0<=(X=s(this.currentOverlays,Z))?this.currentOverlays[X]:null},_updateSequenceButtons:function(q){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==q?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(0<q?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(Z){this._hideMessage();var X=q.makeNeutralElement("div");X.appendChild(document.createTextNode(Z)),this.messageDiv=q.makeCenteredNode(X),q.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var q=this.messageDiv;q&&(q.parentNode.removeChild(q),delete this.messageDiv)},gestureSettingsByDeviceType:function(q){switch(q){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var q,Z=this.currentOverlays.length;for(q=0;q<Z;q++)this.currentOverlays[q].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&1<this.tileSources.length&&(this.referenceStrip=new q.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else q.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),function(q){function s(q){var Z={tracker:q.eventSource,position:q.position,quick:q.quick,shift:q.shift,originalEvent:q.originalEvent,preventDefaultAction:q.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",Z),!Z.preventDefaultAction&&q.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(q.position.x=this.viewport.getContainerSize().x-q.position.x);var X=this.viewport.pointFromPixel(q.position);this.panVertical?this.panHorizontal||(X.x=this.viewer.viewport.getCenter(!0).x):X.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(X),this.viewer.viewport.applyConstraints()}}function a(q){var Z={tracker:q.eventSource,position:q.position,delta:q.delta,speed:q.speed,direction:q.direction,shift:q.shift,originalEvent:q.originalEvent,preventDefaultAction:q.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",Z),!Z.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(q.delta.x=0),this.panVertical||(q.delta.y=0),this.viewer.viewport.flipped&&(q.delta.x=-q.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(q.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function l(q){q.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function h(q){return this.viewer.raiseEvent("navigator-scroll",{tracker:q.eventSource,position:q.position,scroll:q.scroll,shift:q.shift,originalEvent:q.originalEvent}),!1}function u(q,Z){i(q,"rotate("+Z+"deg)")}function i(q,Z){q.style.webkitTransform=Z,q.style.mozTransform=Z,q.style.msTransform=Z,q.style.oTransform=Z,q.style.transform=Z}q.Navigator=function(Z){var X,K,Y=Z.viewer,Q=this;function r(q){u(Q.displayRegionContainer,q),u(Q.displayRegion,-q),Q.viewport.setRotation(q)}Z.id?(this.element=document.getElementById(Z.id),Z.controlOptions={anchor:q.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(Z.id="navigator-"+q.now(),this.element=q.makeNeutralElement("div"),Z.controlOptions={anchor:q.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:Z.autoFade},Z.position&&("BOTTOM_RIGHT"==Z.position?Z.controlOptions.anchor=q.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==Z.position?Z.controlOptions.anchor=q.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==Z.position?Z.controlOptions.anchor=q.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==Z.position?Z.controlOptions.anchor=q.ControlAnchor.TOP_LEFT:"ABSOLUTE"==Z.position&&(Z.controlOptions.anchor=q.ControlAnchor.ABSOLUTE,Z.controlOptions.top=Z.top,Z.controlOptions.left=Z.left,Z.controlOptions.height=Z.height,Z.controlOptions.width=Z.width))),this.element.id=Z.id,this.element.className+=" navigator",(Z=q.extend(!0,{sizeRatio:q.DEFAULT_SETTINGS.navigatorSizeRatio},Z,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:Z.autoResize,minZoomImageRatio:1,background:Z.background,opacity:Z.opacity,borderColor:Z.borderColor,displayRegionColor:Z.displayRegionColor})).minPixelRatio=this.minPixelRatio=Y.minPixelRatio,q.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new q.Point(1,1),this.totalBorderWidths=new q.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),Z.controlOptions.anchor!=q.ControlAnchor.NONE&&function(q,X){q.margin="0px",q.border=X+"px solid "+Z.borderColor,q.padding="0px",q.background=Z.background,q.opacity=Z.opacity,q.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=q.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(q,X){q.position="relative",q.top="0px",q.left="0px",q.fontSize="0px",q.overflow="hidden",q.border=X+"px solid "+Z.displayRegionColor,q.margin="0px",q.padding="0px",q.background="transparent",q.float="left",q.cssFloat="left",q.styleFloat="left",q.zIndex=999999999,q.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=q.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",Y.addControl(this.element,Z.controlOptions),this._resizeWithViewer=Z.controlOptions.anchor!=q.ControlAnchor.ABSOLUTE&&Z.controlOptions.anchor!=q.ControlAnchor.NONE,Z.width&&Z.height?(this.setWidth(Z.width),this.setHeight(Z.height)):this._resizeWithViewer&&(X=q.getElementSize(Y.element),this.element.style.height=Math.round(X.y*Z.sizeRatio)+"px",this.element.style.width=Math.round(X.x*Z.sizeRatio)+"px",this.oldViewerSize=X,K=q.getElementSize(this.element),this.elementArea=K.x*K.y),this.oldContainerSize=new q.Point(0,0),q.Viewer.apply(this,[Z]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),Z.navigatorRotate&&(r(Z.viewer.viewport?Z.viewer.viewport.getRotation():Z.viewer.degrees||0),Z.viewer.addHandler("rotate",(function(q){r(q.degrees)}))),this.innerTracker.destroy(),this.innerTracker=new q.MouseTracker({element:this.element,dragHandler:q.delegate(this,a),clickHandler:q.delegate(this,s),releaseHandler:q.delegate(this,l),scrollHandler:q.delegate(this,h)}),this.addHandler("reset-size",(function(){Q.viewport&&Q.viewport.goHome(!0)})),Y.world.addHandler("item-index-change",(function(q){window.setTimeout((function(){var Z=Q.world.getItemAt(q.previousIndex);Q.world.setItemIndex(Z,q.newIndex)}),1)})),Y.world.addHandler("remove-item",(function(q){var Z=q.item,X=Q._getMatchingItem(Z);X&&Q.world.removeItem(X)})),this.update(Y.viewport)},q.extend(q.Navigator.prototype,q.EventSource.prototype,q.Viewer.prototype,{updateSize:function(){if(this.viewport){var Z=new q.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);Z.equals(this.oldContainerSize)||(this.viewport.resize(Z,!0),this.viewport.goHome(!0),this.oldContainerSize=Z,this.drawer.clear(),this.world.draw())}},setWidth:function(q){this.width=q,this.element.style.width="number"==typeof q?q+"px":q,this._resizeWithViewer=!1},setHeight:function(q){this.height=q,this.element.style.height="number"==typeof q?q+"px":q,this._resizeWithViewer=!1},setFlip:function(q){return this.viewport.setFlip(q),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(q){i(this.displayRegion,q),i(this.canvas,q),i(this.element,q)},update:function(Z){var X,K,Y,Q,J,ee;if(X=q.getElementSize(this.viewer.element),this._resizeWithViewer&&X.x&&X.y&&!X.equals(this.oldViewerSize)&&(this.oldViewerSize=X,this.maintainSizeRatio||!this.elementArea?(K=X.x*this.sizeRatio,Y=X.y*this.sizeRatio):(K=Math.sqrt(this.elementArea*(X.x/X.y)),Y=this.elementArea/K),this.element.style.width=Math.round(K)+"px",this.element.style.height=Math.round(Y)+"px",this.elementArea||(this.elementArea=K*Y),this.updateSize()),Z&&this.viewport){Q=Z.getBoundsNoRotate(!0),J=this.viewport.pixelFromPointNoRotate(Q.getTopLeft(),!1),ee=this.viewport.pixelFromPointNoRotate(Q.getBottomRight(),!1).minus(this.totalBorderWidths);var te=this.displayRegion.style;te.display=this.world.getItemCount()?"block":"none",te.top=Math.round(J.y)+"px",te.left=Math.round(J.x)+"px";var ie=Math.abs(J.x-ee.x),ne=Math.abs(J.y-ee.y);te.width=Math.round(Math.max(ie,0))+"px",te.height=Math.round(Math.max(ne,0))+"px"}},addTiledImage:function(Z){var X=this,K=Z.originalTiledImage;delete Z.original;var Y=q.extend({},Z,{success:function(q){var Z=q.item;function i(){X._matchBounds(Z,K)}Z._originalForNavigator=K,X._matchBounds(Z,K,!0),K.addHandler("bounds-change",i),K.addHandler("clip-change",i),K.addHandler("opacity-change",(function(){X._matchOpacity(Z,K)})),K.addHandler("composite-operation-change",(function(){X._matchCompositeOperation(Z,K)}))}});return q.Viewer.prototype.addTiledImage.apply(this,[Y])},_getMatchingItem:function(q){for(var Z,X=this.world.getItemCount(),K=0;K<X;K++)if((Z=this.world.getItemAt(K))._originalForNavigator===q)return Z;return null},_matchBounds:function(q,Z,X){var K=Z.getBoundsNoRotate();q.setPosition(K.getTopLeft(),X),q.setWidth(K.width,X),q.setRotation(Z.getRotation(),X),q.setClip(Z.getClip())},_matchOpacity:function(q,Z){q.setOpacity(Z.opacity)},_matchCompositeOperation:function(q,Z){q.setCompositeOperation(Z.compositeOperation)}})}(OpenSeadragon),s=OpenSeadragon,a={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}},s.extend(s,{getString:function(q){var Z,X=q.split("."),K=null,Y=arguments,Q=a;for(Z=0;Z<X.length-1;Z++)Q=Q[X[Z]]||{};return"string"!=typeof(K=Q[X[Z]])&&(s.console.log("Untranslated source string:",q),K=""),K.replace(/\{\d+\}/g,(function(q){var Z=parseInt(q.match(/\d+/),10)+1;return Z<Y.length?Y[Z]:""}))},setString:function(q,Z){var X,K=q.split("."),Y=a;for(X=0;X<K.length-1;X++)Y[K[X]]||(Y[K[X]]={}),Y=Y[K[X]];Y[K[X]]=Z}}),function(q){q.Point=function(q,Z){this.x="number"==typeof q?q:0,this.y="number"==typeof Z?Z:0},q.Point.prototype={clone:function(){return new q.Point(this.x,this.y)},plus:function(Z){return new q.Point(this.x+Z.x,this.y+Z.y)},minus:function(Z){return new q.Point(this.x-Z.x,this.y-Z.y)},times:function(Z){return new q.Point(this.x*Z,this.y*Z)},divide:function(Z){return new q.Point(this.x/Z,this.y/Z)},negate:function(){return new q.Point(-this.x,-this.y)},distanceTo:function(q){return Math.sqrt(Math.pow(this.x-q.x,2)+Math.pow(this.y-q.y,2))},squaredDistanceTo:function(q){return Math.pow(this.x-q.x,2)+Math.pow(this.y-q.y,2)},apply:function(Z){return new q.Point(Z(this.x),Z(this.y))},equals:function(Z){return Z instanceof q.Point&&this.x===Z.x&&this.y===Z.y},rotate:function(Z,X){var K,Y;if(X=X||new q.Point(0,0),Z%90==0)switch(q.positiveModulo(Z,360)){case 0:K=1,Y=0;break;case 90:K=0,Y=1;break;case 180:K=-1,Y=0;break;case 270:K=0,Y=-1}else{var Q=Z*Math.PI/180;K=Math.cos(Q),Y=Math.sin(Q)}var J=K*(this.x-X.x)-Y*(this.y-X.y)+X.x,ee=Y*(this.x-X.x)+K*(this.y-X.y)+X.y;return new q.Point(J,ee)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),d=OpenSeadragon,d.TileSource=function(q,Z,X,K,Y,Q){var J,ee,te=this,ie=arguments;if(J=d.isPlainObject(q)?q:{width:ie[0],height:ie[1],tileSize:ie[2],tileOverlap:ie[3],minLevel:ie[4],maxLevel:ie[5]},d.EventSource.call(this),d.extend(!0,this,J),!this.success)for(ee=0;ee<arguments.length;ee++)if(d.isFunction(arguments[ee])){this.success=arguments[ee];break}this.success&&this.addHandler("ready",(function(q){te.success(q)})),"string"==d.type(q)&&(this.url=q),this.url?(this.aspectRatio=1,this.dimensions=new d.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=J.width&&J.height?J.width/J.height:1,this.dimensions=new d.Point(J.width,J.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=J.tileOverlap?J.tileOverlap:0,this.minLevel=J.minLevel?J.minLevel:0,this.maxLevel=void 0!==J.maxLevel&&null!==J.maxLevel?J.maxLevel:J.width&&J.height?Math.ceil(Math.log(Math.max(J.width,J.height))/Math.log(2)):0,this.success&&d.isFunction(this.success)&&this.success(this))},d.TileSource.prototype={getTileSize:function(q){return d.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(q){return this._tileWidth?this._tileWidth:this.getTileSize(q)},getTileHeight:function(q){return this._tileHeight?this._tileHeight:this.getTileSize(q)},getLevelScale:function(q){var Z,X={};for(Z=0;Z<=this.maxLevel;Z++)X[Z]=1/Math.pow(2,this.maxLevel-Z);return this.getLevelScale=function(q){return X[q]},this.getLevelScale(q)},getNumTiles:function(q){var Z=this.getLevelScale(q),X=Math.ceil(Z*this.dimensions.x/this.getTileWidth(q)),K=Math.ceil(Z*this.dimensions.y/this.getTileHeight(q));return new d.Point(X,K)},getPixelRatio:function(q){var Z=this.dimensions.times(this.getLevelScale(q)),X=1/Z.x,K=1/Z.y;return new d.Point(X,K)},getClosestLevel:function(){var q,Z;for(q=this.minLevel+1;q<=this.maxLevel&&!(1<(Z=this.getNumTiles(q)).x||1<Z.y);q++);return q-1},getTileAtPoint:function(q,Z){var X=0<=Z.x&&Z.x<=1&&0<=Z.y&&Z.y<=1/this.aspectRatio;d.console.assert(X,"[TileSource.getTileAtPoint] must be called with a valid point.");var K=this.dimensions.x*this.getLevelScale(q),Y=Z.x*K,Q=Z.y*K,J=Math.floor(Y/this.getTileWidth(q)),ee=Math.floor(Q/this.getTileHeight(q));return 1<=Z.x&&(J=this.getNumTiles(q).x-1),Z.y>=1/this.aspectRatio-1e-15&&(ee=this.getNumTiles(q).y-1),new d.Point(J,ee)},getTileBounds:function(q,Z,X,K){var Y=this.dimensions.times(this.getLevelScale(q)),Q=this.getTileWidth(q),J=this.getTileHeight(q),ee=0===Z?0:Q*Z-this.tileOverlap,te=0===X?0:J*X-this.tileOverlap,ie=Q+(0===Z?1:2)*this.tileOverlap,ne=J+(0===X?1:2)*this.tileOverlap,oe=1/Y.x;return ie=Math.min(ie,Y.x-ee),ne=Math.min(ne,Y.y-te),K?new d.Rect(0,0,ie,ne):new d.Rect(ee*oe,te*oe,ie*oe,ne*oe)},getImageInfo:function(q){var Z,X,K,Y,Q,J,ee,te=this;q&&-1<(ee=(J=(Q=q.split("/"))[Q.length-1]).lastIndexOf("."))&&(Q[Q.length-1]=J.slice(0,ee)),X=function(Z){"string"==typeof Z&&(Z=d.parseXml(Z));var X=d.TileSource.determineType(te,Z,q);X?(void 0===(Y=X.prototype.configure.apply(te,[Z,q])).ajaxWithCredentials&&(Y.ajaxWithCredentials=te.ajaxWithCredentials),K=new X(Y),te.ready=!0,te.raiseEvent("ready",{tileSource:K})):te.raiseEvent("open-failed",{message:"Unable to load TileSource",source:q})},q.match(/\.js$/)?(Z=q.split("/").pop().replace(".js",""),d.jsonp({url:q,async:!1,callbackName:Z,callback:X})):d.makeAjaxRequest({url:q,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(q){var Z=function(q){var Z,X,K=q.responseText,Y=q.status;if(!q)throw new Error(d.getString("Errors.Security"));if(200!==q.status&&0!==q.status)throw Z=404==(Y=q.status)?"Not Found":q.statusText,new Error(d.getString("Errors.Status",Y,Z));if(K.match(/\s*<.*/))try{X=q.responseXML&&q.responseXML.documentElement?q.responseXML:d.parseXml(K)}catch(Z){X=q.responseText}else if(K.match(/\s*[\{\[].*/))try{X=d.parseJSON(K)}catch(Z){X=K}else X=K;return X}(q);X(Z)},error:function(Z,X){var K;try{K="HTTP "+Z.status+" attempting to load TileSource"}catch(Z){K=(void 0!==X&&X.toString?X.toString():"Unknown error")+" attempting to load TileSource"}te.raiseEvent("open-failed",{message:K,source:q})}})},supports:function(q,Z){return!1},configure:function(q,Z){throw new Error("Method not implemented.")},getTileUrl:function(q,Z,X){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(q,Z,X){return{}},tileExists:function(q,Z,X){var K=this.getNumTiles(q);return q>=this.minLevel&&q<=this.maxLevel&&0<=Z&&0<=X&&Z<K.x&&X<K.y}},d.extend(!0,d.TileSource.prototype,d.EventSource.prototype),d.TileSource.determineType=function(q,Z,X){var K;for(K in OpenSeadragon)if(K.match(/.+TileSource$/)&&d.isFunction(OpenSeadragon[K])&&d.isFunction(OpenSeadragon[K].prototype.supports)&&OpenSeadragon[K].prototype.supports.call(q,Z,X))return OpenSeadragon[K];d.console.error("No TileSource was able to open %s %s",X,Z)},function(q){function p(Z,X){var K,Y,Q=X.Image,J=Q.Url,ee=Q.Format,te=Q.Size,ie=Q.DisplayRect||[],ne=parseInt(te.Width,10),oe=parseInt(te.Height,10),re=parseInt(Q.TileSize,10),se=parseInt(Q.Overlap,10),ae=[];for(Y=0;Y<ie.length;Y++)K=ie[Y].Rect,ae.push(new q.DisplayRect(parseInt(K.X,10),parseInt(K.Y,10),parseInt(K.Width,10),parseInt(K.Height,10),parseInt(K.MinLevel,10),parseInt(K.MaxLevel,10)));return q.extend(!0,{width:ne,height:oe,tileSize:re,tileOverlap:se,minLevel:null,maxLevel:null,tilesUrl:J,fileFormat:ee,displayRects:ae},X)}q.DziTileSource=function(Z,X,K,Y,Q,J,ee,te,ie){var ne,oe,re,se;if(se=q.isPlainObject(Z)?Z:{width:Z,height:X,tileSize:K,tileOverlap:Y,tilesUrl:Q,fileFormat:J,displayRects:ee,minLevel:te,maxLevel:ie},this._levelRects={},this.tilesUrl=se.tilesUrl,this.fileFormat=se.fileFormat,this.displayRects=se.displayRects,this.displayRects)for(ne=this.displayRects.length-1;0<=ne;ne--)for(re=(oe=this.displayRects[ne]).minLevel;re<=oe.maxLevel;re++)this._levelRects[re]||(this._levelRects[re]=[]),this._levelRects[re].push(oe);q.TileSource.apply(this,[se])},q.extend(q.DziTileSource.prototype,q.TileSource.prototype,{supports:function(q,Z){var X;return q.Image?X=q.Image.xmlns:q.documentElement&&("Image"!=q.documentElement.localName&&"Image"!=q.documentElement.tagName||(X=q.documentElement.namespaceURI)),-1!==(X=(X||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==X.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(Z,X){var K;return K=(q.isPlainObject(Z)?p:function(Z,X){if(!X||!X.documentElement)throw new Error(q.getString("Errors.Xml"));var K,Y,Q,J,ee,te=X.documentElement,ie=te.localName||te.tagName,ne=X.documentElement.namespaceURI,oe=null,re=[];if("Image"==ie)try{if(void 0===(J=te.getElementsByTagName("Size")[0])&&(J=te.getElementsByTagNameNS(ne,"Size")[0]),oe={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:te.getAttribute("Url"),Format:te.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(te.getAttribute("Overlap"),10),TileSize:parseInt(te.getAttribute("TileSize"),10),Size:{Height:parseInt(J.getAttribute("Height"),10),Width:parseInt(J.getAttribute("Width"),10)}}},!q.imageFormatSupported(oe.Image.Format))throw new Error(q.getString("Errors.ImageFormat",oe.Image.Format.toUpperCase()));for(void 0===(K=te.getElementsByTagName("DisplayRect"))&&(K=te.getElementsByTagNameNS(ne,"DisplayRect")[0]),ee=0;ee<K.length;ee++)void 0===(Q=(Y=K[ee]).getElementsByTagName("Rect")[0])&&(Q=Y.getElementsByTagNameNS(ne,"Rect")[0]),re.push({Rect:{X:parseInt(Q.getAttribute("X"),10),Y:parseInt(Q.getAttribute("Y"),10),Width:parseInt(Q.getAttribute("Width"),10),Height:parseInt(Q.getAttribute("Height"),10),MinLevel:parseInt(Y.getAttribute("MinLevel"),10),MaxLevel:parseInt(Y.getAttribute("MaxLevel"),10)}});return re.length&&(oe.Image.DisplayRect=re),p(Z,oe)}catch(Z){throw Z instanceof Error?Z:new Error(q.getString("Errors.Dzi"))}else{if("Collection"==ie)throw new Error(q.getString("Errors.Dzc"));if("Error"==ie){var se=te.getElementsByTagName("Message")[0].firstChild.nodeValue;throw new Error(se)}}throw new Error(q.getString("Errors.Dzi"))})(this,Z),X&&!K.tilesUrl&&(K.tilesUrl=X.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),-1!=X.search(/\.(dzi|xml|js)\?/)?K.queryParams=X.match(/\?.*/):K.queryParams=""),K},getTileUrl:function(q,Z,X){return[this.tilesUrl,q,"/",Z,"_",X,".",this.fileFormat,this.queryParams].join("")},tileExists:function(q,Z,X){var K,Y,Q,J,ee,te,ie,ne=this._levelRects[q];if(this.minLevel&&q<this.minLevel||this.maxLevel&&q>this.maxLevel)return!1;if(!ne||!ne.length)return!0;for(ie=ne.length-1;0<=ie;ie--)if(!(q<(K=ne[ie]).minLevel||q>K.maxLevel)&&(Y=this.getLevelScale(q),Q=K.x*Y,J=K.y*Y,ee=Q+K.width*Y,te=J+K.height*Y,Q=Math.floor(Q/this._tileWidth),J=Math.floor(J/this._tileWidth),ee=Math.ceil(ee/this._tileWidth),te=Math.ceil(te/this._tileWidth),Q<=Z&&Z<ee&&J<=X&&X<te))return!0;return!1}})}(OpenSeadragon),function(q){function c(q){var Z=Array.isArray(q.profile)?q.profile[0]:q.profile,X=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(Z),K=!1;return 2===q.version&&1<q.profile.length&&q.profile[1].supports&&(K=-1!==q.profile[1].supports.indexOf("sizeByW")),3===q.version&&q.extraFeatures&&(K=-1!==q.extraFeatures.indexOf("sizeByWh")),!X||K}function u(q){for(var Z=[],X=0;X<q.sizes.length;X++)Z.push({url:q["@id"]+"/full/"+q.sizes[X].width+","+(3===q.version?q.sizes[X].height:"")+"/0/default."+q.tileFormat,width:q.sizes[X].width,height:q.sizes[X].height});return Z.sort((function(q,Z){return q.width-Z.width}))}q.IIIFTileSource=function(Z){if(q.extend(!0,this,Z),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(Z.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=Z.version,this.tile_width&&this.tile_height)Z.tileWidth=this.tile_width,Z.tileHeight=this.tile_height;else if(this.tile_width)Z.tileSize=this.tile_width;else if(this.tile_height)Z.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)Z.tileWidth=this.tiles[0].width,Z.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var X=0;X<this.tiles.length;X++)for(var K=0;K<this.tiles[X].scaleFactors.length;K++){var Y=this.tiles[X].scaleFactors[K];this.scale_factors.push(Y),Z.tileSizePerScaleFactor[Y]={width:this.tiles[X].width,height:this.tiles[X].height||this.tiles[X].width}}}else if(c(Z)){for(var Q=Math.min(this.height,this.width),J=[256,512,1024],ee=[],te=0;te<J.length;te++)J[te]<=Q&&ee.push(J[te]);0<ee.length?Z.tileSize=Math.max.apply(null,ee):Z.tileSize=Q}else this.sizes&&0<this.sizes.length?(this.emulateLegacyImagePyramid=!0,Z.levels=u(this),q.extend(!0,Z,{width:Z.levels[Z.levels.length-1].width,height:Z.levels[Z.levels.length-1].height,tileSize:Math.max(Z.height,Z.width),tileOverlap:0,minLevel:0,maxLevel:Z.levels.length-1}),this.levels=Z.levels):q.console.error("Nothing in the info.json to construct image pyramids from");if(!Z.maxLevel&&!this.emulateLegacyImagePyramid)if(this.scale_factors){var ie=Math.max.apply(null,this.scale_factors);Z.maxLevel=Math.round(Math.log(ie)*Math.LOG2E)}else Z.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));q.TileSource.apply(this,[Z])},q.extend(q.IIIFTileSource.prototype,q.TileSource.prototype,{supports:function(q,Z){return!!(q.protocol&&"http://iiif.io/api/image"==q.protocol||q["@context"]&&("http://library.stanford.edu/iiif/image-api/1.1/context.json"==q["@context"]||"http://iiif.io/api/image/1/context.json"==q["@context"])||q.profile&&0===q.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")||q.identifier&&q.width&&q.height||q.documentElement&&"info"==q.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"==q.documentElement.namespaceURI)},configure:function(Z,X){if(q.isPlainObject(Z)){if(Z["@context"]){var K=Z["@context"];if(Array.isArray(K))for(var Y=0;Y<K.length;Y++)if("string"==typeof K[Y]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(K[Y])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===K[Y])){K=K[Y];break}switch(K){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":Z.version=1;break;case"http://iiif.io/api/image/2/context.json":Z.version=2;break;case"http://iiif.io/api/image/3/context.json":Z.version=3;break;default:q.console.error("Data has a @context property which contains no known IIIF context URI.")}}else Z["@context"]="http://iiif.io/api/image/1.0/context.json",Z["@id"]=X.replace("/info.json",""),Z.version=1;if(!Z["@id"]&&Z.id&&(Z["@id"]=Z.id),Z.preferredFormats)for(var Q=0;Q<Z.preferredFormats.length;Q++)if(OpenSeadragon.imageFormatSupported(Z.preferredFormats[Q])){Z.tileFormat=Z.preferredFormats[Q];break}return Z}var J=function(Z){if(!Z||!Z.documentElement)throw new Error(q.getString("Errors.Xml"));var X=Z.documentElement,K=null;if("info"==X.tagName)try{return function e(Z,X,K){var Y,Q;if(3==Z.nodeType&&K)(Q=Z.nodeValue.trim()).match(/^\d*$/)&&(Q=Number(Q)),X[K]?(q.isArray(X[K])||(X[K]=[X[K]]),X[K].push(Q)):X[K]=Q;else if(1==Z.nodeType)for(Y=0;Y<Z.childNodes.length;Y++)e(Z.childNodes[Y],X,Z.nodeName)}(X,K={}),K}catch(Z){throw Z instanceof Error?Z:new Error(q.getString("Errors.IIIF"))}throw new Error(q.getString("Errors.IIIF"))}(Z);return J["@context"]="http://iiif.io/api/image/1.0/context.json",J["@id"]=X.replace("/info.xml",""),J.version=1,J},getTileWidth:function(Z){if(this.emulateLegacyImagePyramid)return q.TileSource.prototype.getTileWidth.call(this,Z);var X=Math.pow(2,this.maxLevel-Z);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[X]?this.tileSizePerScaleFactor[X].width:this._tileWidth},getTileHeight:function(Z){if(this.emulateLegacyImagePyramid)return q.TileSource.prototype.getTileHeight.call(this,Z);var X=Math.pow(2,this.maxLevel-Z);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[X]?this.tileSizePerScaleFactor[X].height:this._tileHeight},getLevelScale:function(Z){if(this.emulateLegacyImagePyramid){var X=NaN;return 0<this.levels.length&&Z>=this.minLevel&&Z<=this.maxLevel&&(X=this.levels[Z].width/this.levels[this.maxLevel].width),X}return q.TileSource.prototype.getLevelScale.call(this,Z)},getNumTiles:function(Z){return this.emulateLegacyImagePyramid?this.getLevelScale(Z)?new q.Point(1,1):new q.Point(0,0):q.TileSource.prototype.getNumTiles.call(this,Z)},getTileAtPoint:function(Z,X){return this.emulateLegacyImagePyramid?new q.Point(0,0):q.TileSource.prototype.getTileAtPoint.call(this,Z,X)},getTileUrl:function(q,Z,X){if(this.emulateLegacyImagePyramid){var K=null;return 0<this.levels.length&&q>=this.minLevel&&q<=this.maxLevel&&(K=this.levels[q].url),K}var Y,Q,J,ee,te,ie,ne,oe,re,se,ae,le,he,ce=Math.pow(.5,this.maxLevel-q),ue=Math.ceil(this.width*ce),de=Math.ceil(this.height*ce);return Y=this.getTileWidth(q),Q=this.getTileHeight(q),J=Math.ceil(Y/ce),ee=Math.ceil(Q/ce),he=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat,ue<Y&&de<Q?(se=2===this.version&&ue===this.width||3===this.version&&ue===this.width&&de===this.height?"max":3===this.version?ue+","+de:ue+",",te="full"):(ie=Z*J,ne=X*ee,oe=Math.min(J,this.width-ie),re=Math.min(ee,this.height-ne),te=0===Z&&0===X&&oe===this.width&&re===this.height?"full":[ie,ne,oe,re].join(","),ae=Math.ceil(oe*ce),le=Math.ceil(re*ce),se=2===this.version&&ae===this.width||3===this.version&&ae===this.width&&le===this.height?"max":3===this.version?ae+","+le:ae+","),[this["@id"],te,se,"0",he].join("/")},__testonly__:{canBeTiled:c,constructLevels:u}})}(OpenSeadragon),function(q){q.OsmTileSource=function(Z,X,K,Y,Q){var J;(J=q.isPlainObject(Z)?Z:{width:Z,height:X,tileSize:K,tileOverlap:Y,tilesUrl:Q}).width&&J.height||(J.width=65572864,J.height=65572864),J.tileSize||(J.tileSize=256,J.tileOverlap=0),J.tilesUrl||(J.tilesUrl="http://tile.openstreetmap.org/"),J.minLevel=8,q.TileSource.apply(this,[J])},q.extend(q.OsmTileSource.prototype,q.TileSource.prototype,{supports:function(q,Z){return q.type&&"openstreetmaps"==q.type},configure:function(q,Z){return q},getTileUrl:function(q,Z,X){return this.tilesUrl+(q-8)+"/"+Z+"/"+X+".png"}})}(OpenSeadragon),h=OpenSeadragon,h.TmsTileSource=function(q,Z,X,K,Y){var Q;Q=h.isPlainObject(q)?q:{width:q,height:Z,tileSize:X,tileOverlap:K,tilesUrl:Y};var J,ee=256*Math.ceil(Q.width/256),te=256*Math.ceil(Q.height/256);J=te<ee?ee/256:te/256,Q.maxLevel=Math.ceil(Math.log(J)/Math.log(2))-1,Q.tileSize=256,Q.width=ee,Q.height=te,h.TileSource.apply(this,[Q])},h.extend(h.TmsTileSource.prototype,h.TileSource.prototype,{supports:function(q,Z){return q.type&&"tiledmapservice"==q.type},configure:function(q,Z){return q},getTileUrl:function(q,Z,X){var K=this.getNumTiles(q).y-1;return this.tilesUrl+q+"/"+Z+"/"+(K-X)+".png"}}),function(q){q.ZoomifyTileSource=function(q){q.tileSize=256;var Z={x:q.width,y:q.height};for(q.imageSizes=[{x:q.width,y:q.height}],q.gridSize=[this._getGridSize(q.width,q.height,q.tileSize)];parseInt(Z.x,10)>q.tileSize||parseInt(Z.y,10)>q.tileSize;)Z.x=Math.floor(Z.x/2),Z.y=Math.floor(Z.y/2),q.imageSizes.push({x:Z.x,y:Z.y}),q.gridSize.push(this._getGridSize(Z.x,Z.y,q.tileSize));q.imageSizes.reverse(),q.gridSize.reverse(),q.minLevel=0,q.maxLevel=q.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[q])},q.extend(q.ZoomifyTileSource.prototype,q.TileSource.prototype,{_getGridSize:function(q,Z,X){return{x:Math.ceil(q/X),y:Math.ceil(Z/X)}},_calculateAbsoluteTileNumber:function(q,Z,X){for(var K=0,Y={},Q=0;Q<q;Q++)K+=(Y=this.gridSize[Q]).x*Y.y;return K+((Y=this.gridSize[q]).x*X+Z)},supports:function(q,Z){return q.type&&"zoomifytileservice"==q.type},configure:function(q,Z){return q},getTileUrl:function(q,Z,X){var K,Y=this._calculateAbsoluteTileNumber(q,Z,X);return K=Math.floor(Y/256),this.tilesUrl+"TileGroup"+K+"/"+q+"-"+Z+"-"+X+".jpg"}})}(OpenSeadragon),function(q){function h(q,Z){return Z.levels}q.LegacyTileSource=function(Z){var X,K,Y;q.isArray(Z)&&(X={type:"legacy-image-pyramid",levels:Z}),X.levels=function(Z){var X,K,Y=[];for(K=0;K<Z.length;K++)(X=Z[K]).height&&X.width&&X.url?Y.push({url:X.url,width:Number(X.width),height:Number(X.height)}):q.console.error("Unsupported image format: %s",X.url?X.url:"<no URL>");return Y.sort((function(q,Z){return q.height-Z.height}))}(X.levels),0<X.levels.length?(K=X.levels[X.levels.length-1].width,Y=X.levels[X.levels.length-1].height):(Y=K=0,q.console.error("No supported image formats found")),q.extend(!0,X,{width:K,height:Y,tileSize:Math.max(Y,K),tileOverlap:0,minLevel:0,maxLevel:0<X.levels.length?X.levels.length-1:0}),q.TileSource.apply(this,[X]),this.levels=X.levels},q.extend(q.LegacyTileSource.prototype,q.TileSource.prototype,{supports:function(q,Z){return q.type&&"legacy-image-pyramid"==q.type||q.documentElement&&"legacy-image-pyramid"==q.documentElement.getAttribute("type")},configure:function(Z,X){return(q.isPlainObject(Z)?h:function(Z,X){if(!X||!X.documentElement)throw new Error(q.getString("Errors.Xml"));var K,Y,Q=X.documentElement,J=Q.tagName,ee=null,te=[];if("image"==J)try{for(ee={type:Q.getAttribute("type"),levels:[]},te=Q.getElementsByTagName("level"),Y=0;Y<te.length;Y++)K=te[Y],ee.levels.push({url:K.getAttribute("url"),width:parseInt(K.getAttribute("width"),10),height:parseInt(K.getAttribute("height"),10)});return h(Z,ee)}catch(Z){throw Z instanceof Error?Z:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==J)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==J)throw new Error("Error: "+X)}throw new Error("Unknown element "+J)})(this,Z)},getLevelScale:function(q){var Z=NaN;return 0<this.levels.length&&q>=this.minLevel&&q<=this.maxLevel&&(Z=this.levels[q].width/this.levels[this.maxLevel].width),Z},getNumTiles:function(Z){return this.getLevelScale(Z)?new q.Point(1,1):new q.Point(0,0)},getTileUrl:function(q,Z,X){var K=null;return 0<this.levels.length&&q>=this.minLevel&&q<=this.maxLevel&&(K=this.levels[q].url),K}})}(OpenSeadragon),function(q){q.ImageTileSource=function(Z){Z=q.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},Z),q.TileSource.apply(this,[Z])},q.extend(q.ImageTileSource.prototype,q.TileSource.prototype,{supports:function(q,Z){return q.type&&"image"===q.type},configure:function(q,Z){return q},getImageInfo:function(Z){var X=this._image=new Image,K=this;this.crossOriginPolicy&&(X.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(X.useCredentials=this.ajaxWithCredentials),q.addEvent(X,"load",(function(){K.width=Object.prototype.hasOwnProperty.call(X,"naturalWidth")?X.naturalWidth:X.width,K.height=Object.prototype.hasOwnProperty.call(X,"naturalHeight")?X.naturalHeight:X.height,K.aspectRatio=K.width/K.height,K.dimensions=new q.Point(K.width,K.height),K._tileWidth=K.width,K._tileHeight=K.height,K.tileOverlap=0,K.minLevel=0,K.levels=K._buildLevels(),K.maxLevel=K.levels.length-1,K.ready=!0,K.raiseEvent("ready",{tileSource:K})})),q.addEvent(X,"error",(function(){K.raiseEvent("open-failed",{message:"Error loading image at "+Z,source:Z})})),X.src=Z},getLevelScale:function(q){var Z=NaN;return q>=this.minLevel&&q<=this.maxLevel&&(Z=this.levels[q].width/this.levels[this.maxLevel].width),Z},getNumTiles:function(Z){return this.getLevelScale(Z)?new q.Point(1,1):new q.Point(0,0)},getTileUrl:function(q,Z,X){var K=null;return q>=this.minLevel&&q<=this.maxLevel&&(K=this.levels[q].url),K},getContext2D:function(q,Z,X){var K=null;return q>=this.minLevel&&q<=this.maxLevel&&(K=this.levels[q].context2D),K},_buildLevels:function(){var Z=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!q.supportsCanvas||!this.useCanvas)return delete this._image,Z;var X=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,K=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,Y=document.createElement("canvas"),Q=Y.getContext("2d");if(Y.width=X,Y.height=K,Q.drawImage(this._image,0,0,X,K),Z[0].context2D=Q,delete this._image,q.isCanvasTainted(Y))return Z;for(;2<=X&&2<=K;){X=Math.floor(X/2),K=Math.floor(K/2);var J=document.createElement("canvas"),ee=J.getContext("2d");J.width=X,J.height=K,ee.drawImage(Y,0,0,X,K),Z.splice(0,0,{context2D:ee,width:X,height:K}),Y=J,Q=ee}return Z}})}(OpenSeadragon),function(q){q.TileSourceCollection=function(Z,X,K,Y){q.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(q){function r(Z){q.requestAnimationFrame((function(){!function(Z){var X;Z.shouldFade&&(X=1-(q.now()-Z.fadeBeginTime)/Z.fadeLength,X=Math.min(1,X),X=Math.max(0,X),Z.imgGroup&&q.setElementOpacity(Z.imgGroup,X,!0),0<X&&r(Z))}(Z)}))}function i(Z,X){Z.element.disabled||(X>=q.ButtonState.GROUP&&Z.currentState==q.ButtonState.REST&&(!function(Z){Z.shouldFade=!1,Z.imgGroup&&q.setElementOpacity(Z.imgGroup,1,!0)}(Z),Z.currentState=q.ButtonState.GROUP),X>=q.ButtonState.HOVER&&Z.currentState==q.ButtonState.GROUP&&(Z.imgHover&&(Z.imgHover.style.visibility=""),Z.currentState=q.ButtonState.HOVER),X>=q.ButtonState.DOWN&&Z.currentState==q.ButtonState.HOVER&&(Z.imgDown&&(Z.imgDown.style.visibility=""),Z.currentState=q.ButtonState.DOWN))}function n(Z,X){Z.element.disabled||(X<=q.ButtonState.HOVER&&Z.currentState==q.ButtonState.DOWN&&(Z.imgDown&&(Z.imgDown.style.visibility="hidden"),Z.currentState=q.ButtonState.HOVER),X<=q.ButtonState.GROUP&&Z.currentState==q.ButtonState.HOVER&&(Z.imgHover&&(Z.imgHover.style.visibility="hidden"),Z.currentState=q.ButtonState.GROUP),X<=q.ButtonState.REST&&Z.currentState==q.ButtonState.GROUP&&(!function(Z){Z.shouldFade=!0,Z.fadeBeginTime=q.now()+Z.fadeDelay,window.setTimeout((function(){r(Z)}),Z.fadeDelay)}(Z),Z.currentState=q.ButtonState.REST))}q.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},q.Button=function(Z){var X=this;q.EventSource.call(this),q.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:q.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:q.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},Z),this.element=Z.element||q.makeNeutralElement("div"),Z.element||(this.imgRest=q.makeTransparentImage(this.srcRest),this.imgGroup=q.makeTransparentImage(this.srcGroup),this.imgHover=q.makeTransparentImage(this.srcHover),this.imgDown=q.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",q.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",q.Browser.vendor==q.BROWSERS.FIREFOX&&q.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=q.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new q.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(Z){Z.insideElementPressed?(i(X,q.ButtonState.DOWN),X.raiseEvent("enter",{originalEvent:Z.originalEvent})):Z.buttonDownAny||i(X,q.ButtonState.HOVER)},focusHandler:function(q){this.enterHandler(q),X.raiseEvent("focus",{originalEvent:q.originalEvent})},exitHandler:function(Z){n(X,q.ButtonState.GROUP),Z.insideElementPressed&&X.raiseEvent("exit",{originalEvent:Z.originalEvent})},blurHandler:function(q){this.exitHandler(q),X.raiseEvent("blur",{originalEvent:q.originalEvent})},pressHandler:function(Z){i(X,q.ButtonState.DOWN),X.raiseEvent("press",{originalEvent:Z.originalEvent})},releaseHandler:function(Z){Z.insideElementPressed&&Z.insideElementReleased?(n(X,q.ButtonState.HOVER),X.raiseEvent("release",{originalEvent:Z.originalEvent})):Z.insideElementPressed?n(X,q.ButtonState.GROUP):i(X,q.ButtonState.HOVER)},clickHandler:function(q){q.quick&&X.raiseEvent("click",{originalEvent:q.originalEvent})},keyHandler:function(q){return 13!==q.keyCode||(X.raiseEvent("click",{originalEvent:q.originalEvent}),X.raiseEvent("release",{originalEvent:q.originalEvent}),!1)}}),n(this,q.ButtonState.REST)},q.extend(q.Button.prototype,q.EventSource.prototype,{notifyGroupEnter:function(){i(this,q.ButtonState.GROUP)},notifyGroupExit:function(){n(this,q.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,q.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,q.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(q){q.ButtonGroup=function(Z){q.extend(!0,this,{buttons:[],clickTimeThreshold:q.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:q.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},Z);var X,K=this.buttons.concat([]),Y=this;if(this.element=Z.element||q.makeNeutralElement("div"),!Z.group)for(this.element.style.display="inline-block",X=0;X<K.length;X++)this.element.appendChild(K[X].element);q.setElementTouchActionNone(this.element),this.tracker=new q.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(q){var Z;for(Z=0;Z<Y.buttons.length;Z++)Y.buttons[Z].notifyGroupEnter()},exitHandler:function(q){var Z;if(!q.insideElementPressed)for(Z=0;Z<Y.buttons.length;Z++)Y.buttons[Z].notifyGroupExit()}})},q.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),R=OpenSeadragon,R.Rect=function(q,Z,X,K,Y){var Q,J;this.x="number"==typeof q?q:0,this.y="number"==typeof Z?Z:0,this.width="number"==typeof X?X:0,this.height="number"==typeof K?K:0,this.degrees="number"==typeof Y?Y:0,this.degrees=R.positiveModulo(this.degrees,360),270<=this.degrees?(Q=this.getTopRight(),this.x=Q.x,this.y=Q.y,J=this.height,this.height=this.width,this.width=J,this.degrees-=270):180<=this.degrees?(Q=this.getBottomRight(),this.x=Q.x,this.y=Q.y,this.degrees-=180):90<=this.degrees&&(Q=this.getBottomLeft(),this.x=Q.x,this.y=Q.y,J=this.height,this.height=this.width,this.width=J,this.degrees-=90)},R.Rect.fromSummits=function(q,Z,X){var K=q.distanceTo(Z),Y=q.distanceTo(X),Q=Z.minus(q),J=Math.atan(Q.y/Q.x);return Q.x<0?J+=Math.PI:Q.y<0&&(J+=2*Math.PI),new R.Rect(q.x,q.y,K,Y,J/Math.PI*180)},R.Rect.prototype={clone:function(){return new R.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new R.Point(this.x,this.y)},getBottomRight:function(){return new R.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new R.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new R.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new R.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new R.Point(this.width,this.height)},equals:function(q){return q instanceof R.Rect&&this.x===q.x&&this.y===q.y&&this.width===q.width&&this.height===q.height&&this.degrees===q.degrees},times:function(q){return new R.Rect(this.x*q,this.y*q,this.width*q,this.height*q,this.degrees)},translate:function(q){return new R.Rect(this.x+q.x,this.y+q.y,this.width,this.height,this.degrees)},union:function(q){var Z=this.getBoundingBox(),X=q.getBoundingBox(),K=Math.min(Z.x,X.x),Y=Math.min(Z.y,X.y),Q=Math.max(Z.x+Z.width,X.x+X.width),J=Math.max(Z.y+Z.height,X.y+X.height);return new R.Rect(K,Y,Q-K,J-Y)},intersection:function(q){var Z=1e-10,X=[],K=this.getTopLeft();q.containsPoint(K,Z)&&X.push(K);var Y=this.getTopRight();q.containsPoint(Y,Z)&&X.push(Y);var Q=this.getBottomLeft();q.containsPoint(Q,Z)&&X.push(Q);var J=this.getBottomRight();q.containsPoint(J,Z)&&X.push(J);var ee=q.getTopLeft();this.containsPoint(ee,Z)&&X.push(ee);var te=q.getTopRight();this.containsPoint(te,Z)&&X.push(te);var ie=q.getBottomLeft();this.containsPoint(ie,Z)&&X.push(ie);var ne=q.getBottomRight();this.containsPoint(ne,Z)&&X.push(ne);for(var oe=this._getSegments(),re=q._getSegments(),se=0;se<oe.length;se++)for(var ae=oe[se],le=0;le<re.length;le++){var he=re[le],ce=w(ae[0],ae[1],he[0],he[1]);ce&&X.push(ce)}function w(q,X,K,Y){var Q=X.minus(q),J=Y.minus(K),ee=-J.x*Q.y+Q.x*J.y;if(0==ee)return null;var te=(Q.x*(q.y-K.y)-Q.y*(q.x-K.x))/ee,ie=(J.x*(q.y-K.y)-J.y*(q.x-K.x))/ee;return-Z<=te&&te<=1-Z&&-Z<=ie&&ie<=1-Z?new R.Point(q.x+ie*Q.x,q.y+ie*Q.y):null}if(0===X.length)return null;for(var ue=X[0].x,de=X[0].x,pe=X[0].y,ge=X[0].y,me=1;me<X.length;me++){var ve=X[me];ve.x<ue&&(ue=ve.x),ve.x>de&&(de=ve.x),ve.y<pe&&(pe=ve.y),ve.y>ge&&(ge=ve.y)}return new R.Rect(ue,pe,de-ue,ge-pe)},_getSegments:function(){var q=this.getTopLeft(),Z=this.getTopRight(),X=this.getBottomLeft(),K=this.getBottomRight();return[[q,Z],[Z,K],[K,X],[X,q]]},rotate:function(q,Z){if(0===(q=R.positiveModulo(q,360)))return this.clone();Z=Z||this.getCenter();var X=this.getTopLeft().rotate(q,Z),K=this.getTopRight().rotate(q,Z).minus(X);K=K.apply((function(q){return Math.abs(q)<1e-15?0:q}));var Y=Math.atan(K.y/K.x);return K.x<0?Y+=Math.PI:K.y<0&&(Y+=2*Math.PI),new R.Rect(X.x,X.y,this.width,this.height,Y/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var q=this.getTopLeft(),Z=this.getTopRight(),X=this.getBottomLeft(),K=this.getBottomRight(),Y=Math.min(q.x,Z.x,X.x,K.x),Q=Math.max(q.x,Z.x,X.x,K.x),J=Math.min(q.y,Z.y,X.y,K.y),ee=Math.max(q.y,Z.y,X.y,K.y);return new R.Rect(Y,J,Q-Y,ee-J)},getIntegerBoundingBox:function(){var q=this.getBoundingBox(),Z=Math.floor(q.x),X=Math.floor(q.y),K=Math.ceil(q.width+q.x-Z),Y=Math.ceil(q.height+q.y-X);return new R.Rect(Z,X,K,Y)},containsPoint:function(q,Z){Z=Z||0;var X=this.getTopLeft(),K=this.getTopRight(),Y=this.getBottomLeft(),Q=K.minus(X),J=Y.minus(X);return(q.x-X.x)*Q.x+(q.y-X.y)*Q.y>=-Z&&(q.x-K.x)*Q.x+(q.y-K.y)*Q.y<=Z&&(q.x-X.x)*J.x+(q.y-X.y)*J.y>=-Z&&(q.x-Y.x)*J.x+(q.y-Y.y)*J.y<=Z},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}},function(q){var Z={};function a(Z){var X=Number(this.element.style.marginLeft.replace("px","")),K=Number(this.element.style.marginTop.replace("px","")),Y=Number(this.element.style.width.replace("px","")),Q=Number(this.element.style.height.replace("px","")),J=q.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?0<-Z.delta.x?X>-(Y-J.x)&&(this.element.style.marginLeft=X+2*Z.delta.x+"px",h(this,J.x,X+2*Z.delta.x)):-Z.delta.x<0&&X<0&&(this.element.style.marginLeft=X+2*Z.delta.x+"px",h(this,J.x,X+2*Z.delta.x)):0<-Z.delta.y?K>-(Q-J.y)&&(this.element.style.marginTop=K+2*Z.delta.y+"px",h(this,J.y,K+2*Z.delta.y)):-Z.delta.y<0&&K<0&&(this.element.style.marginTop=K+2*Z.delta.y+"px",h(this,J.y,K+2*Z.delta.y))),!1}function l(Z){var X=Number(this.element.style.marginLeft.replace("px","")),K=Number(this.element.style.marginTop.replace("px","")),Y=Number(this.element.style.width.replace("px","")),Q=Number(this.element.style.height.replace("px","")),J=q.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?0<Z.scroll?X>-(Y-J.x)&&(this.element.style.marginLeft=X-60*Z.scroll+"px",h(this,J.x,X-60*Z.scroll)):Z.scroll<0&&X<0&&(this.element.style.marginLeft=X-60*Z.scroll+"px",h(this,J.x,X-60*Z.scroll)):Z.scroll<0?K>J.y-Q&&(this.element.style.marginTop=K+60*Z.scroll+"px",h(this,J.y,K+60*Z.scroll)):0<Z.scroll&&K<0&&(this.element.style.marginTop=K+60*Z.scroll+"px",h(this,J.y,K+60*Z.scroll))),!1}function h(Z,X,K){var Y,Q,J,ee,te,ie,ne;for(Y="horizontal"==Z.scroll?Z.panelWidth:Z.panelHeight,Q=Math.ceil(X/Y)+5,ie=Q=(Q=(J=Math.ceil((Math.abs(K)+X)/Y)+1)-Q)<0?0:Q;ie<J&&ie<Z.panels.length;ie++)if(!(ne=Z.panels[ie]).activePanel){var oe,re=Z.viewer.tileSources[ie];oe=re.referenceStripThumbnailUrl?{type:"image",url:re.referenceStripThumbnailUrl}:re,(ee=new q.Viewer({id:ne.id,tileSources:[oe],element:ne,navigatorSizeRatio:Z.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:Z.viewer.loadTilesWithAjax,ajaxHeaders:Z.viewer.ajaxHeaders,useCanvas:Z.useCanvas})).displayRegion=q.makeNeutralElement("div"),ee.displayRegion.id=ne.id+"-displayregion",ee.displayRegion.className="displayregion",(te=ee.displayRegion.style).position="relative",te.top="0px",te.left="0px",te.fontSize="0px",te.overflow="hidden",te.float="left",te.cssFloat="left",te.styleFloat="left",te.zIndex=999999999,te.cursor="default",te.width=Z.panelWidth-4+"px",te.height=Z.panelHeight-4+"px",ee.displayRegion.innerTracker=new q.MouseTracker({element:ee.displayRegion,startDisabled:!0}),ne.getElementsByTagName("div")[0].appendChild(ee.displayRegion),Z.miniViewers[ne.id]=ee,ne.activePanel=!0}}function c(q){var Z=q.eventSource.element;return"horizontal"==this.scroll?Z.style.marginBottom="0px":Z.style.marginLeft="0px",!1}function u(Z){var X=Z.eventSource.element;return"horizontal"==this.scroll?X.style.marginBottom="-"+q.getElementSize(X).y/2+"px":X.style.marginLeft="-"+q.getElementSize(X).x/2+"px",!1}function p(q){if(q.preventDefaultAction||q.ctrl||q.alt||q.meta)return!0;switch(q.keyCode){case 38:case 39:return l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;default:return!0}}function g(q){if(q.preventDefaultAction||q.ctrl||q.alt||q.meta)return!0;switch(q.keyCode){case 61:case 48:case 119:case 87:case 100:return l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:case 115:case 83:case 97:return l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;default:return!0}}q.ReferenceStrip=function(X){var K,Y,Q,J=X.viewer,ee=q.getElementSize(J.element);for(X.id||(X.id="referencestrip-"+q.now(),this.element=q.makeNeutralElement("div"),this.element.id=X.id,this.element.className="referencestrip"),X=q.extend(!0,{sizeRatio:q.DEFAULT_SETTINGS.referenceStripSizeRatio,position:q.DEFAULT_SETTINGS.referenceStripPosition,scroll:q.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:q.DEFAULT_SETTINGS.clickTimeThreshold},X,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),q.extend(this,X),Z[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,(Y=this.element.style).marginTop="0px",Y.marginRight="0px",Y.marginBottom="0px",Y.marginLeft="0px",Y.left="0px",Y.bottom="0px",Y.border="0px",Y.background="#000",Y.position="relative",q.setElementTouchActionNone(this.element),q.setElementOpacity(this.element,.8),this.viewer=J,this.innerTracker=new q.MouseTracker({element:this.element,dragHandler:q.delegate(this,a),scrollHandler:q.delegate(this,l),enterHandler:q.delegate(this,c),exitHandler:q.delegate(this,u),keyDownHandler:q.delegate(this,p),keyHandler:q.delegate(this,g)}),X.width&&X.height?(this.element.style.width=X.width+"px",this.element.style.height=X.height+"px",J.addControl(this.element,{anchor:q.ControlAnchor.BOTTOM_LEFT})):"horizontal"==X.scroll?(this.element.style.width=ee.x*X.sizeRatio*J.tileSources.length+12*J.tileSources.length+"px",this.element.style.height=ee.y*X.sizeRatio+"px",J.addControl(this.element,{anchor:q.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=ee.y*X.sizeRatio*J.tileSources.length+12*J.tileSources.length+"px",this.element.style.width=ee.x*X.sizeRatio+"px",J.addControl(this.element,{anchor:q.ControlAnchor.TOP_LEFT})),this.panelWidth=ee.x*this.sizeRatio+8,this.panelHeight=ee.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},Q=0;Q<J.tileSources.length;Q++)(K=q.makeNeutralElement("div")).id=this.element.id+"-"+Q,K.style.width=this.panelWidth+"px",K.style.height=this.panelHeight+"px",K.style.display="inline",K.style.float="left",K.style.cssFloat="left",K.style.styleFloat="left",K.style.padding="2px",q.setElementTouchActionNone(K),K.innerTracker=new q.MouseTracker({element:K,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(Z){Z.eventSource.dragging=q.now()},releaseHandler:function(Z){var X=Z.eventSource,K=X.element.id,Y=Number(K.split("-")[2]),Q=q.now();Z.insideElementPressed&&Z.insideElementReleased&&X.dragging&&Q-X.dragging<X.clickTimeThreshold&&(X.dragging=null,J.goToPage(Y))}}),this.element.appendChild(K),K.activePanel=!1,this.panels.push(K);h(this,"vertical"==this.scroll?ee.y:ee.x,0),this.setFocus(0)},q.extend(q.ReferenceStrip.prototype,q.EventSource.prototype,q.Viewer.prototype,{setFocus:function(Z){var X,K=this.element.querySelector("#"+this.element.id+"-"+Z),Y=q.getElementSize(this.viewer.canvas),Q=Number(this.element.style.width.replace("px","")),J=Number(this.element.style.height.replace("px","")),ee=-Number(this.element.style.marginLeft.replace("px","")),te=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==K&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=K,this.currentSelected.style.background="#999","horizontal"==this.scroll?(X=Number(Z)*(this.panelWidth+3))>ee+Y.x-this.panelWidth?(X=Math.min(X,Q-Y.x),this.element.style.marginLeft=-X+"px",h(this,Y.x,-X)):X<ee&&(X=Math.max(0,X-Y.x/2),this.element.style.marginLeft=-X+"px",h(this,Y.x,-X)):(X=Number(Z)*(this.panelHeight+3))>te+Y.y-this.panelHeight?(X=Math.min(X,J-Y.y),this.element.style.marginTop=-X+"px",h(this,Y.y,-X)):X<te&&(X=Math.max(0,X-Y.y/2),this.element.style.marginTop=-X+"px",h(this,Y.y,-X)),this.currentPage=Z,c.call(this,{eventSource:this.innerTracker}))},update:function(){return!!Z[this.id].animating&&(q.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var q in this.miniViewers)this.miniViewers[q].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function(q){q.DisplayRect=function(Z,X,K,Y,Q,J){q.Rect.apply(this,[Z,X,K,Y]),this.minLevel=Q,this.maxLevel=J},q.extend(q.DisplayRect.prototype,q.Rect.prototype)}(OpenSeadragon),function(q){q.Spring=function(Z){var X=arguments;"object"!=typeof Z&&(Z={initial:X.length&&"number"==typeof X[0]?X[0]:void 0,springStiffness:1<X.length?X[1].springStiffness:5,animationTime:1<X.length?X[1].animationTime:1.5}),q.console.assert("number"==typeof Z.springStiffness&&0!==Z.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),q.console.assert("number"==typeof Z.animationTime&&0<=Z.animationTime,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),Z.exponential&&(this._exponential=!0,delete Z.exponential),q.extend(!0,this,Z),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:q.now()},q.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},q.Spring.prototype={resetTo:function(Z){q.console.assert(!this._exponential||0!==Z,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=Z,this.start.time=this.target.time=this.current.time=q.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(Z){q.console.assert(!this._exponential||0!==Z,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=Z,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(Z){this.start.value+=Z,this.target.value+=Z,this._exponential&&(q.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(Z){this._exponential=Z,this._exponential&&(q.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var Z,X;this.current.time=q.now(),this._exponential?(Z=this.start._logValue,X=this.target._logValue):(Z=this.start.value,X=this.target.value);var K,Y,Q=this.current.time>=this.target.time?X:Z+(X-Z)*(K=this.springStiffness,Y=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(K*-Y))/(1-Math.exp(-K))),J=this.current.value;return this._exponential?this.current.value=Math.exp(Q):this.current.value=Q,J!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(q){function n(Z){q.extend(!0,this,{timeout:q.DEFAULT_SETTINGS.timeout,jobId:null},Z),this.image=null}n.prototype={errorMsg:null,start:function(){var Z=this,X=this.abort;this.image=new Image,this.image.onload=function(){Z.finish(!0)},this.image.onabort=this.image.onerror=function(){Z.errorMsg="Image load aborted",Z.finish(!1)},this.jobId=window.setTimeout((function(){Z.errorMsg="Image load exceeded timeout ("+Z.timeout+" ms)",Z.finish(!1)}),this.timeout),this.loadWithAjax?(this.request=q.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(q){var X;try{X=new window.Blob([q.response])}catch(Q){var K=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===Q.name&&K){var Y=new K;Y.append(q.response),X=Y.getBlob()}}0===X.size&&(Z.errorMsg="Empty image response.",Z.finish(!1));var Q=(window.URL||window.webkitURL).createObjectURL(X);Z.image.src=Q},error:function(q){Z.errorMsg="Image load aborted - XHR error",Z.finish(!1)}}),this.abort=function(){Z.request.abort(),"function"==typeof X&&X()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(q){this.image.onload=this.image.onerror=this.image.onabort=null,q||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},q.ImageLoader=function(Z){q.extend(!0,this,{jobLimit:q.DEFAULT_SETTINGS.imageLoaderLimit,timeout:q.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},Z)},q.ImageLoader.prototype={addJob:function(q){var Z=this,X=new n({src:q.src,loadWithAjax:q.loadWithAjax,ajaxHeaders:q.loadWithAjax?q.ajaxHeaders:null,crossOriginPolicy:q.crossOriginPolicy,ajaxWithCredentials:q.ajaxWithCredentials,callback:function(X){!function(q,Z,X){q.jobsInProgress--,(!q.jobLimit||q.jobsInProgress<q.jobLimit)&&0<q.jobQueue.length&&(q.jobQueue.shift().start(),q.jobsInProgress++),X(Z.image,Z.errorMsg,Z.request)}(Z,X,q.callback)},abort:q.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(X.start(),this.jobsInProgress++):this.jobQueue.push(X)},clear:function(){for(var q=0;q<this.jobQueue.length;q++){var Z=this.jobQueue[q];"function"==typeof Z.abort&&Z.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(q){q.Tile=function(q,Z,X,K,Y,Q,J,ee,te,ie){this.level=q,this.x=Z,this.y=X,this.bounds=K,this.sourceBounds=ie,this.exists=Y,this.url=Q,this.context2D=J,this.loadWithAjax=ee,this.ajaxHeaders=te,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},q.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(Z){this.cacheImageRecord?this.loaded?(this.element||(this.element=q.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=Z&&Z.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",q.setElementOpacity(this.element,this.opacity)):q.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):q.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(Z,X,K,Y){var Q,J,ee,te=this.position.times(q.pixelDensityRatio),ie=this.size.times(q.pixelDensityRatio);this.context2D||this.cacheImageRecord?(Q=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&Q?(Z.save(),Z.globalAlpha=this.opacity,"number"==typeof K&&1!==K&&(te=te.times(K),ie=ie.times(K)),Y instanceof q.Point&&(te=te.plus(Y)),1===Z.globalAlpha&&this._hasTransparencyChannel()&&Z.clearRect(te.x,te.y,ie.x,ie.y),X({context:Z,tile:this,rendered:Q}),this.sourceBounds?(J=Math.min(this.sourceBounds.width,Q.canvas.width),ee=Math.min(this.sourceBounds.height,Q.canvas.height)):(J=Q.canvas.width,ee=Q.canvas.height),Z.drawImage(Q.canvas,0,0,J,ee,te.x,te.y,ie.x,ie.y),Z.restore()):q.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):q.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var Z;if(this.cacheImageRecord)Z=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return q.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;Z=this.context2D}return Z.canvas.width/(this.size.x*q.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(Z,X,K){var Y=Math.max(1,Math.ceil((K.x-X.x)/2)),Q=Math.max(1,Math.ceil((K.y-X.y)/2));return new q.Point(Y,Q).minus(this.position.times(q.pixelDensityRatio).times(Z||1).apply((function(q){return q%1})))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),c=OpenSeadragon,c.OverlayPlacement=c.Placement,c.OverlayRotationMode=c.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),c.Overlay=function(q,Z,X){var K;K=c.isPlainObject(q)?q:{element:q,location:Z,placement:X},this.element=K.element,this.style=K.element.style,this._init(K)},c.Overlay.prototype={_init:function(q){this.location=q.location,this.placement=void 0===q.placement?c.Placement.TOP_LEFT:q.placement,this.onDraw=q.onDraw,this.checkResize=void 0===q.checkResize||q.checkResize,this.width=void 0===q.width?null:q.width,this.height=void 0===q.height?null:q.height,this.rotationMode=q.rotationMode||c.OverlayRotationMode.EXACT,this.location instanceof c.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=c.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new c.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(q,Z){var X=c.Placement.properties[this.placement];X&&(X.isHorizontallyCentered?q.x-=Z.x/2:X.isRight&&(q.x-=Z.x),X.isVerticallyCentered?q.y-=Z.y/2:X.isBottom&&(q.y-=Z.y))},destroy:function(){var q=this.element,Z=this.style;q.parentNode&&(q.parentNode.removeChild(q),q.prevElementParent&&(Z.display="none",document.body.appendChild(q))),this.onDraw=null,Z.top="",Z.left="",Z.position="",null!==this.width&&(Z.width=""),null!==this.height&&(Z.height="");var X=c.getCssPropertyWithVendorPrefix("transformOrigin"),K=c.getCssPropertyWithVendorPrefix("transform");X&&K&&(Z[X]="",Z[K]="")},drawHTML:function(q,Z){var X=this.element;X.parentNode!==q&&(X.prevElementParent=X.parentNode,X.prevNextSibling=X.nextSibling,q.appendChild(X),this.style.position="absolute",this.size=c.getElementSize(X));var K=this._getOverlayPositionAndSize(Z),Y=K.position,Q=this.size=K.size,J=K.rotate;if(this.onDraw)this.onDraw(Y,Q,this.element);else{var ee=this.style;ee.left=Y.x+"px",ee.top=Y.y+"px",null!==this.width&&(ee.width=Q.x+"px"),null!==this.height&&(ee.height=Q.y+"px");var te=c.getCssPropertyWithVendorPrefix("transformOrigin"),ie=c.getCssPropertyWithVendorPrefix("transform");te&&ie&&(J?(ee[te]=this._getTransformOrigin(),ee[ie]="rotate("+J+"deg)"):(ee[te]="",ee[ie]="")),"none"!==ee.display&&(ee.display="block")}},_getOverlayPositionAndSize:function(q){var Z=q.pixelFromPoint(this.location,!0),X=this._getSizeInPixels(q);this.adjust(Z,X);var K=0;if(q.degrees&&this.rotationMode!==c.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===c.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var Y=new c.Rect(Z.x,Z.y,X.x,X.y),Q=this._getBoundingBox(Y,q.degrees);Z=Q.getTopLeft(),X=Q.getSize()}else K=q.degrees;return{position:Z,size:X,rotate:K}},_getSizeInPixels:function(q){var Z=this.size.x,X=this.size.y;if(null!==this.width||null!==this.height){var K=q.deltaPixelsFromPointsNoRotate(new c.Point(this.width||0,this.height||0),!0);null!==this.width&&(Z=K.x),null!==this.height&&(X=K.y)}if(this.checkResize&&(null===this.width||null===this.height)){var Y=this.size=c.getElementSize(this.element);null===this.width&&(Z=Y.x),null===this.height&&(X=Y.y)}return new c.Point(Z,X)},_getBoundingBox:function(q,Z){var X=this._getPlacementPoint(q);return q.rotate(Z,X).getBoundingBox()},_getPlacementPoint:function(q){var Z=new c.Point(q.x,q.y),X=c.Placement.properties[this.placement];return X&&(X.isHorizontallyCentered?Z.x+=q.width/2:X.isRight&&(Z.x+=q.width),X.isVerticallyCentered?Z.y+=q.height/2:X.isBottom&&(Z.y+=q.height)),Z},_getTransformOrigin:function(){var q="",Z=c.Placement.properties[this.placement];return Z?(Z.isLeft?q="left":Z.isRight&&(q="right"),Z.isTop?q+=" top":Z.isBottom&&(q+=" bottom"),q):q},update:function(q,Z){var X=c.isPlainObject(q)?q:{location:q,placement:Z};this._init({location:X.location||this.location,placement:void 0!==X.placement?X.placement:this.placement,onDraw:X.onDraw||this.onDraw,checkResize:X.checkResize||this.checkResize,width:void 0!==X.width?X.width:this.width,height:void 0!==X.height?X.height:this.height,rotationMode:X.rotationMode||this.rotationMode})},getBounds:function(q){c.console.assert(q,"A viewport must now be passed to Overlay.getBounds.");var Z=this.width,X=this.height;if(null===Z||null===X){var K=q.deltaPointsFromPixelsNoRotate(this.size,!0);null===Z&&(Z=K.x),null===X&&(X=K.y)}var Y=this.location.clone();return this.adjust(Y,new c.Point(Z,X)),this._adjustBoundsForRotation(q,new c.Rect(Y.x,Y.y,Z,X))},_adjustBoundsForRotation:function(q,Z){if(!q||0===q.degrees||this.rotationMode===c.OverlayRotationMode.EXACT)return Z;if(this.rotationMode!==c.OverlayRotationMode.BOUNDING_BOX)return Z.rotate(-q.degrees,this._getPlacementPoint(Z));if(null===this.width||null===this.height)return Z;var X=this._getOverlayPositionAndSize(q);return q.viewerElementToViewportRectangle(new c.Rect(X.position.x,X.position.y,X.size.x,X.size.y))}},u=OpenSeadragon,u.Drawer=function(q){u.console.assert(q.viewer,"[Drawer] options.viewer is required");var Z=arguments;if(u.isPlainObject(q)||(q={source:Z[0],viewport:Z[1],element:Z[2]}),u.console.assert(q.viewport,"[Drawer] options.viewport is required"),u.console.assert(q.element,"[Drawer] options.element is required"),q.source&&u.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=q.viewer,this.viewport=q.viewport,this.debugGridColor="string"==typeof q.debugGridColor?[q.debugGridColor]:q.debugGridColor||u.DEFAULT_SETTINGS.debugGridColor,q.opacity&&u.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=u.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=u.getElement(q.element),this.canvas=u.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var X=this._calculateCanvasSize();this.canvas.width=X.x,this.canvas.height=X.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",u.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},u.Drawer.prototype={addOverlay:function(q,Z,X,K){return u.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(q,Z,X,K),this},updateOverlay:function(q,Z,X){return u.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(q,Z,X),this},removeOverlay:function(q){return u.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(q),this},clearOverlays:function(){return u.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(q){var Z=this.viewport.pixelFromPointNoRotate(q,!0);return new u.Point(Z.x*u.pixelDensityRatio,Z.y*u.pixelDensityRatio)},clipWithPolygons:function(q,Z){if(this.useCanvas){var X=this._getContext(Z);X.beginPath(),q.forEach((function(q){q.forEach((function(q,Z){X[0===Z?"moveTo":"lineTo"](q.x,q.y)}))})),X.clip()}},setOpacity:function(q){u.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var Z=this.viewer.world,X=0;X<Z.getItemCount();X++)Z.getItemAt(X).setOpacity(q);return this},getOpacity:function(){u.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var q=this.viewer.world,Z=0,X=0;X<q.getItemCount();X++){var K=q.getItemAt(X).getOpacity();Z<K&&(Z=K)}return Z},needsUpdate:function(){return u.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return u.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return u.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return u.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var q=this._calculateCanvasSize();if((this.canvas.width!=q.x||this.canvas.height!=q.y)&&(this.canvas.width=q.x,this.canvas.height=q.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas)){var Z=this._calculateSketchCanvasSize();this.sketchCanvas.width=Z.x,this.sketchCanvas.height=Z.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(q,Z){if(this.useCanvas){var X=this._getContext(q);if(Z)X.clearRect(Z.x,Z.y,Z.width,Z.height);else{var K=X.canvas;X.clearRect(0,0,K.width,K.height)}}},viewportToDrawerRectangle:function(q){var Z=this.viewport.pixelFromPointNoRotate(q.getTopLeft(),!0),X=this.viewport.deltaPixelsFromPointsNoRotate(q.getSize(),!0);return new u.Rect(Z.x*u.pixelDensityRatio,Z.y*u.pixelDensityRatio,X.x*u.pixelDensityRatio,X.y*u.pixelDensityRatio)},drawTile:function(q,Z,X,K,Y){if(u.console.assert(q,"[Drawer.drawTile] tile is required"),u.console.assert(Z,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var Q=this._getContext(X);K=K||1,q.drawCanvas(Q,Z,K,Y)}else q.drawHTML(this.canvas)},_getContext:function(q){var Z=this.context;if(q){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var X=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=X.x,this.sketchCanvas.height=X.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var K=this;this.viewer.addHandler("rotate",(function e(){if(0!==K.viewport.getRotation()){K.viewer.removeHandler("rotate",e);var q=K._calculateSketchCanvasSize();K.sketchCanvas.width=q.x,K.sketchCanvas.height=q.y}}))}this._updateImageSmoothingEnabled(this.sketchContext)}Z=this.sketchContext}return Z},saveContext:function(q){this.useCanvas&&this._getContext(q).save()},restoreContext:function(q){this.useCanvas&&this._getContext(q).restore()},setClip:function(q,Z){if(this.useCanvas){var X=this._getContext(Z);X.beginPath(),X.rect(q.x,q.y,q.width,q.height),X.clip()}},drawRectangle:function(q,Z,X){if(this.useCanvas){var K=this._getContext(X);K.save(),K.fillStyle=Z,K.fillRect(q.x,q.y,q.width,q.height),K.restore()}},blendSketch:function(q,Z,X,K){var Y=q;if(u.isPlainObject(Y)||(Y={opacity:q,scale:Z,translate:X,compositeOperation:K}),this.useCanvas&&this.sketchCanvas){q=Y.opacity,K=Y.compositeOperation;var Q=Y.bounds;if(this.context.save(),this.context.globalAlpha=q,K&&(this.context.globalCompositeOperation=K),Q)Q.x<0&&(Q.width+=Q.x,Q.x=0),Q.x+Q.width>this.canvas.width&&(Q.width=this.canvas.width-Q.x),Q.y<0&&(Q.height+=Q.y,Q.y=0),Q.y+Q.height>this.canvas.height&&(Q.height=this.canvas.height-Q.y),this.context.drawImage(this.sketchCanvas,Q.x,Q.y,Q.width,Q.height,Q.x,Q.y,Q.width,Q.height);else{Z=Y.scale||1;var J=(X=Y.translate)instanceof u.Point?X:new u.Point(0,0),ee=0,te=0;if(X){var ie=this.sketchCanvas.width-this.canvas.width,ne=this.sketchCanvas.height-this.canvas.height;ee=Math.round(ie/2),te=Math.round(ne/2)}this.context.drawImage(this.sketchCanvas,J.x-ee*Z,J.y-te*Z,(this.canvas.width+2*ee)*Z,(this.canvas.height+2*te)*Z,-ee,-te,this.canvas.width+2*ee,this.canvas.height+2*te)}this.context.restore()}},drawDebugInfo:function(q,Z,X,K){if(this.useCanvas){var Y=this.viewer.world.getIndexOfItem(K)%this.debugGridColor.length,Q=this.context;Q.save(),Q.lineWidth=2*u.pixelDensityRatio,Q.font="small-caps bold "+13*u.pixelDensityRatio+"px arial",Q.strokeStyle=this.debugGridColor[Y],Q.fillStyle=this.debugGridColor[Y],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),K.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:K.getRotation(!0),point:K.viewport.pixelFromPointNoRotate(K._getRotationPoint(!0),!0)}),0===K.viewport.degrees&&K.getRotation(!0)%360==0&&K._drawer.viewer.viewport.getFlip()&&K._drawer._flip(),Q.strokeRect(q.position.x*u.pixelDensityRatio,q.position.y*u.pixelDensityRatio,q.size.x*u.pixelDensityRatio,q.size.y*u.pixelDensityRatio);var J=(q.position.x+q.size.x/2)*u.pixelDensityRatio,ee=(q.position.y+q.size.y/2)*u.pixelDensityRatio;Q.translate(J,ee),Q.rotate(Math.PI/180*-this.viewport.degrees),Q.translate(-J,-ee),0===q.x&&0===q.y&&(Q.fillText("Zoom: "+this.viewport.getZoom(),q.position.x*u.pixelDensityRatio,(q.position.y-30)*u.pixelDensityRatio),Q.fillText("Pan: "+this.viewport.getBounds().toString(),q.position.x*u.pixelDensityRatio,(q.position.y-20)*u.pixelDensityRatio)),Q.fillText("Level: "+q.level,(q.position.x+10)*u.pixelDensityRatio,(q.position.y+20)*u.pixelDensityRatio),Q.fillText("Column: "+q.x,(q.position.x+10)*u.pixelDensityRatio,(q.position.y+30)*u.pixelDensityRatio),Q.fillText("Row: "+q.y,(q.position.x+10)*u.pixelDensityRatio,(q.position.y+40)*u.pixelDensityRatio),Q.fillText("Order: "+X+" of "+Z,(q.position.x+10)*u.pixelDensityRatio,(q.position.y+50)*u.pixelDensityRatio),Q.fillText("Size: "+q.size.toString(),(q.position.x+10)*u.pixelDensityRatio,(q.position.y+60)*u.pixelDensityRatio),Q.fillText("Position: "+q.position.toString(),(q.position.x+10)*u.pixelDensityRatio,(q.position.y+70)*u.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),K.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===K.viewport.degrees&&K.getRotation(!0)%360==0&&K._drawer.viewer.viewport.getFlip()&&K._drawer._flip(),Q.restore()}},debugRect:function(q){if(this.useCanvas){var Z=this.context;Z.save(),Z.lineWidth=2*u.pixelDensityRatio,Z.strokeStyle=this.debugGridColor[0],Z.fillStyle=this.debugGridColor[0],Z.strokeRect(q.x*u.pixelDensityRatio,q.y*u.pixelDensityRatio,q.width*u.pixelDensityRatio,q.height*u.pixelDensityRatio),Z.restore()}},setImageSmoothingEnabled:function(q){this.useCanvas&&(this._imageSmoothingEnabled=q,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(q){q.msImageSmoothingEnabled=this._imageSmoothingEnabled,q.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(q){var Z=this._getContext(q).canvas;return new u.Point(Z.width,Z.height)},getCanvasCenter:function(){return new u.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(q){var Z=q.point?q.point.times(u.pixelDensityRatio):this.getCanvasCenter(),X=this._getContext(q.useSketch);X.save(),X.translate(Z.x,Z.y),this.viewer.viewport.flipped?(X.rotate(Math.PI/180*-q.degrees),X.scale(-1,1)):X.rotate(Math.PI/180*q.degrees),X.translate(-Z.x,-Z.y)},_flip:function(q){var Z=(q=q||{}).point?q.point.times(u.pixelDensityRatio):this.getCanvasCenter(),X=this._getContext(q.useSketch);X.translate(Z.x,0),X.scale(-1,1),X.translate(-Z.x,0)},_restoreRotationChanges:function(q){this._getContext(q).restore()},_calculateCanvasSize:function(){var q=u.pixelDensityRatio,Z=this.viewport.getContainerSize();return{x:Math.round(Z.x*q),y:Math.round(Z.y*q)}},_calculateSketchCanvasSize:function(){var q=this._calculateCanvasSize();if(0===this.viewport.getRotation())return q;var Z=Math.ceil(Math.sqrt(q.x*q.x+q.y*q.y));return{x:Z,y:Z}}},p=OpenSeadragon,p.Viewport=function(q){var Z=arguments;Z.length&&Z[0]instanceof p.Point&&(q={containerSize:Z[0],contentSize:Z[1],config:Z[2]}),q.config&&(p.extend(!0,q,q.config),delete q.config),this._margins=p.extend({left:0,top:0,right:0,bottom:0},q.margins||{}),delete q.margins,p.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:p.DEFAULT_SETTINGS.springStiffness,animationTime:p.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:p.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:p.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:p.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:p.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:p.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:p.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:p.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:p.DEFAULT_SETTINGS.maxZoomLevel,degrees:p.DEFAULT_SETTINGS.degrees,flipped:p.DEFAULT_SETTINGS.flipped,homeFillsViewer:p.DEFAULT_SETTINGS.homeFillsViewer},q),this._updateContainerInnerSize(),this.centerSpringX=new p.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new p.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new p.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new p.Rect(0,0,1,1),1),this.goHome(!0),this.update()},p.Viewport.prototype={resetContentSize:function(q){return p.console.assert(q,"[Viewport.resetContentSize] contentSize is required"),p.console.assert(q instanceof p.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),p.console.assert(0<q.x,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),p.console.assert(0<q.y,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new p.Rect(0,0,1,q.y/q.x),q.x),this},setHomeBounds:function(q,Z){p.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(q,Z)},_setContentBounds:function(q,Z){p.console.assert(q,"[Viewport._setContentBounds] bounds is required"),p.console.assert(q instanceof p.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),p.console.assert(0<q.width,"[Viewport._setContentBounds] bounds.width must be greater than 0"),p.console.assert(0<q.height,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=q.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(Z),this._contentBounds=q.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(Z),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:Z,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var q=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?1<=q?q:1:1<=q?1:q)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var q=this._contentBounds.getCenter(),Z=1/this.getHomeZoom(),X=Z/this.getAspectRatio();return new p.Rect(q.x-Z/2,q.y-X/2,Z,X)},goHome:function(q){return this.viewer&&this.viewer.raiseEvent("home",{immediately:q}),this.fitBounds(this.getHomeBounds(),q)},getMinZoom:function(){var q=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*q},getMaxZoom:function(){var q=this.maxZoomLevel;return q||(q=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,q/=this._contentBounds.width),Math.max(q,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new p.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return p.extend({},this._margins)},setMargins:function(q){p.console.assert("object"===p.type(q),"[Viewport.setMargins] margins must be an object"),this._margins=p.extend({left:0,top:0,right:0,bottom:0},q),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(q){return this.getBoundsNoRotate(q).rotate(-this.getRotation())},getBoundsNoRotate:function(q){var Z=this.getCenter(q),X=1/this.getZoom(q),K=X/this.getAspectRatio();return new p.Rect(Z.x-X/2,Z.y-K/2,X,K)},getBoundsWithMargins:function(q){return this.getBoundsNoRotateWithMargins(q).rotate(-this.getRotation(),this.getCenter(q))},getBoundsNoRotateWithMargins:function(q){var Z=this.getBoundsNoRotate(q),X=this._containerInnerSize.x*this.getZoom(q);return Z.x-=this._margins.left/X,Z.y-=this._margins.top/X,Z.width+=(this._margins.left+this._margins.right)/X,Z.height+=(this._margins.top+this._margins.bottom)/X,Z},getCenter:function(q){var Z,X,K,Y,Q,J,ee=new p.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),te=new p.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return q?ee:this.zoomPoint?(Z=this.pixelFromPoint(this.zoomPoint,!0),Y=(K=1/(X=this.getZoom()))/this.getAspectRatio(),Q=new p.Rect(ee.x-K/2,ee.y-Y/2,K,Y),J=this._pixelFromPoint(this.zoomPoint,Q).minus(Z).divide(this._containerInnerSize.x*X),te.plus(J)):te},getZoom:function(q){return q?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(q){return Math.max(Math.min(q,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(q){var Z=new p.Rect(q.x,q.y,q.width,q.height);if(!this.wrapHorizontal){var X=this.visibilityRatio*Z.width,K=Z.x+Z.width,Y=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,Q=this._contentBoundsNoRotate.x-K+X,J=Y-Z.x-X;X>this._contentBoundsNoRotate.width?Z.x+=(Q+J)/2:J<0?Z.x+=J:0<Q&&(Z.x+=Q)}if(!this.wrapVertical){var ee=this.visibilityRatio*Z.height,te=Z.y+Z.height,ie=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,ne=this._contentBoundsNoRotate.y-te+ee,oe=ie-Z.y-ee;ee>this._contentBoundsNoRotate.height?Z.y+=(ne+oe)/2:oe<0?Z.y+=oe:0<ne&&(Z.y+=ne)}return Z},_raiseConstraintsEvent:function(q){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:q})},applyConstraints:function(q){var Z=this.getZoom(),X=this._applyZoomConstraints(Z);Z!==X&&this.zoomTo(X,this.zoomPoint,q);var K=this.getBoundsNoRotate(),Y=this._applyBoundaryConstraints(K);return this._raiseConstraintsEvent(q),K.x===Y.x&&K.y===Y.y&&!q||this.fitBounds(Y.rotate(-this.getRotation()),q),this},ensureVisible:function(q){return this.applyConstraints(q)},_fitBounds:function(q,Z){var X=(Z=Z||{}).immediately||!1,K=Z.constraints||!1,Y=this.getAspectRatio(),Q=q.getCenter(),J=new p.Rect(q.x,q.y,q.width,q.height,q.degrees+this.getRotation()).getBoundingBox();J.getAspectRatio()>=Y?J.height=J.width/Y:J.width=J.height*Y,J.x=Q.x-J.width/2,J.y=Q.y-J.height/2;var ee=1/J.width;if(K){var te=J.getAspectRatio(),ie=this._applyZoomConstraints(ee);ee!==ie&&(ee=ie,J.width=1/ee,J.x=Q.x-J.width/2,J.height=J.width/te,J.y=Q.y-J.height/2),Q=(J=this._applyBoundaryConstraints(J)).getCenter(),this._raiseConstraintsEvent(X)}if(X)return this.panTo(Q,!0),this.zoomTo(ee,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var ne=this.getBounds(),oe=this.getZoom();if(0===oe||Math.abs(ee/oe-1)<1e-8)return this.zoomTo(ee,!0),this.panTo(Q,X);var re=(J=J.rotate(-this.getRotation())).getTopLeft().times(ee).minus(ne.getTopLeft().times(oe)).divide(ee-oe);return this.zoomTo(ee,re,X)},fitBounds:function(q,Z){return this._fitBounds(q,{immediately:Z,constraints:!1})},fitBoundsWithConstraints:function(q,Z){return this._fitBounds(q,{immediately:Z,constraints:!0})},fitVertically:function(q){var Z=new p.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(Z,q)},fitHorizontally:function(q){var Z=new p.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(Z,q)},getConstrainedBounds:function(q){var Z;return Z=this.getBounds(q),this._applyBoundaryConstraints(Z)},panBy:function(q,Z){var X=new p.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(X.plus(q),Z)},panTo:function(q,Z){return Z?(this.centerSpringX.resetTo(q.x),this.centerSpringY.resetTo(q.y)):(this.centerSpringX.springTo(q.x),this.centerSpringY.springTo(q.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:q,immediately:Z}),this},zoomBy:function(q,Z,X){return this.zoomTo(this.zoomSpring.target.value*q,Z,X)},zoomTo:function(q,Z,X){var K=this;return this.zoomPoint=Z instanceof p.Point&&!isNaN(Z.x)&&!isNaN(Z.y)?Z:null,X?this._adjustCenterSpringsForZoomPoint((function(){K.zoomSpring.resetTo(q)})):this.zoomSpring.springTo(q),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:q,refPoint:Z,immediately:X}),this},setRotation:function(q){return this.viewer&&this.viewer.drawer.canRotate()?(this.degrees=p.positiveModulo(q,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:q}),this):this},getRotation:function(){return this.degrees},resize:function(q,Z){var X,K=this.getBoundsNoRotate(),Y=K;return this.containerSize.x=q.x,this.containerSize.y=q.y,this._updateContainerInnerSize(),Z&&(X=q.x/this.containerSize.x,Y.width=K.width*X,Y.height=Y.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:q,maintain:Z}),this.fitBounds(Y,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new p.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var q=this;this._adjustCenterSpringsForZoomPoint((function(){q.zoomSpring.update()})),this.centerSpringX.update(),this.centerSpringY.update();var Z=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,Z},_adjustCenterSpringsForZoomPoint:function(q){if(this.zoomPoint){var Z=this.pixelFromPoint(this.zoomPoint,!0);q();var X=this.pixelFromPoint(this.zoomPoint,!0).minus(Z),K=this.deltaPointsFromPixels(X,!0);this.centerSpringX.shiftBy(K.x),this.centerSpringY.shiftBy(K.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else q()},deltaPixelsFromPointsNoRotate:function(q,Z){return q.times(this._containerInnerSize.x*this.getZoom(Z))},deltaPixelsFromPoints:function(q,Z){return this.deltaPixelsFromPointsNoRotate(q.rotate(this.getRotation()),Z)},deltaPointsFromPixelsNoRotate:function(q,Z){return q.divide(this._containerInnerSize.x*this.getZoom(Z))},deltaPointsFromPixels:function(q,Z){return this.deltaPointsFromPixelsNoRotate(q,Z).rotate(-this.getRotation())},pixelFromPointNoRotate:function(q,Z){return this._pixelFromPointNoRotate(q,this.getBoundsNoRotate(Z))},pixelFromPoint:function(q,Z){return this._pixelFromPoint(q,this.getBoundsNoRotate(Z))},_pixelFromPointNoRotate:function(q,Z){return q.minus(Z.getTopLeft()).times(this._containerInnerSize.x/Z.width).plus(new p.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(q,Z){return this._pixelFromPointNoRotate(q.rotate(this.getRotation(),this.getCenter(!0)),Z)},pointFromPixelNoRotate:function(q,Z){var X=this.getBoundsNoRotate(Z);return q.minus(new p.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/X.width).plus(X.getTopLeft())},pointFromPixel:function(q,Z){return this.pointFromPixelNoRotate(q,Z).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(q,Z){var X=this._contentBoundsNoRotate.width;return new p.Point(q*this._contentSizeNoRotate.x/X,Z*this._contentSizeNoRotate.x/X)},viewportToImageCoordinates:function(q,Z){if(q instanceof p.Point)return this.viewportToImageCoordinates(q.x,q.y);if(this.viewer){var X=this.viewer.world.getItemCount();if(1<X)p.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===X)return this.viewer.world.getItemAt(0).viewportToImageCoordinates(q,Z,!0)}return this._viewportToImageDelta(q-this._contentBoundsNoRotate.x,Z-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(q,Z){var X=this._contentBoundsNoRotate.width;return new p.Point(q/this._contentSizeNoRotate.x*X,Z/this._contentSizeNoRotate.x*X)},imageToViewportCoordinates:function(q,Z){if(q instanceof p.Point)return this.imageToViewportCoordinates(q.x,q.y);if(this.viewer){var X=this.viewer.world.getItemCount();if(1<X)p.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===X)return this.viewer.world.getItemAt(0).imageToViewportCoordinates(q,Z,!0)}var K=this._imageToViewportDelta(q,Z);return K.x+=this._contentBoundsNoRotate.x,K.y+=this._contentBoundsNoRotate.y,K},imageToViewportRectangle:function(q,Z,X,K){var Y=q;if(Y instanceof p.Rect||(Y=new p.Rect(q,Z,X,K)),this.viewer){var Q=this.viewer.world.getItemCount();if(1<Q)p.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===Q)return this.viewer.world.getItemAt(0).imageToViewportRectangle(q,Z,X,K,!0)}var J=this.imageToViewportCoordinates(Y.x,Y.y),ee=this._imageToViewportDelta(Y.width,Y.height);return new p.Rect(J.x,J.y,ee.x,ee.y,Y.degrees)},viewportToImageRectangle:function(q,Z,X,K){var Y=q;if(Y instanceof p.Rect||(Y=new p.Rect(q,Z,X,K)),this.viewer){var Q=this.viewer.world.getItemCount();if(1<Q)p.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===Q)return this.viewer.world.getItemAt(0).viewportToImageRectangle(q,Z,X,K,!0)}var J=this.viewportToImageCoordinates(Y.x,Y.y),ee=this._viewportToImageDelta(Y.width,Y.height);return new p.Rect(J.x,J.y,ee.x,ee.y,Y.degrees)},viewerElementToImageCoordinates:function(q){var Z=this.pointFromPixel(q,!0);return this.viewportToImageCoordinates(Z)},imageToViewerElementCoordinates:function(q){var Z=this.imageToViewportCoordinates(q);return this.pixelFromPoint(Z,!0)},windowToImageCoordinates:function(q){p.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var Z=q.minus(p.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(Z)},imageToWindowCoordinates:function(q){return p.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(q).plus(p.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(q){return this.pointFromPixel(q,!0)},viewportToViewerElementCoordinates:function(q){return this.pixelFromPoint(q,!0)},viewerElementToViewportRectangle:function(q){return p.Rect.fromSummits(this.pointFromPixel(q.getTopLeft(),!0),this.pointFromPixel(q.getTopRight(),!0),this.pointFromPixel(q.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(q){return p.Rect.fromSummits(this.pixelFromPoint(q.getTopLeft(),!0),this.pixelFromPoint(q.getTopRight(),!0),this.pixelFromPoint(q.getBottomLeft(),!0))},windowToViewportCoordinates:function(q){p.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var Z=q.minus(p.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(Z)},viewportToWindowCoordinates:function(q){return p.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(q).plus(p.getElementPosition(this.viewer.element))},viewportToImageZoom:function(q){if(this.viewer){var Z=this.viewer.world.getItemCount();if(1<Z)p.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===Z)return this.viewer.world.getItemAt(0).viewportToImageZoom(q)}var X=this._contentSizeNoRotate.x;return q*(this._containerInnerSize.x/X*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(q){if(this.viewer){var Z=this.viewer.world.getItemCount();if(1<Z)p.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===Z)return this.viewer.world.getItemAt(0).imageToViewportZoom(q)}return q*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(q){return this.flipped===q||(this.flipped=q,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:q})),this}},function(q){function m(q,Z,X,K,Y,Q,J,ee,te){var ie=J.getBoundingBox().getTopLeft(),ne=J.getBoundingBox().getBottomRight();q.viewer&&q.viewer.raiseEvent("update-level",{tiledImage:q,havedrawn:Z,level:K,opacity:Y,visibility:Q,drawArea:J,topleft:ie,bottomright:ne,currenttime:ee,best:te}),S(q.coverage,K),S(q.loadingCoverage,K);for(var oe=q._getCornerTiles(K,ie,ne),re=oe.topLeft,se=oe.bottomRight,ae=q.source.getNumTiles(K),le=q.viewport.pixelFromPoint(q.viewport.getCenter()),he=re.x;he<=se.x;he++)for(var ce=re.y;ce<=se.y;ce++){if(!q.wrapHorizontal&&!q.wrapVertical){var ue=q.source.getTileBounds(K,he,ce);if(null===J.intersection(ue))continue}te=T(q,X,Z,he,ce,K,Y,Q,le,ae,ee,te)}return te}function T(Z,X,K,Y,Q,J,ee,te,ie,ne,oe,re){var se=function(Z,X,K,Y,Q,J,ee,te,ie,ne){var oe,re,se,ae,le,he,ce,ue,de;return J[K]||(J[K]={}),J[K][Z]||(J[K][Z]={}),J[K][Z][X]||(oe=(te.x+Z%te.x)%te.x,re=(te.y+X%te.y)%te.y,se=Q.getTileBounds(K,oe,re),ae=Q.getTileBounds(K,oe,re,!0),le=Q.tileExists(K,oe,re),he=Q.getTileUrl(K,oe,re),Y.loadTilesWithAjax?(ce=Q.getTileAjaxHeaders(K,oe,re),q.isPlainObject(Y.ajaxHeaders)&&(ce=q.extend({},Y.ajaxHeaders,ce))):ce=null,ue=Q.getContext2D?Q.getContext2D(K,oe,re):void 0,se.x+=(Z-oe)/te.x,se.y+=ne/ie*((X-re)/te.y),de=new q.Tile(K,Z,X,se,le,he,ue,Y.loadTilesWithAjax,ce,ae),oe==te.x-1&&(de.isRightMost=!0),re==te.y-1&&(de.isBottomMost=!0),J[K][Z][X]=de),(de=J[K][Z][X]).lastTouchTime=ee,de}(Y,Q,J,Z,Z.source,Z.tilesMatrix,oe,ne,Z._worldWidthCurrent,Z._worldHeightCurrent),ae=K;Z.viewer&&Z.viewer.raiseEvent("update-tile",{tiledImage:Z,tile:se}),x(Z.coverage,J,Y,Q,!1);var le=se.loaded||se.loading||w(Z.loadingCoverage,J,Y,Q);if(x(Z.loadingCoverage,J,Y,Q,le),!se.exists)return re;if(X&&!ae&&(w(Z.coverage,J,Y,Q)?x(Z.coverage,J,Y,Q,!0):ae=!0),!ae)return re;if(function(Z,X,K,Y,Q,J){var ee=Z.bounds.getTopLeft();ee.x*=J._scaleSpring.current.value,ee.y*=J._scaleSpring.current.value,ee.x+=J._xSpring.current.value,ee.y+=J._ySpring.current.value;var te=Z.bounds.getSize();te.x*=J._scaleSpring.current.value,te.y*=J._scaleSpring.current.value;var ie=K.pixelFromPointNoRotate(ee,!0),ne=K.pixelFromPointNoRotate(ee,!1),oe=K.deltaPixelsFromPointsNoRotate(te,!0),re=K.deltaPixelsFromPointsNoRotate(te,!1),se=ne.plus(re.divide(2)),ae=Y.squaredDistanceTo(se);X||(oe=oe.plus(new q.Point(1,1))),Z.isRightMost&&J.wrapHorizontal&&(oe.x+=.75),Z.isBottomMost&&J.wrapVertical&&(oe.y+=.75),Z.position=ie,Z.size=oe,Z.squaredDistance=ae,Z.visibility=Q}(se,Z.source.tileOverlap,Z.viewport,ie,te,Z),!se.loaded)if(se.context2D)v(Z,se);else{var he=Z._tileCache.getImageRecord(se.cacheKey);he&&v(Z,se,he.getImage())}return se.loaded?function(q,Z,X,K,Y,Q,J){var ee,te,ie=1e3*q.blendTime;if(Z.blendStart||(Z.blendStart=J),ee=J-Z.blendStart,te=ie?Math.min(1,ee/ie):1,q.alwaysBlend&&(te*=Q),Z.opacity=te,q.lastDrawn.push(Z),1===te)x(q.coverage,Y,X,K,!0),q._hasOpaqueTile=!0;else if(ee<ie)return!0;return!1}(Z,se,Y,Q,J,ee,oe)&&(Z._needsDraw=!0):se.loading?Z._tilesLoading++:le||(re=function(q,Z){return q?Z.visibility>q.visibility||Z.visibility==q.visibility&&Z.squaredDistance<q.squaredDistance?Z:q:Z}(re,se)),re}function v(q,Z,X,K,Y){var Q=0;function s(){return Q++,a}function a(){0==--Q&&(Z.loading=!1,Z.loaded=!0,Z.context2D||q._tileCache.cacheTile({image:X,tile:Z,cutoff:K,tiledImage:q}),q._needsDraw=!0)}q.viewer.raiseEvent("tile-loaded",{tile:Z,tiledImage:q,tileRequest:Y,image:X,getCompletionCallback:s}),s()()}function f(q,Z,X,K){var Y,Q,J,ee;if(!q[Z])return!1;if(void 0!==X&&void 0!==K)return void 0===q[Z][X]||void 0===q[Z][X][K]||!0===q[Z][X][K];for(J in Y=q[Z])if(Object.prototype.hasOwnProperty.call(Y,J))for(ee in Q=Y[J])if(Object.prototype.hasOwnProperty.call(Q,ee)&&!Q[ee])return!1;return!0}function w(q,Z,X,K){return void 0===X||void 0===K?f(q,Z+1):f(q,Z+1,2*X,2*K)&&f(q,Z+1,2*X,2*K+1)&&f(q,Z+1,2*X+1,2*K)&&f(q,Z+1,2*X+1,2*K+1)}function x(Z,X,K,Y,Q){Z[X]?(Z[X][K]||(Z[X][K]={}),Z[X][K][Y]=Q):q.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",X)}function S(q,Z){q[Z]={}}q.TiledImage=function(Z){var X=this;q.console.assert(Z.tileCache,"[TiledImage] options.tileCache is required"),q.console.assert(Z.drawer,"[TiledImage] options.drawer is required"),q.console.assert(Z.viewer,"[TiledImage] options.viewer is required"),q.console.assert(Z.imageLoader,"[TiledImage] options.imageLoader is required"),q.console.assert(Z.source,"[TiledImage] options.source is required"),q.console.assert(!Z.clip||Z.clip instanceof q.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),q.EventSource.call(this),this._tileCache=Z.tileCache,delete Z.tileCache,this._drawer=Z.drawer,delete Z.drawer,this._imageLoader=Z.imageLoader,delete Z.imageLoader,Z.clip instanceof q.Rect&&(this._clip=Z.clip.clone()),delete Z.clip;var K=Z.x||0;delete Z.x;var Y=Z.y||0;delete Z.y,this.normHeight=Z.source.dimensions.y/Z.source.dimensions.x,this.contentAspectX=Z.source.dimensions.x/Z.source.dimensions.y;var Q=1;Z.width?(Q=Z.width,delete Z.width,Z.height&&(q.console.error("specifying both width and height to a tiledImage is not supported"),delete Z.height)):Z.height&&(Q=Z.height/this.normHeight,delete Z.height);var J=Z.fitBounds;delete Z.fitBounds;var ee=Z.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete Z.fitBoundsPlacement;var te=Z.degrees||0;delete Z.degrees,q.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:q.DEFAULT_SETTINGS.springStiffness,animationTime:q.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:q.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:q.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:q.DEFAULT_SETTINGS.wrapVertical,immediateRender:q.DEFAULT_SETTINGS.immediateRender,blendTime:q.DEFAULT_SETTINGS.blendTime,alwaysBlend:q.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:q.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:q.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:q.DEFAULT_SETTINGS.iOSDevice,debugMode:q.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:q.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:q.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:q.DEFAULT_SETTINGS.placeholderFillStyle,opacity:q.DEFAULT_SETTINGS.opacity,preload:q.DEFAULT_SETTINGS.preload,compositeOperation:q.DEFAULT_SETTINGS.compositeOperation},Z),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new q.Spring({initial:K,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new q.Spring({initial:Y,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new q.Spring({initial:Q,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new q.Spring({initial:te,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),J&&this.fitBounds(J,ee,!0),this._drawingHandler=function(Z){X.viewer.raiseEvent("tile-drawing",q.extend({tiledImage:X},Z))}},q.extend(q.TiledImage.prototype,q.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(q){q!==this._fullyLoaded&&(this._fullyLoaded=q,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=q.now(),this._needsDraw=!0},update:function(){var q=this._xSpring.update(),Z=this._ySpring.update(),X=this._scaleSpring.update(),K=this._degreesSpring.update();return!!(q||Z||X||K)&&(this._updateForScale(),this._needsDraw=!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(q){return this.getBoundsNoRotate(q).rotate(this.getRotation(q),this._getRotationPoint(q))},getBoundsNoRotate:function(Z){return Z?new q.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new q.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return q.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(Z){var X=this.getBoundsNoRotate(Z);if(this._clip){var K=(Z?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,Y=this._clip.times(K);X=new q.Rect(X.x+Y.x,X.y+Y.y,Y.width,Y.height)}return X.rotate(this.getRotation(Z),this._getRotationPoint(Z))},getContentSize:function(){return new q.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(Z,X,K){var Y=K?this._scaleSpring.current.value:this._scaleSpring.target.value;return new q.Point(Z*(this.source.dimensions.x/Y),X*(this.source.dimensions.y*this.contentAspectX/Y))},viewportToImageCoordinates:function(Z,X,K){var Y;return Z instanceof q.Point?(K=X,Y=Z):Y=new q.Point(Z,X),Y=Y.rotate(-this.getRotation(K),this._getRotationPoint(K)),K?this._viewportToImageDelta(Y.x-this._xSpring.current.value,Y.y-this._ySpring.current.value):this._viewportToImageDelta(Y.x-this._xSpring.target.value,Y.y-this._ySpring.target.value)},_imageToViewportDelta:function(Z,X,K){var Y=K?this._scaleSpring.current.value:this._scaleSpring.target.value;return new q.Point(Z/this.source.dimensions.x*Y,X/this.source.dimensions.y/this.contentAspectX*Y)},imageToViewportCoordinates:function(Z,X,K){Z instanceof q.Point&&(K=X,X=Z.y,Z=Z.x);var Y=this._imageToViewportDelta(Z,X);return K?(Y.x+=this._xSpring.current.value,Y.y+=this._ySpring.current.value):(Y.x+=this._xSpring.target.value,Y.y+=this._ySpring.target.value),Y.rotate(this.getRotation(K),this._getRotationPoint(K))},imageToViewportRectangle:function(Z,X,K,Y,Q){var J=Z;J instanceof q.Rect?Q=X:J=new q.Rect(Z,X,K,Y);var ee=this.imageToViewportCoordinates(J.getTopLeft(),Q),te=this._imageToViewportDelta(J.width,J.height,Q);return new q.Rect(ee.x,ee.y,te.x,te.y,J.degrees+this.getRotation(Q))},viewportToImageRectangle:function(Z,X,K,Y,Q){var J=Z;Z instanceof q.Rect?Q=X:J=new q.Rect(Z,X,K,Y);var ee=this.viewportToImageCoordinates(J.getTopLeft(),Q),te=this._viewportToImageDelta(J.width,J.height,Q);return new q.Rect(ee.x,ee.y,te.x,te.y,J.degrees-this.getRotation(Q))},viewerElementToImageCoordinates:function(q){var Z=this.viewport.pointFromPixel(q,!0);return this.viewportToImageCoordinates(Z)},imageToViewerElementCoordinates:function(q){var Z=this.imageToViewportCoordinates(q);return this.viewport.pixelFromPoint(Z,!0)},windowToImageCoordinates:function(q){var Z=q.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(Z)},imageToWindowCoordinates:function(q){return this.imageToViewerElementCoordinates(q).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(Z){var X=this._scaleSpring.current.value;return Z=Z.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new q.Rect((Z.x-this._xSpring.current.value)/X,(Z.y-this._ySpring.current.value)/X,Z.width/X,Z.height/X,Z.degrees)},viewportToImageZoom:function(q){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*q},imageToViewportZoom:function(q){return q/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(q,Z){var X=this._xSpring.target.value===q.x&&this._ySpring.target.value===q.y;if(Z){if(X&&this._xSpring.current.value===q.x&&this._ySpring.current.value===q.y)return;this._xSpring.resetTo(q.x),this._ySpring.resetTo(q.y),this._needsDraw=!0}else{if(X)return;this._xSpring.springTo(q.x),this._ySpring.springTo(q.y),this._needsDraw=!0}X||this._raiseBoundsChange()},setWidth:function(q,Z){this._setScale(q,Z)},setHeight:function(q,Z){this._setScale(q/this.normHeight,Z)},setCroppingPolygons:function(Z){try{if(!q.isArray(Z))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=Z.map((function(Z){return function t(Z){return Z.map((function(Z){try{if((X=Z)instanceof q.Point||"number"==typeof X.x&&"number"==typeof X.y)return{x:Z.x,y:Z.y};throw new Error}catch(Z){throw new Error("A Provided cropping polygon point is not supported")}var X}))}(Z)}))}catch(Z){q.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),q.console.error(Z),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(Z,X,K){X=X||q.Placement.CENTER;var Y=q.Placement.properties[X],Q=this.contentAspectX,J=0,ee=0,te=1,ie=1;if(this._clip&&(Q=this._clip.getAspectRatio(),te=this._clip.width/this.source.dimensions.x,ie=this._clip.height/this.source.dimensions.y,Z.getAspectRatio()>Q?(J=this._clip.x/this._clip.height*Z.height,ee=this._clip.y/this._clip.height*Z.height):(J=this._clip.x/this._clip.width*Z.width,ee=this._clip.y/this._clip.width*Z.width)),Z.getAspectRatio()>Q){var ne=Z.height/ie,oe=0;Y.isHorizontallyCentered?oe=(Z.width-Z.height*Q)/2:Y.isRight&&(oe=Z.width-Z.height*Q),this.setPosition(new q.Point(Z.x-J+oe,Z.y-ee),K),this.setHeight(ne,K)}else{var re=Z.width/te,se=0;Y.isVerticallyCentered?se=(Z.height-Z.width/Q)/2:Y.isBottom&&(se=Z.height-Z.width/Q),this.setPosition(new q.Point(Z.x-J,Z.y-ee+se),K),this.setWidth(re,K)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(Z){q.console.assert(!Z||Z instanceof q.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),Z instanceof q.Rect?this._clip=Z.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(q){q!==this.opacity&&(this.opacity=q,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(q){this._preload=!!q,this._needsDraw=!0},getRotation:function(q){return q?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(q,Z){this._degreesSpring.target.value===q&&this._degreesSpring.isAtTargetValue()||(Z?this._degreesSpring.resetTo(q):this._degreesSpring.springTo(q),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(q){return this.getBoundsNoRotate(q).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(q){q!==this.compositeOperation&&(this.compositeOperation=q,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(q,Z){var X=this._scaleSpring.target.value===q;if(Z){if(X&&this._scaleSpring.current.value===q)return;this._scaleSpring.resetTo(q),this._updateForScale(),this._needsDraw=!0}else{if(X)return;this._scaleSpring.springTo(q),this._updateForScale(),this._needsDraw=!0}X||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var q=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),Z=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,X=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(Z/this.minPixelRatio)/Math.log(2))));return X=Math.max(X,this.source.minLevel||0),{lowestLevel:q=Math.min(q,X),highestLevel:X}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};0<this.lastDrawn.length;)this.lastDrawn.pop().beingDrawn=!1;var Z=this.viewport,X=this._viewportToTiledImageRectangle(Z.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var K=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(X=X.intersection(K)))return}for(var Y=this._getLevelsInterval(),Q=Y.lowestLevel,J=Y.highestLevel,ee=null,te=!1,ie=q.now(),ne=J;Q<=ne;ne--){var oe=!1,re=Z.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(ne),!0).x*this._scaleSpring.current.value;if(ne===Q||!te&&re>=this.minPixelRatio)te=oe=!0;else if(!te)continue;var se=Z.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(ne),!1).x*this._scaleSpring.current.value,ae=Z.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,le=this.immediateRender?1:ae;if(ee=m(this,te,oe,ne,Math.min(1,(re-.5)/.5),le/Math.abs(le-se),X,ie,ee),f(this.coverage,ne))break}!function(Z,X){if(0!==Z.opacity&&(0!==X.length||Z.placeholderFillStyle)){var K,Y,Q,J=X[0];J&&(K=Z.opacity<1||Z.compositeOperation&&"source-over"!==Z.compositeOperation||!Z._isBottomItem()&&J._hasTransparencyChannel());var ee,te=Z.viewport.getZoom(!0),ie=Z.viewportToImageZoom(te);1<X.length&&ie>Z.smoothTileEdgesMinZoom&&!Z.iOSDevice&&Z.getRotation(!0)%360==0&&q.supportsCanvas&&(K=!0,Y=J.getScaleForEdgeSmoothing(),Q=J.getTranslationForEdgeSmoothing(Y,Z._drawer.getCanvasSize(!1),Z._drawer.getCanvasSize(!0))),K&&(Y||(ee=Z.viewport.viewportToViewerElementRectangle(Z.getClippedBounds(!0)).getIntegerBoundingBox(),Z._drawer.viewer.viewport.getFlip()&&(0===Z.viewport.degrees&&Z.getRotation(!0)%360==0||(ee.x=Z._drawer.viewer.container.clientWidth-(ee.x+ee.width))),ee=ee.times(q.pixelDensityRatio)),Z._drawer._clear(!0,ee)),Y||(0!==Z.viewport.degrees&&Z._drawer._offsetForRotation({degrees:Z.viewport.degrees,useSketch:K}),Z.getRotation(!0)%360!=0&&Z._drawer._offsetForRotation({degrees:Z.getRotation(!0),point:Z.viewport.pixelFromPointNoRotate(Z._getRotationPoint(!0),!0),useSketch:K}),0===Z.viewport.degrees&&Z.getRotation(!0)%360==0&&Z._drawer.viewer.viewport.getFlip()&&Z._drawer._flip());var ne=!1;if(Z._clip){Z._drawer.saveContext(K);var oe=Z.imageToViewportRectangle(Z._clip,!0);oe=oe.rotate(-Z.getRotation(!0),Z._getRotationPoint(!0));var re=Z._drawer.viewportToDrawerRectangle(oe);Y&&(re=re.times(Y)),Q&&(re=re.translate(Q)),Z._drawer.setClip(re,K),ne=!0}if(Z._croppingPolygons){Z._drawer.saveContext(K);try{var se=Z._croppingPolygons.map((function(q){return q.map((function(q){var X=Z.imageToViewportCoordinates(q.x,q.y,!0).rotate(-Z.getRotation(!0),Z._getRotationPoint(!0)),K=Z._drawer.viewportCoordToDrawerCoord(X);return Y&&(K=K.times(Y)),K}))}));Z._drawer.clipWithPolygons(se,K)}catch(X){q.console.error(X)}ne=!0}if(Z.placeholderFillStyle&&!1===Z._hasOpaqueTile){var ae=Z._drawer.viewportToDrawerRectangle(Z.getBounds(!0));Y&&(ae=ae.times(Y)),Q&&(ae=ae.translate(Q));var le;le="function"==typeof Z.placeholderFillStyle?Z.placeholderFillStyle(Z,Z._drawer.context):Z.placeholderFillStyle,Z._drawer.drawRectangle(ae,le,K)}for(var he=X.length-1;0<=he;he--)J=X[he],Z._drawer.drawTile(J,Z._drawingHandler,K,Y,Q),J.beingDrawn=!0,Z.viewer&&Z.viewer.raiseEvent("tile-drawn",{tiledImage:Z,tile:J});ne&&Z._drawer.restoreContext(K),Y||(Z.getRotation(!0)%360!=0&&Z._drawer._restoreRotationChanges(K),0!==Z.viewport.degrees&&Z._drawer._restoreRotationChanges(K)),K&&(Y&&(0!==Z.viewport.degrees&&Z._drawer._offsetForRotation({degrees:Z.viewport.degrees,useSketch:!1}),Z.getRotation(!0)%360!=0&&Z._drawer._offsetForRotation({degrees:Z.getRotation(!0),point:Z.viewport.pixelFromPointNoRotate(Z._getRotationPoint(!0),!0),useSketch:!1})),Z._drawer.blendSketch({opacity:Z.opacity,scale:Y,translate:Q,compositeOperation:Z.compositeOperation,bounds:ee}),Y&&(Z.getRotation(!0)%360!=0&&Z._drawer._restoreRotationChanges(!1),0!==Z.viewport.degrees&&Z._drawer._restoreRotationChanges(!1))),Y||0===Z.viewport.degrees&&Z.getRotation(!0)%360==0&&Z._drawer.viewer.viewport.getFlip()&&Z._drawer._flip(),function(Z,X){if(Z.debugMode)for(var K=X.length-1;0<=K;K--){var Y=X[K];try{Z._drawer.drawDebugInfo(Y,X.length,K,Z)}catch(Z){q.console.error(Z)}}}(Z,X)}}(this,this.lastDrawn),ee&&!ee.context2D?(!function(Z,X,K){X.loading=!0,Z._imageLoader.addJob({src:X.url,loadWithAjax:X.loadWithAjax,ajaxHeaders:X.ajaxHeaders,crossOriginPolicy:Z.crossOriginPolicy,ajaxWithCredentials:Z.ajaxWithCredentials,callback:function(Y,Q,J){!function(Z,X,K,Y,Q,J){if(!Y)return q.console.log("Tile %s failed to load: %s - error: %s",X,X.url,Q),Z.viewer.raiseEvent("tile-load-failed",{tile:X,tiledImage:Z,time:K,message:Q,tileRequest:J}),X.loading=!1,void(X.exists=!1);if(K<Z.lastResetTime)return q.console.log("Ignoring tile %s loaded before reset: %s",X,X.url),void(X.loading=!1);function s(){var q=Z.source.getClosestLevel();v(Z,X,Y,q,J)}Z._midDraw?window.setTimeout(s,1):s()}(Z,X,K,Y,Q,J)},abort:function(){X.loading=!1}})}(this,ee,ie),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(Z,X,K){var Y,Q,J,ee;this.wrapHorizontal?(Y=q.positiveModulo(X.x,1),Q=q.positiveModulo(K.x,1)):(Y=Math.max(0,X.x),Q=Math.min(1,K.x));var te=1/this.source.aspectRatio;this.wrapVertical?(J=q.positiveModulo(X.y,te),ee=q.positiveModulo(K.y,te)):(J=Math.max(0,X.y),ee=Math.min(te,K.y));var ie=this.source.getTileAtPoint(Z,new q.Point(Y,J)),ne=this.source.getTileAtPoint(Z,new q.Point(Q,ee)),oe=this.source.getNumTiles(Z);return this.wrapHorizontal&&(ie.x+=oe.x*Math.floor(X.x),ne.x+=oe.x*Math.floor(K.x)),this.wrapVertical&&(ie.y+=oe.y*Math.floor(X.y/te),ne.y+=oe.y*Math.floor(K.y/te)),{topLeft:ie,bottomRight:ne}}})}(OpenSeadragon),function(q){function m(Z){q.console.assert(Z,"[TileCache.cacheTile] options is required"),q.console.assert(Z.tile,"[TileCache.cacheTile] options.tile is required"),q.console.assert(Z.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=Z.tile,this.tiledImage=Z.tiledImage}function v(Z){q.console.assert(Z,"[ImageRecord] options is required"),q.console.assert(Z.image,"[ImageRecord] options.image is required"),this._image=Z.image,this._tiles=[]}v.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var q=document.createElement("canvas");q.width=this._image.width,q.height=this._image.height,this._renderedContext=q.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(Z){q.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=Z},addTile:function(Z){q.console.assert(Z,"[ImageRecord.addTile] tile is required"),this._tiles.push(Z)},removeTile:function(Z){for(var X=0;X<this._tiles.length;X++)if(this._tiles[X]===Z)return void this._tiles.splice(X,1);q.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",Z)},getTileCount:function(){return this._tiles.length}},q.TileCache=function(Z){Z=Z||{},this._maxImageCacheCount=Z.maxImageCacheCount||q.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},q.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(Z){q.console.assert(Z,"[TileCache.cacheTile] options is required"),q.console.assert(Z.tile,"[TileCache.cacheTile] options.tile is required"),q.console.assert(Z.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),q.console.assert(Z.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var X=Z.cutoff||0,K=this._tilesLoaded.length,Y=this._imagesLoaded[Z.tile.cacheKey];if(Y||(q.console.assert(Z.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),Y=this._imagesLoaded[Z.tile.cacheKey]=new v({image:Z.image}),this._imagesLoadedCount++),Y.addTile(Z.tile),Z.tile.cacheImageRecord=Y,this._imagesLoadedCount>this._maxImageCacheCount){for(var Q,J,ee,te,ie,ne,oe=null,re=-1,se=null,ae=this._tilesLoaded.length-1;0<=ae;ae--)(Q=(ne=this._tilesLoaded[ae]).tile).level<=X||Q.beingDrawn||(oe?(te=Q.lastTouchTime,J=oe.lastTouchTime,ie=Q.level,ee=oe.level,(te<J||te==J&&ee<ie)&&(oe=Q,re=ae,se=ne)):(oe=Q,re=ae,se=ne));oe&&0<=re&&(this._unloadTile(se),K=re)}this._tilesLoaded[K]=new m({tile:Z.tile,tiledImage:Z.tiledImage})},clearTilesFor:function(Z){var X;q.console.assert(Z,"[TileCache.clearTilesFor] tiledImage is required");for(var K=0;K<this._tilesLoaded.length;++K)(X=this._tilesLoaded[K]).tiledImage===Z&&(this._unloadTile(X),this._tilesLoaded.splice(K,1),K--)},getImageRecord:function(Z){return q.console.assert(Z,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[Z]},_unloadTile:function(Z){q.console.assert(Z,"[TileCache._unloadTile] tileRecord is required");var X=Z.tile,K=Z.tiledImage;X.unload(),X.cacheImageRecord=null;var Y=this._imagesLoaded[X.cacheKey];Y.removeTile(X),Y.getTileCount()||(Y.destroy(),delete this._imagesLoaded[X.cacheKey],this._imagesLoadedCount--),K.viewer.raiseEvent("tile-unloaded",{tile:X,tiledImage:K})}}}(OpenSeadragon),v=OpenSeadragon,v.World=function(q){var Z=this;v.console.assert(q.viewer,"[World] options.viewer is required"),v.EventSource.call(this),this.viewer=q.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(q){Z._autoRefigureSizes?Z._figureSizes():Z._needsSizesFigured=!0},this._figureSizes()},v.extend(v.World.prototype,v.EventSource.prototype,{addItem:function(q,Z){if(v.console.assert(q,"[World.addItem] item is required"),v.console.assert(q instanceof v.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(Z=Z||{}).index){var X=Math.max(0,Math.min(this._items.length,Z.index));this._items.splice(X,0,q)}else this._items.push(q);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,q.addHandler("bounds-change",this._delegatedFigureSizes),q.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:q})},getItemAt:function(q){return v.console.assert(void 0!==q,"[World.getItemAt] index is required"),this._items[q]},getIndexOfItem:function(q){return v.console.assert(q,"[World.getIndexOfItem] item is required"),v.indexOf(this._items,q)},getItemCount:function(){return this._items.length},setItemIndex:function(q,Z){v.console.assert(q,"[World.setItemIndex] item is required"),v.console.assert(void 0!==Z,"[World.setItemIndex] index is required");var X=this.getIndexOfItem(q);if(Z>=this._items.length)throw new Error("Index bigger than number of layers.");Z!==X&&-1!==X&&(this._items.splice(X,1),this._items.splice(Z,0,q),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:q,previousIndex:X,newIndex:Z}))},removeItem:function(q){v.console.assert(q,"[World.removeItem] item is required");var Z=v.indexOf(this._items,q);-1!==Z&&(q.removeHandler("bounds-change",this._delegatedFigureSizes),q.removeHandler("clip-change",this._delegatedFigureSizes),q.destroy(),this._items.splice(Z,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(q))},removeAll:function(){var q,Z;for(this.viewer._cancelPendingImages(),Z=0;Z<this._items.length;Z++)(q=this._items[Z]).removeHandler("bounds-change",this._delegatedFigureSizes),q.removeHandler("clip-change",this._delegatedFigureSizes),q.destroy();var X=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,Z=0;Z<X.length;Z++)q=X[Z],this._raiseRemoveItem(q)},resetItems:function(){for(var q=0;q<this._items.length;q++)this._items[q].reset()},update:function(){for(var q=!1,Z=0;Z<this._items.length;Z++)q=this._items[Z].update()||q;return q},draw:function(){for(var q=0;q<this._items.length;q++)this._items[q].draw();this._needsDraw=!1},needsDraw:function(){for(var q=0;q<this._items.length;q++)if(this._items[q].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(q){(this._autoRefigureSizes=q)&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(q){var Z,X=(q=q||{}).immediately||!1,K=q.layout||v.DEFAULT_SETTINGS.collectionLayout,Y=q.rows||v.DEFAULT_SETTINGS.collectionRows,Q=q.columns||v.DEFAULT_SETTINGS.collectionColumns,J=q.tileSize||v.DEFAULT_SETTINGS.collectionTileSize,ee=J+(q.tileMargin||v.DEFAULT_SETTINGS.collectionTileMargin);Z=!q.rows&&Q?Q:Math.ceil(this._items.length/Y);var te,ie,ne,oe,re,se=0,ae=0;this.setAutoRefigureSizes(!1);for(var le=0;le<this._items.length;le++)le&&le%Z==0&&("horizontal"===K?(ae+=ee,se=0):(se+=ee,ae=0)),oe=(ne=(ie=(te=this._items[le]).getBounds()).width>ie.height?J:J*(ie.width/ie.height))*(ie.height/ie.width),re=new v.Point(se+(J-ne)/2,ae+(J-oe)/2),te.setPosition(re,X),te.setWidth(ne,X),"horizontal"===K?se+=ee:ae+=ee;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var q=this._homeBounds?this._homeBounds.clone():null,Z=this._contentSize?this._contentSize.clone():null,X=this._contentFactor||0;if(this._items.length){var K=this._items[0],Y=K.getBounds();this._contentFactor=K.getContentSize().x/Y.width;for(var Q=K.getClippedBounds().getBoundingBox(),J=Q.x,ee=Q.y,te=Q.x+Q.width,ie=Q.y+Q.height,ne=1;ne<this._items.length;ne++)Y=(K=this._items[ne]).getBounds(),this._contentFactor=Math.max(this._contentFactor,K.getContentSize().x/Y.width),Q=K.getClippedBounds().getBoundingBox(),J=Math.min(J,Q.x),ee=Math.min(ee,Q.y),te=Math.max(te,Q.x+Q.width),ie=Math.max(ie,Q.y+Q.height);this._homeBounds=new v.Rect(J,ee,te-J,ie-ee),this._contentSize=new v.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new v.Rect(0,0,1,1),this._contentSize=new v.Point(1,1),this._contentFactor=1;this._contentFactor===X&&this._homeBounds.equals(q)&&this._contentSize.equals(Z)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(q){this.raiseEvent("remove-item",{item:q})}});