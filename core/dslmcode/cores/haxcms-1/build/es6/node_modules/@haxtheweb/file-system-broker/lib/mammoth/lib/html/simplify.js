var e=require("underscore"),t=require("./ast");function collapse(e){var t=[];return e.map(collapseNode).forEach((function(e){appendChild(t,e)})),t}function collapseNode(e){return n[e.type](e)}var n={element:function collapseElement(e){return t.elementWithTag(e.tag,collapse(e.children))},text:identity,forceWrite:identity};function identity(e){return e}function appendChild(e,n){var r=e[e.length-1];"element"===n.type&&!n.tag.fresh&&r&&"element"===r.type&&n.tag.matchesElement(r.tag)?(n.tag.separator&&appendChild(r.children,t.text(n.tag.separator)),n.children.forEach((function(e){appendChild(r.children,e)}))):e.push(n)}function removeEmpty(t){return function flatMap(t,n){return e.flatten(e.map(t,n),!0)}(t,(function(e){return r[e.type](e)}))}var r={element:function elementEmptier(e){var n=removeEmpty(e.children);return 0!==n.length||t.isVoidElement(e)?[t.elementWithTag(e.tag,n)]:[]},text:function textEmptier(e){return 0===e.value.length?[]:[e]},forceWrite:function neverEmpty(e){return[e]}};module.exports=function simplify(e){return collapse(removeEmpty(e))};