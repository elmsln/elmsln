/**
 * Copyright 2018 Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
export class EvoToWc{get courseicons(){return{assessment:"assessment",brainstorm:"lightbulb-outline",casestudy:"work",discussion:"question-answer",email:"mail",game:"hardware:videogame-asset",group:"social:group",handson:"pan-tool",image:"image:image",mobile:"hardware:phone-android",presentation:"device:dvr",reading:"chrome-reader-mode",reflection:"lightbulb-outline",rss:"mdi-social:rss-box",selfcheck:"assignment-turned-in",survey:"assignment",transcript:"receipt",video:"av:movie",webresource:"language",written:"create",yammer:"lrn:assessment"}}get headings(){return["h1","h2","h3","h4","h5","h6"]}constructor(){}convert(e=document.body){this.convertIfNeeded(e,[{selector:".coursework",function:"convertIcons"},{selector:".graphme",function:"convertGraphmes"},{selector:".tablestyle,.tablestyle2,.tablestyle3",function:"convertTablestyles"},{selector:".tabbed-interface",function:"convertTabs"},{selector:".expandable,.accordion-interface",function:"convertCollapses"},{selector:"figure",function:"convertFigures"},{selector:"img.gif-player",function:"convertGifs"},{selector:".image-thumbnail, .dynamic-image-group,.wcslideplayer, .clickable-list",function:"convertGalleries"},{selector:".newcolorbox,.colorbox,.pulltext,.yellownote,.speechbubble",function:"convertCards"}])}convertIfNeeded(e,t=[]){t.forEach((t=>{let o=e.querySelectorAll(t.selector);o.length>0&&this[t.function](o,e)}))}convertAccordions(e=[]){import("../a11y-collapse/lib/a11y-collapse-group.js"),e.forEach((e=>{let t,o=document.createElement("a11y-collapse-group"),n=[...e.childNodes];o.radio=!0,o.headingButton=!0,n.forEach((e=>{this.isHeading(e)?(t=document.createElement("a11y-collapse"),e.slot="heading",t.headingButton=!0,t.append(e),o.append(t)):t&&t.append(e)})),e.parentElement.insertBefore(o,e),e.remove()}))}convertCards(e=[],t){import("../accent-card/accent-card.js"),this.convertIfNeeded(t,[{selector:".newcolorbox",function:"convertNewcolorboxes"},{selector:".colorbox",function:"convertColorboxes"},{selector:".pulltext",function:"convertPulltexts"},{selector:".yellownote",function:"convertYellownotes"},{selector:".speechbubble",function:"convertSpeechbubbles"}])}convertCarousels(e=[]){e.forEach((e=>{let t=document.createElement("lrndesign-gallery"),o=e.querySelectorAll("figure");t.layout="carousel",t.accentColor="light-blue",o.forEach((e=>t.append(this.slotGallery(e)))),e.parentNode.insertBefore(t,e),e.remove()}))}convertCollapses(e=[],t){import("../a11y-collapse/a11y-collapse.js"),this.convertIfNeeded(t,[{selector:".expandable",function:"convertExpandables"},{selector:".accordion-interface",function:"convertAccordions"}])}convertColorboxes(e=[]){e.forEach((e=>{let t=document.createElement("accent-card");t.accentColor="light-blue",this.replace(e,t,this.slotAccentCard)}))}convertExpandables(e=[]){e.forEach((e=>{let t=document.createElement("a11y-collapse"),o=e.querySelector(".collapseable")?[...e.querySelector(".collapseable").childNodes]:[],n=e.querySelector(".expandcollapse"),r=document.createElement("span");for((n?[...n.childNodes]:[]).forEach((e=>r.append(e))),n.parentNode.insertBefore(r,n);r.parentNode&&r.parentNode!==e;)r=r.parentNode;r.slot="heading",t.headingButton=!0,t.append(r),o.forEach((e=>t.append(e))),e.parentNode.insertBefore(t,e),e.remove()}))}convertFigures(e=[]){import("../a11y-figure/a11y-figure.js"),e.forEach((e=>{let t,o,n,r=e.querySelector("figcaption"),l=document.createElement("a11y-figure"),c=e.querySelector("img");r&&e.classList.contains("image-info")&&(t=[...r.childNodes],this.setSize(c,l),o=document.createElement("details"),n=document.createElement("summary"),n.innerHTML="info",o.append(n),t.forEach((e=>o.append(e))),r.append(o),e.classList.remove("image-info")),e.parentElement.insertBefore(l,e),l.append(e)}))}convertGifs(e=[]){import("../a11y-gif-player/a11y-gif-player.js"),e.forEach((e=>{let t=document.createElement("a11y-gif-player"),o=e.src||"";this.setSize(e,t),this.setSize(e,t,"height"),t.src=o,t.srcWithoutAnimation=o.replace(/\.\w+$/,".gif"),e.parentElement.insertBefore(t,e),e.remove()}))}convertGalleries(e=[],t){this.convertIfNeeded(t,[{selector:".image-thumbnail",function:"convertThumbnails"},{selector:".dynamic-image-group,.wcslideplayer",function:"convertCarousels"},{selector:".clickable-list",function:"convertImageLists"}])}convertGraphmes(e=[]){import("../lrndesign-chart/lib/lrndesign-bar.js"),import("../lrndesign-chart/lib/lrndesign-line.js"),import("../lrndesign-chart/lib/lrndesign-pie.js"),e.forEach((e=>{["bar","line","pie"].forEach((t=>this.insertChart(e,t))),e.classList.contains("showtable")||e.remove(),e.classList.remove("graphme")}))}convertIcons(e,t){import("../hax-iconset/lib/simple-hax-iconset.js"),import("../simple-icon/lib/simple-icon-lite.js"),import("../simple-icon/lib/simple-icons.js"),Object.keys(this.courseicons).forEach((e=>{t.querySelectorAll(`.coursework.${e}`).forEach((t=>{let o=t.firstElementChild,n=document.createElement("simple-icon-lite");n.icon=this.courseicons[e],n.style.marginRight="0.25em",o.insertBefore(n,o.firstChild),t.classList.remove("coursework"),t.classList.remove(e)}))}))}convertImageLists(e=[]){e.forEach((e=>{let t=document.createElement("lrndesign-gallery"),o=e.querySelectorAll("li");t.layout="grid",t.accentColor="light-blue",o.forEach((e=>t.append(this.slotGallery(e)))),e.parentNode.insertBefore(t,e),e.remove()}))}convertNewcolorboxes(e=[]){e.forEach((e=>{let t=document.createElement("accent-card");t.noBorder=!0,t.flat=!0,this.replace(e,t,this.slotAccentCard)}))}convertPulltexts(e=[]){e.forEach((e=>{let t=document.createElement("accent-card");t.accentColor="light-blue",t.horizontal=!0,this.replace(e,t,this.slotAccentCard)}))}convertSpeechbubbles(e=[]){e.forEach((e=>{let t=document.createElement("accent-card"),o=e.nextElementSibling;t.accentColor="light-blue",t.horizontal=!0,this.replace(e,t,this.slotAccentCard),o.classList.contains("speechbubble-caption")&&(o.slot="footer",o.style.fontSize="85%",o.classList.remove("speechbubble-caption"),t.append(o),o.style.textAlign="right")}))}convertTabs(e=[]){import("../a11y-tabs/a11y-tabs.js"),e.forEach((e=>{let t=document.createElement("a11y-tabs");this.replace(e,t,this.slotTabs.bind(this))}))}convertTablestyles(e){import("../editable-table/editable-table.js"),e.forEach((e=>{let t=document.createElement("editable-table");t.bordered=e.classList.contains("dottedrows")||e.classList.contains("dottedcols")||e.classList.contains("linedrows")||e.classList.contains("linedcols"),t.columnStriped=e.classList.contains("alternatecols"),t.striped=!t.columnStriped&&e.classList.contains("alternaterows"),e.parentElement.insertBefore(t,e),e.classList.remove("tablestyle"),e.classList.remove("tablestyle2"),e.classList.remove("tablestyle3"),t.append(e)}))}convertThumbnails(e){e.forEach((e=>{let t=document.createElement("lrndesign-gallery"),o=e.src,n=o.match("_thumb.")?o:void 0,r=n?n.replace(/_thumb\./,"_full."):void 0;t.innerHTML=`<figure><img src="${o}" ></figure>`,parent=e.parentElement,t.layout="masonry",t.accentColor="light-blue",t.sources=[{alt:e.alt||"",details:"",src:o,thumbnail:n,large:r,sizing:"contain",title:e.alt||""}],t.style.display="inline-block",t.style.width="50%",t.style.minWidth="400px",t.style.maxWidth="800px",e.parentNode.insertBefore(t,e),e.remove(),parent&&"figure"==parent.tagName.toLowerCase()&&(parent.style.display="flex",parent.style.flexDirection="column",parent.style.alignItems="stretch")}))}convertYellownotes(e){e.forEach((e=>{let t=document.createElement("accent-card");t.accentColor="yellow",t.accentBackground=!0,t.noBorder=!0,this.replace(e,t,this.slotAccentCard)}))}insertChart(e,t="bar"){let o=document.createElement("table"),n=e.classList.contains(`${t}chart`)?document.createElement(`lrndesign-${t}`):void 0;n&&(n.scale="ct-octave",[...e.childNodes].forEach((e=>o.append(e.cloneNode(!0)))),n.append(o),"pie"!==t&&(n.showGridBackground=!0),"line"===t&&(n.fullWidth=!0),e.parentNode.insertBefore(n,e))}isHeading(e){return e&&e.tagName&&this.headings.includes(e.tagName.toLowerCase())}replace(e,t,o){return e.parentElement.insertBefore(t,e),[...e.childNodes].forEach((e=>{(e=o?o(e):e)&&t.append(e)})),e.remove(),t}setSize(e,t,o="width"){let n=`${e[o]}`;n&&(n.match(/\d$/)&&(n=`${n}px`),t.style[o]=n)}slotAccentCard(e){if(e&&e.tagName)this.isHeading(e)?e.slot="heading":e.slot="content";else{let t=document.createElement("span");t.append(e),t.slot="content",e=t}return e}slotGallery(e){let t=document.createElement("figure"),o=document.createElement("figcaption"),n=e.firstElementChild.querySelector("img")||e.querySelector("img"),r=e.querySelector("figcaption")?[...e.querySelector("figcaption").childNodes]:[...e.childNodes],l=e.querySelector(this.headings.join());return n&&(n.removeAttribute("width"),n.removeAttribute("height"),t.append(n)),l||(l=document.createElement("h3"),n&&(l.innerHTML=n.alt)),o.append(l),r.forEach((t=>{t!=e.firstElementChild&&o.append(t)})),t.append(o),t}slotTabs(e){if(e&&e.tagName){let t=document.createElement("a11y-tab");if(t.id=e.id,e.firstElementChild)e.firstElementChild.slot="label",t.append(e.firstElementChild);else if(e.firstChild){let o=document.createElement("span");o.slot="label",o.append(e),t.append(o)}else t.label=t.id;return this.replace(e,t),t}return!1}}window.EvoToWc=window.EvoToWc||{},window.EvoToWc.requestAvailability=()=>(window.EvoToWc.instance||(window.EvoToWc.instance=new EvoToWc),window.dispatchEvent(new CustomEvent("register-hax-converter",{bubbles:!0,composed:!0,cancelable:!0,detail:window.EvoToWc.instance.convert})),window.EvoToWc.instance);export const EvoToWcConverter=window.EvoToWc.requestAvailability();