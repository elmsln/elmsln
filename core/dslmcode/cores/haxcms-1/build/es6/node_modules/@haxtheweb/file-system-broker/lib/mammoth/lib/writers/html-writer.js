var e=require("util"),n=require("underscore");exports.writer=function writer(e){return(e=e||{}).prettyPrint?function prettyWriter(){var e=0,r="  ",i=[],o=!0,s=!1,u=simpleWriter();function open(n,r){t[n]&&indent(),i.push(n),u.open(n,r),t[n]&&e++,o=!1}function close(n){t[n]&&(e--,indent()),i.pop(),u.close(n)}function text(e){startText();var n=isInPre()?e:e.replace("\n","\n"+r);u.text(n)}function selfClosing(e,n){indent(),u.selfClosing(e,n)}function insideIndentedElement(){return 0===i.length||t[i[i.length-1]]}function startText(){s||(indent(),s=!0)}function indent(){if(s=!1,!o&&insideIndentedElement()&&!isInPre()){u._append("\n");for(var n=0;n<e;n++)u._append(r)}}function isInPre(){return n.some(i,(function(e){return"pre"===e}))}return{asString:u.asString,open,close,text,selfClosing}}():simpleWriter()};var t={div:!0,p:!0,ul:!0,li:!0};function simpleWriter(){var t=[];function generateAttributeString(t){return n.map(t,(function(n,t){return e.format(' %s="%s"',t,function escapeHtmlAttribute(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}(n))})).join("")}return{asString:function asString(){return t.join("")},open:function open(n,r){var i=generateAttributeString(r);t.push(e.format("<%s%s>",n,i))},close:function close(n){t.push(e.format("</%s>",n))},text:function text(e){t.push(function escapeHtmlText(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}(e))},selfClosing:function selfClosing(n,r){var i=generateAttributeString(r);t.push(e.format("<%s%s />",n,i))},_append:function append(e){t.push(e)}}}