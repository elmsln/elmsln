import{DDDSuper as t,DDDPulseEffectSuper as e}from"../../../../d-d-d/d-d-d.js";import{html as s,css as o,LitElement as i}from"../../../../../lit/index.js";import{store as a}from"../../core/haxcms-site-store.js";import{toJS as n}from"../../../../../mobx/dist/mobx.esm.js";import{MicroFrontendRegistry as r}from"../../../../micro-frontend-registry/micro-frontend-registry.js";import{enableServices as h}from"../../../../micro-frontend-registry/lib/microServices.js";import"../../../../simple-icon/lib/simple-icon-button-lite.js";import"../../../../chat-agent/chat-agent.js";h(["haxcms"]),r.add({endpoint:"/api/apps/haxcms/aiChat",name:"@haxcms/aiChat",title:"AI Chat",description:"AI based chat agent that can answer questions about a site",params:{site:"location of the HAXcms site OR site.json data",type:"site for site.json or link for remote loading",question:"Question to ask of the AI",engine:"which engine to use as we test multiple",context:"context to query based on. Course typical"}});export class SiteAiChat extends(e(t(i))){static get tag(){return"site-ai-chat"}constructor(){super(),this.opened=!1,this.question=null,this.answers=[],this.loading=!1,this.context=n(a.manifest.metadata.site.name),this.engine="alfred",this.dataPulse="1"}static get styles(){return[super.styles,o`
        :host {
          display: block;
        }
      `]}askQuestion(t){t.preventDefault(),this.engine=t.target.getAttribute("name"),this.context=this.shadowRoot.querySelector("#context").value,this.question=this.shadowRoot.querySelector("#question").value,this.requestAIFeedback()}updated(t){super.updated&&super.updated(t),t.has("opened")&&(this.opened?this.shadowRoot.querySelector("dialog").showModal():this.shadowRoot.querySelector("dialog").close())}requestAIFeedback(){const t=n(a.manifest);var e="";globalThis.document.querySelector("base")&&(e=globalThis.document.querySelector("base").href);const s={site:{file:e+"site.json",metadata:t.metadata},type:"site",question:this.question,engine:this.engine,context:this.context};this.loading=!0,r.call("@haxcms/aiChat",s).then((t=>{200==t.status&&(this.answers=[...t.data.answers],this.question=t.data.question),this.loading=!1})).catch((t=>{this.loading=!1,console.error(t)}))}closeChat(){this.opened=!1}openChat(){this.opened=!0,setTimeout((()=>{this.shadowRoot.querySelector("#question").focus(),this.shadowRoot.querySelector("#question").select()}),300)}static get properties(){return{...super.properties,engine:{type:String},question:{type:String},context:{type:String},answers:{type:Array},opened:{type:Boolean,reflect:!0},loading:{type:Boolean,reflect:!0}}}}globalThis.customElements.define(SiteAiChat.tag,SiteAiChat);