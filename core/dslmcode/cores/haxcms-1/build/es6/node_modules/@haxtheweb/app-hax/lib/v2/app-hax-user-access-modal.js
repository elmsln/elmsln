/**
 * Copyright 2025 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{html as e,css as t}from"../../../../lit/index.js";import{DDD as a}from"../../../d-d-d/d-d-d.js";import{I18NMixin as d}from"../../../i18n-manager/lib/I18NMixin.js";import"../../../rpg-character/rpg-character.js";import"../../../simple-icon/lib/simple-icons.js";import"../../../simple-icon/lib/simple-icon-button.js";import{store as s}from"./AppHaxStore.js";class AppHaxUserAccessModal extends(d(a)){static get tag(){return"app-hax-user-access-modal"}constructor(){super(),this.username="",this.loading=!1,this.error="",this.siteTitle="",this.t={userAccess:"User Access",enterUsername:"Enter username to grant access",usernamePlaceholder:"Username",addUser:"Add User",cancel:"Cancel",userAccessGranted:"User access granted successfully!",userNotFound:"User not found or unauthorized",loadingAddingUser:"Adding user...",grantAccessTo:"Grant access to:"}}static get properties(){return{...super.properties,username:{type:String},loading:{type:Boolean},error:{type:String},siteTitle:{type:String}}}static get styles(){return[super.styles,t`
        :host {
          display: block;
          font-family: var(--ddd-font-primary);
          background-color: var(--ddd-theme-default-white);
          border-radius: var(--ddd-radius-sm);
          padding: var(--ddd-spacing-6);
          min-width: 420px;
          max-width: 500px;
        }

        .modal-content {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: var(--ddd-spacing-4);
        }

        .site-info {
          text-align: center;
          margin-bottom: var(--ddd-spacing-2);
        }

        .site-title {
          color: var(--ddd-theme-default-nittanyNavy);
          font-weight: var(--ddd-font-weight-bold);
          font-size: var(--ddd-font-size-s);
          margin: var(--ddd-spacing-1) 0;
        }

        .character-container {
          display: flex;
          justify-content: center;
          margin: var(--ddd-spacing-2) 0;
          padding: var(--ddd-spacing-3);
          border-radius: var(--ddd-radius-sm);
          background-color: var(--ddd-theme-default-limestoneLight);
        }

        .input-container {
          width: 100%;
          display: flex;
          flex-direction: column;
          gap: var(--ddd-spacing-2);
        }

        input {
          padding: var(--ddd-spacing-3);
          border: var(--ddd-border-sm);
          border-radius: var(--ddd-radius-xs);
          font-family: var(--ddd-font-primary);
          font-size: var(--ddd-font-size-s);
          width: 100%;
          box-sizing: border-box;
          transition:
            border-color 0.2s ease,
            box-shadow 0.2s ease;
        }

        input:focus {
          outline: none;
          border-color: var(--ddd-theme-default-nittanyNavy);
          box-shadow: 0 0 0 2px var(--ddd-theme-default-potential30);
        }

        .buttons {
          display: flex;
          gap: var(--ddd-spacing-3);
          justify-content: center;
          width: 100%;
          margin-top: var(--ddd-spacing-3);
        }

        button {
          background: var(--ddd-theme-default-nittanyNavy, #001e44);
          color: var(--ddd-theme-default-white, white);
          border: none;
          border-radius: var(--ddd-radius-sm);
          padding: var(--ddd-spacing-3) var(--ddd-spacing-5);
          font-family: var(--ddd-font-primary);
          font-size: var(--ddd-font-size-s);
          font-weight: var(--ddd-font-weight-medium);
          cursor: pointer;
          transition: all 0.2s ease;
          min-width: 100px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        button:hover:not(:disabled) {
          background: var(--ddd-theme-default-keystoneYellow, #ffd100);
          color: var(--ddd-theme-default-nittanyNavy, #001e44);
          transform: translateY(-1px);
          box-shadow: var(--ddd-boxShadow-sm);
        }

        button:disabled {
          background: var(--ddd-theme-default-slateGray);
          cursor: not-allowed;
          transform: none;
          box-shadow: none;
          opacity: 0.6;
        }

        .cancel-button {
          background: transparent;
          color: var(--ddd-theme-default-nittanyNavy);
          border: var(--ddd-border-sm);
        }

        .cancel-button:hover:not(:disabled) {
          background: var(--ddd-theme-default-slateLight);
          color: var(--ddd-theme-default-nittanyNavy);
          transform: translateY(-1px);
        }

        .error {
          color: var(--ddd-theme-default-original87Pink);
          font-size: var(--ddd-font-size-xs);
          text-align: center;
          background-color: var(--ddd-theme-default-original87Pink10);
          padding: var(--ddd-spacing-2);
          border-radius: var(--ddd-radius-xs);
          border: 1px solid var(--ddd-theme-default-original87Pink30);
        }

        .loading {
          display: flex;
          align-items: center;
          gap: var(--ddd-spacing-2);
          justify-content: center;
        }

        .loading simple-icon {
          --simple-icon-width: 16px;
          --simple-icon-height: 16px;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          0% {
            transform: rotate(0deg);
          }
          100% {
            transform: rotate(360deg);
          }
        }

        h3 {
          margin: 0;
          color: var(--ddd-theme-default-nittanyNavy);
          font-size: var(--ddd-font-size-l);
          text-align: center;
          font-weight: var(--ddd-font-weight-bold);
        }

        p {
          margin: 0;
          color: var(--ddd-theme-default-coalyGray);
          font-size: var(--ddd-font-size-s);
          text-align: center;
          line-height: 1.4;
        }

        .empty-character {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 120px;
          height: 120px;
          color: var(--ddd-theme-default-slateGray);
          font-size: var(--ddd-font-size-xs);
          text-align: center;
        }
      `]}render(){return e`
      <div class="modal-content">
        <h3>${this.t.userAccess}</h3>

        ${this.siteTitle?e`
              <div class="site-info">
                <p>${this.t.grantAccessTo}</p>
                <div class="site-title">${this.siteTitle}</div>
              </div>
            `:""}

        <p>${this.t.enterUsername}</p>

        <div class="character-container">
          ${this.username?e`
                <rpg-character
                  seed="${this.username}"
                  height="120"
                  width="96"
                ></rpg-character>
              `:e`
                <div class="empty-character">
                  Character will appear when you enter a username
                </div>
              `}
        </div>

        <div class="input-container">
          <input
            type="text"
            placeholder="${this.t.usernamePlaceholder}"
            .value="${this.username}"
            @input="${this._handleUsernameInput}"
            ?disabled="${this.loading}"
            @keydown="${this._handleKeydown}"
            autocomplete="off"
          />

          ${this.error?e`<div class="error">${this.error}</div>`:""}
        </div>

        <div class="buttons">
          <button
            class="cancel-button"
            @click="${this._handleCancel}"
            ?disabled="${this.loading}"
          >
            ${this.t.cancel}
          </button>

          <button
            @click="${this._handleAddUser}"
            ?disabled="${this.loading||!this.username.trim()}"
          >
            ${this.loading?e`
                  <div class="loading">
                    <simple-icon icon="hax:loading"></simple-icon>
                    <span>${this.t.loadingAddingUser}</span>
                  </div>
                `:this.t.addUser}
          </button>
        </div>
      </div>
    `}_handleUsernameInput(e){this.username=e.target.value,this.error&&(this.error="")}_handleKeydown(e){"Enter"===e.key&&this.username.trim()&&!this.loading?this._handleAddUser():"Escape"===e.key&&this._handleCancel()}async _handleAddUser(){if(this.username.trim()){this.loading=!0,this.error="";try{const e=await this._addUserAccess(this.username.trim());e.ok?(s.appEl&&s.appEl.playSound&&s.appEl.playSound("success"),this._showSuccessToast(),this._closeModal(),this.username=""):403===e.status?this.error=this.t.userNotFound:this.error=`Error: ${e.status} ${e.statusText}`}catch(e){console.error("Error adding user access:",e),this.error="Network error occurred. Please try again."}finally{this.loading=!1}}}_handleCancel(){this._closeModal()}async _addUserAccess(e){let t=null;if(s.activeSite&&s.activeSite.name?t=s.activeSite.name:s.activeSite&&s.activeSite.metadata&&s.activeSite.metadata.site&&s.activeSite.metadata.site.name&&(t=s.activeSite.metadata.site.name),!t)throw new Error("Unable to determine site name");const a=await s.AppHaxAPI.makeCall("haxiamAddUserAccess",{userName:e,siteName:t});return{ok:!a.__failed,status:a.__failed?a.__failed.status:200,statusText:a.__failed?a.__failed.message:"OK",data:a}}_showSuccessToast(){s.toast(this.t.userAccessGranted,4e3,{hat:"construction",userName:this.username})}_closeModal(){document.body.style.overflow="",globalThis.dispatchEvent(new CustomEvent("simple-modal-hide",{bubbles:!0,composed:!0,cancelable:!0,detail:{}}))}firstUpdated(){super.firstUpdated(),s.activeSite&&s.activeSite.title&&(this.siteTitle=s.activeSite.title),setTimeout((()=>{const e=this.shadowRoot.querySelector("input");e&&e.focus()}),100)}connectedCallback(){super.connectedCallback(),this.username="",this.error="",this.loading=!1,document.body.style.overflow="hidden"}}globalThis.customElements.define(AppHaxUserAccessModal.tag,AppHaxUserAccessModal);export{AppHaxUserAccessModal};