var n=require("underscore");function symmetricMarkdownElement(n){return markdownElement(n,n)}function markdownElement(n,r){return function(){return{start:n,end:r}}}function markdownList(n){return function(r,e){return{start:e?"\n":"",end:e?"":"\n",list:{isOrdered:n.isOrdered,indent:e?e.indent+1:0,count:0}}}}var r={p:markdownElement("","\n\n"),br:markdownElement("","  \n"),ul:markdownList({isOrdered:!1}),ol:markdownList({isOrdered:!0}),li:function markdownListItem(n,r,e){(r=r||{indent:0,isOrdered:!1,count:0}).count++,e.hasClosed=!1;var t=r.isOrdered?r.count+".":"-";return{start:repeatString("\t",r.indent)+t+" ",end:function(){if(!e.hasClosed)return e.hasClosed=!0,"\n"}}},strong:symmetricMarkdownElement("__"),em:symmetricMarkdownElement("*"),a:function markdownLink(n){var r=n.href||"";return r?{start:"[",end:"]("+r+")",anchorPosition:"before"}:{}},img:function markdownImage(n){var r=n.src||"",e=n.alt||"";return r||e?{start:"!["+e+"]("+r+")"}:{}}};function repeatString(n,r){return new Array(r+1).join(n)}!function(){for(var n=1;n<=6;n++)r["h"+n]=markdownElement(repeatString("#",n)+" ","\n\n")}(),exports.writer=function markdownWriter(){var e=[],t=[],o=null,i={};function open(n,s){s=s||{};var a=(r[n]||function(){return{}})(s,o,i);t.push({end:a.end,list:o}),a.list&&(o=a.list);var d="before"===a.anchorPosition;d&&writeAnchor(s),e.push(a.start||""),d||writeAnchor(s)}function writeAnchor(n){n.id&&e.push('<a id="'+n.id+'"></a>')}function close(r){var i=t.pop();o=i.list;var s=n.isFunction(i.end)?i.end():i.end;e.push(s||"")}return{asString:function asString(){return e.join("")},open,close,text:function text(n){e.push(function escapeMarkdown(n){return n.replace(/\\/g,"\\\\").replace(/([\`\*_\{\}\[\]\(\)\#\+\-\.\!])/g,"\\$1")}(n))},selfClosing:function selfClosing(n,r){open(n,r),close()}}};