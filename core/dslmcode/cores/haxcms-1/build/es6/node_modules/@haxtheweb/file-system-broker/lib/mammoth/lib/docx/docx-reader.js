exports.read=function read(a,i){return i=i||{},t.props({contentTypes:p(a),partPaths:findPartPaths(a),docxFile:a,files:new h(i.path?e.dirname(i.path):null)}).also((function(e){return{styles:readStylesFromZipFile(a,e.partPaths.styles)}})).also((function(e){return{numbering:readNumberingFromZipFile(a,e.partPaths.numbering,e.styles)}})).also((function(e){return{footnotes:readXmlFileWithBody(e.partPaths.footnotes,e,(function(e,t){return t?f.createFootnotesReader(e)(t):new r([])})),endnotes:readXmlFileWithBody(e.partPaths.endnotes,e,(function(e,t){return t?f.createEndnotesReader(e)(t):new r([])})),comments:readXmlFileWithBody(e.partPaths.comments,e,(function(e,t){return t?c.createCommentsReader(e)(t):new r([])}))}})).also((function(e){return{notes:e.footnotes.flatMap((function(t){return e.endnotes.map((function(e){return new n.Notes(t.concat(e))}))}))}})).then((function(e){return readXmlFileWithBody(e.partPaths.mainDocument,e,(function(t,n){return e.notes.flatMap((function(r){return e.comments.flatMap((function(e){return new l({bodyReader:t,notes:r,comments:e}).convertXmlToDocument(n)}))}))}))}))},exports._findPartPaths=findPartPaths;var e=require("path"),t=require("../promises"),n=require("../documents"),r=require("../results").Result,a=require("../zipfile"),i=require("./office-xml-reader").readXmlFromZipFile,o=require("./body-reader").createBodyReader,l=require("./document-xml-reader").DocumentXmlReader,s=require("./relationships-reader"),u=require("./content-types-reader"),d=require("./numbering-xml"),m=require("./styles-reader"),f=require("./notes-reader"),c=require("./comments-reader"),h=require("./files").Files;function findPartPaths(e){return P(e).then((function(t){var n=findPartPath({docxFile:e,relationships:t,relationshipType:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",basePath:"",fallbackPath:"word/document.xml"});if(!e.exists(n))throw new Error("Could not find main document part. Are you sure this is a valid .docx file?");return xmlFileReader({filename:relationshipsFilename(n),readElement:s.readRelationships,defaultValue:s.defaultValue})(e).then((function(t){function findPartRelatedToMainDocument(r){return findPartPath({docxFile:e,relationships:t,relationshipType:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/"+r,basePath:a.splitPath(n).dirname,fallbackPath:"word/"+r+".xml"})}return{mainDocument:n,comments:findPartRelatedToMainDocument("comments"),endnotes:findPartRelatedToMainDocument("endnotes"),footnotes:findPartRelatedToMainDocument("footnotes"),numbering:findPartRelatedToMainDocument("numbering"),styles:findPartRelatedToMainDocument("styles")}}))}))}function findPartPath(e){var t=e.docxFile,n=e.relationships,r=e.relationshipType,i=e.basePath,o=e.fallbackPath,l=n.findTargetsByType(r).map((function(e){return function stripPrefix(e,t){return e.substring(0,t.length)===t?e.substring(t.length):e}(a.joinPath(i,e),"/")})).filter((function(e){return t.exists(e)}));return 0===l.length?o:l[0]}function xmlFileReader(e){return function(t){return i(t,e.filename).then((function(t){return t?e.readElement(t):e.defaultValue}))}}function readXmlFileWithBody(e,t,n){return xmlFileReader({filename:relationshipsFilename(e),readElement:s.readRelationships,defaultValue:s.defaultValue})(t.docxFile).then((function(r){var a=new o({relationships:r,contentTypes:t.contentTypes,docxFile:t.docxFile,numbering:t.numbering,styles:t.styles,files:t.files});return i(t.docxFile,e).then((function(e){return n(a,e)}))}))}function relationshipsFilename(e){var t=a.splitPath(e);return a.joinPath(t.dirname,"_rels",t.basename+".rels")}var p=xmlFileReader({filename:"[Content_Types].xml",readElement:u.readContentTypesFromXml,defaultValue:u.defaultContentTypes});function readNumberingFromZipFile(e,t,n){return xmlFileReader({filename:t,readElement:function(e){return d.readNumberingXml(e,{styles:n})},defaultValue:d.defaultNumbering})(e)}function readStylesFromZipFile(e,t){return xmlFileReader({filename:t,readElement:m.readStylesXml,defaultValue:m.defaultStyles})(e)}var P=xmlFileReader({filename:"_rels/.rels",readElement:s.readRelationships,defaultValue:s.defaultValue});