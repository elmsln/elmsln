export var badJSEventAttributes=["onauxclick","onafterprint","onbeforematch","onbeforeprint","onbeforeunload","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onformdata","onhashchange","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onlanguagechange","onload","onloadeddata","onloadedmetadata","onloadstart","onmessage","onmessageerror","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onoffline","ononline","onpagehide","onpageshow","onpaste","onpause","onplay","onplaying","onpopstate","onprogress","onratechange","onreset","onresize","onrejectionhandled","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onslotchange","onstalled","onstorage","onsubmit","onsuspend","ontimeupdate","ontoggle","onunhandledrejection","onunload","onvolumechange","onwaiting","onwheel"];export function removeBadJSEventAttributes(e){if(e&&e.attributes)for(let t=0;t<badJSEventAttributes.length;t++){e.removeAttribute(badJSEventAttributes[t]);let n=e.querySelectorAll(`[${badJSEventAttributes[t]}]`);for(let e=0;e<n.length;e++)n[e].removeAttribute(badJSEventAttributes[t])}return e}export async function copyToClipboard(e,t=null){t||(t=`Copied ${e} to clipboard`);try{await globalThis.navigator.clipboard.writeText(e)}catch(e){t="Failed to authorize copy, refresh and authorize action"}let n=globalThis.HAXCMSToast?"haxcms-toast-show":"simple-toast-show";globalThis.dispatchEvent(new CustomEvent(n,{bubbles:!0,composed:!0,cancelable:!0,detail:{text:t,duration:5e3}}))}export function b64toBlob(e,t="",n=512){const r=atob(e),i=[];for(let e=0;e<r.length;e+=n){const t=r.slice(e,e+n),o=new Array(t.length);for(let e=0;e<t.length;e++)o[e]=t.charCodeAt(e);const a=new Uint8Array(o);i.push(a)}return new Blob(i,{type:t})}export function CSVtoArray(e){let t,n="",r=[""],i=[r],o=0,a=0,s=!0;for(t in e)t=e[t],'"'===t?(s&&t===n&&(r[o]+=t),s=!s):","===t&&s?t=r[++o]="":"\n"===t&&s?("\r"===n&&(r[o]=r[o].slice(0,-1)),r=i[++a]=[t=""],o=0):r[o]+=t,n=t;return i}export function cleanVideoSource(e){var t=e.split("?"),n="";if(e=t[0],2==t.length){let e=t[1].split("&"),r=e[0].split("="),i=Array.isArray(e.shift())?e.shift().join(""):e.shift();if("v"==r[0]){let e=void 0!==i&&""!==i?"?"+i:"";n=r[1]+e}}return-1==e.indexOf("player.vimeo.com")&&-1!=e.indexOf("vimeo.com")?(-1!=e.indexOf("/videos/")&&(e=e.replace("/videos/","/")),e.replace("vimeo.com/","player.vimeo.com/video/")):-1!=e.indexOf("youtube.com/watch")?e.replace("youtube.com/watch","youtube.com/embed/")+n:-1!=e.indexOf("youtube-no-cookie.com/")?e.replace("youtube-no-cookie.com/","youtube.com/")+n:-1!=e.indexOf("youtu.be")?e.replace("youtu.be/","www.youtube.com/embed/")+n:-1!=e.indexOf("sketchfab.com")&&-1==e.indexOf("/embed")?e+"/embed":e}function wrap(e,t){e&&e.parentNode&&(e.parentNode.insertBefore(t,e),t.appendChild(e))}export function lightChildrenToShadowRootSelector(e,t){let n=e.firstElementChild;for(;n;)e.shadowRoot.querySelector(t).appendChild(n),n=e.firstElementChild}function wrapAll(e,t){if(e&&e.length)for(var n in e[0].parentNode.insertBefore(t,e[0]),e)t.appendChild(e[n])}function unwrap(e){if(e&&e.parentNode){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.remove()}}export function normalizeEventPath(e){return e.composed&&e.composedPath?e.composedPath():e.path?e.path:e.originalTarget?[e.originalTarget]:[e.target]}function formatHTML(e,t){var n,r,i,o,a,s;for(r=(t=t||{}).indent_size||2,i=t.indent_char||" ",a=t.brace_style||"collapse",o=0==t.max_char?1/0:t.max_char||80,s=t.unformatted||["template","code-sample","simple-icon","vocab-term","inline-audio","lrn-math","oer-schema","moar-sarcasm","a","span","bdo","em","strong","dfn","code","mark","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"],n=new function Parser(){return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.Utils={whitespace:"\n\r\t ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?=".split(","),extra_liners:"head,body,/html".split(","),in_array:function(e,t){for(var n=0;n<t.length;n++)if(e===t[n])return!0;return!1}},this.get_content=function(){for(var e="",t=[],n=!1;"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return t.length?t.join(""):["","TK_EOF"];if(e=this.input.charAt(this.pos),this.pos++,this.line_char_count++,this.Utils.in_array(e,this.Utils.whitespace))t.length&&(n=!0),this.line_char_count--;else{if(n){if(this.line_char_count>=this.max_char){t.push("\n");for(var r=0;r<this.indent_level;r++)t.push(this.indent_string);this.line_char_count=0}else t.push(" "),this.line_char_count++;n=!1}t.push(e)}}return t.length?t.join(""):""},this.get_contents_to=function(e){if(this.pos==this.input.length)return["","TK_EOF"];var t="",n=new RegExp("</"+e+"\\s*>","igm");n.lastIndex=this.pos;var r=n.exec(this.input),i=r?r.index:this.input.length;return this.pos<i&&(t=this.input.substring(this.pos,i),this.pos=i),t},this.record_tag=function(e){this.tags[e+"count"]?(this.tags[e+"count"]++,this.tags[e+this.tags[e+"count"]]=this.indent_level):(this.tags[e+"count"]=1,this.tags[e+this.tags[e+"count"]]=this.indent_level),this.tags[e+this.tags[e+"count"]+"parent"]=this.tags.parent,this.tags.parent=e+this.tags[e+"count"]},this.retrieve_tag=function(e){if(this.tags[e+"count"]){for(var t=this.tags.parent;t&&e+this.tags[e+"count"]!==t;)t=this.tags[t+"parent"];t&&(this.indent_level=this.tags[e+this.tags[e+"count"]],this.tags.parent=this.tags[t+"parent"]),delete this.tags[e+this.tags[e+"count"]+"parent"],delete this.tags[e+this.tags[e+"count"]],1==this.tags[e+"count"]?delete this.tags[e+"count"]:this.tags[e+"count"]--}},this.get_tag=function(){var e,t,n="",r=[],i=!1;do{if(this.pos>=this.input.length)return r.length?r.join(""):["","TK_EOF"];n=this.input.charAt(this.pos),this.pos++,this.line_char_count++,this.Utils.in_array(n,this.Utils.whitespace)?(i=!0,this.line_char_count--):("'"!==n&&'"'!==n||r[1]&&"!"===r[1]||(n+=this.get_unformatted(n),i=!0),"="===n&&(i=!1),r.length&&"="!==r[r.length-1]&&">"!==n&&i&&(this.line_char_count>=this.max_char?(this.print_newline(!1,r),this.line_char_count=0):(r.push(" "),this.line_char_count++),i=!1),"<"===n&&(e=this.pos-1),r.push(n))}while(">"!==n);var o,a=r.join("");o=-1!=a.indexOf(" ")?a.indexOf(" "):a.indexOf(">");var l=a.substring(1,o).toLowerCase();if("/"===a.charAt(a.length-2)||this.Utils.in_array(l,this.Utils.single_token))this.tag_type="SINGLE";else if("script"===l)this.record_tag(l),this.tag_type="SCRIPT";else if("style"===l)this.record_tag(l),this.tag_type="STYLE";else if(this.Utils.in_array(l,s)){var c=this.get_unformatted("</"+l+">",a);r.push(c),e>0&&this.Utils.in_array(this.input.charAt(e-1),this.Utils.whitespace)&&r.splice(0,0,this.input.charAt(e-1)),t=this.pos-1,this.Utils.in_array(this.input.charAt(t+1),this.Utils.whitespace)&&r.push(this.input.charAt(t+1)),this.tag_type="SINGLE"}else if("!"===l.charAt(0))if(-1!=l.indexOf("[if")){if(-1!=a.indexOf("!IE")){c=this.get_unformatted("--\x3e",a);r.push(c)}this.tag_type="START"}else if(-1!=l.indexOf("[endif"))this.tag_type="END",this.unindent();else if(-1!=l.indexOf("[cdata[")){c=this.get_unformatted("]]>",a);r.push(c),this.tag_type="SINGLE"}else{c=this.get_unformatted("--\x3e",a);r.push(c),this.tag_type="SINGLE"}else"/"===l.charAt(0)?(this.retrieve_tag(l.substring(1)),this.tag_type="END"):(this.record_tag(l),this.tag_type="START"),this.Utils.in_array(l,this.Utils.extra_liners)&&this.print_newline(!0,this.output);return r.join("")},this.get_unformatted=function(e,t){if(t&&-1!=t.toLowerCase().indexOf(e))return"";var n="",r="",i=!0;do{if(this.pos>=this.input.length)return r;if(n=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(n,this.Utils.whitespace)){if(!i){this.line_char_count--;continue}if("\n"===n||"\r"===n){r+="\n",this.line_char_count=0;continue}}r+=n,this.line_char_count++,i=!0}while(-1==r.toLowerCase().indexOf(e));return r},this.get_token=function(){var e;if("TK_TAG_SCRIPT"===this.last_token||"TK_TAG_STYLE"===this.last_token){var t=this.last_token.substr(7);return"string"!=typeof(e=this.get_contents_to(t))?e:[e,"TK_"+t]}return"CONTENT"===this.current_mode?"string"!=typeof(e=this.get_content())?e:[e,"TK_CONTENT"]:"TAG"===this.current_mode?"string"!=typeof(e=this.get_tag())?e:[e,"TK_TAG_"+this.tag_type]:void 0},this.get_full_indent=function(e){return(e=this.indent_level+e||0)<1?"":Array(e+1).join(this.indent_string)},this.printer=function(e,t,n,r,i){this.input=e||"",this.output=[],this.indent_character=t,this.indent_string="",this.indent_size=n,this.brace_style=i,this.indent_level=0,this.max_char=r,this.line_char_count=0;for(var o=0;o<this.indent_size;o++)this.indent_string+=this.indent_character;this.print_newline=function(e,t){if(this.line_char_count=0,t&&t.length){if(!e)for(;this.Utils.in_array(t[t.length-1],this.Utils.whitespace);)t.pop();t.push("\n");for(var n=0;n<this.indent_level;n++)t.push(this.indent_string)}},this.print_token=function(e){this.output.push(e)},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}},this},n.printer(e,i,r,o,a);;){var l=n.get_token();if(n.token_text=l[0],n.token_type=l[1],"TK_EOF"===n.token_type)break;switch(n.token_type){case"TK_TAG_START":n.print_newline(!1,n.output),n.print_token(n.token_text),n.indent(),n.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":n.print_newline(!1,n.output),n.print_token(n.token_text),n.current_mode="CONTENT";break;case"TK_TAG_END":if("TK_CONTENT"===n.last_token&&""===n.last_text){var c=n.token_text.match(/\w+/)[0],p=n.output[n.output.length-1].match(/<\s*(\w+)/);null!==p&&p[1]===c||n.print_newline(!0,n.output)}n.print_token(n.token_text),n.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var h=n.token_text.match(/^\s*<([a-z]+)/i);h&&n.Utils.in_array(h[1],s)||n.print_newline(!1,n.output),n.print_token(n.token_text),n.current_mode="CONTENT";break;case"TK_CONTENT":""!==n.token_text&&n.print_token(n.token_text),n.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(""!==n.token_text){n.output.push("\n");var u=n.token_text;if("TK_SCRIPT"==n.token_type)var d="function"==typeof js_beautify&&js_beautify;else if("TK_STYLE"==n.token_type)d="function"==typeof css_beautify&&css_beautify;if("keep"==t.indent_scripts)var g=0;else if("separate"==t.indent_scripts)g=-n.indent_level;else g=1;var m=n.get_full_indent(g);if(d)u=d(u.replace(/^\s*/,m),t);else{var f=u.match(/^\s*/)[0].match(/[^\n\r]*$/)[0].split(n.indent_string).length-1,_=n.get_full_indent(g-f);u=u.replace(/^\s*/,m).replace(/\r\n|\r|\n/g,"\n"+_).replace(/\s*$/,"")}u&&(n.print_token(u),n.print_newline(!0,n.output))}n.current_mode="TAG"}n.last_token=n.token_type,n.last_text=n.token_text}return n.output.join("")}export function localStorageGet(e,t=""){try{return null===localStorage.getItem(e)?t:JSON.parse(localStorage.getItem(e))}catch(e){return!1}}export function mimeTypeToName(e){let t=e.split("/");switch(t[1]){case"msword":return".doc";case"application/vnd.ms-excel":return".xls";case"vnd.ms-powerpoint":return".ppt";case"vnd.openxmlformats-officedocument.wordprocessingml.document":return".docx";case"vnd.openxmlformats-officedocument.spreadsheetml.sheet":return".xlsx";case"vnd.openxmlformats-officedocument.presentationml.presentation":return".pptx";case"mpeg":return".mp3";case"svg+xml":return".svg";case"markdown":return".md";case"plain":return"text";case"text":return".txt";case"rtf":case"gif":case"jpeg":case"jpg":case"png":case"webm":case"webp":case"html":case"htm":case"zip":case"csv":case"pdf":case"mp4":return`.${t[1]}`}return"file"}export function localStorageSet(e,t){try{return localStorage.setItem(e,JSON.stringify(t))}catch(e){return!1}}export function localStorageDelete(e){try{return localStorage.removeItem(e)}catch(e){return!1}}function validURL(e){let t;try{t=new URL(e)}catch(t){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}return"https:"===t.protocol}function valueMapTransform(e,t){let n=[];return t&&e.forEach((e=>{let r={};for(var i in t){let n=t[i];if(!0===n||!1===n||null===n)r[i]=n;else if("function"==typeof n)try{r[i]=n(e)}catch(e){console.warn(e)}else"string"==typeof n&&varExists(e,n)?r[i]=varGet(e,n):r[i]=n}n.push(r)})),n}function camelToDash(e){return e.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()}function dashToCamel(e){return e.replace(/-([a-z])/g,(function(e){return e[1].toUpperCase()}))}function haxElementToNode(e){let t=e.tag,n=e.content?e.content:"",r=e.properties?e.properties:{};globalThis.HaxStore&&globalThis.HaxStore.instance&&globalThis.HaxStore.instance._isSandboxed&&"iframe"===t&&(t="webview");var i=globalThis.document.createElement(t);i.innerHTML=n;var o=i.cloneNode(!0);for(var a in r){if("innerHTML"===a||"innerText"===a)continue;let e=camelToDash(a);r.hasOwnProperty(a)&&-1===badJSEventAttributes.indexOf(a)&&(!0===r[a]?o.setAttribute(e,r[a]):!1===r[a]?o.removeAttribute(e):null!=r[a]&&r[a].constructor===Array?i.properties&&i.properties[a]&&i.properties[a].readOnly||(o.set?o.set(e,r[a]):o[e]=[...r[a]]):null!=r[a]&&r[a].constructor===Object?i.properties&&i.properties[a]&&i.properties[a].readOnly||(o.set?o.set(e,r[a]):o[e]={...r[a]}):o.setAttribute(e,r[a]))}return o}function camelCaseToDash(e){return e.replace(/([A-Z])/g,(e=>`-${e[0].toLowerCase()}`))}function encapScript(e){return e&&"function"==typeof e.replace&&(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<script[\s\S]*?>/gi,"&lt;script&gt;")).replace(/<\/script>/gi,"&lt;/script&gt;")).replace(/<hax-(body|tray|store)[\s\S]*?>/gi,"")).replace(/<\/hax-(body|tray|store)[\s\S]*?>/gi,"")).replace(/<h-a-x[\s\S]*?>/gi,"")).replace(/<\/h-a-x*?>/gi,"")).replace(/<style[\s\S]*?>/gi,"&lt;style&gt;")).replace(/<\/style>/gi,"&lt;/style&gt;")).replace(/<template[\s\S]*?>[\s\S]*?&lt;script[\s\S]*?&gt;[\s\S]*?&lt;\/script&gt;/gi,(function(e,t,n,r){return e=(e=(e=(e=e.replace("&lt;script&gt;","<script>")).replace("&lt;/script&gt;","<\/script>")).replace("&lt;style&gt;","<style>")).replace("&lt;/style&gt;","</style>")}))),e}function findTagsInHTML(e){let t={},n="";var r=e.match(/<\/([a-z,0-9]*?)-(\S*?)>/g);for(var i in r)n=r[i].replace("</","").replace(">",""),t[n]=n;return t}function wipeSlot(e,t="*"){if("*"===t)for(;null!==e.firstChild;)e.removeChild(e.firstChild);else for(var n in e.childNodes)void 0!==e.childNodes[n]&&e.childNodes[n].slot===t&&e.removeChild(e.childNodes[n])}function generateResourceID(e="#"){function idPart(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e+idPart()+idPart()+"-"+idPart()+"-"+idPart()+"-"+idPart()+"-"+idPart()+idPart()+idPart()}export function utf2Html(e){return[...e].map((e=>e.codePointAt()>127?`&#${e.codePointAt()};`:e)).join("")}export function htmlEntities(e){return e.replace(/[\u00A0-\u9999<>\&]/gim,(function(e){return"&#"+e.charCodeAt(0)+";"}))}function stripMSWord(e){var t=e.split("\n\r").join("\n").split("\r").join("\n").split("\n\n").join("\n").split("\n\n").join("\n").split("\n\n").join("\n").split("\n").join(" ").replace(/( class=(")?Mso[a-zA-Z]+(")?)/g,"");t=(t=(t=(t=t.replace(/<\!--(\s|.)*?-->/gim,"")).replace(/<\!(\s|.)*?>/gim,"")).replace(/<(\/)*(meta|link|title|html|head|body|font|br|\\\\?xml:|xml|st1:|o:|w:|m:|v:)(\s|.)*?>/gim,"")).replace(/<span[^>]*>([\s\S]*?)<\/span>/gim,"$1");var n=["style","script","applet","embed","noframes","noscript"];for(var r in n){let e=new RegExp("<"+n[r]+"(s|.)*?"+n[r]+"(.*?)>","gim");t=t.replace(e,"")}for(var r in t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/ style='(\s|.)*?'/gim,"")).replace(/ style="(\s|.)*?"/gim,"")).replace(/ face="(\s|.)*?"/gim,"")).replace(/ align=.*? /g,"")).replace(/ start='.*?'/g,"")).replace(/line-height:.*?\"/g,'"')).replace(/line-height:.*?;/g,"")).replace(/font-weight:normal;/g,"")).replace(/text-decoration:none;/g,"")).replace(/margin-.*?:.*?\"/g,'"')).replace(/margin-.*?:.*?;/g,"")).replace(/ style=""/g,"")).replace(/ id="(\s|.)*?"/gim,"")).replace(/ dir="(\s|.)*?"/gim,"")).replace(/ role="(\s|.)*?"/gim,"")).replace(/ contenteditable="(\s|.)*?"/gim,"")).replace(/ data-(\s|.)*?"(\s|.)*?"/gim,"")).replace(/ class="(\s|.)*?"/gim,"")).replace(/<pstyle/gm,"<p style")).replace(/<a name=\"_GoBack\"><\/a>/gm,"")).replace(/&nbsp;/gm," ")).replace(/<section>/gm,"<p>")).replace(/<\/section>/gm,"</p>")).replace(/<p><p>/gm,"<p>")).replace(/<p><p>/gm,"<p>")).replace(/<\/p><\/p>/gm,"</p>")).replace(/<\/p><\/p>/gm,"</p>")).replace(/<br \/>/gm,"<br/>")).replace(/<p><br \/><b>/gm,"<p><b>")).replace(/<\/p><br \/><\/b>/gm,"</p></b>")).replace(/<b><p>/gm,"<p>")).replace(/<\/p><\/b>/gm,"</p>")).replace(/<b>/gm,"<strong>")).replace(/<\/b>/gm,"</strong>")).replace(/<p style=\".*?\">/gm,"<p>")).replace(/<ul style=\".*?\">/gm,"<ul>")).replace(/<ol style=\".*?\">/gm,"<ol>")).replace(/<li style=\".*?\">/gm,"<li>")).replace(/<td style=\".*?\">/gm,"<td>")).replace(/<tr style=\".*?\">/gm,"<tr>")).replace(/<li><p>/gm,"<li>")).replace(/<\/p><\/li>/gm,"</li>")).replace(/<b><ul>/gm,"<ul>")).replace(/<\/ul><\/b>/gm,"</ul>")).replace(/<b><ol>/gm,"<ol>")).replace(/<\/ol><\/b>/gm,"</ol>")).replace(/<span><p>/gm,"<p>")).replace(/<\/p><\/span>/gm,"</p>")).replace(/<p>(\s*)<\/p>/gm," ")).replace(/<p><\/p>/gm,"")).replace(/<p>&nbsp;<\/p>/gm," ")).replace(/<p><br\/><\/p>/gm,"")).replace(/<p><br><\/p>/gm,"")).replace(/<\/p>(\s*)<p>/gm,"</p><p>")).replace(/ data-hax-ray="(\s|.)*?"/gim,"")).replace(/ class=""/gim,"")).replace(/ class="hax-active"/gim,"")).replace(/ contenteditable="(\s|.)*?"/gim,"")).replace(/ t="(\s|.)*?"/gim,""),n){let e=new RegExp("<"+n[r]+"></"+n[r]+">","gi");t=t.replace(e,"")}return t=t.trim()}function detectMarkdown(e){if(!e||"string"!=typeof e)return!1;const t=e.replace(/<[^>]*>/g,"").trim(),n=[/^#{1,6}\s+.+$/m,/^```[\s\S]*?```$/m,/^\|.+\|.+\|.*$/m,/^>\s+.+$/m,/^\s*\*{3,}\s*$/m,/^\s*-{3,}\s*$/m,/^\s*_{3,}\s*$/m];for(const e of n)if(e.test(t))return!0;const r=[/^\s*[-*+]\s+.+$/m,/^\s*\d+\.\s+.+$/m,/\*\*[^*]+\*\*/,/(?<!\*)\*[^*]+\*(?!\*)/,/\[.+?\]\(.+?\)/,/!\[.*?\]\(.+?\)/,/`[^`\n]+`/,/^\s{4,}.+$/m];let i=0;for(const e of r)e.test(t)&&i++;return i>=2}async function markdownToHTML(e){try{const t=await import("./lib/marked.js"),{marked:n}=t;return n.parse(e)}catch(t){return console.warn("Failed to parse markdown, falling back to original text:",t),e}}function varExists(e,t){return"__failedToFind__"!=objectValFromStringPos(e,t,"__failedToFind__")}function varGet(e,t,n=""){return objectValFromStringPos(e,t,n)}function objectValFromStringPos(e,t,n=null){for(var r=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),i=0,o=r.length;i<o;++i){var a=r[i];if(!e)return n;if(!(a in e))return n;e=e[a]}return e}async function nodeToHaxElement(e,t="insert-element"){if(!e)return null;var n={};let r;if(void 0!==e.style&&(n.style=e.getAttribute("style")),null!==n.style&&"null"!==n.style||delete n.style,void 0!==e.attributes.class&&(n.class=e.attributes.class.value.replace("hax-active","")),void 0!==e.attributes.id&&(n.id=e.getAttribute("id")),customElements.get(e.tagName.toLowerCase())&&(r=customElements.get(e.tagName.toLowerCase()).properties),void 0===r&&(r=e.__data),void 0!==r){for(var i in r)"class"!=i&&"style"!=i&&r.hasOwnProperty(i)&&void 0!==typeof e[i]&&null!=e[i]&&""!=e[i]?n[i]=e[i]:!1===e[i]?n[i]=!1:!0===e[i]?n[i]=!0:0===e[i]&&(n[i]=0);for(var o in e.attributes)(void 0!==e.attributes[o].name&&"class"!=e.attributes[o].name&&"style"!=e.attributes[o].name&&"id"!=e.attributes[o].name&&e.attributes.hasOwnProperty(o)&&void 0!==typeof e.attributes[o].value&&null!=e.attributes[o].value&&""!=e.attributes[o].value&&!r.hasOwnProperty(dashToCamel(e.attributes[o].name))||"0"==e.attributes[o].value)&&(n[e.attributes[o].name]=e.attributes[o].value)}else for(var o in e.attributes)void 0!==e.attributes[o].name&&"class"!=e.attributes[o].name&&"style"!=e.attributes[o].name&&"id"!=e.attributes[o].name&&e.attributes.hasOwnProperty(o)&&void 0!==typeof e.attributes[o].value&&null!=e.attributes[o].value&&""!=e.attributes[o].value&&(n[e.attributes[o].name]=e.attributes[o].value);let a=e.tagName.toLowerCase();globalThis.HaxStore&&globalThis.HaxStore.instance&&globalThis.HaxStore.instance._isSandboxed&&"iframe"===a&&(a="webview");let s="";s=globalThis.HaxStore&&globalThis.HaxStore.instance?await globalThis.HaxStore.instance.getHAXSlot(e):e.innerHTML,""==s&&(s=e.innerText),"a"===a||"mark"===a||"abbr"===a?n.innerText=s:"p"!==a&&"table"!==a&&"ol"!==a&&"ul"!==a&&"div"!==a||(n.innerHTML=s);let l={tag:a,properties:n,content:s};return null!==t&&(l.eventName=t),l}export const winEventsElement=function(e){return class extends e{__applyWinEvents(e){if(this.__winEvents)for(var t in this.__winEvents)window[(e?"add":"remove")+"EventListener"](t,this[this.__winEvents[t]])}connectedCallback(){for(var e in super.connectedCallback&&super.connectedCallback(),this.__winEvents)this[this.__winEvents[e]]=this[this.__winEvents[e]].bind(this);this.__applyWinEvents(!0)}disconnectedCallback(){this.__applyWinEvents(!1),super.disconnectedCallback&&super.disconnectedCallback()}}};export{wrap,wrapAll,unwrap,formatHTML,validURL,valueMapTransform,haxElementToNode,dashToCamel,camelToDash,camelCaseToDash,encapScript,findTagsInHTML,wipeSlot,generateResourceID,stripMSWord,detectMarkdown,markdownToHTML,varExists,varGet,objectValFromStringPos,nodeToHaxElement};const e=globalThis.Node?[globalThis.Node.ELEMENT_NODE,globalThis.Node.TEXT_NODE,globalThis.Node.DOCUMENT_FRAGMENT_NODE]:[];function findNode(t,n,r){const i=n.childNodes||n.children;if(!i)return n;for(let n=0;n<i.length;++n){const a=i[r?n:i.length-1-n];if((o=a,e.includes(o.nodeType))&&t.containsNode(a,!0))return t.containsNode(a,!1)?a:findNode(t,a,r)}var o;return n}export function isElementInViewport(e,t={top:0,right:globalThis.innerWidth,bottom:globalThis.innerHeight,left:0}){var n=e.getBoundingClientRect();return n.top>=t.top&&n.left>=t.left&&n.bottom<=t.bottom&&n.right<=t.right}function containsNextElement(e,t,n){const r=t;for(;(t=walkFromNode(t,n))&&t.contains(r););return!!t&&(t instanceof Element&&e.containsNode(t,!0))}function walkFromNode(e,t){if(!t)return e.previousSibling||e.parentNode||null;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}return null}function initialSpace(e){return e.nodeType!==Node.TEXT_NODE?0:/^\s*/.exec(e.textContent)[0].length}const t=new Map;export function getRange(e){if(e.getSelection){const t=e.getSelection();return t.rangeCount?t.getRangeAt(0):null}const n=t.get(e);if(n)return n;const r=globalThis.getSelection().toString(),i=internalGetShadowSelection(e),o=i&&i.range&&i.range.toString()||null;return null!==o&&o!==r&&o.replace(/\s/g,"")!==r.replace(/\s/g,"")&&(console.warn("invalid range, initial text:",r),console.warn("vs",o,i.mode,i.range)),t.set(e,i.range),globalThis.setTimeout((()=>{t.delete(e)}),0),i.range}export function internalGetShadowSelection(e){const t=globalThis.document.createTextNode(""),n=globalThis.document.createRange(),r=globalThis.getSelection();if(r&&e.host&&!r.containsNode(e.host,!0))return{range:null,mode:"none"};e.insertBefore(t,e.childNodes[0]);const i=r.containsNode(t);if(t.remove(),i)return{range:null,mode:"outside-before"};e.appendChild(t);const o=r.containsNode(t);if(t.remove(),o)return{range:null,mode:"outside-after"};const measure=()=>r.toString().length;r.toString();if("None"===r.type)return null;if("Caret"!==r.type&&"Range"!==r.type)throw new TypeError("unexpected type: "+r.type);r.type;const a=findNode(r,e,!0);let s,l;if("Range"===r.type&&(s=findNode(r,e,!1),l=function getSelectionDirection(e,t,n){if("Range"!==e.type)return;const measure=()=>e.toString().length,r=measure();if(1===r&&t===n)return e.extend(t,0),void e.collapseToEnd();let i;return e.modify("extend","forward","character"),i=measure(),i>r||containsNextElement(e,n,!0)?(e.modify("extend","backward","character"),!0):i<r||!e.containsNode(t)?(e.modify("extend","backward","character"),!1):(e.modify("extend","backward","character"),i=measure(),i>r||containsNextElement(e,t,!1)?(e.modify("extend","forward","character"),!1):i<r||!e.containsNode(n)?(e.modify("extend","forward","character"),!0):void 0)}(r,a,s)),"Caret"===r.type){r.extend(a,0);const e=measure();return r.collapseToEnd(),1===a.nodeType&&a.childNodes&&a.childNodes.length>0?(n.setStart(a.childNodes[0],e),n.setEnd(a.childNodes[0],e)):(n.setStart(a,e),n.setEnd(a,e)),{range:n,mode:"caret"}}if(void 0===l){if("Range"!==r.type)throw new TypeError("unexpected type: "+r.type);return n.setStart(a.childNodes[0],0),n.setEnd(s,s.length),{range:n,mode:"all"}}const c=measure();let p,h;const u=s.length-function ignoredTrailingSpace(e){if(e.nodeType!==Node.TEXT_NODE)return 0;const t=/\s*$/.exec(e.textContent)[0].length;return t?t-1:0}(s);return l?(r.extend(a,0),p=measure()+initialSpace(a),r.extend(s,u),h=u-(measure()-c),r.extend(s,h)):(r.extend(s,u),h=u-measure(),r.extend(a,0),p=measure()-c+initialSpace(a),r.extend(a,p)),n.setStart(a,p),n.setEnd(s,h),{mode:l?"right":"left",range:n}}export function ReplaceWithPolyfill(){var e,t=this.parentNode,n=arguments.length;if(t)for(n||t.removeChild(this);n--;)"object"!=typeof(e=arguments[n])?e=this.ownerDocument.createTextNode(e):e.parentNode&&e.parentNode.removeChild(e),n?t.insertBefore(e,this.nextSibling):t.replaceChild(e,this)}