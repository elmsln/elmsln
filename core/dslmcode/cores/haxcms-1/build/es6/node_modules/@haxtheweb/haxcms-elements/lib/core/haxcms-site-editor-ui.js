import{html as e,css as t,unsafeCSS as a}from"../../../../lit/index.js";import{store as o}from"./haxcms-site-store.js";import{HAXStore as i}from"../../../hax-body/lib/hax-store.js";import{autorun as s,toJS as n}from"../../../../mobx/dist/mobx.esm.js";import{ResponsiveUtilityBehaviors as l}from"../../../responsive-utility/lib/responsive-utility-behaviors.js";import{localStorageSet as r,winEventsElement as d,validURL as c}from"../../../utils/utils.js";import"../../../simple-icon/simple-icon.js";import"../../../simple-icon/lib/simple-icons.js";import{HAXCMSThemeParts as p}from"./utils/HAXCMSThemeParts.js";import{HAXCMSI18NMixin as m}from"./utils/HAXCMSI18NMixin.js";import"../../../rpg-character/rpg-character.js";import"./ui/app-hax-top-bar.js";import"./ui/app-hax-user-menu.js";import"./ui/app-hax-user-menu-button.js";import{DDD as h}from"../../../d-d-d/d-d-d.js";import{SuperDaemonInstance as u}from"../../../super-daemon/super-daemon.js";import"../../../super-daemon/lib/super-daemon-search.js";import{MicroFrontendRegistry as g}from"../../../micro-frontend-registry/micro-frontend-registry.js";import{enableServices as b}from"../../../micro-frontend-registry/lib/microServices.js";import{UserScaffoldInstance as v}from"../../../user-scaffold/user-scaffold.js";import{HAXCMSKeyboardShortcutsInstance as x}from"./utils/HAXCMSKeyboardShortcuts.js";import"../../../simple-modal/simple-modal.js";import"../../../simple-toolbar/lib/simple-toolbar-button.js";import"./haxcms-site-insights.js";import"../../../simple-fields/lib/simple-fields-form.js";import"./micros/haxcms-button-add.js";import"./haxcms-darkmode-toggle.js";import"../ui-components/site/site-remote-content.js";import"../../../page-flag/page-flag.js";import"../../../../wired-elements/lib/wired-button.js";const y=new URL("../assets/images/Logout.svg",import.meta.url).href;class HAXCMSSiteEditorUI extends(p(m(d(l(h))))){static get styles(){return[super.styles,t`
        :host *:not(:defined) {
          display: none;
        }
        :host {
          display: block;
          position: relative;
          height: 48px;
          left: 0;
          top: 0;
          right: 0;
          margin-top: 0;
          opacity: 1;
          transition: all 0.6s ease-in-out;
          z-index: 10000;
          visibility: visible;
        }
        :host([edit-mode]) {
          z-index: 9999;
        }
        :host *[hidden] {
          display: none;
        }
        /* Ensure Add Page button is never visible while actively editing */
        :host([edit-mode]) #addpagebutton {
          display: none;
        }
        simple-tooltip:not(:defined) {
          display: none !important;
        }
        :host([painting]) {
          opacity: 0;
          margin-top: -48px;
          visibility: hidden;
        }
        #editbutton {
          visibility: hidden;
          opacity: 0;
        }

        #saveandeditbutton {
          visibility: hidden;
          opacity: 0;
        }

        :host([page-allowed]) #editbutton,
        :host([page-allowed]) #saveandeditbutton,
        :host([page-allowed]) #editdetails {
          visibility: visible;
          opacity: 1;
        }
        /* Ensure edit and save buttons are visible when in edit mode */
        :host([edit-mode]) #editbutton,
        :host([edit-mode]) #saveandeditbutton {
          visibility: visible;
          opacity: 1;
        }
        #saveandeditbutton,
        #editbutton {
          background-color: var(--ddd-theme-default-skyBlue);
          color: white; /* Ensure text is visible on blue background */
        }

        #merlin,
        .merlin {
          color: var(--ddd-theme-default-wonderPurple);
        }

        super-daemon-search.merlin {
          border: var(--ddd-border-xs);
        }

        :host([dark-mode]) #merlin,
        :host([dark-mode]) .merlin {
          color: white; /* Ensure text is visible on blue background */
        }

        #cancelbutton {
          background-color: var(--ddd-theme-default-discoveryCoral);
          color: white; /* Ensure text is visible on blue background */
        }
        haxcms-button-add {
          color: inherit;
          background-color: var(--simple-colors-default-theme-grey-1);
          --simple-toolbar-border-color: var(--ddd-theme-default-limestoneGray);
        }
        haxcms-button-add::part(button) {
          --simple-toolbar-button-border-width: 1px;
          border-bottom: 0;
        }

        simple-toolbar-menu-item a {
          color: var(--simple-colors-default-theme-grey-12);
          text-decoration: none;
        }
        simple-toolbar-menu-item simple-toolbar-button {
          --simple-toolbar-button-min-width: 100%;
        }

        simple-toolbar-button.top-bar-button::part(button) {
          --simple-toolbar-button-border-width: 1px;
          border-bottom: 0;
        }
        simple-toolbar-button.merlin:hover,
        simple-toolbar-button.merlin:active,
        simple-toolbar-button.merlin:focus {
          background-color: var(--simple-colors-default-theme-purple-1);
          color: light-dark(
            var(--ddd-theme-default-white),
            var(--ddd-theme-default-coalyGray)
          );
        }
        simple-toolbar-menu:hover,
        simple-toolbar-menu:active,
        simple-toolbar-menu:focus,
        simple-toolbar-button:not(.merlin):hover,
        simple-toolbar-button:not(.merlin):active,
        simple-toolbar-button:not(.merlin):focus,
        haxcms-button-add:hover,
        haxcms-button-add:active,
        haxcms-button-add:focus {
          color: var(--hax-ui-color);
          background-color: light-dark(
            var(--ddd-theme-default-white),
            var(--ddd-theme-default-coalyGray)
          );
        }
        simple-toolbar-button:hover,
        simple-toolbar-button:active,
        simple-toolbar-button:focus {
          --simple-toolbar-border-color: black;
        }
        :host(:hover),
        :host(:active),
        :host(:focus) {
          opacity: 1;
        }
        simple-tooltip {
          --simple-tooltip-background: #000000;
          --simple-tooltip-opacity: 1;
          --simple-tooltip-text-color: #ffffff;
          --simple-tooltip-delay-in: 0;
          --simple-tooltip-duration-in: 300ms;
          --simple-tooltip-duration-out: 0;
          --simple-tooltip-border-radius: 0;
          --simple-tooltip-font-size: 14px;
        }
        app-hax-top-bar {
          z-index: 1000;
          right: 8px;
          left: 8px;
          position: fixed;
          transition-delay: 0.9s;
          transition: all 0.9s ease-in-out;
        }
        app-hax-top-bar[edit-mode] {
          right: 0px;
          left: 0px;
        }
        :host([dark-mode]) app-hax-top-bar {
          --bg-color: #000;
          --accent-color: #fff;
        }
        app-hax-top-bar::part(top-bar) {
          grid-template-columns: 5% 85% 10%;
          overflow: visible;
        }
        .haxLogo {
          color: var(--simple-colors-default-theme-accent-11, black);
        }
        :host([dark-mode]) .haxLogo:hover,
        :host([dark-mode]) .haxLogo:focus,
        :host([dark-mode]) .haxLogo:active,
        .haxLogo:hover,
        .haxLogo:focus,
        .haxLogo:active {
          color: var(--haxcms-color);
        }
        .haxLogo simple-icon-lite {
          --simple-icon-height: 32px;
          --simple-icon-width: 32px;
          margin: 8px;
          transition: all 0.3s ease-in-out;
        }
        .soundToggle {
          position: relative;
          display: inline-flex;
          vertical-align: top;
        }

        .soundToggle img {
          width: 24px;
          height: 24px;
        }

        :host([edit-mode]) simple-toolbar simple-toolbar-button,
        :host([edit-mode]) simple-toolbar simple-toolbar-menu {
          --simple-toolbar-border-color: #dddddd;
        }

        simple-toolbar simple-toolbar-button,
        simple-toolbar simple-toolbar-menu {
          --simple-toolbar-border-radius: 0;
          background-color: var(--simple-colors-default-theme-grey-1);
        }

        app-hax-search-bar {
          vertical-align: middle;
          display: inline-flex;
        }
        .toolbar-buttons {
          display: flex;
          align-items: stretch;
          justify-content: center;
          height: var(--top-bar-height);
          gap: 0;
        }
        .toolbar-buttons simple-toolbar-button,
        .toolbar-buttons simple-toolbar-menu,
        .toolbar-buttons haxcms-button-add {
          min-width: 48px;
          --simple-toolbar-button-disabled-opacity: 0.3;
          --simple-toolbar-button-padding: 3px 6px;
          --simple-toolbar-border-radius: 0;
        }
        /* Visually indicate which HAX content tab is active (config / blocks / map / source) */
        .toolbar-buttons simple-toolbar-button[active] {
          --simple-icon-color: var(--ddd-theme-default-skyBlue);
        }
        .toolbar-buttons haxcms-button-add {
          background-color: var(--ddd-theme-default-skyBlue);
          color: white;
        }
        .toolbar-buttons simple-toolbar-menu {
          --a11y-menu-button-bg-color: light-dark(
            var(--ddd-theme-default-white),
            var(--ddd-theme-default-coalyGray)
          );
          --a11y-menu-button-list-bg-color: light-dark(
            var(--ddd-theme-default-white),
            var(--ddd-theme-default-coalyGray)
          );
          --a11y-menu-button-color: light-dark(
            var(--ddd-theme-default-coalyGray),
            var(--ddd-theme-default-white)
          );
        }
        simple-toolbar {
          align-items: stretch;
          justify-content: center;
          height: var(--top-bar-height);
          --simple-toolbar-button-disabled-border-color: transparent;
          --simple-toolbar-button-disabled-opacity: 0.3;
          --simple-toolbar-button-padding: 3px 6px;
        }
        simple-toolbar[dark-mode] {
          --simple-toolbar-button-color: #e0e0e0;
          --simple-toolbar-button-hover-color: #fff;
          --simple-toolbar-button-bg: #222;
          --simple-toolbar-button-hover-bg: #000;
        }
        simple-toolbar::part(buttons) {
          flex: 0 1 auto;
        }
        .ops-panel {
          justify-content: space-around;
          display: flex;
          padding: 4px 0px;
        }

        .topbar-character {
          cursor: pointer;
          display: inline-block;
          border: none;
          border-radius: 0px;
          padding: 0 8px;
          margin: 0 0 0 16px;
          background-color: transparent;
          height: 48px;
          max-width: 160px;
          overflow: hidden;
          word-break: break-all;
          transition: all 0.6 ease-in-out;
          color: #222;
        }
        .characterbtn-name {
          margin-left: 8px;
          font-size: 12px;
          vertical-align: bottom;
          line-height: 48px;
          overflow: hidden;
          text-overflow: ellipsis;
          height: 48px;
          word-break: break-all;
        }
        :host([dark-mode]) .topbar-character,
        :host([dark-mode]) .topbar-character {
          color: #e0e0e0;
          background-color: #222;
        }
        .topbar-character rpg-character {
          margin: -4px -14px 0px -10px;
          height: 52px;
          width: 64px;
          display: inline-block;
          transform: scale(0.7);
          transition: all 0.5 ease-in-out;
        }
        .topbar-character:hover rpg-character,
        .topbar-character:focus rpg-character {
          transform: scale(0.9);
        }

        .mysiteslink {
          text-decoration: none;
        }

        .logout::part(menu-button) {
          background-image: url("${a(y)}");
          background-repeat: no-repeat;
          background-position: center center;
          text-align: center;
          background-size: cover;
          border-top: 0px;
          border-bottom: 0px;
          padding: 10px;
        }
        app-hax-user-menu app-hax-user-menu-button::part(menu-button) {
          font-size: 12px;
        }
        simple-toolbar-menu,
        simple-toolbar-button {
          min-width: 48px;
          margin: 0;
          --simple-toolbar-border-color: var(--ddd-theme-default-limestoneGray);
        }
        simple-toolbar-menu-item.menu-item-delete simple-toolbar-button {
          border-top: var(--ddd-border-sm) solid
            var(--ddd-theme-default-limestoneGray);
          margin-top: var(--ddd-spacing-1);
          padding-top: var(--ddd-spacing-2);
        }
        simple-toolbar-menu-item.menu-item-delete simple-toolbar-button:hover {
          color: var(--ddd-theme-default-error);
          background-color: var(--ddd-theme-default-errorLight);
        }

        @media screen and (max-width: 800px) {
          :host([edit-mode]) {
            bottom: unset;
          }
          app-hax-top-bar::part(top-bar) {
            display: grid;
          }
          #undo,
          #redo {
            display: none;
          }
          .topbar-character {
            padding: 0;
            margin: 0;
          }
          .characterbtn-name {
            padding: 0;
            margin: 0;
            width: 30px;
            display: inline-flex;
            overflow: hidden;
            text-overflow: ellipsis;
            letter-spacing: -2px;
            margin-left: -6px;
          }
          simple-toolbar {
            --simple-toolbar-button-padding: 3px 3px;
          }
          .characterbtn-name,
          haxcms-button-add,
          simple-toolbar-menu,
          simple-toolbar-button {
            font-size: 10px;
          }
          simple-toolbar-menu {
            --icon-offset-right: 2px;
            --icon-offset-left: 2px;
          }
          simple-toolbar-menu::part(dropdown-icon) {
            right: 0;
            top: 10px;
          }
          :host([edit-mode]) #addmenubutton,
          :host([edit-mode]) #editdetails {
            display: none;
          }
        }
        @media (max-width: 600px) {
          .haxLogo {
            display: none;
          }

          .topbar-character rpg-character {
            margin: 0 0 0px -8px;
            height: 10px;
            width: 48px;
          }
          simple-toolbar {
            --simple-toolbar-button-padding: 0px;
            justify-content: space-between;
            background-color: white;
            height: auto;
          }
          .characterbtn-name {
            padding: 0px;
            margin: -42px 8px 0px 0px;
            width: 40px;
            display: block;
            text-overflow: ellipsis;
            font-size: 12px;
            font-family: auto;
            letter-spacing: normal;
            font-weight: normal;
          }
        }
      `]}static get tag(){return"haxcms-site-editor-ui"}_expandSettingsPanel(e){this.shadowRoot.querySelector("#content-edit").click()}selectFileToProcess(){import("../../../file-system-broker/file-system-broker.js").then((async e=>{const t=globalThis.FileSystemBroker.requestAvailability(),a=await t.getFileContents("*"),o=t.fileHandler;let i=o.name.split("."),s="";i.length>1&&(s=i.pop()),u.waveWand(["","/",{operation:"file-selected",contents:a,data:o,type:s},"hax-agent","Agent"],this.shadowRoot.querySelector("#merlin"),"coin2")}))}processUrlFromInput(e){const t=e.trim();this.isValidUrl(t)?u.waveWand(["","/",{operation:"url-selected",url:t,data:t},"hax-link-agent","Link Agent"],this.shadowRoot.querySelector("#merlin"),"coin2"):o.toast("Invalid URL provided",3e3,{hat:"construction"})}isValidUrl(e){try{return new URL(e),!0}catch(e){return!1}}detectUrlType(e){try{const t=new URL(e),a=t.hostname.toLowerCase(),o=t.pathname.toLowerCase(),i=t.search.toLowerCase();return a.includes("youtube.com")||a.includes("youtu.be")||a.includes("m.youtube.com")?"youtube":o.match(/\.(jpg|jpeg|png|gif|webp|svg|bmp)$/i)?"image":o.match(/\.(mp4|webm|ogg|mov|avi|wmv|flv)$/i)?"video":o.match(/\.pdf$/i)||i.includes(".pdf")?"pdf":o.match(/\.(mp3|wav|ogg|flac|aac|m4a)$/i)?"audio":"generic"}catch(e){return"generic"}}async processUrlContentsBasedOnUserDesire(e,t){const a=e.url;this.setProcessingVisual(),!1===o.editMode&&(o.editMode=!0),setTimeout((()=>{let s=null;switch(t){case"embed-youtube":const t=this.extractYouTubeId(a);t&&(s=i.activeHaxBody.haxInsert("video-player","",{source:`https://www.youtube.com/watch?v=${t}`,"source-type":"youtube"}));break;case"insert-image":s=i.activeHaxBody.haxInsert("img","",{src:a,alt:"Image from URL",loading:"lazy"});break;case"embed-pdf":s=i.activeHaxBody.haxInsert("iframe","",{src:a,width:"100%",height:"500px",frameborder:"0"});break;case"embed-video":s=i.activeHaxBody.haxInsert("video","",{src:a,controls:!0,width:"100%"});break;case"insert-rich-link":case"insert-simple-link":default:s=i.activeHaxBody.haxInsert("a",a,{href:a,target:"_blank",rel:"noopener"});break;case"hax-default":const n={source:a,title:e.title||a};if(i.insertLogicFromValues(n,i,!1,!0))return;s=i.activeHaxBody.haxInsert("a",a,{href:a,target:"_blank",rel:"noopener"});break;case"apply-to-selected-text":const l=globalThis.getSelection();if(l&&!l.isCollapsed){const e=l.getRangeAt(0),t=l.toString().trim();if(t&&e){const i=globalThis.document.createElement("a");return i.setAttribute("href",a),i.setAttribute("target","_blank"),i.setAttribute("rel","noopener noreferrer"),i.textContent=t,e.deleteContents(),e.insertNode(i),setTimeout((()=>{e.setStartAfter(i),e.setEndAfter(i),l.removeAllRanges(),l.addRange(e)}),0),void o.toast("Link applied to selected text!",3e3,{hat:"construction",walking:!0})}}s=i.activeHaxBody.haxInsert("a",a,{href:a,target:"_blank",rel:"noopener"})}s&&o.toast("URL processed successfully!",3e3,{hat:"construction",walking:!0})}),300)}extractYouTubeId(e){const t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);return t&&11===t[2].length?t[2]:null}setProcessingVisual(){let e=globalThis.document.createElement("simple-icon-lite");e.icon="hax:loading",e.style.setProperty("--simple-icon-height","40px"),e.style.setProperty("--simple-icon-width","40px"),e.style.marginLeft="8px",o.toast("Processing",5e3,{hat:"construction",speed:150,walking:!0,slot:e})}csvToHtmlTable(e){try{const t=globalThis.document.createElement("table"),a=globalThis.document.createElement("tbody");t.appendChild(a);const o=[];let i=0,s="",n=[],l=!1;const pushField=()=>{let e=s;e.length>0&&'"'===e[0]&&'"'===e[e.length-1]&&(e=e.substring(1,e.length-1).replace(/""/g,'"')),n.push(e),s=""};for(;i<e.length;){const t=e[i];if(l){if('"'===t){if('"'===e[i+1]){s+='"',i+=2;continue}l=!1,i++;continue}s+=t,i++}else'"'!==t?","!==t?"\n"!==t&&"\r"!==t?(s+=t,i++):("\r"===t&&"\n"===e[i+1]?i+=2:i++,pushField(),o.push(n),n=[]):(pushField(),i++):(l=!0,i++)}return pushField(),n.length>0&&o.push(n),o.forEach(((e,t)=>{if(1===e.length&&""===e[0].trim())return;const o=globalThis.document.createElement("tr");e.forEach((e=>{const a=0===t?globalThis.document.createElement("th"):globalThis.document.createElement("td"),i=globalThis.document.createElement("span");i.textContent=e,a.appendChild(i),o.appendChild(a)})),a.appendChild(o)})),t.setAttribute("border","1"),t.style.width="100%",t.style.borderCollapse="collapse",t}catch(e){return console.warn("CSV to table conversion failed:",e),null}}async processFileContentsBasedOnUserDesire(e,t,a){n(v.data).event;switch(this.setProcessingVisual(),t){case"set-page-media":this.dispatchEvent(new CustomEvent("hax-file-upload",{bubbles:!0,cancelable:!0,composed:!0,detail:{file:e.data,placeHolderElement:null,operationType:"upload-only",callback:e=>{const t=n(o.activeItem);t&&t.id&&e&&e.file&&(globalThis.dispatchEvent(new CustomEvent("haxcms-save-node-details",{bubbles:!0,composed:!0,cancelable:!0,detail:{id:t.id,operation:"setMedia",media:e.file}})),o.toast("Page media updated successfully!",3e3,{hat:"construction",walking:!0}))}}}));break;case"upload":case"link":case"insert-file":"upload"===t?this.dispatchEvent(new CustomEvent("hax-file-upload",{bubbles:!0,cancelable:!0,composed:!0,detail:{file:e.data,placeHolderElement:null,operationType:a}})):"link"===t?(!1===o.editMode&&(o.editMode=!0),setTimeout((()=>{let t=i.activeHaxBody.haxInsert("p","",{});this.dispatchEvent(new CustomEvent("hax-file-upload",{bubbles:!0,cancelable:!0,composed:!0,detail:{file:e.data,placeHolderElement:t,operationType:a}}))}),300)):(!1===o.editMode&&(o.editMode=!0),setTimeout((()=>{let t=i.activeHaxBody.haxInsert("p","",{});this.dispatchEvent(new CustomEvent("hax-file-upload",{bubbles:!0,cancelable:!0,composed:!0,detail:{file:e.data,placeHolderElement:t,operationType:a}}))}),300));break;case"insert-table":case"insert-csv":let s=new FormData;s.append("upload",e.data),!1===o.editMode&&(o.editMode=!0);try{const e=await g.call("@core/xlsxToCsv",s);if(200===e.status){const a=e.data.contents;setTimeout((()=>{if("insert-table"===t){const e=this.csvToHtmlTable(a);e&&(i.activeHaxBody.haxInsert("table",e.innerHTML,{}),o.toast("Excel converted to table successfully!",3e3,{hat:"construction",walking:!0}))}else{i.activeHaxBody.haxInsert("pre",a,{});o.toast("Excel converted to CSV text!",3e3,{hat:"construction",walking:!0})}}),300)}else o.toast(`Error converting Excel file: ${e.data.error||"Unknown error"}`,4e3,{hat:"construction"})}catch(e){console.error("Excel conversion error:",e),o.toast(`Error processing Excel file: ${e.message}`,4e3,{hat:"construction"})}break;case"insert-html":case"create-sibling":case"create-child":case"create-branch":let l=null,r=new FormData;switch(e.type){case"docx":case"doc":if(r.append("upload",e.data),l="@core/docxToHtml","create-branch"===t){l="@haxcms/docxToSite",r.append("method","branch"),r.append("type","branch");const e=n(o.activeItem);r.append("parentId",e.parent)}break;case"md":case"txt":l="@core/mdToHtml",r={md:e.contents}}let d={};if(l){if("insert-html"===t)d=await g.call(l,r),200==d.status&&this.insertElementsFromContentBlob(d.data.contents||d.data);else if(d=await g.call(l,r),200==d.status)if(["create-sibling","create-child"].includes(t))this.createNewNode(t.replace("create-",""),e.data.name,d.data.contents||d.data);else if(d.data&&""!=d.data.contents){let e={};e.items=d.data.items,await import("../../../outline-designer/outline-designer.js").then((async t=>{e.jwt=n(o.jwt),e.site={name:n(o.manifest.metadata.site.name)};const a=globalThis.document.createElement("outline-designer");a.items=d.data.items,a.eventData=e,a.storeTools=!0;const i=globalThis.document.createElement("button");i.innerText="Confirm",i.classList.add("hax-modal-btn"),i.addEventListener("click",(async e=>{const t=await a.getData();let i=0,s=0,n=0;t.items.map((e=>{e.delete?i++:e.new?n++:e.modified&&s++}));let l=`${n>0?`‣ ${n} new pages will be created\n`:""}${s>0?`‣ ${s} pages will be updated\n`:""}${i>0?`‣ ${i} pages will be deleted\n`:""}`,r=!1;if(r=""==l||globalThis.confirm(`Saving will commit the following actions:\n${l}\nAre you sure?`),r){o.cmsSiteEditorAvailability().querySelector("#createajax").body=t,this.setProcessingVisual(),o.cmsSiteEditorAvailability().querySelector("#createajax").generateRequest();const e=new CustomEvent("simple-modal-hide",{bubbles:!0,composed:!0,cancelable:!0,detail:{}});globalThis.dispatchEvent(e)}}));const s=globalThis.document.createElement("button");s.innerText="Cancel",s.classList.add("hax-modal-btn"),s.classList.add("cancel"),s.addEventListener("click",(e=>{const t=new CustomEvent("simple-modal-hide",{bubbles:!0,composed:!0,cancelable:!0,detail:{}});globalThis.dispatchEvent(t)}));const l=globalThis.document.createElement("div");l.appendChild(i),l.appendChild(s),this.dispatchEvent(new CustomEvent("simple-modal-show",{bubbles:!0,cancelable:!0,composed:!0,detail:{title:"Confirm structure",elements:{content:a,buttons:l},modal:!0,styles:{"--simple-modal-titlebar-background":"transparent","--simple-modal-titlebar-color":"light-dark(black, white)","--simple-modal-width":"90vw","--simple-modal-min-width":"300px","--simple-modal-z-index":"100000000","--simple-modal-height":"90vh","--simple-modal-min-height":"400px","--simple-modal-titlebar-height":"80px"}}}))}))}}else"insert-html"===t?this.insertElementsFromContentBlob(e.contents):"create-branch"!==t&&this.createNewNode(t.replace("create-",""),e.data.name,e.contents)}}async createNewNode(e,t="New page",a="<p></p>"){let i=null,s=null;const l=n(o.activeItem);if(l)if("sibling"===e)s=l.parent,i=parseInt(l.order);else if("child"===e){s=l.id;let e=n(await o.getLastChildItem(l.id)).order;i=0,(e||0===e)&&(i=e+1)}else s=null,i=0;""==t&&(t="New page");var r={node:{title:t,location:"",contents:a},order:i,parent:s};this.dispatchEvent(new CustomEvent("haxcms-create-node",{bubbles:!0,composed:!0,cancelable:!0,detail:{originalTarget:this,values:r}}))}insertElementsFromContentBlob(e){let t=!1;!1===o.editMode?(o.editMode=!0,t=!0):this.activeNode.hasAttribute("slot")&&(s=this.activeNode.getAttribute("slot"));const a=globalThis.document.createElement("div");a.innerHTML=e;let s=!1;if(!t&&this.activeNode&&this.activeNode.parentNode)for(var n=a.children.length-1;n>0;n--)s&&a.children[n].setAttribute("slot",s),this.activeNode.parentNode.insertBefore(a.children[n],this.activeNode.nextSibling);else setTimeout((()=>{for(var e=a.children.length-1;e>0;e--)i.activeHaxBody.appendChild(a.children[e]);setTimeout((()=>{i.activeHaxBody.scrollHere(this.activeNode),setTimeout((()=>{i.activeHaxBody.scrollHere(this.activeNode)}),500)}),1e3)}),300);i.toast(this.t.contentImported)}async insertUrl(e,t){if(!1===o.editMode&&(o.editMode=!0),t){const t=await g.call("@core/websiteMetadata",{q:e});if(t.data&&(t.data["og:title"]||t.data.title)){let a={title:t.data["og:title"]||t.data.title,source:e};i.insertLogicFromValues(a,this)}}}generateSlugFromTitle(e){return e.toLowerCase().split(" ").join("-").replace(/[^0-9\-\/a-z]/gi,"")}async getPageTemplates(){try{const e=globalThis.document.querySelector("haxcms-site-builder");if(!e)return console.warn("getPageTemplates: No haxcms-site-builder found"),[];const t=await o.loadStyleGuideContent();if(!t)return console.warn("getPageTemplates: No style guide content found"),[];const a=await e.htmlToHaxElements(t),i=[];for(const e of a)if(e&&"page-template"===e.tag){const t=e.properties&&e.properties.schema,a=e.properties&&e.properties.name,o=e.properties&&(e.properties["data-haxsg-id"]||e.properties.id);if("page"===t&&a&&e.content){const t={id:o||`template-${i.length}`,name:a,content:e.content};i.push(t)}}return i}catch(e){return console.warn("Failed to get page templates:",e),[]}}async createPageWithTitle(e,t,a=null){const s=globalThis.SuperDaemonManager&&globalThis.SuperDaemonManager.requestAvailability();s&&"create-page"===s.programName&&s.value&&""!==s.value.trim()&&(e=s.value.trim());let l=null,r=null;const d=n(o.activeItem);if(d)if("sibling"===t)r=d.parent,l=parseInt(d.order)+1;else if("child"===t){r=d.id;let e=n(await o.getLastChildItem(d.id));l=0,e.order&&(l=parseInt(e.order)+1)}else"duplicate"===t&&(r=d.parent,l=parseInt(d.order)+1);const c=this.generateSlugFromTitle(e),p={node:{title:e,location:o.getUniqueSlugName(c)},order:l,parent:r,merlinCreated:!0};"duplicate"===t&&d&&(p.node.duplicate=d.id),a&&(p.node.contents=a),this.dispatchEvent(new CustomEvent("haxcms-create-node",{bubbles:!0,composed:!0,cancelable:!0,detail:{originalTarget:this,values:p}}));let m=`Page "${e}" created successfully!`;"child"===t?m=`Child page "${e}" created successfully!`:"duplicate"===t&&(m=`Page "${e}" duplicated successfully!`),a&&(m+=" Template applied."),o.playSound("success"),i.toast(m),s.close()}async movePageUnderParent(e,t){if(!e)return void o.toast("Error: No page to move",3e3,{fire:!0});if(!await o.findItem(e))return void o.toast("Error: Page not found",3e3,{fire:!0});let a=0;if(t){const e=n(await o.getLastChildItem(t));e&&(e.order||0===e.order)&&(a=parseInt(e.order)+1)}else{const e=n(await o.getLastChildItem(null));e&&(e.order||0===e.order)&&(a=parseInt(e.order)+1)}o.playSound("click"),globalThis.dispatchEvent(new CustomEvent("haxcms-save-node-details",{bubbles:!0,composed:!0,cancelable:!0,detail:{id:e,operation:"setParent",parent:t,order:a}}));const i=t?(await o.findItem(t)).title:"Root Level";o.toast(`Page moved under "${i}"`,3e3,{hat:"construction",walking:!0}),u.close()}constructor(){super(),this.__winEvents={"can-redo-changed":"_redoChanged","can-undo-changed":"_undoChanged","hax-drop-focus-event":"_expandSettingsPanel","jwt-logged-in":"_jwtLoggedIn","super-daemon-close":"sdCloseEvent","super-daemon-konami-code":"_konamiCodeActivated"},b(["core","haxcms"]),this.konamiCodeActivated=!1,this.rpgHat="none",this.darkMode=!1,this.__editText="Edit",this.userMenuOpen=!1,this.soundIcon="",this.__disposer=this.__disposer||[],this.t=this.t||{},this._configureWasFocused=!1,u.allowedCallback=()=>!0,u.keyHandlerCallback=()=>{const e=this.shadowRoot.querySelector("#merlin");return o.playSound("click"),"super-daemon-modal"==e.getAttribute("data-event")?i.haxTray.collapsed=!1:(u.mini=!0,u.wand=!0,u.activeNode=this.shadowRoot.querySelector("#merlin")),u.runProgram("","*"),!0},u.noResultsSlot=()=>e`<div class="no-results">
          Expecting to see an option Merlin didn't provide?
        </div>
        <a
          @click="${e=>{i._haxStoreContribute("merlin","POP,enhancement",u.commandContext+" "+u.value)}}"
          >Make a suggestion to improve results</a
        >`,u.appendContext("CMS"),u.defineOption({title:"Add Page",icon:"hax:add-page",priority:-2e3,tags:["page","add","create","new","CMS"],eventName:"super-daemon-run-program",path:"CMS/action/add/page",value:{name:"create-page",machineName:"create-page",placeholder:"Type page title to create page",program:async(e,t)=>{const a=globalThis.document.querySelector("haxcms-site-editor-ui")||this,i=n(o.activeItem);if(!e||""===e.trim())return[{title:"Create New Page",icon:"hax:add-page",tags:["page","blank","create"],value:{target:a,method:"createPageWithTitle",args:["New Page","sibling"]},eventName:"super-daemon-element-method",path:"CMS/action/create/page"}];const s=e.trim();try{const e=await a.getPageTemplates(),t=[];return t.push({title:`Create ${s}`,icon:"hax:add-page",tags:["page","blank","create"],value:{target:a,method:"createPageWithTitle",args:[s,"sibling"]},eventName:"super-daemon-element-method",path:"CMS/action/create/page/blank"}),e&&e.length>0&&e.forEach(((e,o)=>{t.push({title:`Create ${e.name} named ${s}`,icon:"hax:templates",tags:["template","page","create"],value:{target:a,method:"createPageWithTitle",args:[s,"sibling",e.content]},eventName:"super-daemon-element-method",path:`CMS/action/create/page/template/${e.id}`})})),i&&t.push({title:`Duplicate as ${s}`,icon:"hax:duplicate",tags:["page","duplicate","create"],value:{target:a,method:"createPageWithTitle",args:[s,"duplicate"]},eventName:"super-daemon-element-method",path:"CMS/action/create/page/duplicate"}),t}catch(e){return console.error("Error in create-page program:",e),[{title:`Error: ${e.message}`,icon:"icons:error",tags:["error"],value:{disabled:!0},eventName:"disabled",path:"Error occurred"}]}}}}),u.defineOption({title:"Move Page",icon:"icons:open-with",priority:0,tags:["page","move","relocate","parent","CMS"],eventName:"super-daemon-run-program",path:"CMS/action/move/page",value:{name:"move-page",machineName:"move-page",placeholder:"Type to filter pages",program:async(e,t)=>{const a=t.pageId||(o.activeItem?o.activeItem.id:null);if(!a)return[{title:"Error: No page selected to move",icon:"icons:error",tags:["error"],value:{disabled:!0},eventName:"disabled",path:"Error occurred"}];if(!await o.findItem(a))return[{title:"Error: Page not found",icon:"icons:error",tags:["error"],value:{disabled:!0},eventName:"disabled",path:"Error occurred"}];const i=o.getManifestItems(!0),s=[],n=e?e.toLowerCase().trim():"";return(!n||n.includes("root")||n.includes("top")||n.includes("level"))&&s.push({title:"Move to Root Level",icon:"hax:site-map",tags:["root","top","level"],value:{target:globalThis.document.querySelector("haxcms-site-editor-ui"),method:"movePageUnderParent",args:[a,null]},eventName:"super-daemon-element-method",path:"CMS/action/move/page/root"}),i.forEach((e=>{if(e.id===a)return;let t=!1,o=e;for(;o&&o.parent;){if(o.parent===a){t=!0;break}o=i.find((e=>e.id===o.parent))}if(t)return;if(n&&!e.title.toLowerCase().includes(n))return;let l=e,r="";for(;l&&null!=l.parent;)l=i.find((e=>e.id===l.parent)),l&&(r="--"+r);s.push({title:`${r}${r?" ":""}${e.title}`,icon:"hax:add-child-page",tags:["move","parent"],value:{target:globalThis.document.querySelector("haxcms-site-editor-ui"),method:"movePageUnderParent",args:[a,e.id]},eventName:"super-daemon-element-method",path:`CMS/action/move/page/${e.id}`})})),0===s.length?[{title:"No matching pages found",icon:"icons:search",tags:["empty"],value:{disabled:!0},eventName:"disabled",path:"No results"}]:s}}}),u.defineOption({title:"Magic File Wand",icon:"hax:hax2022",priority:-1e4,tags:["Agent","help","merlin"],eventName:"super-daemon-run-program",path:"HAX/agent",value:{name:"Agent",machineName:"hax-agent",program:async(e,t)=>{const a=n(v.action),o=n(v.memory),i=n(v.data);let s=[];if("file-selected"===t.operation){switch(t.type){case"md":case"docx":case"doc":case"txt":case"html":case"htm":o.editMode||(s.push({title:`New Sibling Page from ${t.type}`,icon:"hax:add-page",tags:["agent"],value:{target:this,method:"processFileContentsBasedOnUserDesire",args:[t,"create-sibling"]},eventName:"super-daemon-element-method",path:"Page created next to current"}),s.push({title:`New Child Page from ${t.type}`,icon:"hax:add-child-page",tags:["agent"],value:{target:this,method:"processFileContentsBasedOnUserDesire",args:[t,"create-child"]},eventName:"super-daemon-element-method",path:"Page created under current"}),["docx","doc"].includes(t.type)&&s.push({title:`Create outline from ${t.type}`,icon:"hax:site-map",tags:["agent"],value:{target:this,method:"processFileContentsBasedOnUserDesire",args:[t,"create-branch"]},eventName:"super-daemon-element-method",path:"H1,H2 tags create menu pages"})),s.push({title:`Insert ${t.type} contents in Page`,icon:"hax:html-code",tags:["agent"],value:{target:this,method:"processFileContentsBasedOnUserDesire",args:[t,"insert-html"]},eventName:"super-daemon-element-method",path:"Content converted to HTML and inserted"});break;case"png":case"jpeg":case"gif":case"jpg":s.push({title:`Insert ${t.type} in page`,icon:"editor:insert-photo",tags:["agent"],value:{target:this,method:"processFileContentsBasedOnUserDesire",args:[t,"insert-file","image"]},eventName:"super-daemon-element-method",path:"Image embedded in page"}),s.push({title:"Set as the media for the active page",icon:"image:photo-library",tags:["agent"],value:{target:this,method:"processFileContentsBasedOnUserDesire",args:[t,"set-page-media","image"]},eventName:"super-daemon-element-method",path:"Image set as page media"});break;case"mp4":s.push({title:`Insert ${t.type} in page`,icon:"av:play-circle-filled",tags:["agent"],value:{target:this,method:"processFileContentsBasedOnUserDesire",args:[t,"insert-file","video"]},eventName:"super-daemon-element-method",path:"Video embedded in page"});break;case"midi":case"mid":case"mp3":s.push({title:`Insert ${t.type} in page`,icon:"av:volume-up",tags:["agent"],value:{target:this,method:"processFileContentsBasedOnUserDesire",args:[t,"insert-file","audio"]},eventName:"super-daemon-element-method",path:"Audio embedded in page"});break;case"pdf":s.push({title:`Embed ${t.type} in page`,icon:"hax:file-pdf",tags:["agent"],value:{target:this,method:"processFileContentsBasedOnUserDesire",args:[t,"insert-file","pdf"]},eventName:"super-daemon-element-method",path:"PDF embedded in a frame element"});break;case"xlsx":case"xls":case"ods":s.push({title:`Insert ${t.type} as table`,icon:"editor:border-all",tags:["agent"],value:{target:this,method:"processFileContentsBasedOnUserDesire",args:[t,"insert-table"]},eventName:"super-daemon-element-method",path:"Spreadsheet converted to HTML table"}),s.push({title:`Insert ${t.type} as CSV text`,icon:"hax:code",tags:["agent"],value:{target:this,method:"processFileContentsBasedOnUserDesire",args:[t,"insert-csv"]},eventName:"super-daemon-element-method",path:"Spreadsheet converted to CSV text"})}s.push({title:`Link to ${t.type} file`,icon:"editor:insert-link",tags:["agent"],value:{target:this,method:"processFileContentsBasedOnUserDesire",args:[t,"link","link"]},eventName:"super-daemon-element-method",path:"File uploaded and linked to"}),s.push({title:`Just Upload ${t.type} file`,icon:"file-upload",tags:["agent"],value:{target:this,method:"processFileContentsBasedOnUserDesire",args:[t,"upload","upload-only"]},eventName:"super-daemon-element-method",path:"File uploaded for later use"})}else if("drop"===a.type&&"drop"===t.type){const e=i.file,t=await e.text();let a=e.name.split("."),o="";a.length>1&&(o=a.pop()),u.waveWand(["","/",{operation:"file-selected",contents:t,data:e,type:o},"hax-agent","Agent"],this.shadowRoot.querySelector("#merlin"),"coin2")}else s=[{title:"Select file..",icon:"folder-open",tags:["agent"],value:{target:this,method:"selectFileToProcess",args:[]},eventName:"super-daemon-element-method",path:"Watch Merlin work his magic!"}],this.selectFileToProcess();return s}}}),u.defineOption({title:"Magic Link Wand",icon:"editor:insert-link",priority:-9999,tags:["Agent","help","merlin","url","link"],eventName:"super-daemon-run-program",path:"HAX/link-agent",value:{name:"Link Agent",machineName:"hax-link-agent",program:async(e,t)=>{const a=n(v.action),o=(n(v.memory),n(v.data));let i=[];if("url-selected"===t.operation){const e=t.url;switch(this.detectUrlType(e)){case"youtube":i.push({title:"Embed YouTube Video",icon:"av:play-circle-filled",tags:["agent","video"],value:{target:this,method:"processUrlContentsBasedOnUserDesire",args:[t,"embed-youtube"]},eventName:"super-daemon-element-method",path:"YouTube video embedded in page"});break;case"image":i.push({title:"Insert Image from URL",icon:"editor:insert-photo",tags:["agent","image"],value:{target:this,method:"processUrlContentsBasedOnUserDesire",args:[t,"insert-image"]},eventName:"super-daemon-element-method",path:"Image from URL embedded in page"});break;case"pdf":i.push({title:"Embed PDF Document",icon:"hax:file-pdf",tags:["agent","document"],value:{target:this,method:"processUrlContentsBasedOnUserDesire",args:[t,"embed-pdf"]},eventName:"super-daemon-element-method",path:"PDF document embedded in page"});break;case"video":i.push({title:"Embed Video",icon:"av:videocam",tags:["agent","video"],value:{target:this,method:"processUrlContentsBasedOnUserDesire",args:[t,"embed-video"]},eventName:"super-daemon-element-method",path:"Video embedded in page"});break;default:i.push({title:"Insert as Rich Link",icon:"editor:insert-link",tags:["agent","link"],value:{target:this,method:"processUrlContentsBasedOnUserDesire",args:[t,"insert-rich-link"]},eventName:"super-daemon-element-method",path:"Rich link with preview inserted"})}i.push({title:"Insert as Simple Link",icon:"editor:insert-link",tags:["agent","link"],value:{target:this,method:"processUrlContentsBasedOnUserDesire",args:[t,"insert-simple-link"]},eventName:"super-daemon-element-method",path:"Simple hyperlink inserted"}),i.push({title:"Use HAX Default Processing",icon:"hax:hax2022",tags:["agent","hax","auto"],value:{target:this,method:"processUrlContentsBasedOnUserDesire",args:[t,"hax-default"]},eventName:"super-daemon-element-method",path:"HAX automatically detects best element type"});const a=globalThis.getSelection&&globalThis.getSelection();a&&!a.isCollapsed&&a.toString().trim()&&i.push({title:`Apply Link to Selected Text: "${a.toString().trim().substring(0,30)}${a.toString().trim().length>30?"...":""}"`,icon:"editor:format-color-text",tags:["agent","link","selection"],value:{target:this,method:"processUrlContentsBasedOnUserDesire",args:[t,"apply-to-selected-text"]},eventName:"super-daemon-element-method",path:"URL applied as link to selected text"})}else if("paste"===a.type&&"paste"===t.type){const e=o.text;this.isValidUrl(e)&&u.waveWand(["","/",{operation:"url-selected",url:e.trim(),data:e},"hax-link-agent","Link Agent"],this.shadowRoot.querySelector("#merlin"),"coin2")}else{if(e&&this.isValidUrl(e.trim()))return this.processUrlFromInput(e),[];i=[{title:"Paste URL in search box above and press Enter",icon:"editor:insert-link",tags:["agent","link","instruction"],value:{},eventName:"super-daemon-noop",path:"Enter any URL to see processing options"}]}return i}}}),i.ready&&(["site-remote-content","citation-element","page-flag","site-collection-list","collection-list","collection-item"].map((e=>{let t=globalThis.document.createElement(e);i.haxAutoloader.appendChild(t)})),i.primativeHooks.a||(i.primativeHooks.a={}),i.primativeHooks.a.setupActiveElementForm=e=>{const t=o.getManifestItems(!0);var a=[{text:`-- ${this.t.selectPage} --`,value:null}];t.forEach((e=>{if(e.id!=this.itemId){let o=e,i="- ";for(;o&&null!=o.parent;)o=t.find((e=>e.id==o.parent)),o&&(i="--"+i);a.push({text:i+e.title,value:e.id})}}))}),this.t={...this.t,selectPage:"Select page",backToSiteList:"Back to site list",mySites:"My sites",cancel:"Cancel",unsavedChangesWillBeLostIfSelectingOkAreYouSure:"Unsaved changes will be lost if selecting OK, are you sure?",editDetails:"Page details",add:"Add",source:"Source",viewSource:"Source",confirmHtmlSourceExit:"HTML Source changes will not be saved without pressing the `Update HTML` button, Save without HTML code editor changes?",findMedia:"Media",undo:"Undo",redo:"Redo",media:"Media",outline:"Outline",blocks:"Blocks",addBlock:"Blocks",addPage:"Add page",addChildPage:"Add child page",clonePage:"Clone page",delete:"Delete page",siteSettings:"Site settings",themeSettings:"Theme settings",seoSettings:"SEO settings",authorSettings:"Author settings",styleGuide:"Style Guide",close:"Close",settings:"Settings",edit:"Edit",configureBlock:"Configure",configure:"Configure",save:"Save",saveAndEdit:"Save & Edit",unlockPage:"Unlock page",newJourney:"New Journey",accountInfo:"Account Info",outlineDesigner:"Site Outline",outline:"Outline",pageOutline:"Structure",more:"More",pageActions:"Page actions",insights:"Insights dashboard",merlin:"Merlin",summonMerlin:"Summon Merlin",logOut:"Log out",menu:"Menu",showMore:"More",contentImported:"Content imported!"},this.backText="Site list",this.painting=!0,this.pageAllowed=!1,this.editMode=!1,this.__editIcon="icons:create",this.manifestEditMode=!1,this.backLink="../../",this.activeTagName="",this.activeNode=null,this.activeDrag=!1,this.activeType=null,globalThis.appSettings&&globalThis.appSettings.backLink&&(this.backLink=globalThis.appSettings.backLink),s((()=>{const e=n(o.isLoggedIn);v.writeMemory("isLoggedIn",this.isLoggedIn);const t=Math.floor(Date.now()/1e3);if(e&&!this.loggedInTime){this.displayConsoleWarning(),this.loggedInTime=t;var a=v.readMemory("recentLogins");a?a&&(a.length<5&&a.shift(),a.push(t),v.writeMemory("recentLogins",a,"long")):v.writeMemory("recentLogins",[t],"long")}})),s((()=>{const e=n(v.memory),t=n(v.action);!1===e.editMode&&e.interactionDelay>=3600&&null===t.type&&o.cmsSiteEditor.haxCmsSiteEditorUIElement&&o.cmsSiteEditor.haxCmsSiteEditorUIElement.shadowRoot&&setTimeout((()=>{o.cmsSiteEditor.haxCmsSiteEditorUIElement.shadowRoot.querySelector("#editbutton").dataPulse="1"}),300),v.active&&v.memory.isLoggedIn&&v.memory.recentTarget===u&&null===u.programName&&v.memory.interactionDelay>600&&["paste","key"].includes(t.type)?c(u.value)&&u.waveWand([u.value,"/",{},"hax-agent","Agent"],null,"coin2"):v.active&&v.memory.isLoggedIn&&null===u.programName&&["paste"].includes(t.type)&&"url"==v.data.architype&&u.waveWand([n(v.data.value),"/",{},"hax-agent","Agent"],null,"coin2")})),s((()=>{const e=n(v.action),t=n(v.data);v.active&&v.memory.isLoggedIn&&null===u.programName&&"drag"===e.type?(this.activeDrag=!0,this.activeType=t.value||t.architype):v.active&&v.memory.isLoggedIn&&null===u.programName&&"dragleave"===e.type&&(this.activeDrag=!1,this.activeType=null)})),s((()=>{const e=n(i.activeGizmo);e&&e.title&&(this.activeTagName=e.title)})),s((()=>{this.activeNode=n(i.activeNode)})),s((()=>{const e=n(o.badDevice);if(!1===e){const e=globalThis.document.createElement("link");e.setAttribute("href","https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"),e.setAttribute("rel","stylesheet"),e.setAttribute("fetchpriority","low"),globalThis.document.head.appendChild(e)}else!0===e&&globalThis.document.body.classList.add("bad-device")})),s((()=>{this.darkMode=n(o.darkMode),this.dark=this.darkMode,n(o.darkMode)?(u.dark=!0,u.toastInstance.darkMode=!0,i.globalPreferences.haxUiTheme="haxdark"):(i.globalPreferences.haxUiTheme="hax",u.dark=!1,u.toastInstance.darkMode=!1)})),s((()=>{this.soundIcon=n(o.soundStatus)?new URL("../../../app-hax/lib/assets/images/FullVolume.svg",import.meta.url).href:new URL("../../../app-hax/lib/assets/images/Silence.svg",import.meta.url).href})),setTimeout((()=>{import("./haxcms-outline-editor-dialog.js")}),0)}displayConsoleWarning(){setTimeout((()=>{console.warn("%c⚠️STOP⚠️","color: white; padding: 10px; font-weight: bold; font-size: 5em;font-family: arial; background-color: darkred; border: 5px solid white; border: 5px solid white;"),console.warn("%cThis is a browser feature intended for developers. If someone told you to copy and paste something here to enable a hidden feature, it is likely a scam and could give them access to your account.","font-size: 1.5em; font-family: arial; color: white; background-color: darkred; padding: 10px")}),3500)}soundToggle(){const e=!n(o.soundStatus);o.soundStatus=e,r("app-hax-soundStatus",e),e?(o.toast("Can you hear me now? Good.",2e3,{hat:"random"}),o.playSound("click")):o.toast("Sound off.. hey.. HELLO!?!",2e3,{fire:!0})}platformAllows(e){return!this.platformConfig||"object"!=typeof this.platformConfig||!1!==this.platformConfig[e]}closeMenu(){this.userMenuOpen=!1}toggleMenu(){this.userMenuOpen=!this.userMenuOpen,o.playSound("click")}getIconPosition(e){return["xl","lg"].includes(e)?"left":"top"}render(){return e`
      <app-hax-top-bar part="top-bar" ?edit-mode="${this.editMode}">
        <span slot="left" class="home-btn">
          <a
            href="${this.backLink}"
            class="haxLogo"
            id="backtosites"
            title="${this.backText}"
            part="hax-logo"
          >
            <simple-icon-lite icon="hax:hax2022"></simple-icon-lite>
          </a>
          <simple-tooltip for="backtosites" position="right"
            >${this.backText}</simple-tooltip
          >
          <slot name="haxcms-site-editor-ui-prefix-avatar"></slot>
        </span>
        <div slot="center" class="toolbar-buttons">
          <slot name="haxcms-site-editor-ui-prefix-buttons"></slot>
          <simple-toolbar-button
            ?hidden="${!this.activeItem||!this.activeItem.metadata||!this.activeItem.metadata.locked||this.editMode}"
            id="lockbutton"
            class="top-bar-button"
            icon="icons:lock"
            icon-position="${this.getIconPosition(this.responsiveSize)}"
            label="${this.t.unlockPage}"
            @click="${this._toggleLockedStatus}"
          ></simple-toolbar-button>
          <simple-toolbar-button
            ?hidden="${!this.pageAllowed}"
            ?disabled="${this.activeItem&&this.activeItem.metadata&&this.activeItem.metadata.locked&&!this.editMode}"
            class="top-bar-button"
            id="editbutton"
            icon="${this.__editIcon}"
            icon-position="${this.getIconPosition(this.responsiveSize)}"
            @click="${this._editButtonTap}"
            label="${this.__editText}"
            voice-command="edit (this) page"
          ></simple-toolbar-button>
          <simple-toolbar-button
            ?hidden="${!this.editMode}"
            class="top-bar-button"
            id="saveandeditbutton"
            icon="hax:page-edit"
            icon-position="${this.getIconPosition(this.responsiveSize)}"
            @click="${this._saveAndEditButtonTap}"
            label="${this.t.saveAndEdit} • Ctrl⇧W"
            data-primary="4"
            voice-command="save and edit page"
          ></simple-toolbar-button>
          <haxcms-button-add
            ?hidden="${this.editMode||!this.platformAllows("addPage")}"
            id="addpagebutton"
            class="top-bar-button"
            align-horizontal="center"
            icon="hax:add-page"
            label="${this.t.addPage} • Ctrl⇧1"
            merlin
          ></haxcms-button-add>
          <simple-toolbar-button
            ?hidden="${this.editMode||!this.platformAllows("outlineDesigner")}"
            id="outlinebutton"
            class="top-bar-button"
            icon="hax:site-map"
            icon-position="${this.getIconPosition(this.responsiveSize)}"
            label="${this.t.outline} • Ctrl⇧2"
            @click="${this._outlineButtonTap}"
          ></simple-toolbar-button>

          <simple-toolbar-button
            id="cancelbutton"
            class="top-bar-button"
            icon="icons:cancel"
            icon-position="${this.getIconPosition(this.responsiveSize)}"
            @click="${this._cancelButtonTap}"
            ?hidden="${!this.editMode}"
            ?disabled="${!this.editMode}"
            tabindex="${this.editMode?"0":"-1"}"
            label="${this.t.cancel} • Ctrl⇧/"
            voice-command="cancel (editing)"
          ></simple-toolbar-button>
          <simple-toolbar-button
            icon="icons:undo"
            class="top-bar-button"
            icon-position="${this.getIconPosition(this.responsiveSize)}"
            ?disabled="${!this.canUndo}"
            @click="${this.haxButtonOp}"
            label="${this.t.undo} • Ctrl Z"
            data-event="undo"
            id="undo"
            ?hidden="${!this.editMode}"
            voice-command="undo"
          >
          </simple-toolbar-button>
          <simple-toolbar-button
            icon="icons:redo"
            class="top-bar-button"
            @click="${this.haxButtonOp}"
            ?disabled="${!this.canRedo}"
            ?hidden="${!this.editMode}"
            label="${this.t.redo} • Ctrl⇧Z"
            data-event="redo"
            id="redo"
            voice-command="redo"
            icon-position="${this.getIconPosition(this.responsiveSize)}"
          >
          </simple-toolbar-button>

          <simple-toolbar-button
            data-event="content-edit"
            icon="settings"
            class="top-bar-button"
            @click="${this.haxButtonOp}"
            id="content-edit"
            label="${this.t.configureBlock} • Ctrl⇧1"
            ?hidden="${!this.editMode}"
            ?disabled="${!this.activeTagName||""==this.activeTagName||!this.activeNode||!this.activeNode.tagName}"
            voice-command="(modify)(configure)(edit) selected"
            controls="tray-detail"
            tooltip="${this.t.configure} ${this.activeTagName}"
            ?active="${"content-edit"===this.trayDetail}"
            icon-position="${this.getIconPosition(this.responsiveSize)}"
          >
          </simple-toolbar-button>
          <simple-toolbar-button
            ?hidden="${!this.editMode}"
            ?disabled="${!this.editMode}"
            data-event="content-add"
            icon="hax:add-brick"
            id="content-add"
            class="top-bar-button"
            label="${this.t.addBlock} • Ctrl⇧2"
            voice-command="select blocks (menu)"
            ?active="${"content-add"===this.trayDetail}"
            icon-position="${this.getIconPosition(this.responsiveSize)}"
            @click="${this.haxButtonOp}"
          >
          </simple-toolbar-button>
          <simple-toolbar-button
            ?hidden="${!this.editMode}"
            ?disabled="${!this.editMode}"
            data-event="content-map"
            icon="hax:newspaper"
            id="content-map"
            class="top-bar-button"
            label="${this.t.pageOutline} • Ctrl⇧3"
            voice-command="select content outline (menu)"
            @click="${this.haxButtonOp}"
            ?active="${"content-map"===this.trayDetail}"
            icon-position="${this.getIconPosition(this.responsiveSize)}"
          >
          </simple-toolbar-button>

          <simple-toolbar-button
            id="exportbtn"
            icon="hax:html-code"
            label="${this.t.viewSource} • Ctrl⇧4"
            data-event="view-source"
            class="top-bar-button"
            @click="${this.haxButtonOp}"
            voice-command="view (page) source"
            icon-position="${this.getIconPosition(this.responsiveSize)}"
            ?hidden="${!this.editMode}"
            ?disabled="${!this.editMode}"
            ?active="${"view-source"===this.trayDetail}"
          >
          </simple-toolbar-button>

          <simple-toolbar-button
            ?hidden="${!this.editMode}"
            ?disabled="${!this.editMode}"
            icon="hax:multimedia"
            class="top-bar-button"
            label="${this.t.findMedia} • Ctrl⇧5"
            voice-command="select media (menu)"
            icon-position="${this.getIconPosition(this.responsiveSize)}"
            data-event="media-program"
            @click="${this.haxButtonOp}"
          >
          </simple-toolbar-button>

          <simple-toolbar-button
            ?hidden="${this.editMode||!this.platformAllows("styleGuide")}"
            ?disabled="${this.editMode}"
            id="styleguidebutton"
            @click="${this._styleGuideButtonTap}"
            icon-position="${this.getIconPosition(this.responsiveSize)}"
            icon="lrn:palette"
            part="styleguidebtn"
            class="top-bar-button"
            label="${this.t.styleGuide} • Ctrl⇧3"
          ></simple-toolbar-button>

          <simple-toolbar-button
            ?hidden="${this.editMode||!this.platformAllows("insights")}"
            ?disabled="${this.editMode}"
            id="insightsbutton"
            icon="hax:clipboard-pulse"
            part="insightsbtn"
            class="top-bar-button"
            icon-position="${this.getIconPosition(this.responsiveSize)}"
            @click="${this._insightsButtonTap}"
            label="${this.t.insights} • Ctrl⇧4"
            voice-command="insights"
          ></simple-toolbar-button>

          <simple-toolbar-button
            @click="${this._manifestButtonTap}"
            icon-position="left"
            icon="hax:home-edit"
            part="manifestbtn"
            class="top-bar-button"
            id="manifestbtn"
            ?disabled="${this.editMode}"
            ?hidden="${this.editMode||!this.platformAllows("manifest")}"
            label="${this.t.siteSettings} • Ctrl⇧5"
          ></simple-toolbar-button>
          <slot name="haxcms-site-editor-ui-suffix-buttons"></slot>
          <simple-toolbar-button
            icon="hax:wizard-hat"
            label="${this.t.merlin} • Alt⇧"
            voice-command="${this.t.merlin}"
            class="merlin top-bar-button"
            id="merlin"
            @click="${this.haxButtonOp}"
            data-event="${"xs"===this.responsiveSize?"super-daemon-modal":"super-daemon"}"
          ></simple-toolbar-button>
          <super-daemon-search
            @click="${this.haxButtonOp}"
            @value-changed="${this.haxButtonOp}"
            @drop="${this.dropEvent}"
            @dragenter="${this.dragenterEvent}"
            @dragleave="${this.dragleaveEvent}"
            @dragover="${this.dragoverEvent}"
            icon="hax:wizard-hat"
            id="search"
            voice-search
            class="merlin"
            data-event="${"xs"===this.responsiveSize?"super-daemon-modal":"super-daemon"}"
            ?hidden="${["xs"].includes(this.responsiveSize)}"
            mini
            wand
            droppable-type="${this.activeType}"
            ?droppable="${this.activeDrag}"
          >
          </super-daemon-search>
        </div>

        <app-hax-user-menu
          slot="right"
          id="user-menu"
          part="app-hax-user-menu"
          ?is-open="${this.userMenuOpen}"
        >
          <button
            class="topbar-character"
            slot="menuButton"
            @click="${this.toggleMenu}"
            aria-label="User menu for ${this.userName}"
            aria-expanded="${this.userMenuOpen}"
            aria-haspopup="menu"
          >
            <rpg-character
              seed="${this.userName}"
              width="68"
              height="68"
              part="rpgcharacter"
              role="img"
              alt="Avatar for ${this.userName}"
              hat="${this.rpgHat}"
            ></rpg-character>
            <span class="characterbtn-name" aria-hidden="true"
              >${this.userName}</span
            >
            <slot name="haxcms-site-editor-ui-topbar-character-button"></slot>
          </button>
          <div slot="pre-menu" class="ops-panel">
            <slot name="haxcms-site-editor-ui-pre-menu"></slot>
            <wired-button
              elevation="1"
              class="soundToggle"
              @click="${this.soundToggle}"
              aria-label="Toggle sound effects ${this.soundIcon&&-1!==this.soundIcon.indexOf("Full")?"off":"on"}"
              aria-pressed="${this.soundIcon&&-1!==this.soundIcon.indexOf("Full")?"true":"false"}"
            >
              <simple-icon-lite
                src="${this.soundIcon}"
                loading="lazy"
                decoding="async"
                aria-hidden="true"
              ></simple-icon-lite>
            </wired-button>
            <haxcms-darkmode-toggle></haxcms-darkmode-toggle>
          </div>
          <!-- <app-hax-user-menu-button
          slot="main-menu"
          icon="face"
          label="${this.t.accountInfo}"
        ></app-hax-user-menu-button> -->
          <slot slot="main-menu" name="haxcms-site-editor-ui-main-menu"></slot>
          <a
            class="mysiteslink"
            href="${this.backLink}"
            slot="main-menu"
            part="mysiteslink"
            tabindex="-1"
          >
            <app-hax-user-menu-button
              icon="hax:hax2022"
              label="${this.t.mySites}"
              part="mysitesbtn"
            ></app-hax-user-menu-button>
          </a>
          <app-hax-user-menu-button
            slot="main-menu"
            icon="add"
            label="${this.t.newJourney}"
            part="newjourneybtn"
            @click="${this._addButtonTap}"
          ></app-hax-user-menu-button>
          <slot slot="post-menu" name="haxcms-site-editor-ui-post-menu"></slot>
          <app-hax-user-menu-button
            slot="post-menu"
            part="logoutbtn"
            class="logout"
            label="${this.t.logOut}"
            @click=${this._logout}
          ></app-hax-user-menu-button>
        </app-hax-user-menu>
      </app-hax-top-bar>
    `}dropEvent(e){e.preventDefault(),this.activeDrag=!1,this.activeType=null,u.waveWand(["","/",e,"hax-agent","Agent"],this.shadowRoot.querySelector("#merlin"))}dragenterEvent(e){e.preventDefault(),this.sdSearch.dragover=!0}dragoverEvent(e){e.preventDefault(),this.sdSearch.dragover=!0}dragleaveEvent(e){e.preventDefault(),this.sdSearch.dragover=!1}sdCloseEvent(e){setTimeout((()=>{this._ignoreReset=!0,this.sdSearch.value=""}),0),this.sdSearch.disabled=!1,this.sdSearch.dragover=!1,this.sdSearch.droppable=!1,this.sdSearch.droppableType=null}haxButtonOp(e){let t=e.target.getAttribute("data-event");switch(t){case"super-daemon":if(!this._ignoreReset||"click"===e.type){const t=this.sdSearch.value;"value-changed"===e.type?t&&u.waveWand([t,"*"],this.shadowRoot.querySelector("#merlin"),null):u.waveWand([t,"*"],this.shadowRoot.querySelector("#merlin"),null),this.sdSearch.value=null,this.sdSearch.disabled=!1,this.sdSearch.dragover=!1,this.sdSearch.droppable=!1,this.sdSearch.droppableType=null}this._ignoreReset=!1;break;case"super-daemon-modal":this._ignoreReset&&"click"!==e.type||(o.playSound("click"),u.open(),i.haxTray.collapsed=!1);break;case"media-program":o.playSound("click"),u.waveWand(["sources","/"],this.shadowRoot.querySelector("#merlin"),null);break;case"content-edit":case"content-map":case"content-add":i.haxTray.trayDetail==t?i.haxTray.collapsed=!i.haxTray.collapsed:i.haxTray.collapsed=!1,i.haxTray.trayDetail=t;break;case"undo":i.activeHaxBody.undo();break;case"redo":i.activeHaxBody.redo();break;case"view-source":i.haxTray.trayDetail=t,i.haxTray.shadowRoot.querySelector("#view-source").openSource(),i.haxTray.collapsed=!1}}_logout(){globalThis.dispatchEvent(new CustomEvent("jwt-login-logout",{composed:!0,bubbles:!0,cancelable:!1,detail:!0})),this.__logoutUserAction=!0}_jwtLoggedIn(e){!1===e.detail&&this.__logoutUserAction&&(this.__logoutUserAction=!1,setTimeout((()=>{globalThis.location.reload()}),100))}updateAvailableButtons(){this.shadowRoot&&setTimeout((()=>{globalThis.appSettings&&globalThis.appSettings.backText&&(this.backText=globalThis.appSettings.backText);[{varPath:"saveNodePath",selector:"#editbutton"},{varPath:"createNodePath",selector:"#addpagebutton"}].forEach((e=>{globalThis.appSettings&&globalThis.appSettings[e.varPath]&&null!=globalThis.appSettings[e.varPath]&&""!=globalThis.appSettings[e.varPath]&&"null"!=globalThis.appSettings[e.varPath]&&(e.dep?null!=globalThis.appSettings[e.dep]&&""!=globalThis.appSettings[e.dep]&&"null"!=globalThis.appSettings[e.dep]&&this.shadowRoot.querySelector(e.selector).removeAttribute("hidden"):this.shadowRoot.querySelector(e.selector).removeAttribute("hidden"))}))}),100)}firstUpdated(t){super.firstUpdated&&super.firstUpdated(t),this.shadowRoot.querySelectorAll("[data-super-daemon-path]").forEach((e=>{u.defineOption({title:e.getAttribute("data-super-daemon-label"),icon:e.getAttribute("data-super-daemon-icon"),tags:["page","operation","command","add","create"],value:{target:e},context:"CMS",eventName:"super-daemon-element-click",path:e.getAttribute("data-super-daemon-path")})})),this.sdSearch=this.shadowRoot.querySelector("super-daemon-search"),u.wandTarget=this.shadowRoot.querySelector("#merlin"),u.defineOption({title:this.t.save,icon:"icons:save",tags:["CMS","save","page","operation","command"],value:{target:this,method:"_editButtonTap"},context:"HAX",eventName:"super-daemon-element-method",path:"CMS/action/save"}),u.defineOption({title:this.t.insights,icon:"hax:clipboard-pulse",tags:["CMS","insights","data","operation"],value:{target:this,method:"_insightsButtonTap"},context:"CMS",eventName:"super-daemon-element-method",path:"CMS/site/insights"}),u.defineOption({title:this.t.edit,icon:"hax:page-edit",priority:-1500,tags:["CMS","edit","page","operation","command"],value:{target:this,method:"_editButtonTap"},context:"CMS",eventName:"super-daemon-element-method",path:"CMS/action/edit"}),u.defineOption({title:this.t.siteSettings,icon:"hax:site-settings",tags:["CMS","site","settings","operation","command","theme","seo","author"],value:{target:this,method:"_manifestButtonTap",args:[{target:this.shadowRoot.querySelector("#manifestbtn")}]},context:"CMS",eventName:"super-daemon-element-method",path:"CMS/action/site/settings"}),u.defineOption({title:this.t.themeSettings,icon:"hax:site-settings",tags:["CMS","site","settings","operation","command","theme","seo","author"],value:{target:this,method:"_manifestButtonTap",args:[{target:this.shadowRoot.querySelector("#manifestbtn")}]},context:"CMS",eventName:"super-daemon-element-method",path:"CMS/action/site/settings/theme"}),u.defineOption({title:this.t.seoSettings,icon:"hax:site-settings",tags:["CMS","site","settings","operation","command","theme","seo","search","engine"],value:{target:this,method:"_manifestButtonTap",args:[{target:this.shadowRoot.querySelector("#manifestbtn")}]},context:"CMS",eventName:"super-daemon-element-method",path:"CMS/action/site/settings/seo"}),u.defineOption({title:this.t.authorSettings,icon:"hax:site-settings",tags:["CMS","site","settings","operation","command","theme","author"],value:{target:this,method:"_manifestButtonTap",args:[{target:this.shadowRoot.querySelector("#manifestbtn")}]},context:"CMS",eventName:"super-daemon-element-method",path:"CMS/action/site/settings/author"}),u.defineOption({title:this.t.styleGuide,icon:"lrn:palette",tags:["CMS","theme","style guide","design"],value:{target:this,method:"_styleGuideButtonTap"},context:["logged-in","CMS"],eventName:"super-daemon-element-method",path:"CMS/theme/style-guide"}),u.defineOption({title:this.t.newJourney,icon:"add",tags:["CMS","create","new site"],value:{target:this,method:"_addButtonTap"},context:"CMS",eventName:"super-daemon-element-method",path:"CMS/action/create-site"}),u.defineOption({title:this.t.logOut,icon:"add",tags:["CMS","user","logout"],value:{target:this,method:"_logout"},context:["logged-in","CMS"],eventName:"super-daemon-element-method",path:"CMS/user/logout"}),u.defineOption({title:"Dark mode toggle",icon:"device:brightness-medium",tags:["CMS","dark mode"],value:{target:this.shadowRoot.querySelector("haxcms-darkmode-toggle"),method:"toggle"},voice:"(toggle) dark mode",eventName:"super-daemon-element-method",path:"CMS/action/darkMode"}),u.defineOption({title:"Sound toggle",icon:"av:volume-up",tags:["CMS","sound"],value:{target:this.shadowRoot.querySelector(".soundToggle")},eventName:"super-daemon-element-click",path:"CMS/action/sound"}),u.defineOption({title:this.t.outlineDesigner,icon:"hax:site-map",tags:["CMS","outline","designer","site outline","operation","command"],value:{target:this.shadowRoot.querySelector("#outlinebutton")},context:["CMS"],eventName:"super-daemon-element-click",path:"CMS/action/outline"}),u.defineOption({title:"Load HAXSchema",icon:"hax:hax2022",tags:["Developer","schema","load","demo","testing"],eventName:"super-daemon-run-program",path:">hax/loadElement",context:[">"],value:{name:"Load HAXSchema",context:">",program:async(e,t)=>{const a=globalThis.WCAutoload.requestAvailability();let o=[];return Object.keys(a.registry.list).forEach((async t=>{let i="hax:hax2022";if(globalThis.customElements.get(t)&&globalThis.customElements.get(t).haxProperties&&globalThis.customElements.get(t).haxProperties.gizmo&&(i=globalThis.customElements.get(t).haxProperties.gizmo.icon),""==e||t.includes(e)){let e={};e[t]=a.registry.list[t],o.push({title:t,icon:i,tags:["schema"],value:{target:globalThis.HaxStore.instance,method:"_handleDynamicImports",args:[e,globalThis.HaxStore.instance.haxAutoloader]},eventName:"super-daemon-element-method",context:[">",">hax/loadElement/"+t],path:">hax/loadElement/"+t})}})),o}}}),u.defineOption({title:"Welcome to HAX",icon:"hax:hax2022",tags:["welcome","tutorial","getting started","onboarding","help","guide"],eventName:"super-daemon-run-program",path:"CMS/welcome",context:["CMS","logged-in"],priority:2e3,value:{name:"Welcome to HAX",machineName:"welcome",context:"CMS",program:async(e,t)=>[{title:"Edit this page",icon:"hax:page-edit",tags:["welcome","common","operation"],value:{target:this,method:"executeWelcomeAction",args:["edit-page"]},eventName:"super-daemon-element-method",context:["CMS"],path:"CMS/welcome/edit-page"},{title:"Create a new page",icon:"hax:add-page",tags:["welcome","common","operation"],value:{target:this,method:"executeWelcomeAction",args:["create-page"]},eventName:"super-daemon-element-method",context:["CMS"],path:"CMS/welcome/create-page"},{title:"Upload a file",icon:"file-upload",tags:["welcome","common","operation"],value:{target:this,method:"executeWelcomeAction",args:["upload-file"]},eventName:"super-daemon-element-method",context:["CMS"],path:"CMS/welcome/upload-file"},{title:"Edit site outline",icon:"hax:site-map",tags:["welcome","common","operation"],value:{target:this,method:"executeWelcomeAction",args:["outline-designer"]},eventName:"super-daemon-element-method",context:["CMS"],path:"CMS/welcome/outline-designer"},{title:"Change site settings",icon:"hax:site-settings",tags:["welcome","common","operation"],value:{target:this,method:"executeWelcomeAction",args:["site-settings"]},eventName:"super-daemon-element-method",context:["CMS"],path:"CMS/welcome/site-settings"},{title:"Don't show this welcome again",icon:"icons:visibility-off",tags:["welcome","dismiss","settings"],value:{target:this,method:"dismissWelcomeProgram",args:[]},eventName:"super-daemon-element-method",context:["CMS"],path:"CMS/welcome/dismiss"}]}}),u.defineOption({title:"Change theme temporarily",icon:"image:style",tags:["Developer","theme"],eventName:"super-daemon-run-program",path:">settings/theme",context:[">"],more:e`<span
        >Change theme just for the current browsing session</span
      >`,voice:"change theme (temporarily)",value:{name:"Change theme",context:">",program:async(e,t)=>{let a=[];try{const t=await fetch(new URL("../themes.json",import.meta.url).href),o=await t.json();Object.keys(o).forEach((t=>{const i=o[t];(""==e||t.includes(e)||i.name.toLowerCase().includes(e.toLowerCase()))&&a.push({title:i.name,icon:"image:style",tags:["theme"],value:{target:globalThis.HAXCMS,method:"setTheme",args:[t]},eventName:"super-daemon-element-method",context:[">",">settings/theme/"+t],path:">settings/theme/"+t})}))}catch(t){console.warn("Failed to load themes.json, falling back to basic theme:",t),(""==e||"clean-one".includes(e))&&a.push({title:"Clean One",icon:"image:style",tags:["theme"],value:{target:globalThis.HAXCMS,method:"setTheme",args:["clean-one"]},eventName:"super-daemon-element-method",context:[">",">settings/theme/clean-one"],path:">settings/theme/clean-one"})}return a}}}),u.defineOption({title:"HAX Labs",icon:"hax:hax2022",tags:["Developer","labs","experiments"],eventName:"super-daemon-element-method",path:">hax/labs",context:[">"],value:{target:this,method:"enableLabExperiments",args:[]}}),u.defineOption({title:"View only mode",icon:"visibility",tags:["CMS","view","read-only","preview"],eventName:"super-daemon-element-method",path:"CMS/mode/view-only",context:["CMS"],more:e`<span
        >Enable view only mode to hide all editing tools and experience the site
        as a visitor would see it</span
      >`,voice:"view only mode",value:{target:this,method:"enableViewOnlyMode",args:[]}}),u.defineOption({title:"Go to site",icon:"hax:hax2022",tags:["Developer","change","sites","administration"],eventName:"super-daemon-run-program",path:"/hax/changeSite",context:["CMS"],value:{name:"Go to site",context:"CMS",program:async(e,t)=>{let a=[];return await fetch("./../../system/api/listSites").then((e=>e.ok?e.json():[])).then((t=>{t.data&&t.data.items.length>0&&t.data.items.forEach((async t=>{(""==e||t.metadata.site&&t.metadata.site.name&&t.metadata.site.name.includes(e)&&o.manifest.metadata.site.name!=t.metadata.site.name)&&a.push({title:t.title,icon:t.metadata.theme.variables.icon,tags:["site",t.description],value:{target:this,method:"goToLocation",args:[t.slug]},eventName:"super-daemon-element-method",context:["/","/hax/changeSite/"+t.metadata.site.name],path:"/hax/changeSite/"+t.metadata.site.name})}))})),a}}}),u.defineOption({title:"Print Options",icon:"icons:print",tags:["CMS","print","page","site","pdf"],eventName:"super-daemon-run-program",path:"CMS/action/print",context:["CMS"],voice:"print (options)",value:{name:"Print Options",machineName:"print-options",program:async(e,t)=>{const{createPrintProgram:a}=await import("./utils/PrintProgram.js"),o=a(this);return await o(e,t)}}}),u.defineOption({title:"Export page",icon:"icons:file-download",tags:["CMS","export","page"],eventName:"super-daemon-run-program",path:"CMS/export/page",context:["CMS","HAX"],voice:"export page",value:{name:"Export page",machineName:"export-page",program:async(e,t)=>{const{createExportPageProgram:a}=await import("./utils/ExportPageProgram.js"),o=a(this);return await o(e,t)}}}),u.defineOption({title:"Export site",icon:"icons:file-download",tags:["CMS","export","site"],eventName:"super-daemon-run-program",path:"CMS/export/site",context:["CMS"],voice:"export site",value:{name:"Export site",machineName:"export-site",program:async(e,t)=>{const{createExportSiteProgram:a}=await import("./utils/ExportSiteProgram.js"),o=a(this);return await o(e,t)}}}),u.defineOption({title:"Edit title",icon:"editor:title",tags:["CMS","edit","title","metadata"],eventName:"super-daemon-run-program",path:"CMS/edit/title",context:["CMS"],voice:"edit title",value:{name:"Edit title",machineName:"edit-title",placeholder:"Enter new title",program:async(e,t)=>{const{createEditTitleProgram:a}=await import("./utils/EditTitleProgram.js"),o=a(this);return await o(e,t)}}}),u.defineOption({title:"Edit description",icon:"editor:format-quote",tags:["CMS","edit","description","metadata"],eventName:"super-daemon-run-program",path:"CMS/edit/description",context:["CMS"],voice:"edit description",value:{name:"Edit description",machineName:"edit-description",placeholder:"Enter new description",program:async(e,t)=>{const{createEditDescriptionProgram:a}=await import("./utils/EditDescriptionProgram.js"),o=a(this);return await o(e,t)}}}),u.defineOption({title:"Edit slug",icon:"editor:insert-link",tags:["CMS","edit","slug","url","metadata"],eventName:"super-daemon-run-program",path:"CMS/edit/slug",context:["CMS"],voice:"edit slug",value:{name:"Edit slug",machineName:"edit-slug",placeholder:"Enter new slug (URL path)",program:async(e,t)=>{const{createEditSlugProgram:a}=await import("./utils/EditSlugProgram.js"),o=a(this);return await o(e,t)}}}),u.defineOption({title:"Edit tags",icon:"icons:label",tags:["CMS","edit","tags","metadata"],eventName:"super-daemon-run-program",path:"CMS/edit/tags",context:["CMS"],voice:"edit tags",value:{name:"Edit tags",machineName:"edit-tags",placeholder:"Enter tags separated by commas",program:async(e,t)=>{const{createEditTagsProgram:a}=await import("./utils/EditTagsProgram.js"),o=a(this);return await o(e,t)}}}),u.defineOption({title:"Go to page in this site",icon:"link",tags:["Site","navigation"],eventName:"super-daemon-run-program",context:["CMS"],path:"/site/navigation",value:{name:"Go to page",context:["CMS"],program:async(e,t)=>{let a=[];const i=n(o.routerManifest)||n(o.manifest);return i&&i.items&&i.items.length>0&&i.items.forEach((async t=>{(t.title.toLowerCase().includes(e.toLowerCase())||""===e)&&a.push({title:t.title,icon:"link",tags:["CMS","page"],value:{target:globalThis.location,method:"assign",args:[t.slug]},context:["CMS"],eventName:"super-daemon-element-method",path:"site/navigation/page"})})),a}}}),u.defineOption({title:"Link to site page",icon:"hax:file-link-outline",tags:["Search","pages","links"],eventName:"super-daemon-run-program",path:"/sources/site-pages",context:["HAX","/"],priority:-1,value:{name:"Search pages",context:["HAX","/"],program:async(e,t)=>{let a=[];const i=n(o.routerManifest)||n(o.manifest);return i&&i.items&&i.items.length>0&&i.items.forEach((async t=>{(t.title.toLowerCase().includes(e.toLowerCase())||""===e)&&a.push({title:t.title,icon:"link",tags:["CMS","page"],value:{value:"a",eventName:"insert-tag",properties:{href:t.slug,"data-uuid":t.id},content:t.title},context:["HAX","/","/sources/site-pages"],eventName:"hax-super-daemon-insert-tag",path:"/sources/site-pages"})})),a}}}),u.defineOption({title:"Keyboard shortcuts",icon:"hardware:keyboard",tags:["help","shortcuts","keyboard","reference"],eventName:"super-daemon-run-program",path:"CMS/help/keyboard-shortcuts",context:["CMS"],value:{name:"Keyboard shortcuts",context:["CMS"],program:async e=>{const t=x.getShortcutsForDisplay(),a=[];return t.forEach((t=>{(""===e||t.description.toLowerCase().includes(e.toLowerCase())||t.label.toLowerCase().includes(e.toLowerCase()))&&a.push({title:`${t.description} • ${t.label}`,icon:"hardware:keyboard",tags:["shortcut","keyboard",t.context],value:{shortcutKey:t.key},context:["CMS"],eventName:"execute-keyboard-shortcut",path:"CMS/help/keyboard-shortcuts"})})),a}}}),this.addEventListener("execute-keyboard-shortcut",(e=>{const t=e.detail.value.shortcutKey.split("+"),a=t[t.length-1],o=t.includes("Ctrl"),i=t.includes("Shift"),s=t.includes("Alt"),n=t.includes("Meta"),l=x.getShortcut(a,o,i,s,n);if(l&&l.callback){const e=new KeyboardEvent("keydown",{key:a,ctrlKey:o,shiftKey:i,altKey:s,metaKey:n,bubbles:!0});l.callback(e)}})),this.updateAvailableButtons(),this.dispatchEvent(new CustomEvent("haxcms-load-user-data",{bubbles:!0,composed:!0,cancelable:!1,detail:!0})),this.checkAndTriggerWelcomeProgram()}enableLabExperiments(){import("../../../video-player/lib/lecture-player.js"),import("../ui-components/magic/site-ai-chat.js")}checkAndTriggerWelcomeProgram(){if(o.isLoggedIn&&!v.readMemory("hasSeenHaxWelcome")){const triggerWelcome=()=>{o.appReady&&this.shadowRoot&&this.shadowRoot.querySelector("#merlin")?(u.waveWand(["","CMS",{operation:"welcome"},"welcome","Welcome to HAX"],this.shadowRoot.querySelector("#merlin"),"magic"),o.toast("👋 Welcome to HAX! Merlin is here to help you get started",8e3,{hat:"knight"})):setTimeout(triggerWelcome,500)};setTimeout(triggerWelcome,2e3)}}dismissWelcomeProgram(){v.writeMemory("hasSeenHaxWelcome",!0,"long"),u.close(),o.toast("Welcome program dismissed. You can always access Merlin by pressing Alt+Shift or clicking the search bar.",5e3,{hat:"good"})}executeWelcomeAction(e){switch(e){case"create-page":u.close(),setTimeout((()=>{this.shadowRoot.querySelector("#addpagebutton").HAXCMSButtonClick()}),100);break;case"edit-page":this._editButtonTap();break;case"upload-file":u.waveWand(["","/",{operation:"file-upload"},"hax-agent","File Agent"],this.shadowRoot.querySelector("#merlin"),"coin2");break;case"outline-designer":this._outlineButtonTap();break;case"site-settings":this._manifestButtonTap({target:this.shadowRoot.querySelector("#manifestbtn")});break;default:console.warn("Unknown welcome action type:",e)}}enableViewOnlyMode(){v.writeMemory("ViewOnlyMode",!0,"long"),o.showViewOnlyModeToast(),setTimeout((()=>{globalThis.location.reload()}),600)}goToLocation(e){globalThis.location=e}async exportPageAs(e){const{exportPageAs:t}=await import("./utils/ExportPageProgram.js");return t.call(this,e)}async _exportPageAsHTML(e,t){const{_exportPageAsHTML:a}=await import("./utils/ExportPageProgram.js");return a.call(this,e,t)}async _exportPageAsMarkdown(e,t){const{_exportPageAsMarkdown:a}=await import("./utils/ExportPageProgram.js");return a.call(this,e,t)}async _exportPageAsDOCX(e,t){const{_exportPageAsDOCX:a}=await import("./utils/ExportPageProgram.js");return a.call(this,e,t)}async _exportPageAsPDF(e,t){const{_exportPageAsPDF:a}=await import("./utils/ExportPageProgram.js");return a.call(this,e,t)}async _exportPageAsHAXSchema(){const{_exportPageAsHAXSchema:e}=await import("./utils/ExportPageProgram.js");return e.call(this)}async exportSiteAs(e){const{exportSiteAs:t}=await import("./utils/ExportSiteProgram.js");return t.call(this,e)}async _exportSiteAsHTML(e,t,a){const{_exportSiteAsHTML:o}=await import("./utils/ExportSiteProgram.js");return o.call(this,e,t,a)}async _exportSiteAsMarkdown(e,t,a){const{_exportSiteAsMarkdown:o}=await import("./utils/ExportSiteProgram.js");return o.call(this,e,t,a)}async _exportSiteAsDOCX(e,t,a){const{_exportSiteAsDOCX:o}=await import("./utils/ExportSiteProgram.js");return o.call(this,e,t,a)}async _exportSiteAsPDF(e,t,a){const{_exportSiteAsPDF:o}=await import("./utils/ExportSiteProgram.js");return o.call(this,e,t,a)}async _exportSiteAsEPUB(e,t,a){const{_exportSiteAsEPUB:o}=await import("./utils/ExportSiteProgram.js");return o.call(this,e,t,a)}async _downloadSiteArchive(){const{_downloadSiteArchive:e}=await import("./utils/ExportSiteProgram.js");return e.call(this)}async _exportSiteAsSkeleton(e,t,a){const{_exportSiteAsSkeleton:o}=await import("./utils/ExportSiteProgram.js");return o.call(this,e,t,a)}_downloadFile(e,t,a="text/plain"){const o=new Blob([e],{type:a});this._downloadBlob(o,t)}_downloadBlob(e,t){const a=globalThis.document.createElement("a");a.href=globalThis.URL.createObjectURL(e),a.download=t,a.target="_blank",globalThis.document.body.appendChild(a),a.click(),globalThis.document.body.removeChild(a),globalThis.URL.revokeObjectURL(a.href)}updated(e){super.updated&&super.updated(e),e.forEach(((e,t)=>{"userMenuOpen"===t&&void 0!==e&&(this.userMenuOpen?this.rpgHat="edit":this.rpgHat="none"),"responsiveSize"===t&&this._updateEditButtonLabel(),"editMode"==t&&(this.editMode?this.rpgHat="construction":this.rpgHat="none",this._updateEditButtonLabel(),void 0!==e&&u.close(),this._editModeChanged(this[t],e),this.dispatchEvent(new CustomEvent("edit-mode-changed",{detail:this[t]}))),"manifestEditMode"==t&&(this._manifestEditModeChanged(this[t],e),this.dispatchEvent(new CustomEvent("manifest-edit-mode-changed",{detail:this[t]})))}))}_redoChanged(e){this.canRedo=e.detail.value}_undoChanged(e){this.canUndo=e.detail.value}static get properties(){return{...super.properties,t:{type:Object},userName:{type:String,attribute:"user-name"},activeDrag:{type:Boolean},activeType:{type:String},activeNode:{type:Object},activeTagName:{type:String},canUndo:{type:Boolean,attribute:"can-undo"},canRedo:{type:Boolean,attribute:"can-redo"},rpgHat:{type:String},userPicture:{type:String,attribute:"user-picture"},userMenuOpen:{type:Boolean},soundIcon:{type:String},darkMode:{type:Boolean,reflect:!0,attribute:"dark-mode"},backLink:{type:String},backText:{type:String},__editIcon:{type:String},__editText:{type:String},painting:{type:Boolean,reflect:!0},pageAllowed:{type:Boolean,attribute:"page-allowed",reflect:!0},editMode:{type:Boolean,reflect:!0,attribute:"edit-mode"},manifestEditMode:{type:Boolean,attribute:"manifest-edit-mode",reflect:!0},activeTitle:{type:String,attribute:"active-title"},activeItem:{type:Object},manifest:{type:Object},trayDetail:{type:String,attribute:"tray-detail",reflect:!0},onInternalRoute:{type:Boolean},platformConfig:{type:Object}}}connectedCallback(){super.connectedCallback(),this._registerKeyboardShortcuts(),x.enable(),s((e=>{this.trayDetail=n(i.trayDetail),this.__disposer.push(e)})),s((e=>{o.userData&&(this.userName=n(o.userData.userName),this.userPicture=n(o.userData.userPicture),this.updateAvailableButtons()),this.__disposer.push(e)})),s((e=>{const t=this.editMode,a=n(o.editMode);this.editMode=a,v.writeMemory("editMode",this.editMode),!t&&a&&i.activeNode&&i.activeNode.tagName&&(i.trayDetail="content-edit",i.haxTray&&(i.haxTray.trayDetail="content-edit",i.haxTray.collapsed=!1)),this.__disposer.push(e)})),s((e=>{this.manifest=n(o.manifest),this.manifest&&this.manifest.metadata&&this.manifest.metadata.platform?this.platformConfig=n(this.manifest.metadata.platform):this.platformConfig={},this.__disposer.push(e)})),s((e=>{this.pageAllowed=n(o.pageAllowed),this.__disposer.push(e)})),s((e=>{const t=n(o.activeItem);if(this.activeItem=t,this.updateAvailableButtons(),t&&t.id){this.activeTitle=t.title,this.onInternalRoute=t._internalRoute||!1;const e=o.currentRouteSupportsHaxEditor();o.pageAllowed=e}else this.onInternalRoute=!1,o.pageAllowed=!1;this.__disposer.push(e)}))}disconnectedCallback(){for(var e in x.disable(),this.__disposer)this.__disposer[e].dispose();super.disconnectedCallback()}_updateEditButtonLabel(){this.editMode?this.__editText=`${this.t.save} • Ctrl⇧S`:this.__editText=`${this.t.edit} • Ctrl⇧E`}_registerKeyboardShortcuts(){x.register({key:"S",ctrl:!0,shift:!0,callback:e=>{this._editButtonTap(e)},condition:()=>o.isLoggedIn&&this.pageAllowed&&this.editMode,description:"Save page and exit edit mode",context:"edit"}),x.register({key:"E",ctrl:!0,shift:!0,callback:e=>{this._editButtonTap(e)},condition:()=>o.isLoggedIn&&this.pageAllowed&&!this.editMode,description:"Enter edit mode",context:"view"}),x.register({key:"W",ctrl:!0,shift:!0,callback:e=>{this._saveAndEditButtonTap(e)},condition:()=>o.isLoggedIn&&this.pageAllowed&&this.editMode,description:"Save and continue editing",context:"edit"}),x.register({key:"/",ctrl:!0,shift:!0,callback:e=>{this._cancelButtonTap(e)},condition:()=>o.isLoggedIn&&this.editMode,description:"Cancel editing",context:"edit"}),x.register({key:"V",ctrl:!0,shift:!0,callback:e=>{i.haxTray&&("view-source"===i.haxTray.trayDetail?i.haxTray.collapsed=!0:(i.haxTray.trayDetail="view-source",i.haxTray.shadowRoot.querySelector("#view-source").openSource(),i.haxTray.collapsed=!1))},condition:()=>o.isLoggedIn&&this.editMode,description:"Toggle view source mode",context:"edit"}),x.register({key:"B",ctrl:!0,shift:!0,callback:e=>{i.haxTray&&("content-add"===i.haxTray.trayDetail?i.haxTray.collapsed=!i.haxTray.collapsed:(i.haxTray.trayDetail="content-add",i.haxTray.collapsed=!1))},condition:()=>o.isLoggedIn&&this.editMode,description:"Open block browser",context:"edit"}),x.register({key:"1",ctrl:!0,shift:!0,callback:e=>{if(this.editMode)i.haxTray&&(i.haxTray.trayDetail="content-edit",i.haxTray.collapsed=!1);else if(this.platformAllows("addPage")){const e=this.shadowRoot.querySelector("#addpagebutton");e&&e.HAXCMSButtonClick()}},condition:()=>o.isLoggedIn,description:"Configure panel (edit) / Add page (view)",context:"global"}),x.register({key:"2",ctrl:!0,shift:!0,callback:e=>{this.editMode?i.haxTray&&("content-add"===i.haxTray.trayDetail?i.haxTray.collapsed=!i.haxTray.collapsed:(i.haxTray.trayDetail="content-add",i.haxTray.collapsed=!1)):this.platformAllows("outlineDesigner")&&this._outlineButtonTap(e)},condition:()=>o.isLoggedIn,description:"Blocks browser (edit) / Site outline (view)",context:"global"}),x.register({key:"3",ctrl:!0,shift:!0,callback:e=>{this.editMode?i.haxTray&&("content-map"===i.haxTray.trayDetail?i.haxTray.collapsed=!i.haxTray.collapsed:(i.haxTray.trayDetail="content-map",i.haxTray.collapsed=!1)):this.platformAllows("styleGuide")&&this._styleGuideButtonTap(e)},condition:()=>o.isLoggedIn,description:"Page structure (edit) / Style guide (view)",context:"global"}),x.register({key:"4",ctrl:!0,shift:!0,callback:e=>{this.editMode?i.haxTray&&("view-source"===i.haxTray.trayDetail?i.haxTray.collapsed=!0:(i.haxTray.trayDetail="view-source",i.haxTray.shadowRoot.querySelector("#view-source").openSource(),i.haxTray.collapsed=!1)):this.platformAllows("insights")&&this._insightsButtonTap(e)},condition:()=>o.isLoggedIn,description:"View source (edit) / Insights dashboard (view)",context:"global"}),x.register({key:"5",ctrl:!0,shift:!0,callback:e=>{this.editMode?u.waveWand(["sources","/"],this.shadowRoot.querySelector("#merlin"),null):this.platformAllows("manifest")&&this._manifestButtonTap(e)},condition:()=>o.isLoggedIn,description:"Media browser (edit) / Site settings (view)",context:"global"}),x.register({key:"6",ctrl:!0,shift:!0,callback:e=>{u.waveWand(["","*"],this.shadowRoot.querySelector("#merlin"),null)},condition:()=>o.isLoggedIn,description:"Open Merlin (Super Daemon)",context:"global"})}_editButtonTap(e){const t=n(o.activeItem);return t&&t.metadata&&t.metadata.locked&&!this.editMode?(o.toast("This page is locked. Click the lock button to unlock it before editing.",3e3,{hat:"error"}),o.playSound("error"),!1):!(this.editMode&&"view-source"===i.haxTray.trayDetail&&!globalThis.confirm(this.t.confirmHtmlSourceExit))&&(o.playSound("click"),this.editMode=!this.editMode,this.editMode||this.dispatchEvent(new CustomEvent("haxcms-save-node",{bubbles:!0,composed:!0,cancelable:!1,detail:o.activeItem})),void globalThis.dispatchEvent(new CustomEvent("simple-modal-hide",{bubbles:!0,cancelable:!0,detail:{}})))}_saveAndEditButtonTap(e){if(this.editMode&&"view-source"===i.haxTray.trayDetail&&!globalThis.confirm(this.t.confirmHtmlSourceExit))return!1;o.playSound("click"),this.dispatchEvent(new CustomEvent("haxcms-save-node",{bubbles:!0,composed:!0,cancelable:!1,detail:{...o.activeItem,keepEditMode:!0}})),globalThis.dispatchEvent(new CustomEvent("simple-modal-hide",{bubbles:!0,cancelable:!0,detail:{}}))}_insightsButtonTap(e){o.playSound("click");const t=globalThis.document.createElement("haxcms-site-insights"),a=new CustomEvent("simple-modal-show",{bubbles:!0,composed:!0,cancelable:!1,detail:{title:this.t.insights,styles:{"--simple-modal-titlebar-background":"black","--simple-modal-titlebar-color":"light-dark(black, white)","--simple-modal-width":"94vw","--simple-modal-min-width":"300px","--simple-modal-z-index":"100000000","--simple-modal-height":"94vh","--simple-modal-min-height":"300px","--simple-modal-titlebar-height":"80px"},elements:{content:t},invokedBy:this.shadowRoot.querySelector("#insightsbutton"),clone:!1,modal:!1}});globalThis.dispatchEvent(a)}_styleGuideButtonTap(e){o.playSound("click"),globalThis.location.href="x/theme/style-guide"}async _cancelButtonTap(e){if(await i.activeHaxBody.haxToContent()!=this._originalContent&&!globalThis.confirm(this.t.unsavedChangesWillBeLostIfSelectingOkAreYouSure))return!1;this.editMode=!1,o.playSound("error"),this.dispatchEvent(new CustomEvent("hax-cancel",{bubbles:!0,composed:!0,cancelable:!1,detail:e.detail})),globalThis.dispatchEvent(new CustomEvent("simple-modal-hide",{bubbles:!0,cancelable:!0,detail:{}}))}_deleteButtonTap(e){o.playSound("click");let t=globalThis.document.createElement("span");t.innerHTML=`"${o.activeItem.title}" will be removed from the outline but its content stays on the file system.`;let a=globalThis.document.createElement("button");a.appendChild(globalThis.document.createTextNode("Confirm")),a.classList.add("hax-modal-btn"),a.addEventListener("click",this._deleteActive.bind(this));let i=globalThis.document.createElement("button");i.appendChild(globalThis.document.createTextNode("cancel")),i.addEventListener("click",(()=>o.playSound("error"))),i.setAttribute("dialog-dismiss","dialog-dismiss"),i.classList.add("hax-modal-btn"),i.classList.add("cancel");let s=globalThis.document.createElement("span");s.appendChild(a),s.appendChild(i);const n=new CustomEvent("simple-modal-show",{bubbles:!0,composed:!0,cancelable:!1,detail:{title:"Permanently delete this page?",styles:{"--simple-modal-titlebar-background":"black","--simple-modal-titlebar-color":"light-dark(black, white)","--simple-modal-width":"25vw","--simple-modal-min-width":"300px","--simple-modal-z-index":"100000000","--simple-modal-height":"15vh","--simple-modal-min-height":"300px","--simple-modal-titlebar-height":"80px"},elements:{content:t,buttons:s},invokedBy:this,clone:!1,modal:!0}});globalThis.dispatchEvent(n)}_deleteActive(e){o.playSound("click");const t=new CustomEvent("haxcms-delete-node",{bubbles:!0,composed:!0,cancelable:!1,detail:{item:o.activeItem}});this.dispatchEvent(t)}_editTitlePrompt(e){const t=n(o.activeItem);if(!t||!t.id)return;const a=t.title||"",i=globalThis.SuperDaemonManager.requestAvailability();o.playSound("click"),i.waveWand([a,"/",{},"edit-title","Edit title"])}_editDescriptionPrompt(e){const t=n(o.activeItem);if(!t||!t.id)return;const a=t.description||"",i=globalThis.SuperDaemonManager.requestAvailability();o.playSound("click"),i.waveWand([a,"/",{},"edit-description","Edit description",""])}_toggleLockStatus(e){const t=n(o.activeItem);if(!t||!t.id)return;const a=t.metadata&&t.metadata.locked;o.playSound("click"),globalThis.dispatchEvent(new CustomEvent("haxcms-save-node-details",{bubbles:!0,composed:!0,cancelable:!0,detail:{id:t.id,operation:"setLocked",locked:!a}}))}_duplicatePagePrompt(e){const t=n(o.activeItem);if(!t||!t.id)return;const a=globalThis.prompt("Enter title for duplicated page:",`${t.title} (copy)`);if(a&&""!==a.trim()){o.playSound("click");globalThis.SuperDaemonManager.requestAvailability().waveWand([a,"/",{},"create-page","Add Page"])}}_editSlugPrompt(e){const t=n(o.activeItem);if(!t||!t.id)return;const a=t.slug||"",i=globalThis.SuperDaemonManager.requestAvailability();o.playSound("click"),i.waveWand([a,"/",{},"edit-slug","Edit slug",""])}_movePageProgramFromMenu(e){const t=n(o.activeItem);if(!t||!t.id)return;const a=globalThis.SuperDaemonManager.requestAvailability();o.playSound("click"),a.waveWand(["","/",{pageId:t.id},"move-page","Move Page",""])}_toggleLockedStatus(e){const t=n(o.activeItem);if(!t||!t.id)return;const a=!!(!t.metadata||!t.metadata.locked);o.playSound("click"),globalThis.dispatchEvent(new CustomEvent("haxcms-save-node-details",{bubbles:!0,composed:!0,cancelable:!0,detail:{id:t.id,operation:"setLocked",locked:a}}))}_togglePublishedStatus(e){const t=n(o.activeItem);if(!t||!t.id)return;const a=!(t.metadata&&!1!==t.metadata.published);o.playSound("click"),globalThis.dispatchEvent(new CustomEvent("haxcms-save-node-details",{bubbles:!0,composed:!0,cancelable:!0,detail:{id:t.id,operation:"setPublished",published:a}}))}_outlineButtonTap(e){o.playSound("click");const t=new CustomEvent("simple-modal-show",{bubbles:!0,composed:!0,cancelable:!1,detail:{title:this.t.outlineDesigner,styles:{"--simple-modal-titlebar-background":"black","--simple-modal-titlebar-color":"light-dark(black, white)","--simple-modal-z-index":"100000000","--simple-modal-titlebar-height":"80px","--simple-modal-width":"85vw","--simple-modal-max-width":"85vw","--simple-modal-height":"85vh","--simple-modal-max-height":"85vh"},elements:{content:globalThis.document.createElement("haxcms-outline-editor-dialog")},invokedBy:this.shadowRoot.querySelector("#outlinebutton"),clone:!1,modal:!0}});globalThis.dispatchEvent(t)}_addButtonTap(){o.playSound("click"),setTimeout((()=>{globalThis.location=this.backLink}),100)}_manifestButtonTap(e){o.playSound("click"),globalThis.dispatchEvent(new CustomEvent("simple-modal-hide",{bubbles:!0,cancelable:!0,detail:{}})),import("./haxcms-site-dashboard.js").then((()=>{globalThis.dispatchEvent(new CustomEvent("simple-modal-show",{bubbles:!0,composed:!0,cancelable:!1,detail:{title:this.t.siteSettings,styles:{"--simple-modal-titlebar-background":"black","--simple-modal-titlebar-color":"light-dark(black, white)","--simple-modal-z-index":"100000000","--simple-modal-titlebar-height":"80px","--simple-modal-width":"85vw","--simple-modal-max-width":"85vw","--simple-modal-height":"85vh","--simple-modal-max-height":"85vh"},elements:{content:globalThis.document.createElement("haxcms-site-dashboard")},invokedBy:this.shadowRoot.querySelector("#manifestbtn"),clone:!1,modal:!0}})),setTimeout((()=>{globalThis.dispatchEvent(new CustomEvent("haxcms-load-site-dashboard",{bubbles:!0,composed:!0,cancelable:!1,detail:e.target}))}),0)}))}_editModeChanged(e,t){e?(setTimeout((async()=>{this._originalContent=await i.activeHaxBody.haxToContent()}),100),this.__editIcon="icons:save",u.appendContext("HAX"),u.removeContext("CMS")):(this.__editIcon="icons:create",u.appendContext("CMS"),u.removeContext("HAX")),this._updateEditButtonLabel(),void 0!==t&&(o.editMode=e,e&&(i.haxTray.collapsed=!1))}_outlineEditModeChanged(e,t){this.dispatchEvent(new CustomEvent("haxcms-outline-edit-mode-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:e}))}_manifestEditModeChanged(e,t){this.dispatchEvent(new CustomEvent("haxcms-manifest-edit-mode-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:e}))}async _konamiCodeActivated(e){if(!this.konamiCodeActivated){this.konamiCodeActivated=!0;try{const e=await import("./haxcms-cheat-codes.js");e.addCheatCodeMethods(this,u),e.defineCheatCodes(this,u),i.toast("🎮 Cheat codes unlocked! Check Merlin for new programs."),u.close(),setTimeout((()=>{u.mini=!0,u.wand=!0,u.activeNode=this.shadowRoot.querySelector("#merlin"),u.open(),u.items=u.filterItems(u.allItems,u.context),u.runProgram("","*")}),100)}catch(e){console.error("🎮 Failed to load cheat codes:",e),i.toast("🎮 Failed to unlock cheat codes")}}}}globalThis.customElements.define(HAXCMSSiteEditorUI.tag,HAXCMSSiteEditorUI);export{HAXCMSSiteEditorUI};