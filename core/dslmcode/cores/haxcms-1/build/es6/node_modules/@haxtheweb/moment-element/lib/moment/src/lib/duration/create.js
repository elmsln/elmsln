import{Duration as o,isDuration as s}from"./constructor.js";import e from"../utils/is-number.js";import r from"../utils/to-int.js";import t from"../utils/abs-round.js";import i from"../utils/has-own-prop.js";import{DATE as n,HOUR as m,MINUTE as a,SECOND as l,MILLISECOND as c}from"../units/constants.js";import{cloneWithOffset as f}from"../units/offset.js";import{createLocal as p}from"../create/local.js";import{createInvalid as d}from"./valid.js";var u=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,h=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;export function createDuration(d,v){var j,M,I,D=d,y=null;return s(d)?D={ms:d._milliseconds,d:d._days,M:d._months}:e(d)?(D={},v?D[v]=d:D.milliseconds=d):(y=u.exec(d))?(j="-"===y[1]?-1:1,D={y:0,d:r(y[n])*j,h:r(y[m])*j,m:r(y[a])*j,s:r(y[l])*j,ms:r(t(1e3*y[c]))*j}):(y=h.exec(d))?(j="-"===y[1]?-1:(y[1],1),D={y:parseIso(y[2],j),M:parseIso(y[3],j),w:parseIso(y[4],j),d:parseIso(y[5],j),h:parseIso(y[6],j),m:parseIso(y[7],j),s:parseIso(y[8],j)}):null==D?D={}:"object"==typeof D&&("from"in D||"to"in D)&&(I=function momentsDifference(o,s){var e;if(!o.isValid()||!s.isValid())return{milliseconds:0,months:0};s=f(s,o),o.isBefore(s)?e=positiveMomentsDifference(o,s):((e=positiveMomentsDifference(s,o)).milliseconds=-e.milliseconds,e.months=-e.months);return e}(p(D.from),p(D.to)),(D={}).ms=I.milliseconds,D.M=I.months),M=new o(D),s(d)&&i(d,"_locale")&&(M._locale=d._locale),M}function parseIso(o,s){var e=o&&parseFloat(o.replace(",","."));return(isNaN(e)?0:e)*s}function positiveMomentsDifference(o,s){var e={milliseconds:0,months:0};return e.months=s.month()-o.month()+12*(s.year()-o.year()),o.clone().add(e.months,"M").isAfter(s)&&--e.months,e.milliseconds=+s-+o.clone().add(e.months,"M"),e}createDuration.fn=o.prototype,createDuration.invalid=d;