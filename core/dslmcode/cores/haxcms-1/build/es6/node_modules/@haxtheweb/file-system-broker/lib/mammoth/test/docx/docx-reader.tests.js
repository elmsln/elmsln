var e=require("assert"),t=require("../../lib/docx/docx-reader"),n=require("../../lib/documents"),r=require("../../lib/xml"),o=require("../testing"),a=require("../test")(module),i=o.testData,m=o.createFakeDocxFile;a("can read document with single paragraph with single run of text",(function(){var r=n.Document([n.Paragraph([n.Run([n.Text("Hello.")])])]),o=m({"word/document.xml":i("simple/word/document.xml")});return t.read(o).then((function(t){e.deepEqual(r,t.value)}))})),a("hyperlink hrefs are read from relationships file",(function(){var n=m({"word/document.xml":i("hyperlinks/word/document.xml"),"word/_rels/document.xml.rels":i("hyperlinks/word/_rels/document.xml.rels")});return t.read(n).then((function(t){var n=t.value.children[0];e.equal(1,n.children.length);var r=n.children[0];e.equal(r.href,"http://www.example.com"),e.equal(r.children.length,1)}))}));var s={r:"http://schemas.openxmlformats.org/package/2006/relationships"};function createPackageRelationships(e){return r.writeString(r.element("r:Relationships",{},[r.element("r:Relationship",{Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",Target:e})]),s)}a("main document is found using _rels/.rels",(function(){var o=r.element("r:Relationships",{},[r.element("r:Relationship",{Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",Target:"/word/document2.xml"})]),a=m({"word/document2.xml":i("simple/word/document.xml"),"_rels/.rels":r.writeString(o,s)}),l=n.Document([n.Paragraph([n.Run([n.Text("Hello.")])])]);return t.read(a).then((function(t){e.deepEqual(l,t.value)}))})),a("error is thrown when main document part does not exist",(function(){var n=r.element("r:Relationships",{},[r.element("r:Relationship",{Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",Target:"/word/document2.xml"})]),o=m({"_rels/.rels":r.writeString(n,s)});return t.read(o).then((function(t){e.ok(!1,"Expected error")}),(function(t){e.equal(t.message,"Could not find main document part. Are you sure this is a valid .docx file?")}))})),a("part paths",{"main document part is found using package relationships":function(){var n=r.element("r:Relationships",{},[r.element("r:Relationship",{Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",Target:"/word/document2.xml"})]),o=m({"word/document2.xml":" ","_rels/.rels":r.writeString(n,s)});return t._findPartPaths(o).then((function(t){e.equal(t.mainDocument,"word/document2.xml")}))},"word/document.xml is used as fallback location for main document part":function(){var n=m({"word/document.xml":" "});return t._findPartPaths(n).then((function(t){e.equal(t.mainDocument,"word/document.xml")}))}}),[{name:"comments",type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments"},{name:"endnotes",type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/endnotes"},{name:"footnotes",type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/footnotes"},{name:"numbering",type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/numbering"},{name:"styles",type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles"}].forEach((function(n){a(n.name+" part is found using main document relationships",(function(){var o=m({"_rels/.rels":createPackageRelationships("word/document.xml"),"word/document.xml":" ","word/_rels/document.xml.rels":r.writeString(r.element("r:Relationships",{},[r.element("r:Relationship",{Type:n.type,Target:"target-path.xml"})]),s),"word/target-path.xml":" "});return t._findPartPaths(o).then((function(t){e.equal(t[n.name],"word/target-path.xml")}))})),a("word/"+n.name+".xml is used as fallback location for "+n.name+" part",(function(){var r={"_rels/.rels":createPackageRelationships("word/document.xml"),"word/document.xml":" "};r["word/"+n.name+".xml"]=" ";var o=m(r);return t._findPartPaths(o).then((function(t){e.equal(t[n.name],"word/"+n.name+".xml")}))}))}));