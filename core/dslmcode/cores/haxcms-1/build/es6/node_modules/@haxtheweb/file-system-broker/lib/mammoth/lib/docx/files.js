var r=require("fs"),e=require("url"),o=require("os"),t=require("path").resolve,n=require("path-is-absolute"),i=require("../promises");exports.Files=function Files(r){return{read:function read(e,o){return function resolveUri(e){var o=uriToPath(e);return n(o)?i.resolve(o):r?i.resolve(t(r,o)):i.reject(new Error("could not find external image '"+e+"', path of input document is unknown"))}(e).then((function(t){return u(t,o).caught((function(o){var t="could not open external image: '"+e+"' (document directory: '"+r+"')\n"+o.message;return i.reject(new Error(t))}))}))}}},exports.uriToPath=uriToPath;var u=i.promisify(r.readFile.bind(r));function uriToPath(r,t){t||(t=o.platform());var n=e.parse(r);if(function isLocalFileUri(r){return"file:"===r.protocol&&(!r.host||"localhost"===r.host)}(n)||function isRelativeUri(r){return!r.protocol&&!r.host}(n)){var i=decodeURIComponent(n.path);return"win32"===t&&/^\/[a-z]:/i.test(i)?i.slice(1):i}throw new Error("Could not convert URI to path: "+r)}