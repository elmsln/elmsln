/**
 * Copyright 2025 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{html as e}from"../../../../../lit/index.js";import{store as t}from"../../core/haxcms-site-store.js";import{HAXCMSI18NMixin as i}from"../../core/utils/HAXCMSI18NMixin.js";import{DDD as r}from"../../../../d-d-d/d-d-d.js";import{autorun as s,toJS as o}from"../../../../../mobx/dist/mobx.esm.js";export class SitePrintRoute extends(i(r)){static get tag(){return"site-print-route"}constructor(){super(),this.windowControllers=new AbortController,this.HAXCMSI18NMixinBase="../../../",this.t.print="Print",this.t.redirectingToPrint="Redirecting to print mode...",this.t.noPageSpecified="No page specified for printing",this.t.pageNotFound="The specified page could not be found",this.redirectToPrintMode()}getPageSlugFromUrl(){return new URLSearchParams(globalThis.location.search).get("page")}validatePage(e){if(!e||!t.routerManifest||!t.routerManifest.items)return null;const i=t.routerManifest.items.find((t=>t.slug===e&&!t._internalRoute&&!t.slug.startsWith("x/")));return i?!t.isLoggedIn&&i.metadata&&!1===i.metadata.published?null:i:null}getFallbackPage(){if(t.routerManifest&&t.routerManifest.items){const e=t.routerManifest.items.filter((e=>!(!e.slug||e._internalRoute||e.slug.startsWith("x/"))&&!(!t.isLoggedIn&&e.metadata&&!1===e.metadata.published)));if(e.length>0)return e[0]}return null}redirectToPrintMode(){const e=this.getPageSlugFromUrl();let t=null;if(e){if(t=this.validatePage(e),!t)return console.warn(`Page not found or not accessible: ${e}`),void(this.errorMessage=this.t.pageNotFound)}else if(t=this.getFallbackPage(),!t)return console.warn("No pages available for printing"),void(this.errorMessage=this.t.noPageSpecified);const i=`${t.slug}?format=print-page`;globalThis.location.href=i}disconnectedCallback(){this.windowControllers.abort(),super.disconnectedCallback()}render(){return this.errorMessage?e`
        <div role="alert" aria-live="assertive">
          <h2>Print Error</h2>
          <p>${this.errorMessage}</p>
          <p>You can try:</p>
          <ul>
            <li>
              Going back to a specific page and using the print function there
            </li>
            <li>Using the format: <code>x/print?page=your-page-slug</code></li>
            <li>Checking that the page exists and is published</li>
          </ul>
        </div>
      `:e`
      <div role="status" aria-live="polite">
        <h2>${this.t.print}</h2>
        <p>${this.t.redirectingToPrint}</p>
      </div>
    `}static get properties(){return{...super.properties,errorMessage:{type:String}}}}globalThis.customElements.define(SitePrintRoute.tag,SitePrintRoute);