/**
 * Copyright 2022 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
const t=["endpoint","name","title","description","params","callback","method"];export class MicroFrontend{constructor(n={}){t.map((t=>this[t]="params"===t?n[t]||{}:n[t]||null))}}class MicroFrontendRegistryEl extends HTMLElement{static get tag(){return"micro-frontend-registry"}constructor(){super(),this.list=[],this.MicroFrontend=MicroFrontend}add(t){this.define(new MicroFrontend(t))}define(n){if(n instanceof MicroFrontend||(console.warn("MicroFrontendRegistry: use class MicroFrontend instance but if keys match it will register still."),console.warn(n)),!Object.keys(n).every((n=>t.includes(n))))return!1;if(n.endpoint.startsWith("/api/")){var e="";e=window.MicroFrontendRegistryConfig.base?window.MicroFrontendRegistryConfig.base:window.location.origin.startsWith("http://127.0.0.1")||window.location.origin.startsWith("http://localhost")?window.location.origin.replace(/127.0.0.1:8(.*)/,"localhost:3000").replace(/localhost:8(.*)/,"localhost:3000"):"https://haxapi.vercel.app",n.endpoint=`${e}${n.endpoint}`}return window.MicroFrontendRegistryConfig[n.name]&&Object.keys(window.MicroFrontendRegistryConfig[n.name]).map((t=>{n[t]=window.MicroFrontendRegistryConfig[n.name][t]})),this.has(n.name)?void 0:(this.list.push(n),!0)}get(t,n=!1){if(t&&this.list.length>0){const n=this.list.find((n=>n.name===t));if(n)return n}return n||console.error(`call for ${t} but not found in micro-frontend-registry`),null}has(t){return null!==this.get(t,!0)}set(t,n={}){if(t&&this.list.length>0&&this.has(t)){const e=this.list.findIndex((n=>n.name===t));this.list[e]=n}return null}async call(t,n={},e=null,i=null,o=""){if(this.has(t)){const r=this.get(t);let s="POST";r.method&&(s=r.method),n.__method&&(s=n.__method,delete n.__method);let a=null;switch(s){case"GET":case"HEAD":const t=new URLSearchParams(n).toString();a=await fetch(t?`${r.endpoint}?${t}${o}`:r.endpoint+o,{method:s}).then((t=>t.ok?t.json():{status:t.status,data:null})).catch(((t,n)=>(console.warn("Request failed",t),{status:500,data:null})));break;default:a=await fetch(r.endpoint+o,{method:s,body:n instanceof FormData?n:JSON.stringify(n)}).then((t=>t.ok?t.json():{status:t.status,data:null})).catch(((t,n)=>(console.warn("Request failed",t),{status:500,data:null})))}return r.callback&&await r.callback(a,i),e&&await e(a,i),a}return null}url(t,n={}){if(this.has(t)){const i=this.get(t);for(var e in n)n.hasOwnProperty(e)&&null==n[e]&&delete n[e];return new URL(i.endpoint).toString()+`?${new URLSearchParams(n).toString()}`}return""}}customElements.define(MicroFrontendRegistryEl.tag,MicroFrontendRegistryEl),window.MicroFrontendRegistry=window.MicroFrontendRegistry||{},window.MicroFrontendRegistryConfig=window.MicroFrontendRegistryConfig||{},window.MicroFrontendRegistry.requestAvailability=()=>(window.MicroFrontendRegistry.instance||(window.MicroFrontendRegistry.instance=document.createElement(MicroFrontendRegistryEl.tag),document.body.appendChild(window.MicroFrontendRegistry.instance)),window.MicroFrontendRegistry.instance);export const MicroFrontendRegistry=window.MicroFrontendRegistry.requestAvailability();