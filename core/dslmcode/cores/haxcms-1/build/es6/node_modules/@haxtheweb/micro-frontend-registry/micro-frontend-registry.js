/**
 * Copyright 2022 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
const t=["endpoint","name","title","description","params","callback","method"];export class MicroFrontend{constructor(n={}){t.map((t=>this[t]="params"===t?n[t]||{}:n[t]||null))}}class MicroFrontendRegistryEl extends HTMLElement{static get tag(){return"micro-frontend-registry"}constructor(){super(),this.list=[],this.MicroFrontend=MicroFrontend}add(t){this.define(new MicroFrontend(t))}define(n){if(n instanceof MicroFrontend||(console.warn("MicroFrontendRegistry: use class MicroFrontend instance but if keys match it will register still."),console.warn(n)),!Object.keys(n).every((n=>t.includes(n))))return!1;if(n.endpoint.startsWith("/api/")){var e="";e=globalThis.MicroFrontendRegistryConfig.base?globalThis.MicroFrontendRegistryConfig.base:globalThis.HAXCMSContext&&"nodejs"===globalThis.HAXCMSContext||!globalThis.location.origin.startsWith("http://127.0.0.1")&&!globalThis.location.origin.startsWith("http://localhost")?"https://open-apis.hax.cloud":globalThis.location.origin.replace(/127.0.0.1:8(.*)/,"localhost:3000").replace(/localhost:8(.*)/,"localhost:3000"),n.endpoint=`${e}${n.endpoint}`}return globalThis.MicroFrontendRegistryConfig[n.name]&&Object.keys(globalThis.MicroFrontendRegistryConfig[n.name]).map((t=>{n[t]=globalThis.MicroFrontendRegistryConfig[n.name][t]})),this.has(n.name)?void 0:(this.list.push(n),!0)}get(t,n=!1){if(t&&this.list.length>0){const n=this.list.find((n=>n.name===t));if(n)return n}return n||console.error(`call for ${t} but not found in micro-frontend-registry`),null}has(t){return null!==this.get(t,!0)}set(t,n={}){if(t&&this.list.length>0&&this.has(t)){const e=this.list.findIndex((n=>n.name===t));this.list[e]=n}return null}async call(t,n={},e=null,i=null,o=""){if(this.has(t)){const s=this.get(t);let r="POST";s.method&&(r=s.method),n.__method&&(r=n.__method,delete n.__method);let l=null;switch(r){case"GET":case"HEAD":const t=new URLSearchParams(n).toString();l=await fetch(t?`${s.endpoint}?${t}${o}`:s.endpoint+o,{method:r}).then((t=>t.ok?t.json():{status:t.status,data:null})).catch(((t,n)=>(console.warn("Request failed",t),{status:500,data:null})));break;default:l=await fetch(s.endpoint+o,{method:r,body:n instanceof FormData?n:JSON.stringify(n)}).then((t=>t.ok?t.json():{status:t.status,data:null})).catch(((t,n)=>(console.warn("Request failed",t),{status:500,data:null})))}return s.callback&&await s.callback(l,i),e&&await e(l,i),l}return null}url(t,n={}){if(this.has(t)){const i=this.get(t);for(var e in n)n.hasOwnProperty(e)&&null==n[e]&&delete n[e];return new URL(i.endpoint).toString()+`?${new URLSearchParams(n).toString()}`}return""}}customElements.define(MicroFrontendRegistryEl.tag,MicroFrontendRegistryEl),globalThis.MicroFrontendRegistry=globalThis.MicroFrontendRegistry||{},globalThis.MicroFrontendRegistryConfig=globalThis.MicroFrontendRegistryConfig||{},globalThis.MicroFrontendRegistry.requestAvailability=()=>(globalThis.MicroFrontendRegistry.instance||(globalThis.MicroFrontendRegistry.instance=globalThis.document.createElement(MicroFrontendRegistryEl.tag),globalThis.document.body.appendChild(globalThis.MicroFrontendRegistry.instance)),globalThis.MicroFrontendRegistry.instance);export const MicroFrontendRegistry=globalThis.MicroFrontendRegistry.requestAvailability();