var e=require("fs"),r=require("path"),t=require("./"),n=require("./promises"),a=require("./images");module.exports=function main(o){var u=o["docx-path"],i=o["output-path"],s=o.output_dir,c=o.output_format;(function readStyleMap(r){return r?n.nfcall(e.readFile,r,"utf8"):n.resolve(null)})(o.style_map).then((function(o){var p={styleMap:o,outputFormat:c};if(s){var l=r.basename(u,".docx");i=r.join(s,l+".html");var f=0;p.convertImage=a.imgElement((function(t){f++;var a=t.contentType.split("/")[1],o=f+"."+a;return t.read().then((function(t){var a=r.join(s,o);return n.nfcall(e.writeFile,a,t)})).then((function(){return{src:o}}))}))}return t.convert({path:u},p).then((function(r){r.messages.forEach((function(e){process.stderr.write(e.message),process.stderr.write("\n")})),(i?e.createWriteStream(i):process.stdout).write(r.value)}))})).done()};