/**
 * Copyright 2025 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{html as e,css as t}from"../../../lit/index.js";import{DDD as o}from"../../d-d-d/d-d-d.js";class SimpleContextMenu extends o{static get tag(){return"simple-context-menu"}static get styles(){return[super.styles,t`
        :host {
          display: inline-block;
          --simple-toolbar-border-radius: 0;
        }

        dialog {
          position: absolute;
          background: light-dark(
            var(--simple-context-menu-background, white),
            var(--simple-context-menu-background-dark, #000000)
          );
          border: var(--ddd-border-sm);
          border-color: light-dark(
            var(--simple-context-menu-border-color, #e0e0e0),
            var(--simple-context-menu-border-color-dark, #444)
          );
          box-shadow: var(
            --simple-context-menu-shadow,
            0 2px 8px rgba(0, 0, 0, 0.15)
          );
          min-width: var(--simple-context-menu-min-width, 200px);
          padding: 0;
          margin: 0;
          z-index: var(--simple-context-menu-z-index, 1000);
          border-radius: var(--ddd-radius-sm);
        }

        dialog::backdrop {
          background: transparent;
        }

        .menu-header {
          padding: var(--ddd-spacing-2);
          font-weight: var(--ddd-font-weight-bold);
          font-size: var(--ddd-font-size-4xs);
          text-transform: uppercase;
          border-bottom: var(--ddd-border-sm);
          margin-bottom: var(--ddd-spacing-1);
          color: var(--simple-context-menu-header-color, inherit);
        }

        ::slotted(*) {
          display: flex;
          align-items: center;
          gap: var(--ddd-spacing-1);
          cursor: pointer;
          border: none;
          background: transparent;
          text-align: left;
          font-size: 12px;
          color: inherit;
        }

        ::slotted(*:hover),
        ::slotted(*:focus) {
          background: light-dark(#f0f0f0, #333);
          outline: none;
        }

        ::slotted([disabled]) {
          opacity: 0.5;
          cursor: not-allowed;
          pointer-events: none;
        }
      `]}static get properties(){return{...super.properties,title:{type:String},open:{type:Boolean,reflect:!0},positionStrategy:{type:String,attribute:"position-strategy"},x:{type:Number},y:{type:Number},offset:{type:Number}}}constructor(){super(),this.title="",this.open=!1,this.positionStrategy="anchor",this.x=0,this.y=0,this.offset=4,this._anchorElement=null}render(){return e`
      <dialog
        id="menu"
        @click=${this._handleBackdropClick}
        @keydown=${this._handleKeydown}
      >
        ${this.title?e` <div class="menu-header">${this.title}</div> `:""}
        <slot></slot>
      </dialog>
    `}toggle(e=null){this.open?this.close():this.openMenu(e)}openMenu(e=null){const t=this.shadowRoot.querySelector("#menu");t&&(this._anchorElement=e,t.showModal(),this.open=!0,this._positionDialog(t,e),setTimeout((()=>{const e=this._getFocusableItems()[0];e&&e.focus()}),0),this.dispatchEvent(new CustomEvent("simple-context-menu-opened",{bubbles:!0,composed:!0})))}close(){const e=this.shadowRoot.querySelector("#menu");e&&e.open&&(e.close(),this.open=!1,this.dispatchEvent(new CustomEvent("simple-context-menu-closed",{bubbles:!0,composed:!0})))}_positionDialog(e,t){if("fixed"===this.positionStrategy)e.style.top=`${this.y}px`,e.style.left=`${this.x}px`;else if("anchor"===this.positionStrategy&&t){const o=t.getBoundingClientRect();e.style.top=`${o.bottom+this.offset}px`,e.style.left=`${o.left}px`}}_getFocusableItems(){return this.shadowRoot.querySelector("slot").assignedElements().filter((e=>!e.hasAttribute("disabled")&&("BUTTON"===e.tagName||e.tabIndex>=0||e.hasAttribute("tabindex"))))}_handleKeydown(e){const t=this._getFocusableItems();if(0===t.length)return;const o=t.indexOf(globalThis.document.activeElement);switch(e.key){case"ArrowDown":e.preventDefault();const n=(o+1)%t.length;t[n]&&t[n].focus();break;case"ArrowUp":e.preventDefault();const s=0===o?t.length-1:o-1;t[s]&&t[s].focus();break;case"Escape":this.close();break;case"Enter":case" ":e.preventDefault(),o>=0&&t[o]&&t[o].click()}}_handleBackdropClick(e){const t=e.target;if("DIALOG"===e.target.nodeName){const o=t.getBoundingClientRect();(e.clientX<o.left||e.clientX>o.right||e.clientY<o.top||e.clientY>o.bottom)&&this.close()}}}globalThis.customElements.define(SimpleContextMenu.tag,SimpleContextMenu);export{SimpleContextMenu};