import{html as e,css as t}from"../../../lit-element/lit-element.js";import{SimpleColors as i}from"../../simple-colors/simple-colors.js";import"../../../@polymer/iron-ajax/iron-ajax.js";import{winEventsElement as a}from"../../utils/utils.js";class HaxAppSearch extends(a(i)){static get styles(){return[...super.styles,t`
        :host {
          display: block;
        }
        hexagon-loader {
          display: none;
          justify-content: center;
          width: 100%;
          z-index: 1000;
          position: absolute;
          --hexagon-color: var(--hax-color-bg-accent, #0085ba);
        }
        hexagon-loader[loading] {
          display: block;
          opacity: 0.8;
        }
        .card-content {
          padding: 16px;
        }
        .card-content p {
          padding: 0;
          margin: 0;
        }
        #itemlist {
          min-height: 172px;
          border: 1px solid #222222;
        }
        hax-app-search-inputs {
          min-height: 80px;
          padding: 0 16px;
        }
        hax-app-pagination {
          min-height: 32px;
          font-size: 12.8px;
          display: none;
          justify-content: flex-end;
          justify-content: center;
        }
      `]}constructor(){super(),this.__winEvents={"hax-store-property-updated":"_haxStorePropertyUpdated"},this.auto=!1,this.headers={},this.method="GET",this.loading=!1,this.requestData={},this.media=[],this.resultMap={},import("../../../@polymer/paper-input/paper-input.js"),import("../../dropdown-select/dropdown-select.js"),import("../../hexagon-loader/hexagon-loader.js"),import("./hax-app-search-inputs.js"),import("./hax-app-search-result.js")}render(){return e`
      <iron-ajax
        id="request"
        handle-as="json"
        @last-response-changed="${this.requestDataChanged}"
        @loading-changed="${this._loadingChanged}"
        debounce-duration="200"
      ></iron-ajax>
      <hax-app-search-inputs
        id="searchinput"
        .label="${this.label}"
        .schema="${this.searchSchema}"
        @search-values-changed="${this._searchValuesChanged}"
      ></hax-app-search-inputs>
      <hax-app-pagination
        id="pagerbottom"
        .request-data="${this.requestData}"
        .pagination="${this.pagination}"
      ></hax-app-pagination>
      <hexagon-loader
        size="medium"
        item-count="4"
        ?loading="${this.loading}"
        aria-roledescription="Loading"
      ></hexagon-loader>
      <div id="itemlist">
        ${this.media.map(t=>e`
            <hax-app-search-result
              image="${t.image}"
              title="${t.title}"
              details="${t.details}"
              .map="${t.map}"
              type="${t.type}"
            ></hax-app-search-result>
          `)}
      </div>
    `}requestDataChanged(e){this.requestData=e.detail.value}updated(e){e.forEach((e,t)=>{["auto","method","headers"].includes(t)&&(this.shadowRoot.querySelector("#request")[t]=this[t]),"requestEndPoint"==t&&(this.shadowRoot.querySelector("#request").url=this[t]),"requestParams"==t&&(this.shadowRoot.querySelector("#request").params=this[t]),"activeApp"==t&&this._resetAppSearch(this[t],e),"requestData"==t&&this._requestDataChanged(this[t],e)})}static get tag(){return"hax-app-search"}static get properties(){return{activeApp:{type:Object},auto:{type:Boolean},searchSchema:{type:Object},headers:{type:Object},method:{type:String},loading:{type:Boolean},requestData:{type:Object},media:{type:Array},requestEndPoint:{type:String},requestParams:{type:Object},resultMap:{type:Object}}}_searchValuesChanged(e){let t=this.requestParams;for(let i in e.detail)""!=e.detail[i]&&(t[i]=e.detail[i]);this.requestParams={...this.requestParams}}_resetAppSearch(e,t){if(null!=e){let t=e;var i={};this.label=t.details.title,this.auto=!1,this.media=[],void 0!==t.connection.data&&(i=t.connection.data),void 0!==t.connection.operations.browse.data&&(i=Object.assign(i,t.connection.operations.browse.data)),this.method=t.connection.operations.browse.method,this.headers={},void 0!==t.connection.headers&&(this.headers=t.connection.headers),this.requestParams={},this.requestParams=i;var a=t.connection.protocol+"://"+t.connection.url;"/"!=a.substr(a.length-1)&&(a+="/"),void 0!==t.connection.operations.browse.endPoint&&(a+=t.connection.operations.browse.endPoint),this.requestEndPoint=a,this.searchSchema={};var o={properties:{}};void 0!==t.connection.operations.browse.search&&(o.properties=t.connection.operations.browse.search,this.searchSchema=o),this.resultMap=t.connection.operations.browse.resultMap,this.pagination={},void 0!==t.connection.operations.browse.pagination&&(this.pagination=t.connection.operations.browse.pagination),void 0!==t.connection.auto?this.auto=t.connection.auto:this.auto=!0}}_haxStorePropertyUpdated(e){e.detail&&void 0!==e.detail.value&&e.detail.property&&(this[e.detail.property]=e.detail.value)}_requestDataChanged(e,t){if(this.resultMap&&this.resultMap.items&&typeof e!={}&&void 0!==t){let t=[],o=this.resultMap,s=[];if(void 0!==this._resolveObjectPath(o.items,e)?s=this._resolveObjectPath(o.items,e):null!=e&&(s=e),null!=s){for(var i=0;i<s.length;i++){if(t[i]={title:this._resolveObjectPath(o.preview.title,s[i]),details:this._resolveObjectPath(o.preview.details,s[i]),type:o.defaultGizmoType,map:{}},void 0!==t[i].details&&null!=t[i].details&&(t[i].details=t[i].details.replace(/(<([^>]+)>)/gi,"")),o.preview.id.constructor===Object){let e=this._resolveObjectPath(o.preview.id.property,s[i]);"split"===o.preview.id.op&&(e=e.split(o.preview.id.delimiter),t[i].id=e[o.preview.id.position])}else t[i].id=this._resolveObjectPath(o.preview.id,s[i]);for(var a in void 0!==o.preview.image?t[i].image=this._resolveObjectPath(o.preview.image,s[i]):void 0!==o.image?t[i].image=o.image:t[i].image="",o.gizmo)if("_url_source"===a){let e="";e=void 0!==t[i].map.__id?t[i].map.__id:this._resolveObjectPath(o.gizmo.id,s[i]),t[i].map.source=o.gizmo._url_source.replace("<%= id %>",e)}else if(o.gizmo[a].constructor===Object){let e=this._resolveObjectPath(o.gizmo[a].property,s[i]);"split"===o.gizmo[a].op&&(e=e.split(o.gizmo[a].delimiter),t[i].map[a]=e[o.gizmo[a].position],"id"===a&&(t[i].map.__id=t[i].map[a]))}else t[i].map[a]=this._resolveObjectPath(o.gizmo[a],s[i]);void 0===t[i].map.url&&void 0!==t[i].map.source&&(t[i].map.url=t[i].map.source),void 0!==o.gizmo.type&&(t[i].type=this._resolveObjectPath(o.gizmo.type,s[i]))}this.media=[...t]}}}_loadingChanged(e){this.loading=e.detail.value}_resolveObjectPath(e,t){return e.split(".").reduce((function(e,t){return e?e[t]:null}),t||self)}}window.customElements.define(HaxAppSearch.tag,HaxAppSearch);export{HaxAppSearch};