export function b64toBlob(e,t="",n=512){const r=atob(e),o=[];for(let e=0;e<r.length;e+=n){const t=r.slice(e,e+n),i=new Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);const a=new Uint8Array(i);o.push(a)}return new Blob(o,{type:t})}export function CSVtoArray(e){let t,n="",r=[""],o=[r],i=0,a=0,l=!0;for(t in e)t=e[t],'"'===t?(l&&t===n&&(r[i]+=t),l=!l):","===t&&l?t=r[++i]="":"\n"===t&&l?("\r"===n&&(r[i]=r[i].slice(0,-1)),r=o[++a]=[t=""],i=0):r[i]+=t,n=t;return o}export function cleanVideoSource(e){var t=e.split("?"),n="";if(e=t[0],2==t.length){let e=t[1].split("&"),r=e[0].split("="),o=Array.isArray(e.shift())?e.shift().join(""):e.shift();if("v"==r[0]){let e=void 0!==o&&""!==o?"?"+o:"";n=r[1]+e}}return-1==e.indexOf("player.vimeo.com")&&-1!=e.indexOf("vimeo.com")?(-1!=e.indexOf("/videos/")&&(e=e.replace("/videos/","/")),e.replace("vimeo.com/","player.vimeo.com/video/")):-1!=e.indexOf("youtube.com/watch")?e.replace("youtube.com/watch","youtube.com/embed/")+n:-1!=e.indexOf("youtube-no-cookie.com/")?e.replace("youtube-no-cookie.com/","youtube.com/")+n:-1!=e.indexOf("youtu.be")?e.replace("youtu.be/","www.youtube.com/embed/")+n:-1!=e.indexOf("sketchfab.com")&&-1==e.indexOf("/embed")?e+"/embed":e}function wrap(e,t){e&&e.parentNode&&(e.parentNode.insertBefore(t,e),t.appendChild(e))}export function lightChildrenToShadowRootSelector(e,t){let n=e.firstElementChild;for(;n;)e.shadowRoot.querySelector(t).appendChild(n),n=e.firstElementChild}function wrapAll(e,t){if(e&&e.length)for(var n in e[0].parentNode.insertBefore(t,e[0]),e)t.appendChild(e[n])}function unwrap(e){if(e&&e.parentNode){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.remove()}}export function normalizeEventPath(e){return e.composed&&e.composedPath?e.composedPath():e.path?e.path:e.originalTarget?[e.originalTarget]:[e.target]}function formatHTML(e){var t=document.createElement("div");return t.innerHTML=e.trim(),formatHTMLInternals(t,0).innerHTML}function formatHTMLInternals(e,t){let n,r=new Array(1+t++).join("  "),o=new Array(t-1).join("  ");for(var i=0;i<e.children.length;i++)n=document.createTextNode("\n"+r),e.insertBefore(n,e.children[i]),formatHTMLInternals(e.children[i],t),e.lastElementChild==e.children[i]&&(n=document.createTextNode("\n"+o),e.appendChild(n));return e}export function localStorageGet(e,t=""){try{return null===localStorage.getItem(e)?t:JSON.parse(localStorage.getItem(e))}catch(e){return!1}}export function localStorageSet(e,t){try{return localStorage.setItem(e,JSON.stringify(t))}catch(e){return!1}}function validURL(e){let t;try{t=new URL(e)}catch(t){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}return"https:"===t.protocol}function valueMapTransform(e,t){let n=[];return t&&e.forEach((e=>{let r={};for(var o in t){let n=t[o];if(!0===n||!1===n||null===n)r[o]=n;else if("function"==typeof n)try{r[o]=n(e)}catch(e){console.warn(e)}else"string"==typeof n&&varExists(e,n)?r[o]=varGet(e,n):r[o]=n}n.push(r)})),n}function camelToDash(e){return e.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()}function dashToCamel(e){return e.replace(/-([a-z])/g,(function(e){return e[1].toUpperCase()}))}function haxElementToNode(e){let t=e.tag,n=e.content?e.content:"",r=e.properties?e.properties:{};window.HaxStore&&window.HaxStore.instance&&window.HaxStore.instance._isSandboxed&&"iframe"===t&&(t="webview");var o=document.createElement(t);o.innerHTML=n;var i=o.cloneNode(!0);for(var a in r){let e=camelToDash(a);r.hasOwnProperty(a)&&(!0===r[a]?i.setAttribute(e,r[a]):!1===r[a]?i.removeAttribute(e):null!=r[a]&&r[a].constructor===Array?o.properties&&o.properties[a]&&o.properties[a].readOnly||(i.set?i.set(e,r[a]):i[e]=[...r[a]]):null!=r[a]&&r[a].constructor===Object?o.properties&&o.properties[a]&&o.properties[a].readOnly||(i.set?i.set(e,r[a]):i[e]={...r[a]}):i.setAttribute(e,r[a]))}return i}function camelCaseToDash(e){return e.replace(/([A-Z])/g,(e=>`-${e[0].toLowerCase()}`))}function encapScript(e){return e&&"function"==typeof e.replace&&(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<script[\s\S]*?>/gi,"&lt;script&gt;")).replace(/<\/script>/gi,"&lt;/script&gt;")).replace(/<hax-(body|tray|store)[\s\S]*?>/gi,"")).replace(/<\/hax-(body|tray|store)[\s\S]*?>/gi,"")).replace(/<h-a-x[\s\S]*?>/gi,"")).replace(/<\/h-a-x*?>/gi,"")).replace(/<style[\s\S]*?>/gi,"&lt;style&gt;")).replace(/<\/style>/gi,"&lt;/style&gt;")).replace(/<template[\s\S]*?>[\s\S]*?&lt;script[\s\S]*?&gt;[\s\S]*?&lt;\/script&gt;/gi,(function(e,t,n,r){return e=(e=(e=(e=e.replace("&lt;script&gt;","<script>")).replace("&lt;/script&gt;","<\/script>")).replace("&lt;style&gt;","<style>")).replace("&lt;/style&gt;","</style>")}))),e}function findTagsInHTML(e){let t={},n="";var r=e.match(/<\/([a-z,0-9]*?)-(\S*?)>/g);for(var o in r)n=r[o].replace("</","").replace(">",""),t[n]=n;return t}function wipeSlot(e,t="*"){if("*"===t)for(;null!==e.firstChild;)e.removeChild(e.firstChild);else for(var n in e.childNodes)void 0!==e.childNodes[n]&&e.childNodes[n].slot===t&&e.removeChild(e.childNodes[n])}function generateResourceID(e="#"){function idPart(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e+idPart()+idPart()+"-"+idPart()+"-"+idPart()+"-"+idPart()+"-"+idPart()+idPart()+idPart()}export function utf2Html(e){return[...e].map((e=>e.codePointAt()>127?`&#${e.codePointAt()};`:e)).join("")}export function htmlEntities(e){return e.replace(/[\u00A0-\u9999<>\&]/gim,(function(e){return"&#"+e.charCodeAt(0)+";"}))}function stripMSWord(e){var t=e.split("\n\r").join("\n").split("\r").join("\n").split("\n\n").join("\n").split("\n\n").join("\n").split("\n\n").join("\n").split("\n").join(" ").replace(/( class=(")?Mso[a-zA-Z]+(")?)/g,"");t=(t=(t=t.replace(/<\!--(\s|.)*?-->/gim,"")).replace(/<\!(\s|.)*?>/gim,"")).replace(/<(\/)*(meta|link|title|html|head|body|span|font|br|\\\\?xml:|xml|st1:|o:|w:|m:|v:)(\s|.)*?>/gim,"");var n=["style","script","applet","embed","noframes","noscript"];for(var r in n){let e=new RegExp("<"+n[r]+"(s|.)*?"+n[r]+"(.*?)>","gim");t=t.replace(e,"")}for(var r in t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/ style='(\s|.)*?'/gim,"")).replace(/ face="(\s|.)*?"/gim,"")).replace(/ align=.*? /g,"")).replace(/ start='.*?'/g,"")).replace(/line-height:.*?\"/g,'"')).replace(/line-height:.*?;/g,"")).replace(/font-weight:normal;/g,"")).replace(/text-decoration:none;/g,"")).replace(/margin-.*?:.*?\"/g,'"')).replace(/margin-.*?:.*?;/g,"")).replace(/ style=""/g,"")).replace(/ id="(\s|.)*?"/gim,"")).replace(/ dir="(\s|.)*?"/gim,"")).replace(/ role="(\s|.)*?"/gim,"")).replace(/ contenteditable="(\s|.)*?"/gim,"")).replace(/ data-(\s|.)*?"(\s|.)*?"/gim,"")).replace(/ class="(\s|.)*?"/gim,"")).replace(/<pstyle/gm,"<p style")).replace(/<a name=\"_GoBack\"><\/a>/gm,"")).replace(/&nbsp;/gm," ")).replace(/<section>/gm,"<p>")).replace(/<\/section>/gm,"</p>")).replace(/<p><p>/gm,"<p>")).replace(/<p><p>/gm,"<p>")).replace(/<\/p><\/p>/gm,"</p>")).replace(/<\/p><\/p>/gm,"</p>")).replace(/<br \/>/gm,"<br/>")).replace(/<p><br \/><b>/gm,"<p><b>")).replace(/<\/p><br \/><\/b>/gm,"</p></b>")).replace(/<b><p>/gm,"<p>")).replace(/<\/p><\/b>/gm,"</p>")).replace(/<b>/gm,"<strong>")).replace(/<\/b>/gm,"</strong>")).replace(/<p style=\".*?\">/gm,"<p>")).replace(/<ul style=\".*?\">/gm,"<ul>")).replace(/<ol style=\".*?\">/gm,"<ol>")).replace(/<li style=\".*?\">/gm,"<li>")).replace(/<td style=\".*?\">/gm,"<td>")).replace(/<tr style=\".*?\">/gm,"<tr>")).replace(/<li><p>/gm,"<li>")).replace(/<\/p><\/li>/gm,"</li>")).replace(/<b><ul>/gm,"<ul>")).replace(/<\/ul><\/b>/gm,"</ul>")).replace(/<b><ol>/gm,"<ol>")).replace(/<\/ol><\/b>/gm,"</ol>")).replace(/<span><p>/gm,"<p>")).replace(/<\/p><\/span>/gm,"</p>")).replace(/<p>(\s*)<\/p>/gm," ")).replace(/<p><\/p>/gm,"")).replace(/<p>&nbsp;<\/p>/gm," ")).replace(/<p><br\/><\/p>/gm,"")).replace(/<p><br><\/p>/gm,"")).replace(/<\/p>(\s*)<p>/gm,"</p><p>")).replace(/ data-hax-ray="(\s|.)*?"/gim,"")).replace(/ class=""/gim,"")).replace(/ class="hax-active"/gim,"")).replace(/ contenteditable="(\s|.)*?"/gim,""),n){let e=new RegExp("<"+n[r]+"></"+n[r]+">","gi");t=t.replace(e,"")}return t=t.trim()}function varExists(e,t){return"__failedToFind__"!=objectValFromStringPos(e,t,"__failedToFind__")}function varGet(e,t,n=""){return objectValFromStringPos(e,t,n)}function objectValFromStringPos(e,t,n=null){for(var r=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),o=0,i=r.length;o<i;++o){var a=r[o];if(!e)return n;if(!(a in e))return n;e=e[a]}return e}async function nodeToHaxElement(e,t="insert-element"){if(!e)return null;var n={};let r;if(void 0!==e.style&&(n.style=e.getAttribute("style")),null!==n.style&&"null"!==n.style||delete n.style,void 0!==e.attributes.class&&(n.class=e.attributes.class.value.replace("hax-active","")),void 0!==e.attributes.id&&(n.id=e.getAttribute("id")),customElements.get(e.tagName.toLowerCase())&&(r=customElements.get(e.tagName.toLowerCase()).properties),void 0===r&&(r=e.__data),void 0!==r){for(var o in r)"class"!=o&&"style"!=o&&r.hasOwnProperty(o)&&void 0!==typeof e[o]&&null!=e[o]&&""!=e[o]?n[o]=e[o]:!1===e[o]?n[o]=!1:!0===e[o]?n[o]=!0:0===e[o]&&(n[o]=0);for(var i in e.attributes)(void 0!==e.attributes[i].name&&"class"!=e.attributes[i].name&&"style"!=e.attributes[i].name&&"id"!=e.attributes[i].name&&e.attributes.hasOwnProperty(i)&&void 0!==typeof e.attributes[i].value&&null!=e.attributes[i].value&&""!=e.attributes[i].value&&!r.hasOwnProperty(dashToCamel(e.attributes[i].name))||"0"==e.attributes[i].value)&&(n[e.attributes[i].name]=e.attributes[i].value)}else for(var i in e.attributes)void 0!==e.attributes[i].name&&"class"!=e.attributes[i].name&&"style"!=e.attributes[i].name&&"id"!=e.attributes[i].name&&e.attributes.hasOwnProperty(i)&&void 0!==typeof e.attributes[i].value&&null!=e.attributes[i].value&&""!=e.attributes[i].value&&(n[e.attributes[i].name]=e.attributes[i].value);let a=e.tagName.toLowerCase();window.HaxStore.instance._isSandboxed&&"iframe"===a&&(a="webview");let l=await window.HaxStore.instance.getHAXSlot(e);""==l&&(l=e.innerText),"a"===a||"mark"===a?n.innerText=l:"p"!==a&&"table"!==a&&"ol"!==a&&"ul"!==a&&"div"!==a||(n.innerHTML=l);let c={tag:a,properties:n,content:l};return null!==t&&(c.eventName=t),c}export const winEventsElement=function(e){return class extends e{__applyWinEvents(e){if(this.__winEvents)for(var t in this.__winEvents)window[(e?"add":"remove")+"EventListener"](t,this[this.__winEvents[t]])}connectedCallback(){for(var e in super.connectedCallback&&super.connectedCallback(),this.__winEvents)this[this.__winEvents[e]]=this[this.__winEvents[e]].bind(this);this.__applyWinEvents(!0)}disconnectedCallback(){this.__applyWinEvents(!1),super.disconnectedCallback&&super.disconnectedCallback()}}};export{wrap,wrapAll,unwrap,formatHTML,validURL,valueMapTransform,haxElementToNode,dashToCamel,camelToDash,camelCaseToDash,encapScript,findTagsInHTML,wipeSlot,generateResourceID,stripMSWord,varExists,varGet,objectValFromStringPos,nodeToHaxElement};const e=!1,t=[Node.ELEMENT_NODE,Node.TEXT_NODE,Node.DOCUMENT_FRAGMENT_NODE];function findNode(n,r,o){const i=r.childNodes||r.children;if(!i)return r;for(let l=0;l<i.length;++l){const c=i[o?l:i.length-1-l];if(a=c,t.includes(a.nodeType)){if(e&&console.debug("checking child",c,"IsLeft",o),n.containsNode(c,!0))return n.containsNode(c,!1)?(e&&console.info("found child",c),c):(e&&console.info("descending child",c),findNode(n,c,o));e&&console.info(r,"does NOT contain",c)}}var a;return r}const n=(()=>{if(document.createElement("div").attachShadow({mode:"open"}).getSelection)return document.addEventListener("selectionchange",(e=>{document.dispatchEvent(new CustomEvent("-shadow-selectionchange"))})),()=>{};let e=!1;const t=[];return document.addEventListener("selectionchange",(n=>{e||(document.dispatchEvent(new CustomEvent("-shadow-selectionchange")),e=!0,window.setTimeout((()=>{e=!1}),0),t.forEach((e=>e(n))))})),e=>t.push(e)})();let r=!1,o=null;n((e=>{"Caret"===window.getSelection().type?r=!0:r&&!o&&(o=Promise.resolve(!0).then((()=>{r=!1,o=null})))}));export function isElementInViewport(e,t={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0}){var n=e.getBoundingClientRect();return n.top>=t.top&&n.left>=t.left&&n.bottom<=t.bottom&&n.right<=t.right}function containsNextElement(e,t,n){const r=t;for(;(t=walkFromNode(t,n))&&t.contains(r););return!!t&&(t instanceof Element&&e.containsNode(t,!0))}function walkFromNode(e,t){if(!t)return e.previousSibling||e.parentNode||null;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}return null}function initialSpace(e){return e.nodeType!==Node.TEXT_NODE?0:/^\s*/.exec(e.textContent)[0].length}const i=new Map;export function getRange(t){if(t.getSelection){const e=t.getSelection();return e.rangeCount?e.getRangeAt(0):null}const n=i.get(t);if(n)return n;const r=window.getSelection().toString(),o=internalGetShadowSelection(t),a=o&&o.range&&o.range.toString()||null;return null!==a&&a!==r&&a.replace(/\s/g,"")!==r.replace(/\s/g,"")&&(console.warn("invalid range, initial text:",r),console.warn("vs",a,o.mode,o.range)),i.set(t,o.range),window.setTimeout((()=>{i.delete(t)}),0),e&&console.debug("getRange got",o),o.range}const a=document.createTextNode("");export function internalGetShadowSelection(t){const n=document.createRange(),o=window.getSelection();if(o&&t.host&&!o.containsNode(t.host,!0))return{range:null,mode:"none"};t.insertBefore(a,t.childNodes[0]);const i=o.containsNode(a);if(a.remove(),i)return{range:null,mode:"outside-before"};t.appendChild(a);const l=o.containsNode(a);if(a.remove(),l)return{range:null,mode:"outside-after"};const measure=()=>o.toString().length;o.toString();if("None"===o.type)return null;if("Caret"!==o.type&&"Range"!==o.type)throw new TypeError("unexpected type: "+o.type);o.type;const c=findNode(o,t,!0);let s,p;if("Range"===o.type&&(s=findNode(o,t,!1),p=function getSelectionDirection(t,n,o){if("Range"!==t.type)return;const measure=()=>t.toString().length,i=measure();if(e&&console.info(`initial selection: "${t.toString()}"`),1===i&&r&&n===o)return e&&console.debug("resetting size=1"),t.extend(n,0),void t.collapseToEnd();let a;return t.modify("extend","forward","character"),a=measure(),e&&console.info(`forward selection: "${t.toString()}"`),a>i||containsNextElement(t,o,!0)?(e&&console.info("got forward >, moving right"),t.modify("extend","backward","character"),!0):a<i||!t.containsNode(n)?(e&&console.info("got forward <, moving left"),t.modify("extend","backward","character"),!1):(t.modify("extend","backward","character"),a=measure(),e&&console.info(`backward selection: "${t.toString()}"`),a>i||containsNextElement(t,n,!1)?(e&&console.info("got backwards >, moving left"),t.modify("extend","forward","character"),!1):a<i||!t.containsNode(o)?(e&&console.info("got backwards <, moving right"),t.modify("extend","forward","character"),!0):void 0)}(o,c,s)),"Caret"===o.type){o.extend(c,0);const e=measure();return o.collapseToEnd(),1===c.nodeType&&c.childNodes&&c.childNodes.length>0?(n.setStart(c.childNodes[0],e),n.setEnd(c.childNodes[0],e)):(n.setStart(c,e),n.setEnd(c,e)),{range:n,mode:"caret"}}if(void 0===p){if("Range"!==o.type)throw new TypeError("unexpected type: "+o.type);return n.setStart(c.childNodes[0],0),n.setEnd(s,s.length),{range:n,mode:"all"}}const d=measure();let u,g;const m=s.length-function ignoredTrailingSpace(e){if(e.nodeType!==Node.TEXT_NODE)return 0;const t=/\s*$/.exec(e.textContent)[0].length;return t?t-1:0}(s);return p?(o.extend(c,0),u=measure()+initialSpace(c),o.extend(s,m),g=m-(measure()-d),o.extend(s,g)):(o.extend(s,m),g=m-measure(),o.extend(c,0),u=measure()-d+initialSpace(c),o.extend(c,u)),e&&(c===s?console.info("got string",c.textContent.substr(u,g-u)):(console.info(">>> string",c.textContent.substr(u)),console.info("<<< string",s.textContent.substr(0,g)))),n.setStart(c,u),n.setEnd(s,g),{mode:p?"right":"left",range:n}}export function ReplaceWithPolyfill(){var e,t=this.parentNode,n=arguments.length;if(t)for(n||t.removeChild(this);n--;)"object"!=typeof(e=arguments[n])?e=this.ownerDocument.createTextNode(e):e.parentNode&&e.parentNode.removeChild(e),n?t.insertBefore(e,this.nextSibling):t.replaceChild(e,this)}