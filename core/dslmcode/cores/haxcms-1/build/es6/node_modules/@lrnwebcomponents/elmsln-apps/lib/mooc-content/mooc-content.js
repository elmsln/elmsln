import{html as e,PolymerElement as t}from"../../../../@polymer/polymer/polymer-element.js";import{dom as o}from"../../../../@polymer/polymer/lib/legacy/polymer.dom.js";import{microTask as i}from"../../../../@polymer/polymer/lib/utils/async.js";import"../../../../@polymer/iron-icons/iron-icons.js";import"../../../../@polymer/iron-icons/hardware-icons.js";import"../../../../@polymer/iron-ajax/iron-ajax.js";import"../../../simple-icon/simple-icon.js";import"../../../simple-icon/lib/simple-icons.js";import"../../../simple-icon/lib/simple-icon-button.js";import"../../../hax-iconset/lib/simple-hax-iconset.js";import"../../../../@polymer/paper-styles/color.js";import"../../../simple-tooltip/simple-tooltip.js";import"../../../../@polymer/app-route/app-location.js";import"../../../../@polymer/app-route/app-route.js";import"../../../grid-plate/grid-plate.js";import"../../../responsive-grid/lib/responsive-grid-row.js";import"../../../responsive-grid/lib/responsive-grid-col.js";import"../../../materializecss-styles/materializecss-styles.js";import"../../../simple-modal/simple-modal.js";import"../elmsln-base-deps.js";import{normalizeEventPath as a}from"../../../utils/utils.js";class MoocContent extends t{static get template(){return e`
    <style include="materializecss-styles">
      :host {
        display: block;
        font-size: 16px;
        box-sizing: content-box;
      }
      #content[data-loading] {
        opacity: .2 !important;
        pointer-events: none;
      }
      #content {
        opacity: 1;
        visibility: visible;
        transition: all .4s ease;
      }
      #block-mooc-nav-block-mooc-nav-nav {
        z-index: 1;
      }
    </style>
    <div id="hackycontainer"><style id="hackycsspotterhates"></style></div>
    <iron-ajax
      reject-with-request
      on-last-error-changed="lastErrorChanged"
      id="fulloutlinepath"
      url="[[fullOutlinePath]]"
      handle-as="json"
      on-response="handleOutlineResponse"
      last-response="{{outlineData}}"></iron-ajax>
    <iron-ajax
      reject-with-request
      on-last-error-changed="lastErrorChanged"
      id="pageajax"
      params="[[requestParams]]"
      url="[[sourcePath]]"
      handle-as="json"
      on-response="handleResponse"
      last-response="{{pageData}}"
      loading="{{_loading}}"></iron-ajax>
    <app-location route="{{route}}" query-params="{{queryParams}}"></app-location>
    <app-route
      route="{{route}}"
      pattern="[[endPoint]]/:type/:id"
      data="{{data}}"
      tail="{{tail}}"
      query-params="{{queryParams}}">
    </app-route>
    <main id="etb-tool-nav" data-offcanvas="">
      <div id="anchor"></div>
      <div class="inner-wrap">
        <section class="main-section etb-book" style="min-height: 318px;">
          <h2 class="element-invisible">Content navigation</h2>
          <div class="r-header row">
            <div class="r-header__left">
              <div class="book-navigation-header book-sibling-nav-container book-navigation-header-2">
                <div class="book-navigation-header book-sibling-nav-container">
                  <lrnsys-dialog id="outlinepopover" data-voicecommand="open outline" label="Outline" header="Outline">
                    <span slot="button">
                      <simple-icon icon="explore"></simple-icon>
                      Outline
                    </span>
                    <div class="elmsln-modal-content" id="block-mooc-helper-mooc-helper-toc-nav-modal">
                      <div id="outlinemodal" on-click="_modalTap"><slot name="outlinemodal"></slot></div>
                    </div>
                  </lrnsys-dialog>
                  <div id="navigation"><slot name="navigation"></slot></div>
                </div>
              </div>
            </div>
            <div id="options" class="r-header__right">
              <slot name="options"></slot>
            </div>
          </div>
          <div class="elmsln-content-wrap" role="main">
          <responsive-grid-row gutter="4">
            <responsive-grid-col xl="2" lg="2" md="3" sm="3" xs="12">
              <section id="block-mooc-nav-block-mooc-nav-nav" class="mooc-nav-block-left block block-mooc-nav-block contextual-links-region block-mooc-nav-block-mooc-nav column" role="navigation" aria-label$="[[outlineTitle]]">
                <div class="block-mooc-nav-block-mooc-title black white-text">[[outlineTitle]]</div>
                <div id="outline"><slot name="outline"></slot></div>
              </section>
              <div id="blocks"><slot name="blocks"></slot></div>
            </responsive-grid-col>
            <responsive-grid-col xl="9" lg="9" md="9" sm="9" xs="12">
              <a id="main-content" class="scrollspy" data-scrollspy="scrollspy"></a>
              <div class="column">
                <div id="content" data-loading$="[[loading]]"><slot name="content"></slot></div>
              </div>
            </responsive-grid-col>
          </responsive-grid-row>
        </section>
        <a class="exit-off-canvas"></a>
      </div>
    </main>`}static get tag(){return"mooc-content"}lastErrorChanged(e){if(e.detail.value){console.error(e);const t=a(e)[0];switch(parseInt(e.detail.value.status)){case 401:case 401:fetch(window.Drupal.settings.basePath,{mode:"no-cors"}).then((e=>{console.log(e),setTimeout((()=>{t.generateRequest()}),250)}))}}}static get observers(){return["_routeChanged(data, route, endPoint)"]}static get properties(){return{elmslnCourse:{type:String},elmslnSection:{type:String},basePath:{type:String},csrfToken:{type:String},endPoint:{type:String},sourcePath:{type:String},fullOutlinePath:{type:String},route:{type:Object,notify:!0},currentTitle:{type:String},requestParams:{type:Object,notify:!0,value:{node:null}},pageData:{type:Object,value:{}},outlineData:{type:Object,value:{}},resetScroll:{type:Boolean,value:!1},responseData:{type:Object,value:{}},basePath:{type:String},elmslnCourse:{type:String},outlineTitle:{type:String},nid:{type:Number},_loading:{type:Boolean,observer:"_contentLoading"},loading:{type:Boolean,reflectToAttribute:!0,value:!1},aliases:{type:Array},activeNodeItem:{type:Object,value:null}}}_modalTap(e){var t=o(e).localTarget;"LRNSYS-BUTTON"===t.tagName&&(null!=this.activeNodeItem&&this.activeNodeItem.classList.remove("book-menu-item-active"),this.activeNodeItem=t,this.activeNodeItem.classList.add("book-menu-item-active"),this.$.outlinepopover.toggleDialog())}_contentLoading(e,t){var o=this;"undefined"==(void 0===e?"undefined":typeof e)||e?this.loading=!0:setTimeout((function(){o.loading=!1,o._resetScroll("anchor"),o.$["main-content"].focus()}),500)}handleResponse(e){if(void 0!==this.pageData.data){var t=this.pageData.data;void 0!==t.ops.redirect?(this.set("route.path",t.ops.redirect),this._routeChanged(this.data,this.route,this.endPoint)):(this.outlineTitle=t.bookOutline.subject,this.$.content.innerHTML=t.content,this.$.navigation.innerHTML=t.topNavigation,this.$.outline.innerHTML=t.bookOutline.content,this.$.options.innerHTML=t.options,this.__injectStyle(t.styles),window.Drupal&&window.Drupal.attachBehaviors(document,window.Drupal.settings),window.WCAutoload&&window.WCAutoload.process(),void 0===this.outlineData.data&&this.$.fulloutlinepath.generateRequest(),i.run((()=>{window.dispatchEvent(new Event("resize"))})))}}handleOutlineResponse(e){var t=this.outlineData.data;"undefined"!=(void 0===t?"undefined":typeof t)&&(this.$.outlinemodal.innerHTML=t.outline,this.aliases=t.aliases)}connectedCallback(){super.connectedCallback(),window.Drupal&&window.Drupal.attachBehaviors(document,window.Drupal.settings)}_routeChanged(e,t,o){if("string"==typeof t.path){var i=t.path.replace("/"+this.elmslnCourse+"/","");if(t.path.startsWith("/"+this.elmslnCourse+"/node/")){var a=t.path;a.endsWith("/")&&(a=a.substring(0,a.length-1));var n=a.split("/");if(!isNaN(parseFloat(n[n.length-1]))&&isFinite(n[n.length-1]))return this.nid=n[n.length-1],this.requestParams.node=this.nid,this.$.pageajax.generateRequest(),void(this.__modal&&this.__modal.opened&&window.dispatchEvent(new CustomEvent("simple-modal-hide",{bubbles:!0,cancelable:!0,detail:{}})));"edit"==n[n.length-1]&&window.location.reload()}else{if(this.aliases&&i&&this.aliases[i])return this.nid=this.aliases[i].replace("node/",""),this.requestParams.node=this.nid,this.$.pageajax.generateRequest(),void(this.__modal&&this.__modal.opened&&window.dispatchEvent(new CustomEvent("simple-modal-hide",{bubbles:!0,cancelable:!0,detail:{}})));if(""==i)return this.requestParams.node=this.nid,this.set("route.path","/"+this.elmslnCourse+"/node/"+this.nid),void this.$.pageajax.generateRequest()}}""!=this.elmslnCourse&&window.location.reload()}ready(){super.ready(),this.__modal=window.SimpleModal.requestAvailability()}_resetScroll(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"anchor";this.resetScroll=!0,this.$[e].scrollIntoView({block:"nearest",behavior:"smooth"})}_toArray(e){return null==e?[]:Object.keys(e).map((function(t){return e[t]}))}__injectStyle(e){null!=this.$.hackycsspotterhates&&(o(this.$.hackycontainer).innerHTML="");var t=document.createElement("style","custom-style");t.id="hackycsspotterhates",t.textContent=e,o(this.$.hackycontainer).appendChild(t)}_attachDom(e){this.appendChild(e)}}customElements.define(MoocContent.tag,MoocContent);export{MoocContent};