import{store as t}from"../haxcms-site-store.js";import{HAXStore as e}from"../../../../hax-body/lib/hax-store.js";import{HAXCMSButton as i}from"../utils/HAXCMSButton.js";import{SimpleToolbarButtonBehaviors as s}from"../../../../simple-toolbar/lib/simple-toolbar-button.js";import{toJS as o}from"../../../../../mobx/dist/mobx.esm.js";export class HAXCMSButtonAdd extends(s(i)){static get tag(){return"haxcms-button-add"}constructor(){super(),this.windowControllers=new AbortController,this.t=this.t||{},this.t.newPageAdded="New page added",this.t.newPage="Page",this.t.copy="Copy",this.t.newChildPage="Child",this.t.duplicatePage="Clone",this.icon="hax:add-page",this.voiceCommand="add page",this.dark=!1,this.type="sibling",this.autoEdit=!1,this.showTextLabel=!0,this.iconPosition="left",this.alignHorizontal="left",this.addEventListener("click",this.HAXCMSButtonClick)}static get styles(){return[...super.styles,...this.iconStyles,...this.labelStyles,...this.tooltipStyles,...this.simpleButtonCoreStyles,...this.simpleButtonLayoutStyles,...this.simpleButtonThemeStyles]}static get properties(){return{...super.properties,autoEdit:{type:Boolean,attribute:"auto-edit"},type:{type:String}}}updated(t){switch(super.updated&&super.updated(t),this.type){case"sibling":return this.label=this.t.newPage;case"child":return this.icon="hax:add-child-page",this.label=this.t.newChildPage;case"duplicate":return this.icon="hax:duplicate",this.label=this.t.duplicatePage}this.icon=void 0,this.setAttribute("role","menuitem")}render(){return this.buttonTemplate}connectedCallback(){super.connectedCallback(),window.addEventListener("haxcms-create-node-success",this.HAXCMSButtonClickResponse.bind(this),{signal:this.windowControllers.signal})}disconnectedCallback(){this.windowControllers.abort(),super.disconnectedCallback()}HAXCMSButtonClick(){t.playSound("click");let e=null,i=this.t.newPage,s=null;const a=o(t.activeItem);a&&("sibling"===this.type?(s=a.parent,e=parseInt(a.order)+1):"child"===this.type?(s=a.id,e=0):"duplicate"===this.type&&(i=a.title+" "+this.t.copy,s=a.parent,e=parseInt(a.order)+1)),""===i&&(i="New");var n={node:{title:i,location:""},order:e,parent:s};"duplicate"===this.type&&(n.node.duplicate=a.id),this.HAXCMSFireButtonEvent("haxcms-create-node",this,n)}HAXCMSButtonClickResponse(i){this===i.detail.originalTarget&&this.autoEdit&&(e.haxTray.collapsed=!1,setTimeout((()=>{t.editMode=!0}),250))}}customElements.define(HAXCMSButtonAdd.tag,HAXCMSButtonAdd);