!function(b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define([],b):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PouchDB=b()}((function(){return function o(b,T,N){function c(Q,F){if(!T[Q]){if(!b[Q]){var K="function"==typeof require&&require;if(!F&&K)return K(Q,!0);if(U)return U(Q,!0);var J=new Error("Cannot find module '"+Q+"'");throw J.code="MODULE_NOT_FOUND",J}var z=T[Q]={exports:{}};b[Q][0].call(z.exports,(function(T){return c(b[Q][1][T]||T)}),z,z.exports,o,b,T,N)}return T[Q].exports}for(var U="function"==typeof require&&require,Q=0;Q<N.length;Q++)c(N[Q]);return c}({1:[function(b,T,N){T.exports=function(b){return function(){var T=arguments.length;if(T){for(var N=[],U=-1;++U<T;)N[U]=arguments[U];return b.call(this,N)}return b.call(this,[])}}},{}],2:[function(b,T,N){var U=Object.create||function(b){function t(){}return t.prototype=b,new t},Q=Object.keys||function(b){var T=[];for(var N in b)Object.prototype.hasOwnProperty.call(b,N)&&T.push(N);return N},F=Function.prototype.bind||function(b){var T=this;return function(){return T.apply(b,arguments)}};function r(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=U(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((T.exports=r).EventEmitter=r).prototype._events=void 0,r.prototype._maxListeners=void 0;var K,J=10;try{var z={};Object.defineProperty&&Object.defineProperty(z,"x",{value:0}),K=0===z.x}catch(b){K=!1}function f(b){return void 0===b._maxListeners?r.defaultMaxListeners:b._maxListeners}function l(b,T,N,Q){var F,K,J;if("function"!=typeof N)throw new TypeError('"listener" argument must be a function');if((K=b._events)?(K.newListener&&(b.emit("newListener",T,N.listener?N.listener:N),K=b._events),J=K[T]):(K=b._events=U(null),b._eventsCount=0),J){if("function"==typeof J?J=K[T]=Q?[N,J]:[J,N]:Q?J.unshift(N):J.push(N),!J.warned&&(F=f(b))&&0<F&&J.length>F){J.warned=!0;var z=new Error("Possible EventEmitter memory leak detected. "+J.length+' "'+String(T)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');z.name="MaxListenersExceededWarning",z.emitter=b,z.type=T,z.count=J.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",z.name,z.message)}}else J=K[T]=N,++b._eventsCount;return b}function d(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var b=new Array(arguments.length),T=0;T<b.length;++T)b[T]=arguments[T];this.listener.apply(this.target,b)}}function h(b,T,N){var U={fired:!1,wrapFn:void 0,target:b,type:T,listener:N},Q=F.call(d,U);return Q.listener=N,U.wrapFn=Q}function p(b,T,N){var U=b._events;if(!U)return[];var Q=U[T];return Q?"function"==typeof Q?N?[Q.listener||Q]:[Q]:N?function(b){for(var T=new Array(b.length),N=0;N<T.length;++N)T[N]=b[N].listener||b[N];return T}(Q):y(Q,Q.length):[]}function v(b){var T=this._events;if(T){var N=T[b];if("function"==typeof N)return 1;if(N)return N.length}return 0}function y(b,T){for(var N=new Array(T),U=0;U<T;++U)N[U]=b[U];return N}K?Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return J},set:function(b){if("number"!=typeof b||b<0||b!=b)throw new TypeError('"defaultMaxListeners" must be a positive number');J=b}}):r.defaultMaxListeners=J,r.prototype.setMaxListeners=function(b){if("number"!=typeof b||b<0||isNaN(b))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=b,this},r.prototype.getMaxListeners=function(){return f(this)},r.prototype.emit=function(b,T,N,U){var Q,F,K,J,z,V,W="error"===b;if(V=this._events)W=W&&null==V.error;else if(!W)return!1;if(W){if(1<arguments.length&&(Q=T),Q instanceof Error)throw Q;var G=new Error('Unhandled "error" event. ('+Q+")");throw G.context=Q,G}if(!(F=V[b]))return!1;var oe="function"==typeof F;switch(K=arguments.length){case 1:!function(b,T,N){if(T)b.call(N);else for(var U=b.length,Q=y(b,U),F=0;F<U;++F)Q[F].call(N)}(F,oe,this);break;case 2:!function(b,T,N,U){if(T)b.call(N,U);else for(var Q=b.length,F=y(b,Q),K=0;K<Q;++K)F[K].call(N,U)}(F,oe,this,T);break;case 3:!function(b,T,N,U,Q){if(T)b.call(N,U,Q);else for(var F=b.length,K=y(b,F),J=0;J<F;++J)K[J].call(N,U,Q)}(F,oe,this,T,N);break;case 4:!function(b,T,N,U,Q,F){if(T)b.call(N,U,Q,F);else for(var K=b.length,J=y(b,K),z=0;z<K;++z)J[z].call(N,U,Q,F)}(F,oe,this,T,N,U);break;default:for(J=new Array(K-1),z=1;z<K;z++)J[z-1]=arguments[z];!function(b,T,N,U){if(T)b.apply(N,U);else for(var Q=b.length,F=y(b,Q),K=0;K<Q;++K)F[K].apply(N,U)}(F,oe,this,J)}return!0},r.prototype.on=r.prototype.addListener=function(b,T){return l(this,b,T,!1)},r.prototype.prependListener=function(b,T){return l(this,b,T,!0)},r.prototype.once=function(b,T){if("function"!=typeof T)throw new TypeError('"listener" argument must be a function');return this.on(b,h(this,b,T)),this},r.prototype.prependOnceListener=function(b,T){if("function"!=typeof T)throw new TypeError('"listener" argument must be a function');return this.prependListener(b,h(this,b,T)),this},r.prototype.removeListener=function(b,T){var N,Q,F,K,J;if("function"!=typeof T)throw new TypeError('"listener" argument must be a function');if(!(Q=this._events))return this;if(!(N=Q[b]))return this;if(N===T||N.listener===T)0==--this._eventsCount?this._events=U(null):(delete Q[b],Q.removeListener&&this.emit("removeListener",b,N.listener||T));else if("function"!=typeof N){for(F=-1,K=N.length-1;0<=K;K--)if(N[K]===T||N[K].listener===T){J=N[K].listener,F=K;break}if(F<0)return this;0===F?N.shift():function(b,T){for(var N=T,U=N+1,Q=b.length;U<Q;N+=1,U+=1)b[N]=b[U];b.pop()}(N,F),1===N.length&&(Q[b]=N[0]),Q.removeListener&&this.emit("removeListener",b,J||T)}return this},r.prototype.removeAllListeners=function(b){var T,N,F;if(!(N=this._events))return this;if(!N.removeListener)return 0===arguments.length?(this._events=U(null),this._eventsCount=0):N[b]&&(0==--this._eventsCount?this._events=U(null):delete N[b]),this;if(0===arguments.length){var K,J=Q(N);for(F=0;F<J.length;++F)"removeListener"!==(K=J[F])&&this.removeAllListeners(K);return this.removeAllListeners("removeListener"),this._events=U(null),this._eventsCount=0,this}if("function"==typeof(T=N[b]))this.removeListener(b,T);else if(T)for(F=T.length-1;0<=F;F--)this.removeListener(b,T[F]);return this},r.prototype.listeners=function(b){return p(this,b,!0)},r.prototype.rawListeners=function(b){return p(this,b,!1)},r.listenerCount=function(b,T){return"function"==typeof b.listenerCount?b.listenerCount(T):v.call(b,T)},r.prototype.listenerCount=v,r.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],3:[function(b,T,N){(function(b){var N,U,Q=b.MutationObserver||b.WebKitMutationObserver;if(Q){var F=0,K=new Q(c),J=b.document.createTextNode("");K.observe(J,{characterData:!0}),N=function(){J.data=F=++F%2}}else if(b.setImmediate||void 0===b.MessageChannel)N="document"in b&&"onreadystatechange"in b.document.createElement("script")?function(){var T=b.document.createElement("script");T.onreadystatechange=function(){c(),T.onreadystatechange=null,T.parentNode.removeChild(T),T=null},b.document.documentElement.appendChild(T)}:function(){setTimeout(c,0)};else{var z=new b.MessageChannel;z.port1.onmessage=c,N=function(){z.port2.postMessage(0)}}var V=[];function c(){var b,T;U=!0;for(var N=V.length;N;){for(T=V,V=[],b=-1;++b<N;)T[b]();N=V.length}U=!1}T.exports=function(b){1!==V.push(b)||U||N()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(b,T,N){"function"==typeof Object.create?T.exports=function(b,T){T&&(b.super_=T,b.prototype=Object.create(T.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}))}:T.exports=function(b,T){if(T){function n(){}b.super_=T,n.prototype=T.prototype,b.prototype=new n,b.prototype.constructor=b}}},{}],5:[function(b,T,N){var U,Q,F=T.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function u(b){if(U===setTimeout)return setTimeout(b,0);if((U===s||!U)&&setTimeout)return U=setTimeout,setTimeout(b,0);try{return U(b,0)}catch(T){try{return U.call(null,b,0)}catch(T){return U.call(this,b,0)}}}!function(){try{U="function"==typeof setTimeout?setTimeout:s}catch(b){U=s}try{Q="function"==typeof clearTimeout?clearTimeout:a}catch(b){Q=a}}();var K,J=[],z=!1,V=-1;function h(){z&&K&&(z=!1,K.length?J=K.concat(J):V=-1,J.length&&p())}function p(){if(!z){var b=u(h);z=!0;for(var T=J.length;T;){for(K=J,J=[];++V<T;)K&&K[V].run();V=-1,T=J.length}K=null,z=!1,function(b){if(Q===clearTimeout)return clearTimeout(b);if((Q===a||!Q)&&clearTimeout)return Q=clearTimeout,clearTimeout(b);try{Q(b)}catch(T){try{return Q.call(null,b)}catch(T){return Q.call(this,b)}}}(b)}}function v(b,T){this.fun=b,this.array=T}function y(){}F.nextTick=function(b){var T=new Array(arguments.length-1);if(1<arguments.length)for(var N=1;N<arguments.length;N++)T[N-1]=arguments[N];J.push(new v(b,T)),1!==J.length||z||u(p)},v.prototype.run=function(){this.fun.apply(null,this.array)},F.title="browser",F.browser=!0,F.env={},F.argv=[],F.version="",F.versions={},F.on=y,F.addListener=y,F.once=y,F.off=y,F.removeListener=y,F.removeAllListeners=y,F.emit=y,F.prependListener=y,F.prependOnceListener=y,F.listeners=function(b){return[]},F.binding=function(b){throw new Error("process.binding is not supported")},F.cwd=function(){return"/"},F.chdir=function(b){throw new Error("process.chdir is not supported")},F.umask=function(){return 0}},{}],6:[function(b,T,N){!function(b){if("object"==typeof N)T.exports=b();else{var U;try{U=window}catch(b){U=self}U.SparkMD5=b()}}((function(b){var T=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function f(b,T){var N=b[0],U=b[1],Q=b[2],F=b[3];U=((U+=((Q=((Q+=((F=((F+=((N=((N+=(U&Q|~U&F)+T[0]-680876936|0)<<7|N>>>25)+U|0)&U|~N&Q)+T[1]-389564586|0)<<12|F>>>20)+N|0)&N|~F&U)+T[2]+606105819|0)<<17|Q>>>15)+F|0)&F|~Q&N)+T[3]-1044525330|0)<<22|U>>>10)+Q|0,U=((U+=((Q=((Q+=((F=((F+=((N=((N+=(U&Q|~U&F)+T[4]-176418897|0)<<7|N>>>25)+U|0)&U|~N&Q)+T[5]+1200080426|0)<<12|F>>>20)+N|0)&N|~F&U)+T[6]-1473231341|0)<<17|Q>>>15)+F|0)&F|~Q&N)+T[7]-45705983|0)<<22|U>>>10)+Q|0,U=((U+=((Q=((Q+=((F=((F+=((N=((N+=(U&Q|~U&F)+T[8]+1770035416|0)<<7|N>>>25)+U|0)&U|~N&Q)+T[9]-1958414417|0)<<12|F>>>20)+N|0)&N|~F&U)+T[10]-42063|0)<<17|Q>>>15)+F|0)&F|~Q&N)+T[11]-1990404162|0)<<22|U>>>10)+Q|0,U=((U+=((Q=((Q+=((F=((F+=((N=((N+=(U&Q|~U&F)+T[12]+1804603682|0)<<7|N>>>25)+U|0)&U|~N&Q)+T[13]-40341101|0)<<12|F>>>20)+N|0)&N|~F&U)+T[14]-1502002290|0)<<17|Q>>>15)+F|0)&F|~Q&N)+T[15]+1236535329|0)<<22|U>>>10)+Q|0,U=((U+=((Q=((Q+=((F=((F+=((N=((N+=(U&F|Q&~F)+T[1]-165796510|0)<<5|N>>>27)+U|0)&Q|U&~Q)+T[6]-1069501632|0)<<9|F>>>23)+N|0)&U|N&~U)+T[11]+643717713|0)<<14|Q>>>18)+F|0)&N|F&~N)+T[0]-373897302|0)<<20|U>>>12)+Q|0,U=((U+=((Q=((Q+=((F=((F+=((N=((N+=(U&F|Q&~F)+T[5]-701558691|0)<<5|N>>>27)+U|0)&Q|U&~Q)+T[10]+38016083|0)<<9|F>>>23)+N|0)&U|N&~U)+T[15]-660478335|0)<<14|Q>>>18)+F|0)&N|F&~N)+T[4]-405537848|0)<<20|U>>>12)+Q|0,U=((U+=((Q=((Q+=((F=((F+=((N=((N+=(U&F|Q&~F)+T[9]+568446438|0)<<5|N>>>27)+U|0)&Q|U&~Q)+T[14]-1019803690|0)<<9|F>>>23)+N|0)&U|N&~U)+T[3]-187363961|0)<<14|Q>>>18)+F|0)&N|F&~N)+T[8]+1163531501|0)<<20|U>>>12)+Q|0,U=((U+=((Q=((Q+=((F=((F+=((N=((N+=(U&F|Q&~F)+T[13]-1444681467|0)<<5|N>>>27)+U|0)&Q|U&~Q)+T[2]-51403784|0)<<9|F>>>23)+N|0)&U|N&~U)+T[7]+1735328473|0)<<14|Q>>>18)+F|0)&N|F&~N)+T[12]-1926607734|0)<<20|U>>>12)+Q|0,U=((U+=((Q=((Q+=((F=((F+=((N=((N+=(U^Q^F)+T[5]-378558|0)<<4|N>>>28)+U|0)^U^Q)+T[8]-2022574463|0)<<11|F>>>21)+N|0)^N^U)+T[11]+1839030562|0)<<16|Q>>>16)+F|0)^F^N)+T[14]-35309556|0)<<23|U>>>9)+Q|0,U=((U+=((Q=((Q+=((F=((F+=((N=((N+=(U^Q^F)+T[1]-1530992060|0)<<4|N>>>28)+U|0)^U^Q)+T[4]+1272893353|0)<<11|F>>>21)+N|0)^N^U)+T[7]-155497632|0)<<16|Q>>>16)+F|0)^F^N)+T[10]-1094730640|0)<<23|U>>>9)+Q|0,U=((U+=((Q=((Q+=((F=((F+=((N=((N+=(U^Q^F)+T[13]+681279174|0)<<4|N>>>28)+U|0)^U^Q)+T[0]-358537222|0)<<11|F>>>21)+N|0)^N^U)+T[3]-722521979|0)<<16|Q>>>16)+F|0)^F^N)+T[6]+76029189|0)<<23|U>>>9)+Q|0,U=((U+=((Q=((Q+=((F=((F+=((N=((N+=(U^Q^F)+T[9]-640364487|0)<<4|N>>>28)+U|0)^U^Q)+T[12]-421815835|0)<<11|F>>>21)+N|0)^N^U)+T[15]+530742520|0)<<16|Q>>>16)+F|0)^F^N)+T[2]-995338651|0)<<23|U>>>9)+Q|0,U=((U+=((F=((F+=(U^((N=((N+=(Q^(U|~F))+T[0]-198630844|0)<<6|N>>>26)+U|0)|~Q))+T[7]+1126891415|0)<<10|F>>>22)+N|0)^((Q=((Q+=(N^(F|~U))+T[14]-1416354905|0)<<15|Q>>>17)+F|0)|~N))+T[5]-57434055|0)<<21|U>>>11)+Q|0,U=((U+=((F=((F+=(U^((N=((N+=(Q^(U|~F))+T[12]+1700485571|0)<<6|N>>>26)+U|0)|~Q))+T[3]-1894986606|0)<<10|F>>>22)+N|0)^((Q=((Q+=(N^(F|~U))+T[10]-1051523|0)<<15|Q>>>17)+F|0)|~N))+T[1]-2054922799|0)<<21|U>>>11)+Q|0,U=((U+=((F=((F+=(U^((N=((N+=(Q^(U|~F))+T[8]+1873313359|0)<<6|N>>>26)+U|0)|~Q))+T[15]-30611744|0)<<10|F>>>22)+N|0)^((Q=((Q+=(N^(F|~U))+T[6]-1560198380|0)<<15|Q>>>17)+F|0)|~N))+T[13]+1309151649|0)<<21|U>>>11)+Q|0,U=((U+=((F=((F+=(U^((N=((N+=(Q^(U|~F))+T[4]-145523070|0)<<6|N>>>26)+U|0)|~Q))+T[11]-1120210379|0)<<10|F>>>22)+N|0)^((Q=((Q+=(N^(F|~U))+T[2]+718787259|0)<<15|Q>>>17)+F|0)|~N))+T[9]-343485551|0)<<21|U>>>11)+Q|0,b[0]=N+b[0]|0,b[1]=U+b[1]|0,b[2]=Q+b[2]|0,b[3]=F+b[3]|0}function l(b){var T,N=[];for(T=0;T<64;T+=4)N[T>>2]=b.charCodeAt(T)+(b.charCodeAt(T+1)<<8)+(b.charCodeAt(T+2)<<16)+(b.charCodeAt(T+3)<<24);return N}function d(b){var T,N=[];for(T=0;T<64;T+=4)N[T>>2]=b[T]+(b[T+1]<<8)+(b[T+2]<<16)+(b[T+3]<<24);return N}function i(b){var T,N,U,Q,F,K,J=b.length,z=[1732584193,-271733879,-1732584194,271733878];for(T=64;T<=J;T+=64)f(z,l(b.substring(T-64,T)));for(N=(b=b.substring(T-64)).length,U=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],T=0;T<N;T+=1)U[T>>2]|=b.charCodeAt(T)<<(T%4<<3);if(U[T>>2]|=128<<(T%4<<3),55<T)for(f(z,U),T=0;T<16;T+=1)U[T]=0;return Q=(Q=8*J).toString(16).match(/(.*?)(.{0,8})$/),F=parseInt(Q[2],16),K=parseInt(Q[1],16)||0,U[14]=F,U[15]=K,f(z,U),z}function n(b){var N,U="";for(N=0;N<4;N+=1)U+=T[b>>8*N+4&15]+T[b>>8*N&15];return U}function s(b){var T;for(T=0;T<b.length;T+=1)b[T]=n(b[T]);return b.join("")}function h(b,T){return(b=0|b||0)<0?Math.max(b+T,0):Math.min(b,T)}function o(b){return/[\u0080-\uFFFF]/.test(b)&&(b=unescape(encodeURIComponent(b))),b}function a(b){var T,N=[],U=b.length;for(T=0;T<U-1;T+=2)N.push(parseInt(b.substr(T,2),16));return String.fromCharCode.apply(String,N)}function u(){this.reset()}return s(i("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(T,N){var U,Q,F,K,J=this.byteLength,z=h(T,J),V=J;return N!==b&&(V=h(N,J)),V<z?new ArrayBuffer(0):(U=V-z,Q=new ArrayBuffer(U),F=new Uint8Array(Q),K=new Uint8Array(this,z,U),F.set(K),Q)}),u.prototype.append=function(b){return this.appendBinary(o(b)),this},u.prototype.appendBinary=function(b){this._buff+=b,this._length+=b.length;var T,N=this._buff.length;for(T=64;T<=N;T+=64)f(this._hash,l(this._buff.substring(T-64,T)));return this._buff=this._buff.substring(T-64),this},u.prototype.end=function(b){var T,N,U=this._buff,Q=U.length,F=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(T=0;T<Q;T+=1)F[T>>2]|=U.charCodeAt(T)<<(T%4<<3);return this._finish(F,Q),N=s(this._hash),b&&(N=a(N)),this.reset(),N},u.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},u.prototype.setState=function(b){return this._buff=b.buff,this._length=b.length,this._hash=b.hash,this},u.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},u.prototype._finish=function(b,T){var N,U,Q,F=T;if(b[F>>2]|=128<<(F%4<<3),55<F)for(f(this._hash,b),F=0;F<16;F+=1)b[F]=0;N=(N=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),U=parseInt(N[2],16),Q=parseInt(N[1],16)||0,b[14]=U,b[15]=Q,f(this._hash,b)},u.hash=function(b,T){return u.hashBinary(o(b),T)},u.hashBinary=function(b,T){var N=s(i(b));return T?a(N):N},(u.ArrayBuffer=function(){this.reset()}).prototype.append=function(b){var T,N=function(b,T,N){var U=new Uint8Array(b.byteLength+T.byteLength);return U.set(new Uint8Array(b)),U.set(new Uint8Array(T),b.byteLength),U}(this._buff.buffer,b),U=N.length;for(this._length+=b.byteLength,T=64;T<=U;T+=64)f(this._hash,d(N.subarray(T-64,T)));return this._buff=T-64<U?new Uint8Array(N.buffer.slice(T-64)):new Uint8Array(0),this},u.ArrayBuffer.prototype.end=function(b){var T,N,U=this._buff,Q=U.length,F=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(T=0;T<Q;T+=1)F[T>>2]|=U[T]<<(T%4<<3);return this._finish(F,Q),N=s(this._hash),b&&(N=a(N)),this.reset(),N},u.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.ArrayBuffer.prototype.getState=function(){var b=u.prototype.getState.call(this);return b.buff=function(b){return String.fromCharCode.apply(null,new Uint8Array(b))}(b.buff),b},u.ArrayBuffer.prototype.setState=function(b){return b.buff=function(b,T){var N,U=b.length,Q=new ArrayBuffer(U),F=new Uint8Array(Q);for(N=0;N<U;N+=1)F[N]=b.charCodeAt(N);return F}(b.buff),u.prototype.setState.call(this,b)},u.ArrayBuffer.prototype.destroy=u.prototype.destroy,u.ArrayBuffer.prototype._finish=u.prototype._finish,u.ArrayBuffer.hash=function(b,T){var N=s(function(b){var T,N,U,Q,F,K,J=b.length,z=[1732584193,-271733879,-1732584194,271733878];for(T=64;T<=J;T+=64)f(z,d(b.subarray(T-64,T)));for(N=(b=T-64<J?b.subarray(T-64):new Uint8Array(0)).length,U=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],T=0;T<N;T+=1)U[T>>2]|=b[T]<<(T%4<<3);if(U[T>>2]|=128<<(T%4<<3),55<T)for(f(z,U),T=0;T<16;T+=1)U[T]=0;return Q=(Q=8*J).toString(16).match(/(.*?)(.{0,8})$/),F=parseInt(Q[2],16),K=parseInt(Q[1],16)||0,U[14]=F,U[15]=K,f(z,U),z}(new Uint8Array(b)));return T?a(N):N},u}))},{}],7:[function(b,T,N){var U=b(10),Q=b(11),F=Q;F.v1=U,F.v4=Q,T.exports=F},{10:10,11:11}],8:[function(b,T,N){for(var U=[],Q=0;Q<256;++Q)U[Q]=(Q+256).toString(16).substr(1);T.exports=function(b,T){var N=T||0,Q=U;return[Q[b[N++]],Q[b[N++]],Q[b[N++]],Q[b[N++]],"-",Q[b[N++]],Q[b[N++]],"-",Q[b[N++]],Q[b[N++]],"-",Q[b[N++]],Q[b[N++]],"-",Q[b[N++]],Q[b[N++]],Q[b[N++]],Q[b[N++]],Q[b[N++]],Q[b[N++]]].join("")}},{}],9:[function(b,T,N){var U="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(U){var Q=new Uint8Array(16);T.exports=function(){return U(Q),Q}}else{var F=new Array(16);T.exports=function(){for(var b,T=0;T<16;T++)0==(3&T)&&(b=4294967296*Math.random()),F[T]=b>>>((3&T)<<3)&255;return F}}},{}],10:[function(b,T,N){var U,Q,F=b(9),K=b(8),J=0,z=0;T.exports=function(b,T,N){var V=T&&N||0,W=T||[],G=(b=b||{}).node||U,oe=void 0!==b.clockseq?b.clockseq:Q;if(null==G||null==oe){var ie=F();null==G&&(G=U=[1|ie[0],ie[1],ie[2],ie[3],ie[4],ie[5]]),null==oe&&(oe=Q=16383&(ie[6]<<8|ie[7]))}var se=void 0!==b.msecs?b.msecs:(new Date).getTime(),ae=void 0!==b.nsecs?b.nsecs:z+1,me=se-J+(ae-z)/1e4;if(me<0&&void 0===b.clockseq&&(oe=oe+1&16383),(me<0||J<se)&&void 0===b.nsecs&&(ae=0),1e4<=ae)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");J=se,Q=oe;var be=(1e4*(268435455&(se+=122192928e5))+(z=ae))%4294967296;W[V++]=be>>>24&255,W[V++]=be>>>16&255,W[V++]=be>>>8&255,W[V++]=255&be;var qe=se/4294967296*1e4&268435455;W[V++]=qe>>>8&255,W[V++]=255&qe,W[V++]=qe>>>24&15|16,W[V++]=qe>>>16&255,W[V++]=oe>>>8|128,W[V++]=255&oe;for(var He=0;He<6;++He)W[V+He]=G[He];return T||K(W)}},{8:8,9:9}],11:[function(b,T,N){var U=b(9),Q=b(8);T.exports=function(b,T,N){var F=T&&N||0;"string"==typeof b&&(T="binary"===b?new Array(16):null,b=null);var K=(b=b||{}).random||(b.rng||U)();if(K[6]=15&K[6]|64,K[8]=63&K[8]|128,T)for(var J=0;J<16;++J)T[F+J]=K[J];return T||Q(K)}},{8:8,9:9}],12:[function(b,T,N){function h(b,T,N){var U=N[N.length-1];b===U.element&&(N.pop(),U=N[N.length-1]);var Q=U.element,F=U.index;Array.isArray(Q)?Q.push(b):F===T.length-2?Q[T.pop()]=b:T.push(b)}N.stringify=function(b){var T=[];T.push({obj:b});for(var N,U,Q,F,K,J,z,V,W,G,oe="";N=T.pop();)if(U=N.obj,oe+=N.prefix||"",Q=N.val||"")oe+=Q;else if("object"!=typeof U)oe+=void 0===U?null:JSON.stringify(U);else if(null===U)oe+="null";else if(Array.isArray(U)){for(T.push({val:"]"}),F=U.length-1;0<=F;F--)K=0===F?"":",",T.push({obj:U[F],prefix:K});T.push({val:"["})}else{for(z in J=[],U)U.hasOwnProperty(z)&&J.push(z);for(T.push({val:"}"}),F=J.length-1;0<=F;F--)W=U[V=J[F]],G=0<F?",":"",G+=JSON.stringify(V)+":",T.push({obj:W,prefix:G});T.push({val:"{"})}return oe},N.parse=function(b){for(var T,N,U,Q,F,K,J,z,V,W=[],G=[],oe=0;;)if("}"!==(T=b[oe++])&&"]"!==T&&void 0!==T)switch(T){case" ":case"\t":case"\n":case":":case",":break;case"n":oe+=3,h(null,W,G);break;case"t":oe+=3,h(!0,W,G);break;case"f":oe+=4,h(!1,W,G);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(N="",oe--;;){if(U=b[oe++],!/[\d\.\-e\+]/.test(U)){oe--;break}N+=U}h(parseFloat(N),W,G);break;case'"':for(Q="",F=void 0,K=0;'"'!==(J=b[oe++])||"\\"===F&&K%2==1;)Q+=J,"\\"===(F=J)?K++:K=0;h(JSON.parse('"'+Q+'"'),W,G);break;case"[":z={element:[],index:W.length},W.push(z.element),G.push(z);break;case"{":V={element:{},index:W.length},W.push(V.element),G.push(V);break;default:throw new Error("unexpectedly reached end of input: "+T)}else{if(1===W.length)return W.pop();h(W.pop(),W,G)}}},{}],13:[function(b,T,N){(function(N,U){function t(b){return b&&"object"==typeof b&&"default"in b?b.default:b}var Q,F,K=t(b(3)),J=t(b(7)),z=t(b(6)),V=t(b(12)),W=t(b(1)),G=t(b(4)),oe=b(2);function s(b){return"$"+b}function c(){this._store={}}function n(b){if(this._store=new c,b&&Array.isArray(b))for(var T=0,N=b.length;T<N;T++)this.add(b[T])}c.prototype.get=function(b){var T=s(b);return this._store[T]},c.prototype.set=function(b,T){var N=s(b);return this._store[N]=T,!0},c.prototype.has=function(b){return s(b)in this._store},c.prototype.delete=function(b){var T=s(b),N=T in this._store;return delete this._store[T],N},c.prototype.forEach=function(b){for(var T=Object.keys(this._store),N=0,U=T.length;N<U;N++){var Q=T[N];b(this._store[Q],Q=Q.substring(1))}},Object.defineProperty(c.prototype,"size",{get:function(){return Object.keys(this._store).length}}),n.prototype.add=function(b){return this._store.set(b,!0)},n.prototype.has=function(b){return this._store.has(b)},n.prototype.forEach=function(b){this._store.forEach((function(T,N){b(N)}))},Object.defineProperty(n.prototype,"size",{get:function(){return this._store.size}}),F=function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var b=Object.getOwnPropertyDescriptor(Map,Symbol.species);return b&&"get"in b&&Map[Symbol.species]===Map}()?(Q=Set,Map):(Q=n,c);var ie=Function.prototype.toString,se=ie.call(Object);function R(b){var T,N,U;if(!b||"object"!=typeof b)return b;if(Array.isArray(b)){for(T=[],N=0,U=b.length;N<U;N++)T[N]=R(b[N]);return T}if(b instanceof Date)return b.toISOString();if(function(b){return"undefined"!=typeof ArrayBuffer&&b instanceof ArrayBuffer||"undefined"!=typeof Blob&&b instanceof Blob}(b))return function l(b){if(b instanceof ArrayBuffer)return function(b){if("function"==typeof b.slice)return b.slice(0);var T=new ArrayBuffer(b.byteLength),N=new Uint8Array(T),U=new Uint8Array(b);return N.set(U),T}(b);var T=b.size,N=b.type;return"function"==typeof b.slice?b.slice(0,T,N):b.webkitSlice(0,T,N)}(b);if(!function(b){var T=Object.getPrototypeOf(b);if(null===T)return!0;var N=T.constructor;return"function"==typeof N&&N instanceof N&&ie.call(N)==se}(b))return b;for(N in T={},b)if(Object.prototype.hasOwnProperty.call(b,N)){var Q=R(b[N]);void 0!==Q&&(T[N]=Q)}return T}function v(b){var T=!1;return W((function(N){if(T)throw new Error("once called more than once");T=!0,b.apply(this,N)}))}function y(b){return W((function(T){T=R(T);var N=this,U="function"==typeof T[T.length-1]&&T.pop(),Q=new Promise((function(U,Q){var F;try{var K=v((function(b,T){b?Q(b):U(T)}));T.push(K),(F=b.apply(N,T))&&"function"==typeof F.then&&U(F)}catch(F){Q(F)}}));return U&&Q.then((function(b){U(null,b)}),U),Q}))}function m(b,T){return y(W((function(N){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var U=this;return function(b,T,N){if(b.constructor.listeners("debug").length){for(var U=["api",b.name,T],Q=0;Q<N.length-1;Q++)U.push(N[Q]);b.constructor.emit("debug",U);var F=N[N.length-1];N[N.length-1]=function(N,U){var Q=["api",b.name,T];Q=Q.concat(N?["error",N]:["success",U]),b.constructor.emit("debug",Q),F(N,U)}}}(U,b,N),this.taskqueue.isReady?T.apply(this,N):new Promise((function(T,Q){U.taskqueue.addTask((function(F){F?Q(F):T(U[b].apply(U,N))}))}))})))}function w(b,T){for(var N={},U=0,Q=T.length;U<Q;U++){var F=T[U];F in b&&(N[F]=b[F])}return N}var ae,me=6;function k(b){return b}function j(b){return[{ok:b}]}function O(b,T,N){var U=T.docs,Q=new F;U.forEach((function(b){Q.has(b.id)?Q.get(b.id).push(b):Q.set(b.id,[b])}));var K=Q.size,J=0,z=new Array(K);function l(){++J===K&&function(){var b=[];z.forEach((function(T){T.docs.forEach((function(N){b.push({id:T.id,docs:[N]})}))})),N(null,{results:b})}()}var V=[];Q.forEach((function(b,T){V.push(T)}));var W=0;!function d(){if(!(W>=V.length)){var N=Math.min(W+me,V.length),U=V.slice(W,N);!function(N,U){N.forEach((function(N,F){var K=U+F,J=Q.get(N),V=w(J[0],["atts_since","attachments"]);V.open_revs=J.map((function(b){return b.rev})),V.open_revs=V.open_revs.filter(k);var W=k;0===V.open_revs.length&&(delete V.open_revs,W=j),["revs","attachments","binary","ajax","latest"].forEach((function(b){b in T&&(V[b]=T[b])})),b.get(N,V,(function(b,T){var U;U=b?[{error:b}]:W(T),function(b,T,N){z[b]={id:T,docs:N},l()}(K,N,U),d()}))}))}(U,W),W+=U.length}}()}try{localStorage.setItem("_pouch_check_localstorage",1),ae=!!localStorage.getItem("_pouch_check_localstorage")}catch(U){ae=!1}function A(){return ae}function q(){oe.EventEmitter.call(this),this._listeners={},function(b){A()&&addEventListener("storage",(function(T){b.emit(T.key)}))}(this)}function E(b){if("undefined"!=typeof console&&"function"==typeof console[b]){var T=Array.prototype.slice.call(arguments,1);console[b].apply(console,T)}}function M(b){var T=0;return b||(T=2e3),function(b,T){return b=parseInt(b,10)||0,(T=parseInt(T,10))!=T||T<=b?T=(b||1)<<1:T+=1,6e5<T&&(b=3e5,T=6e5),~~((T-b)*Math.random()+b)}(b,T)}function S(b,T){E("info","The above "+b+" is totally normal. "+T)}G(q,oe.EventEmitter),q.prototype.addListener=function(b,T,N,U){if(!this._listeners[T]){var Q=this,F=!1;this._listeners[T]=s,this.on(b,s)}function s(){if(Q._listeners[T])if(F)F="waiting";else{F=!0;var b=w(U,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);N.changes(b).on("change",(function(b){b.seq>U.since&&!U.cancelled&&(U.since=b.seq,U.onChange(b))})).on("complete",(function(){"waiting"===F&&K(s),F=!1})).on("error",(function(){F=!1}))}}},q.prototype.removeListener=function(b,T){T in this._listeners&&(oe.EventEmitter.prototype.removeListener.call(this,b,this._listeners[T]),delete this._listeners[T])},q.prototype.notifyLocalWindows=function(b){A()&&(localStorage[b]="a"===localStorage[b]?"b":"a")},q.prototype.notify=function(b){this.emit(b),this.notifyLocalWindows(b)};var be="function"==typeof Object.assign?Object.assign:function(b){for(var T=Object(b),N=1;N<arguments.length;N++){var U=arguments[N];if(null!=U)for(var Q in U)Object.prototype.hasOwnProperty.call(U,Q)&&(T[Q]=U[Q])}return T};function P(b,T,N){Error.call(this,N),this.status=b,this.name=T,this.message=N,this.error=!0}G(P,Error),P.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})},new P(401,"unauthorized","Name or password is incorrect.");var qe=new P(400,"bad_request","Missing JSON list of 'docs'"),He=new P(404,"not_found","missing"),Ze=new P(409,"conflict","Document update conflict"),Xe=new P(400,"bad_request","_id field must contain a string"),et=new P(412,"missing_id","_id is required for puts"),rt=new P(400,"bad_request","Only reserved document ids may start with underscore."),ct=(new P(412,"precondition_failed","Database not open"),new P(500,"unknown_error","Database encountered an unknown error")),ft=new P(500,"badarg","Some query argument is invalid"),lt=(new P(400,"invalid_request","Request was invalid"),new P(400,"query_parse_error","Some query parameter is invalid")),qt=new P(500,"doc_validation","Bad special document member"),Lt=new P(400,"bad_request","Something wrong with the request"),Dt=new P(400,"bad_request","Document must be a JSON object"),Nt=(new P(404,"not_found","Database not found"),new P(500,"indexed_db_went_bad","unknown")),Ut=(new P(500,"web_sql_went_bad","unknown"),new P(500,"levelDB_went_went_bad","unknown"),new P(403,"forbidden","Forbidden by design doc validate_doc_update function"),new P(400,"bad_request","Invalid rev format")),Ft=(new P(412,"file_exists","The database could not be created, the file already exists."),new P(412,"missing_stub","A pre-existing attachment stub wasn't found"));function Y(b,T){function t(T){for(var N in b)"function"!=typeof b[N]&&(this[N]=b[N]);void 0!==T&&(this.reason=T)}return t.prototype=P.prototype,new t(T)}function H(b){if("object"!=typeof b){var T=b;(b=ct).data=T}return"error"in b&&"conflict"===b.error&&(b.name="conflict",b.status=409),"name"in b||(b.name=b.error||"unknown"),"status"in b||(b.status=500),"message"in b||(b.message=b.message||b.reason),b}function X(b){var T={},N=b.filter&&"function"==typeof b.filter;return T.query=b.query_params,function(U){U.doc||(U.doc={});var Q=N&&function(b,T,N){try{return!b(T,N)}catch(b){var U="Filter function threw: "+b.toString();return Y(Lt,U)}}(b.filter,U.doc,T);if("object"==typeof Q)return Q;if(Q)return!1;if(b.include_docs){if(!b.attachments)for(var F in U.doc._attachments)U.doc._attachments.hasOwnProperty(F)&&(U.doc._attachments[F].stub=!0)}else delete U.doc;return!0}}function Z(b){for(var T=[],N=0,U=b.length;N<U;N++)T=T.concat(b[N]);return T}function ee(b){var T;if(b?"string"!=typeof b?T=Y(Xe):/^_/.test(b)&&!/^_(design|local)/.test(b)&&(T=Y(rt)):T=Y(et),T)throw T}function te(b){return"boolean"==typeof b._remote?b._remote:"function"==typeof b.type&&(E("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===b.type())}function ne(b){if(!b)return null;var T=b.split("/");return 2===T.length?T:1===T.length?[b,b]:null}function re(b){var T=ne(b);return T?T.join("/"):null}new P(413,"invalid_url","Provided URL is invalid");var Kt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Jt="queryKey",zt=/(?:^|&)([^&=]*)=?([^&]*)/g,Vt=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function ue(b){for(var T=Vt.exec(b),N={},U=14;U--;){var Q=Kt[U],F=T[U]||"",K=-1!==["user","password"].indexOf(Q);N[Q]=K?decodeURIComponent(F):F}return N[Jt]={},N[Kt[12]].replace(zt,(function(b,T,U){T&&(N[Jt][T]=U)})),N}function ce(b,T){var N=[],U=[];for(var Q in T)T.hasOwnProperty(Q)&&(N.push(Q),U.push(T[Q]));return N.push(b),Function.apply(null,N).apply(null,U)}function fe(b,T,N){return new Promise((function(U,Q){b.get(T,(function(F,K){if(F){if(404!==F.status)return Q(F);K={}}var J=K._rev,z=N(K);if(!z)return U({updated:!1,rev:J});z._id=T,z._rev=J,U(function(b,T,N){return b.put(T).then((function(b){return{updated:!0,rev:b.rev}}),(function(U){if(409!==U.status)throw U;return fe(b,T._id,N)}))}(b,z,N))}))}))}var le=function(b){return atob(b)},de=function(b){return btoa(b)};function he(b,T){b=b||[],T=T||{};try{return new Blob(b,T)}catch(Q){if("TypeError"!==Q.name)throw Q;for(var N=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),U=0;U<b.length;U+=1)N.append(b[U]);return N.getBlob(T.type)}}function pe(b,T){return he([function(b){for(var T=b.length,N=new ArrayBuffer(T),U=new Uint8Array(N),Q=0;Q<T;Q++)U[Q]=b.charCodeAt(Q);return N}(b)],{type:T})}function ve(b,T){return pe(le(b),T)}function ye(b,T){var N=new FileReader,U="function"==typeof N.readAsBinaryString;N.onloadend=function(b){var N=b.target.result||"";if(U)return T(N);T(function(b){for(var T="",N=new Uint8Array(b),U=N.byteLength,Q=0;Q<U;Q++)T+=String.fromCharCode(N[Q]);return T}(N))},U?N.readAsBinaryString(b):N.readAsArrayBuffer(b)}function _e(b,T){ye(b,(function(b){T(b)}))}function ge(b,T){_e(b,(function(b){T(de(b))}))}var Gt=U.setImmediate||U.setTimeout,rn=32768;function we(b,T,N,U,Q){(0<N||U<T.size)&&(T=function(b,T,N){return b.webkitSlice?b.webkitSlice(T,N):b.slice(T,N)}(T,N,U)),function(b,T){var N=new FileReader;N.onloadend=function(b){var N=b.target.result||new ArrayBuffer(0);T(N)},N.readAsArrayBuffer(b)}(T,(function(T){b.append(T),Q()}))}function ke(b,T,N,U,Q){(0<N||U<T.length)&&(T=T.substring(N,U)),b.appendBinary(T),Q()}function je(b,T){var N="string"==typeof b,U=N?b.length:b.size,Q=Math.min(rn,U),F=Math.ceil(U/Q),K=0,J=N?new z:new z.ArrayBuffer,V=N?ke:we;function c(){Gt(l)}function f(){var b=function(b){return de(b)}(J.end(!0));T(b),J.destroy()}function l(){var T=K*Q;V(J,b,T,T+Q,++K<F?c:f)}l()}function Oe(b){return z.hash(b)}function Ae(b,T){var N=R(b);return T?(delete N._rev_tree,Oe(JSON.stringify(N))):J.v4().replace(/-/g,"").toLowerCase()}var cn=J.v4;function Ee(b){for(var T,N,U,Q,F=b.rev_tree.slice();Q=F.pop();){var K=Q.ids,J=K[2],z=Q.pos;if(J.length)for(var V=0,W=J.length;V<W;V++)F.push({pos:z+1,ids:J[V]});else{var G=!!K[1].deleted,oe=K[0];T&&!(U!==G?U:N!==z?N<z:T<oe)||(T=oe,N=z,U=G)}}return N+"-"+T}function Se(b,T){for(var N,U=b.slice();N=U.pop();)for(var Q=N.pos,F=N.ids,K=F[2],J=T(0===K.length,Q,F[0],N.ctx,F[1]),z=0,V=K.length;z<V;z++)U.push({pos:Q+1,ids:K[z],ctx:J})}function xe(b,T){return b.pos-T.pos}function Ce(b){var T=[];Se(b,(function(b,N,U,Q,F){b&&T.push({rev:N+"-"+U,pos:N,opts:F})})),T.sort(xe).reverse();for(var N=0,U=T.length;N<U;N++)delete T[N].pos;return T}function Pe(b){for(var T=Ee(b),N=Ce(b.rev_tree),U=[],Q=0,F=N.length;Q<F;Q++){var K=N[Q];K.rev===T||K.opts.deleted||U.push(K.rev)}return U}function Le(b){for(var T,N=[],U=b.slice();T=U.pop();){var Q=T.pos,F=T.ids,K=F[0],J=F[1],z=F[2],V=0===z.length,W=T.history?T.history.slice():[];W.push({id:K,opts:J}),V&&N.push({pos:Q+1-W.length,ids:W});for(var G=0,oe=z.length;G<oe;G++)U.push({pos:Q+1,ids:z[G],history:W})}return N.reverse()}function De(b,T){return b.pos-T.pos}function $e(b,T,N){var U=function(b,T,N){for(var U,Q=0,F=b.length;Q<F;)N(b[U=Q+F>>>1],T)<0?Q=1+U:F=U;return Q}(b,T,N);b.splice(U,0,T)}function Ie(b,T){for(var N,U,Q=T,F=b.length;Q<F;Q++){var K=b[Q],J=[K.id,K.opts,[]];U?(U[2].push(J),U=J):N=U=J}return N}function Be(b,T){return b[0]<T[0]?-1:1}function Te(b,T){for(var N=[{tree1:b,tree2:T}],U=!1;0<N.length;){var Q=N.pop(),F=Q.tree1,K=Q.tree2;(F[1].status||K[1].status)&&(F[1].status="available"===F[1].status||"available"===K[1].status?"available":"missing");for(var J=0;J<K[2].length;J++)if(F[2][0]){for(var z=!1,V=0;V<F[2].length;V++)F[2][V][0]===K[2][J][0]&&(N.push({tree1:F[2][V],tree2:K[2][J]}),z=!0);z||(U="new_branch",$e(F[2],K[2][J],Be))}else U="new_leaf",F[2][0]=K[2][J]}return{conflicts:U,tree:b}}function Re(b,T,N){var U,Q=[],F=!1,K=!1;if(!b.length)return{tree:[T],conflicts:"new_leaf"};for(var J=0,z=b.length;J<z;J++){var V=b[J];if(V.pos===T.pos&&V.ids[0]===T.ids[0])U=Te(V.ids,T.ids),Q.push({pos:V.pos,ids:U.tree}),F=F||U.conflicts,K=!0;else if(!0!==N){var W=V.pos<T.pos?V:T,G=V.pos<T.pos?T:V,oe=G.pos-W.pos,ie=[],se=[];for(se.push({ids:W.ids,diff:oe,parent:null,parentIdx:null});0<se.length;){var ae=se.pop();if(0!==ae.diff)for(var me=ae.ids[2],be=0,qe=me.length;be<qe;be++)se.push({ids:me[be],diff:ae.diff-1,parent:ae.ids,parentIdx:be});else ae.ids[0]===G.ids[0]&&ie.push(ae)}var He=ie[0];He?(U=Te(He.ids,G.ids),He.parent[2][He.parentIdx]=U.tree,Q.push({pos:W.pos,ids:W.ids}),F=F||U.conflicts,K=!0):Q.push(V)}else Q.push(V)}return K||Q.push(T),Q.sort(De),{tree:Q,conflicts:F||"internal_node"}}function Me(b,T,N){var U=Re(b,T),Q=function(b,T){for(var N,U,Q=Le(b),F=0,K=Q.length;F<K;F++){var J,z=Q[F],V=z.ids;if(V.length>T){N=N||{};var W=V.length-T;J={pos:z.pos+W,ids:Ie(V,W)};for(var G=0;G<W;G++){var oe=z.pos+G+"-"+V[G].id;N[oe]=!0}}else J={pos:z.pos,ids:Ie(V,0)};U=U?Re(U,J,!0).tree:[J]}return N&&Se(U,(function(b,T,U){delete N[T+"-"+U]})),{tree:U,revs:N?Object.keys(N):[]}}(U.tree,N);return{tree:Q.tree,stemmedRevs:Q.revs,conflicts:U.conflicts}}function Ne(b){return b.ids}function Ue(b,T){for(var N,U=(T=T||Ee(b)).substring(T.indexOf("-")+1),Q=b.rev_tree.map(Ne);N=Q.pop();){if(N[0]===U)return!!N[1].deleted;Q=Q.concat(N[2])}}function Fe(b){return/^_local/.test(b)}function Ke(b,T,N){oe.EventEmitter.call(this);var U=this;this.db=b;var Q=(T=T?R(T):{}).complete=v((function(T,N){T?0<function(b,T){return"listenerCount"in b?b.listenerCount(T):oe.EventEmitter.listenerCount(b,T)}(U,"error")&&U.emit("error",T):U.emit("complete",N),U.removeAllListeners(),b.removeListener("destroyed",s)}));function s(){U.cancel()}N&&(U.on("complete",(function(b){N(null,b)})),U.on("error",N)),b.once("destroyed",s),T.onChange=function(b,T,N){U.isCancelled||function(b,T,N,U){try{b.emit("change",T,N,U)}catch(b){E("error",'Error in .on("change", function):',b)}}(U,b,T,N)};var F=new Promise((function(b,N){T.complete=function(T,U){T?N(T):b(U)}}));U.once("cancel",(function(){b.removeListener("destroyed",s),T.complete(null,{status:"cancelled"})})),this.then=F.then.bind(F),this.catch=F.catch.bind(F),this.then((function(b){Q(null,b)}),Q),b.taskqueue.isReady?U.validateChanges(T):b.taskqueue.addTask((function(b){b?T.complete(b):U.isCancelled?U.emit("cancel"):U.validateChanges(T)}))}function Je(b,T,N){var U=[{rev:b._rev}];"all_docs"===N.style&&(U=Ce(T.rev_tree).map((function(b){return{rev:b.rev}})));var Q={id:T.id,changes:U,doc:b};return Ue(T,b._rev)&&(Q.deleted=!0),N.conflicts&&(Q.doc._conflicts=Pe(T),Q.doc._conflicts.length||delete Q.doc._conflicts),Q}function ze(b,T){return b<T?-1:T<b?1:0}function Ve(b,T){return function(N,U){N||U[0]&&U[0].error?((N=N||U[0]).docId=T,b(N)):b(null,U.length?U[0]:U)}}function Ge(b,T){var N=ze(b._id,T._id);return 0!==N?N:ze(b._revisions?b._revisions.start:0,T._revisions?T._revisions.start:0)}function Qe(){for(var b in oe.EventEmitter.call(this),Qe.prototype)"function"==typeof this[b]&&(this[b]=this[b].bind(this))}function We(){this.isReady=!1,this.failed=!1,this.queue=[]}function Ye(b,T){if(!(this instanceof Ye))return new Ye(b,T);var N=this;if(T=T||{},b&&"object"==typeof b&&(b=(T=b).name,delete T.name),void 0===T.deterministic_revs&&(T.deterministic_revs=!0),this.__opts=T=R(T),N.auto_compaction=T.auto_compaction,N.prefix=Ye.prefix,"string"!=typeof b)throw new Error("Missing/invalid DB name");var U=function(b,T){var N=b.match(/([a-z-]*):\/\/(.*)/);if(N)return{name:/https?/.test(N[1])?N[1]+"://"+N[2]:N[2],adapter:N[1]};var U=Ye.adapters,Q=Ye.preferredAdapters,F=Ye.prefix,K=T.adapter;if(!K)for(var J=0;J<Q.length&&"idb"===(K=Q[J])&&"websql"in U&&A()&&localStorage["_pouch__websqldb_"+F+b];++J)E("log",'PouchDB is downgrading "'+b+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');var z=U[K];return{name:z&&"use_prefix"in z&&!z.use_prefix?b:F+b,adapter:K}}((T.prefix||"")+b,T);if(T.name=U.name,T.adapter=T.adapter||U.adapter,N.name=b,N._adapter=T.adapter,Ye.emit("debug",["adapter","Picked adapter: ",T.adapter]),!Ye.adapters[T.adapter]||!Ye.adapters[T.adapter].valid())throw new Error("Invalid Adapter: "+T.adapter);Qe.call(N),N.taskqueue=new We,N.adapter=T.adapter,Ye.adapters[T.adapter].call(N,T,(function(b){if(b)return N.taskqueue.fail(b);!function(b){function e(T){b.removeListener("closed",n),T||b.constructor.emit("destroyed",b.name)}function n(){b.removeListener("destroyed",e),b.constructor.emit("unref",b)}b.once("destroyed",e),b.once("closed",n),b.constructor.emit("ref",b)}(N),N.emit("created",N),Ye.emit("created",N.name),N.taskqueue.ready(N)}))}G(Ke,oe.EventEmitter),Ke.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},Ke.prototype.validateChanges=function(b){var T=b.complete,N=this;Ye._changesFilterPlugin?Ye._changesFilterPlugin.validate(b,(function(U){if(U)return T(U);N.doChanges(b)})):N.doChanges(b)},Ke.prototype.doChanges=function(b){var T=this,N=b.complete;if("live"in(b=R(b))&&!("continuous"in b)&&(b.continuous=b.live),b.processChange=Je,"latest"===b.since&&(b.since="now"),b.since||(b.since=0),"now"!==b.since){if(Ye._changesFilterPlugin){if(Ye._changesFilterPlugin.normalize(b),Ye._changesFilterPlugin.shouldFilter(this,b))return Ye._changesFilterPlugin.filter(this,b)}else["doc_ids","filter","selector","view"].forEach((function(T){T in b&&E("warn",'The "'+T+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')}));"descending"in b||(b.descending=!1),b.limit=0===b.limit?1:b.limit,b.complete=N;var U=this.db._changes(b);if(U&&"function"==typeof U.cancel){var Q=T.cancel;T.cancel=W((function(b){U.cancel(),Q.apply(this,b)}))}}else this.db.info().then((function(U){T.isCancelled?N(null,{status:"cancelled"}):(b.since=U.update_seq,T.doChanges(b))}),N)},G(Qe,oe.EventEmitter),Qe.prototype.post=m("post",(function(b,T,N){if("function"==typeof T&&(N=T,T={}),"object"!=typeof b||Array.isArray(b))return N(Y(Dt));this.bulkDocs({docs:[b]},T,Ve(N,b._id))})),Qe.prototype.put=m("put",(function(b,T,N){if("function"==typeof T&&(N=T,T={}),"object"!=typeof b||Array.isArray(b))return N(Y(Dt));if(ee(b._id),Fe(b._id)&&"function"==typeof this._putLocal)return b._deleted?this._removeLocal(b,N):this._putLocal(b,N);var U,Q,F,K,J=this;function u(N){"function"==typeof J._put&&!1!==T.new_edits?J._put(b,T,N):J.bulkDocs({docs:[b]},T,Ve(N,b._id))}T.force&&b._rev?(Q=(U=b._rev.split("-"))[1],F=parseInt(U[0],10)+1,K=Ae(),b._revisions={start:F,ids:[K,Q]},b._rev=F+"-"+K,T.new_edits=!1,u((function(T){var U=T?null:{ok:!0,id:b._id,rev:b._rev};N(T,U)}))):u(N)})),Qe.prototype.putAttachment=m("putAttachment",(function(b,T,N,U,Q){var F=this;function a(b){var N="_rev"in b?parseInt(b._rev,10):0;return b._attachments=b._attachments||{},b._attachments[T]={content_type:Q,data:U,revpos:++N},F.put(b)}return"function"==typeof Q&&(Q=U,U=N,N=null),void 0===Q&&(Q=U,U=N,N=null),Q||E("warn","Attachment",T,"on document",b,"is missing content_type"),F.get(b).then((function(b){if(b._rev!==N)throw Y(Ze);return a(b)}),(function(T){if(T.reason===He.message)return a({_id:b});throw T}))})),Qe.prototype.removeAttachment=m("removeAttachment",(function(b,T,N,U){var Q=this;Q.get(b,(function(b,F){if(b)U(b);else if(F._rev===N){if(!F._attachments)return U();delete F._attachments[T],0===Object.keys(F._attachments).length&&delete F._attachments,Q.put(F,U)}else U(Y(Ze))}))})),Qe.prototype.remove=m("remove",(function(b,T,N,U){var Q;"string"==typeof T?(Q={_id:b,_rev:T},"function"==typeof N&&(U=N,N={})):(Q=b,N="function"==typeof T?(U=T,{}):(U=N,T)),(N=N||{}).was_delete=!0;var F={_id:Q._id,_rev:Q._rev||N.rev,_deleted:!0};if(Fe(F._id)&&"function"==typeof this._removeLocal)return this._removeLocal(Q,U);this.bulkDocs({docs:[F]},N,Ve(U,F._id))})),Qe.prototype.revsDiff=m("revsDiff",(function(b,T,N){"function"==typeof T&&(N=T,T={});var U=Object.keys(b);if(!U.length)return N(null,{});var Q=0,K=new F;function c(b,T){K.has(b)||K.set(b,{missing:[]}),K.get(b).missing.push(T)}U.map((function(T){this._getRevisionTree(T,(function(F,J){if(F&&404===F.status&&"missing"===F.message)K.set(T,{missing:b[T]});else{if(F)return N(F);!function(T,N){var U=b[T].slice(0);Se(N,(function(b,N,Q,F,K){var J=N+"-"+Q,z=U.indexOf(J);-1!==z&&(U.splice(z,1),"available"!==K.status&&c(T,J))})),U.forEach((function(b){c(T,b)}))}(T,J)}if(++Q===U.length){var z={};return K.forEach((function(b,T){z[T]=b})),N(null,z)}}))}),this)})),Qe.prototype.bulkGet=m("bulkGet",(function(b,T){O(this,b,T)})),Qe.prototype.compactDocument=m("compactDocument",(function(b,T,N){var U=this;this._getRevisionTree(b,(function(Q,F){if(Q)return N(Q);var K=function(b){var T={},N=[];return Se(b,(function(b,U,Q,F){var K=U+"-"+Q;return b&&(T[K]=0),void 0!==F&&N.push({from:F,to:K}),K})),N.reverse(),N.forEach((function(b){void 0===T[b.from]?T[b.from]=1+T[b.to]:T[b.from]=Math.min(T[b.from],1+T[b.to])})),T}(F),J=[],z=[];Object.keys(K).forEach((function(b){K[b]>T&&J.push(b)})),Se(F,(function(b,T,N,U,Q){var F=T+"-"+N;"available"===Q.status&&-1!==J.indexOf(F)&&z.push(F)})),U._doCompaction(b,z,N)}))})),Qe.prototype.compact=m("compact",(function(b,T){"function"==typeof b&&(T=b,b={});var N=this;b=b||{},N._compactionQueue=N._compactionQueue||[],N._compactionQueue.push({opts:b,callback:T}),1===N._compactionQueue.length&&function n(b){var T=b._compactionQueue[0],N=T.opts,U=T.callback;b.get("_local/compaction").catch((function(){return!1})).then((function(T){T&&T.last_seq&&(N.last_seq=T.last_seq),b._compact(N,(function(T,N){T?U(T):U(null,N),K((function(){b._compactionQueue.shift(),b._compactionQueue.length&&n(b)}))}))}))}(N)})),Qe.prototype._compact=function(b,T){var N=this,U={return_docs:!1,last_seq:b.last_seq||0},Q=[];N.changes(U).on("change",(function(b){Q.push(N.compactDocument(b.id,0))})).on("complete",(function(b){var U=b.last_seq;Promise.all(Q).then((function(){return fe(N,"_local/compaction",(function(b){return(!b.last_seq||b.last_seq<U)&&(b.last_seq=U,b)}))})).then((function(){T(null,{ok:!0})})).catch(T)})).on("error",T)},Qe.prototype.get=m("get",(function(b,T,N){if("function"==typeof T&&(N=T,T={}),"string"!=typeof b)return N(Y(Xe));if(Fe(b)&&"function"==typeof this._getLocal)return this._getLocal(b,N);var U=[],Q=this;function r(){var F=[],K=U.length;if(!K)return N(null,F);U.forEach((function(U){Q.get(b,{rev:U,revs:T.revs,latest:T.latest,attachments:T.attachments,binary:T.binary},(function(b,T){if(b)F.push({missing:U});else{for(var Q,J=0,z=F.length;J<z;J++)if(F[J].ok&&F[J].ok._rev===T._rev){Q=!0;break}Q||F.push({ok:T})}--K||N(null,F)}))}))}if(!T.open_revs)return this._get(b,T,(function(U,F){if(U)return U.docId=b,N(U);var K=F.doc,J=F.metadata,z=F.ctx;if(T.conflicts){var V=Pe(J);V.length&&(K._conflicts=V)}if(Ue(J,K._rev)&&(K._deleted=!0),T.revs||T.revs_info){for(var W=K._rev.split("-"),G=parseInt(W[0],10),oe=W[1],ie=Le(J.rev_tree),se=null,ae=0;ae<ie.length;ae++){var me=ie[ae],be=me.ids.map((function(b){return b.id})).indexOf(oe);(be===G-1||!se&&-1!==be)&&(se=me)}if(!se)return(U=new Error("invalid rev tree")).docId=b,N(U);var qe=se.ids.map((function(b){return b.id})).indexOf(K._rev.split("-")[1])+1,He=se.ids.length-qe;if(se.ids.splice(qe,He),se.ids.reverse(),T.revs&&(K._revisions={start:se.pos+se.ids.length-1,ids:se.ids.map((function(b){return b.id}))}),T.revs_info){var Ze=se.pos+se.ids.length;K._revs_info=se.ids.map((function(b){return{rev:--Ze+"-"+b.id,status:b.opts.status}}))}}if(T.attachments&&K._attachments){var Xe=K._attachments,et=Object.keys(Xe).length;if(0===et)return N(null,K);Object.keys(Xe).forEach((function(b){this._getAttachment(K._id,b,Xe[b],{rev:K._rev,binary:T.binary,ctx:z},(function(T,U){var Q=K._attachments[b];Q.data=U,delete Q.stub,delete Q.length,--et||N(null,K)}))}),Q)}else{if(K._attachments)for(var rt in K._attachments)K._attachments.hasOwnProperty(rt)&&(K._attachments[rt].stub=!0);N(null,K)}}));if("all"===T.open_revs)this._getRevisionTree(b,(function(b,T){if(b)return N(b);U=Ce(T).map((function(b){return b.rev})),r()}));else{if(!Array.isArray(T.open_revs))return N(Y(ct,"function_clause"));U=T.open_revs;for(var F=0;F<U.length;F++){var K=U[F];if("string"!=typeof K||!/^\d+-/.test(K))return N(Y(Ut))}r()}})),Qe.prototype.getAttachment=m("getAttachment",(function(b,T,N,U){var Q=this;N instanceof Function&&(U=N,N={}),this._get(b,N,(function(F,K){return F?U(F):K.doc._attachments&&K.doc._attachments[T]?(N.ctx=K.ctx,N.binary=!0,void Q._getAttachment(b,T,K.doc._attachments[T],N,U)):U(Y(He))}))})),Qe.prototype.allDocs=m("allDocs",(function(b,T){if("function"==typeof b&&(T=b,b={}),b.skip=void 0!==b.skip?b.skip:0,b.start_key&&(b.startkey=b.start_key),b.end_key&&(b.endkey=b.end_key),"keys"in b){if(!Array.isArray(b.keys))return T(new TypeError("options.keys must be an array"));var N=["startkey","endkey","key"].filter((function(T){return T in b}))[0];if(N)return void T(Y(lt,"Query parameter `"+N+"` is not compatible with multi-get"));if(!te(this)&&(function(b){var T="limit"in b?b.keys.slice(b.skip,b.limit+b.skip):0<b.skip?b.keys.slice(b.skip):b.keys;b.keys=T,b.skip=0,delete b.limit,b.descending&&(T.reverse(),b.descending=!1)}(b),0===b.keys.length))return this._allDocs({limit:0},T)}return this._allDocs(b,T)})),Qe.prototype.changes=function(b,T){return"function"==typeof b&&(T=b,b={}),(b=b||{}).return_docs="return_docs"in b?b.return_docs:!b.live,new Ke(this,b,T)},Qe.prototype.close=m("close",(function(b){return this._closed=!0,this.emit("closed"),this._close(b)})),Qe.prototype.info=m("info",(function(b){var T=this;this._info((function(N,U){if(N)return b(N);U.db_name=U.db_name||T.name,U.auto_compaction=!(!T.auto_compaction||te(T)),U.adapter=T.adapter,b(null,U)}))})),Qe.prototype.id=m("id",(function(b){return this._id(b)})),Qe.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},Qe.prototype.bulkDocs=m("bulkDocs",(function(b,T,N){if("function"==typeof T&&(N=T,T={}),T=T||{},Array.isArray(b)&&(b={docs:b}),!b||!b.docs||!Array.isArray(b.docs))return N(Y(qe));for(var U=0;U<b.docs.length;++U)if("object"!=typeof b.docs[U]||Array.isArray(b.docs[U]))return N(Y(Dt));var Q;if(b.docs.forEach((function(b){b._attachments&&Object.keys(b._attachments).forEach((function(T){Q=Q||function(b){return"_"===b.charAt(0)&&b+" is not a valid attachment name, attachment names cannot start with '_'"}(T),b._attachments[T].content_type||E("warn","Attachment",T,"on document",b._id,"is missing content_type")}))})),Q)return N(Y(Lt,Q));"new_edits"in T||(T.new_edits=!("new_edits"in b)||b.new_edits);var F=this;T.new_edits||te(F)||b.docs.sort(Ge),function(b){for(var T=0;T<b.length;T++){var N=b[T];if(N._deleted)delete N._attachments;else if(N._attachments)for(var U=Object.keys(N._attachments),Q=0;Q<U.length;Q++){var F=U[Q];N._attachments[F]=w(N._attachments[F],["data","digest","content_type","length","revpos","stub"])}}}(b.docs);var K=b.docs.map((function(b){return b._id}));return this._bulkDocs(b,T,(function(b,U){if(b)return N(b);if(T.new_edits||(U=U.filter((function(b){return b.error}))),!te(F))for(var Q=0,J=U.length;Q<J;Q++)U[Q].id=U[Q].id||K[Q];N(null,U)}))})),Qe.prototype.registerDependentDatabase=m("registerDependentDatabase",(function(b,T){var N=new this.constructor(b,this.__opts);fe(this,"_local/_pouch_dependentDbs",(function(T){return T.dependentDbs=T.dependentDbs||{},!T.dependentDbs[b]&&(T.dependentDbs[b]=!0,T)})).then((function(){T(null,{db:N})})).catch(T)})),Qe.prototype.destroy=m("destroy",(function(b,T){"function"==typeof b&&(T=b,b={});var N=this,U=!("use_prefix"in N)||N.use_prefix;function u(){N._destroy(b,(function(b,U){if(b)return T(b);N._destroyed=!0,N.emit("destroyed"),T(null,U||{ok:!0})}))}if(te(N))return u();N.get("_local/_pouch_dependentDbs",(function(b,Q){if(b)return 404!==b.status?T(b):u();var F=Q.dependentDbs,K=N.constructor,J=Object.keys(F).map((function(b){var T=U?b.replace(new RegExp("^"+K.prefix),""):b;return new K(T,N.__opts).destroy()}));Promise.all(J).then(u,T)}))})),We.prototype.execute=function(){var b;if(this.failed)for(;b=this.queue.shift();)b(this.failed);else for(;b=this.queue.shift();)b()},We.prototype.fail=function(b){this.failed=b,this.execute()},We.prototype.ready=function(b){this.isReady=!0,this.db=b,this.execute()},We.prototype.addTask=function(b){this.queue.push(b),this.failed&&this.execute()},G(Ye,Qe);var fn="undefined"!=typeof AbortController?AbortController:function(){return{abort:function(){}}},pn=fetch,vn=Headers;Ye.adapters={},Ye.preferredAdapters=[],Ye.prefix="_pouch_";var yn=new oe.EventEmitter;function tt(b,T){for(var N=b,U=0,Q=T.length;U<Q&&(N=N[T[U]]);U++);return N}function nt(b){for(var T=[],N="",U=0,Q=b.length;U<Q;U++){var F=b[U];"."===F?N=0<U&&"\\"===b[U-1]?N.substring(0,N.length-1)+".":(T.push(N),""):N+=F}return T.push(N),T}!function(b){Object.keys(oe.EventEmitter.prototype).forEach((function(T){"function"==typeof oe.EventEmitter.prototype[T]&&(b[T]=yn[T].bind(yn))}));var T=b._destructionListeners=new F;b.on("ref",(function(b){T.has(b.name)||T.set(b.name,[]),T.get(b.name).push(b)})),b.on("unref",(function(b){if(T.has(b.name)){var N=T.get(b.name),U=N.indexOf(b);U<0||(N.splice(U,1),1<N.length?T.set(b.name,N):T.delete(b.name))}})),b.on("destroyed",(function(b){if(T.has(b)){var N=T.get(b);T.delete(b),N.forEach((function(b){b.emit("destroyed",!0)}))}}))}(Ye),Ye.adapter=function(b,T,N){T.valid()&&(Ye.adapters[b]=T,N&&Ye.preferredAdapters.push(b))},Ye.plugin=function(b){if("function"==typeof b)b(Ye);else{if("object"!=typeof b||0===Object.keys(b).length)throw new Error('Invalid plugin: got "'+b+'", expected an object or a function');Object.keys(b).forEach((function(T){Ye.prototype[T]=b[T]}))}return this.__defaults&&(Ye.__defaults=be({},this.__defaults)),Ye},Ye.defaults=function(b){function n(b,T){if(!(this instanceof n))return new n(b,T);T=T||{},b&&"object"==typeof b&&(b=(T=b).name,delete T.name),T=be({},n.__defaults,T),Ye.call(this,b,T)}return G(n,Ye),n.preferredAdapters=Ye.preferredAdapters.slice(),Object.keys(Ye).forEach((function(b){b in n||(n[b]=Ye[b])})),n.__defaults=be({},this.__defaults,b),n},Ye.fetch=function(b,T){return pn(b,T)};var gn=["$or","$nor","$not"];function it(b){return-1<gn.indexOf(b)}function ot(b){return Object.keys(b)[0]}function st(b){var T={};return b.forEach((function(b){Object.keys(b).forEach((function(N){var U=b[N];if("object"!=typeof U&&(U={$eq:U}),it(N))T[N]=U instanceof Array?U.map((function(b){return st([b])})):st([U]);else{var Q=T[N]=T[N]||{};Object.keys(U).forEach((function(b){var T=U[b];return"$gt"===b||"$gte"===b?function(b,T,N){void 0===N.$eq&&(void 0!==N.$gte?"$gte"===b?T>N.$gte&&(N.$gte=T):T>=N.$gte&&(delete N.$gte,N.$gt=T):void 0!==N.$gt?"$gte"===b?T>N.$gt&&(delete N.$gt,N.$gte=T):T>N.$gt&&(N.$gt=T):N[b]=T)}(b,T,Q):"$lt"===b||"$lte"===b?function(b,T,N){void 0===N.$eq&&(void 0!==N.$lte?"$lte"===b?T<N.$lte&&(N.$lte=T):T<=N.$lte&&(delete N.$lte,N.$lt=T):void 0!==N.$lt?"$lte"===b?T<N.$lt&&(delete N.$lt,N.$lte=T):T<N.$lt&&(N.$lt=T):N[b]=T)}(b,T,Q):"$ne"===b?function(b,T){"$ne"in T?T.$ne.push(b):T.$ne=[b]}(T,Q):"$eq"===b?function(b,T){delete T.$gt,delete T.$gte,delete T.$lt,delete T.$lte,delete T.$ne,T.$eq=b}(T,Q):void(Q[b]=T)}))}}))})),T}function at(b){var T=R(b),N=!1;!function e(b,T){for(var N in b){"$and"===N&&(T=!0);var U=b[N];"object"==typeof U&&(T=e(U,T))}return T}(T,!1)||("$and"in(T=function e(b){for(var T in b){if(Array.isArray(b))for(var N in b)b[N].$and&&(b[N]=st(b[N].$and));var U=b[T];"object"==typeof U&&e(U)}return b}(T))&&(T=st(T.$and)),N=!0),["$or","$nor"].forEach((function(b){b in T&&T[b].forEach((function(b){for(var T=Object.keys(b),N=0;N<T.length;N++){var U=T[N],Q=b[U];"object"==typeof Q&&null!==Q||(b[U]={$eq:Q})}}))})),"$not"in T&&(T.$not=st([T.$not]));for(var U=Object.keys(T),Q=0;Q<U.length;Q++){var F=U[Q],K=T[F];"object"!=typeof K||null===K?K={$eq:K}:"$ne"in K&&!N&&(K.$ne=[K.$ne]),T[F]=K}return T}var mn=-324,bn=3,wn="";function dt(b,T){if(b===T)return 0;b=ht(b),T=ht(T);var N=gt(b),U=gt(T);if(N-U!=0)return N-U;switch(typeof b){case"number":return b-T;case"boolean":return b<T?-1:1;case"string":return function(b,T){return b===T?0:T<b?1:-1}(b,T)}return Array.isArray(b)?function(b,T){for(var N=Math.min(b.length,T.length),U=0;U<N;U++){var Q=dt(b[U],T[U]);if(0!==Q)return Q}return b.length===T.length?0:b.length>T.length?1:-1}(b,T):function(b,T){for(var N=Object.keys(b),U=Object.keys(T),Q=Math.min(N.length,U.length),F=0;F<Q;F++){var K=dt(N[F],U[F]);if(0!==K)return K;if(0!==(K=dt(b[N[F]],T[U[F]])))return K}return N.length===U.length?0:N.length>U.length?1:-1}(b,T)}function ht(b){switch(typeof b){case"undefined":return null;case"number":return b===1/0||b===-1/0||isNaN(b)?null:b;case"object":var T=b;if(Array.isArray(b)){var N=b.length;b=new Array(N);for(var U=0;U<N;U++)b[U]=ht(T[U])}else{if(b instanceof Date)return b.toJSON();if(null!==b)for(var Q in b={},T)if(T.hasOwnProperty(Q)){var F=T[Q];void 0!==F&&(b[Q]=ht(F))}}}return b}function vt(b){return gt(b=ht(b))+wn+function pt(b){if(null!==b)switch(typeof b){case"boolean":return b?1:0;case"number":return function(b){if(0===b)return"1";var T=b.toExponential().split(/e\+?/),N=parseInt(T[1],10),U=b<0,Q=U?"0":"2",F=function ut(b,T,N){return function(b,T,N){for(var U="",Q=N-b.length;U.length<Q;)U+=T;return U}(b,T,N)+b}(((U?-N:N)-mn).toString(),"0",bn);Q+=wn+F;var K=Math.abs(parseFloat(T[0]));U&&(K=10-K);var J=K.toFixed(20);return J=J.replace(/\.?0+$/,""),Q+(wn+J)}(b);case"string":return b.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var T=Array.isArray(b),N=T?b:Object.keys(b),U=-1,Q=N.length,F="";if(T)for(;++U<Q;)F+=vt(N[U]);else for(;++U<Q;){var K=N[U];F+=vt(K)+vt(b[K])}return F}return""}(b)+"\0"}function yt(b,T){var N,U=T;if("1"===b[T])N=0,T++;else{var Q="0"===b[T];T++;var F="",K=b.substring(T,T+bn),J=parseInt(K,10)+mn;for(Q&&(J=-J),T+=bn;;){var z=b[T];if("\0"===z)break;F+=z,T++}N=1===(F=F.split(".")).length?parseInt(F,10):parseFloat(F[0]+"."+F[1]),Q&&(N-=10),0!==J&&(N=parseFloat(N+"e"+J))}return{num:N,length:T-U}}function _t(b,T){var N=b.pop();if(T.length){var U=T[T.length-1];N===U.element&&(T.pop(),U=T[T.length-1]);var Q=U.element,F=U.index;Array.isArray(Q)?Q.push(N):F===b.length-2?Q[b.pop()]=N:b.push(N)}}function gt(b){var T=["boolean","number","string","object"].indexOf(typeof b);return~T?null===b?1:Array.isArray(b)?5:T<3?T+2:T+3:Array.isArray(b)?5:void 0}function bt(b,T,N){if(b=b.filter((function(b){return wt(b.doc,T.selector,N)})),T.sort){var U=function mt(b){function r(T){return b.map((function(b){var N=nt(ot(b));return tt(T,N)}))}return function(b,T){var N=dt(r(b.doc),r(T.doc));return 0!==N?N:function(b,T){return b<T?-1:T<b?1:0}(b.doc._id,T.doc._id)}}(T.sort);b=b.sort(U),"string"!=typeof T.sort[0]&&"desc"===function(b){return b[ot(b)]}(T.sort[0])&&(b=b.reverse())}if("limit"in T||"skip"in T){var Q=T.skip||0,F=("limit"in T?T.limit:b.length)+Q;b=b.slice(Q,F)}return b}function wt(b,T,N){return N.every((function(N){var U=T[N],Q=nt(N),F=tt(b,Q);return it(N)?function(b,T,N){return"$or"!==b?"$not"!==b?!T.find((function(b){return wt(N,b,Object.keys(b))})):!wt(N,T,Object.keys(T)):T.some((function(b){return wt(N,b,Object.keys(b))}))}(N,U,b):kt(U,b,Q,F)}))}function kt(b,T,N,U){return!b||("object"==typeof b?Object.keys(b).every((function(Q){var F=b[Q];return function(b,T,N,U,Q){if(kn[b])return kn[b](T,N,U,Q);throw new Error('unknown operator "'+b+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all')}(Q,T,F,N,U)})):b===U)}function jt(b){return null!=b}function Ot(b){return void 0!==b}function At(b,T){return T.some((function(T){return b instanceof Array?-1<b.indexOf(T):b===T}))}var kn={$elemMatch:function(b,T,N,U){return!!Array.isArray(U)&&0!==U.length&&("object"==typeof U[0]?U.some((function(b){return wt(b,T,Object.keys(T))})):U.some((function(U){return kt(T,b,N,U)})))},$allMatch:function(b,T,N,U){return!!Array.isArray(U)&&0!==U.length&&("object"==typeof U[0]?U.every((function(b){return wt(b,T,Object.keys(T))})):U.every((function(U){return kt(T,b,N,U)})))},$eq:function(b,T,N,U){return Ot(U)&&0===dt(U,T)},$gte:function(b,T,N,U){return Ot(U)&&0<=dt(U,T)},$gt:function(b,T,N,U){return Ot(U)&&0<dt(U,T)},$lte:function(b,T,N,U){return Ot(U)&&dt(U,T)<=0},$lt:function(b,T,N,U){return Ot(U)&&dt(U,T)<0},$exists:function(b,T,N,U){return T?Ot(U):!Ot(U)},$mod:function(b,T,N,U){return jt(U)&&function(b,T){var N=T[0],U=T[1];if(0===N)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(N,10)!==N)throw new Error("Divisor is not an integer");if(parseInt(U,10)!==U)throw new Error("Modulus is not an integer");return parseInt(b,10)===b&&b%N===U}(U,T)},$ne:function(b,T,N,U){return T.every((function(b){return 0!==dt(U,b)}))},$in:function(b,T,N,U){return jt(U)&&At(U,T)},$nin:function(b,T,N,U){return jt(U)&&!At(U,T)},$size:function(b,T,N,U){return jt(U)&&function(b,T){return b.length===T}(U,T)},$all:function(b,T,N,U){return Array.isArray(U)&&function(b,T){return T.every((function(T){return-1<b.indexOf(T)}))}(U,T)},$regex:function(b,T,N,U){return jt(U)&&function(b,T){return new RegExp(T).test(b)}(U,T)},$type:function(b,T,N,U){return function(b,T){switch(T){case"null":return null===b;case"boolean":return"boolean"==typeof b;case"number":return"number"==typeof b;case"string":return"string"==typeof b;case"array":return b instanceof Array;case"object":return"[object Object]"==={}.toString.call(b)}throw new Error(T+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}(U,T)}};function Et(b,T){if(b.selector&&b.filter&&"_selector"!==b.filter){var N="string"==typeof b.filter?b.filter:"function";return T(new Error('selector invalid for filter "'+N+'"'))}T()}function St(b){b.view&&!b.filter&&(b.filter="_view"),b.selector&&!b.filter&&(b.filter="_selector"),b.filter&&"string"==typeof b.filter&&("_view"===b.filter?b.view=re(b.view):b.filter=re(b.filter))}function xt(b,T){return T.filter&&"string"==typeof T.filter&&!T.doc_ids&&!te(b.db)}function Ct(b,T){var N=T.complete;if("_view"===T.filter){if(!T.view||"string"!=typeof T.view){var U=Y(Lt,"`view` filter parameter not found or invalid.");return N(U)}var Q=ne(T.view);b.db.get("_design/"+Q[0],(function(U,F){if(b.isCancelled)return N(null,{status:"cancelled"});if(U)return N(H(U));var K=F&&F.views&&F.views[Q[1]]&&F.views[Q[1]].map;if(!K)return N(Y(He,F.views?"missing json key: "+Q[1]:"missing json key: views"));T.filter=function(b){return ce(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+b+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{})}(K),b.doChanges(T)}))}else if(T.selector)T.filter=function(b){return function(b,T){if("object"!=typeof T)throw new Error("Selector error: expected a JSON object");var N=bt([{doc:b}],{selector:T=at(T)},Object.keys(T));return N&&1===N.length}(b,T.selector)},b.doChanges(T);else{var F=ne(T.filter);b.db.get("_design/"+F[0],(function(U,Q){if(b.isCancelled)return N(null,{status:"cancelled"});if(U)return N(H(U));var K=Q&&Q.filters&&Q.filters[F[1]];if(!K)return N(Y(He,Q&&Q.filters?"missing json key: "+F[1]:"missing json key: filters"));T.filter=function(b){return ce('"use strict";\nreturn '+b+";",{})}(K),b.doChanges(T)}))}}function Pt(b){return b.reduce((function(b,T){return b[T]=!0,b}),{})}Ye.plugin((function(b){b._changesFilterPlugin={validate:Et,normalize:St,shouldFilter:xt,filter:Ct}})),Ye.version="7.2.1";var Nn=Pt(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Un=Pt(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function $t(b){if(!/^\d+-/.test(b))return Y(Ut);var T=b.indexOf("-"),N=b.substring(0,T),U=b.substring(T+1);return{prefix:parseInt(N,10),id:U}}function It(b,T,N){var U,Q,F;N=N||{deterministic_revs:!0};var K={status:"available"};if(b._deleted&&(K.deleted=!0),T)if(b._id||(b._id=cn()),Q=Ae(b,N.deterministic_revs),b._rev){if((F=$t(b._rev)).error)return F;b._rev_tree=[{pos:F.prefix,ids:[F.id,{status:"missing"},[[Q,K,[]]]]}],U=F.prefix+1}else b._rev_tree=[{pos:1,ids:[Q,K,[]]}],U=1;else if(b._revisions&&(b._rev_tree=function(b,T){for(var N=b.start-b.ids.length+1,U=b.ids,Q=[U[0],T,[]],F=1,K=U.length;F<K;F++)Q=[U[F],{status:"missing"},[Q]];return[{pos:N,ids:Q}]}(b._revisions,K),U=b._revisions.start,Q=b._revisions.ids[0]),!b._rev_tree){if((F=$t(b._rev)).error)return F;U=F.prefix,Q=F.id,b._rev_tree=[{pos:U,ids:[Q,K,[]]}]}ee(b._id),b._rev=U+"-"+Q;var J={metadata:{},data:{}};for(var z in b)if(Object.prototype.hasOwnProperty.call(b,z)){var V="_"===z[0];if(V&&!Nn[z]){var W=Y(qt,z);throw W.message=qt.message+": "+z,W}V&&!Un[z]?J.metadata[z.slice(1)]=b[z]:J.data[z]=b[z]}return J}function Tt(b,T,N){if(b.stub)return N();"string"==typeof b.data?function Bt(b,T,N){var U=function(b){try{return le(b)}catch(b){return{error:Y(ft,"Attachment is not a valid base64 string")}}}(b.data);if(U.error)return N(U.error);b.length=U.length,b.data="blob"===T?pe(U,b.content_type):"base64"===T?de(U):U,je(U,(function(T){b.digest="md5-"+T,N()}))}(b,T,N):function(b,T,N){je(b.data,(function(U){b.digest="md5-"+U,b.length=b.data.size||b.data.length||0,"binary"===T?_e(b.data,(function(T){b.data=T,N()})):"base64"===T?ge(b.data,(function(T){b.data=T,N()})):N()}))}(b,T,N)}function Mt(b,T,N,U,Q,K,J,z,V){function d(b,T,N){var U=Ee(b.metadata),Q=Ue(b.metadata,U);if("was_delete"in z&&Q)return K[T]=Y(He,"deleted"),N();if(W&&function(b){return"missing"===b.metadata.rev_tree[0].ids[1].status}(b)){var F=Y(Ze);return K[T]=F,N()}J(b,U,Q,Q,!1,Q?0:1,T,N)}b=b||1e3;var W=z.new_edits,G=new F,oe=0,ie=T.length;function v(){++oe===ie&&V&&V()}T.forEach((function(b,T){if(b._id&&Fe(b._id)){var U=b._deleted?"_removeLocal":"_putLocal";N[U](b,{ctx:Q},(function(b,N){K[T]=b||N,v()}))}else{var F=b.metadata.id;G.has(F)?(ie--,G.get(F).push([b,T])):G.set(F,[[b,T]])}})),G.forEach((function(T,N){var Q=0;function a(){++Q<T.length?e():v()}function e(){var F=T[Q],z=F[0],V=F[1];if(U.has(N))!function Rt(b,T,N,U,Q,F,K,J){if(function(b,T){for(var N,U=b.slice(),Q=T.split("-"),F=parseInt(Q[0],10),K=Q[1];N=U.pop();){if(N.pos===F&&N.ids[0]===K)return!0;for(var J=N.ids[2],z=0,V=J.length;z<V;z++)U.push({pos:N.pos+1,ids:J[z]})}return!1}(T.rev_tree,N.metadata.rev)&&!J)return U[Q]=N,F();var z=T.winningRev||Ee(T),V="deleted"in T?T.deleted:Ue(T,z),W="deleted"in N.metadata?N.metadata.deleted:Ue(N.metadata),G=/^1-/.test(N.metadata.rev);if(V&&!W&&J&&G){var oe=N.data;oe._rev=z,oe._id=N.metadata.id,N=It(oe,J)}var ie=Me(T.rev_tree,N.metadata.rev_tree[0],b);if(J&&(V&&W&&"new_leaf"!==ie.conflicts||!V&&"new_leaf"!==ie.conflicts||V&&!W&&"new_branch"===ie.conflicts)){var se=Y(Ze);return U[Q]=se,F()}var ae=N.metadata.rev;N.metadata.rev_tree=ie.tree,N.stemmedRevs=ie.stemmedRevs||[],T.rev_map&&(N.metadata.rev_map=T.rev_map);var me=Ee(N.metadata),be=Ue(N.metadata,me),qe=V===be?0:V<be?-1:1;K(N,me,be,ae===me?be:Ue(N.metadata,ae),!0,qe,Q,F)}(b,U.get(N),z,K,V,a,J,W);else{var G=Me([],z.metadata.rev_tree[0],b);z.metadata.rev_tree=G.tree,z.stemmedRevs=G.stemmedRevs||[],d(z,V,a)}}e()}))}var Qn="document-store",Fn="by-sequence",Hn="attach-store",Gn="attach-seq-store",Zn="meta-store",Xn="local-store",er="detect-blob-support";function Qt(b){return function(T){var N="unknown_error";T.target&&T.target.error&&(N=T.target.error.name||T.target.error.message),b(Y(Nt,N,T.type))}}function Wt(b,T,N){return{data:function(b){try{return JSON.stringify(b)}catch(T){return V.stringify(b)}}(b),winningRev:T,deletedOrLocal:N?"1":"0",seq:b.seq,id:b.id}}function Yt(b){if(!b)return null;var T=function(b){try{return JSON.parse(b)}catch(T){return V.parse(b)}}(b.data);return T.winningRev=b.winningRev,T.deleted="1"===b.deletedOrLocal,T.seq=b.seq,T}function Ht(b){if(!b)return b;var T=b._doc_id_rev.lastIndexOf(":");return b._id=b._doc_id_rev.substring(0,T-1),b._rev=b._doc_id_rev.substring(T+1),delete b._doc_id_rev,b}function Xt(b,T,N,U){N?U(b?"string"!=typeof b?b:ve(b,T):he([""],{type:T})):b?"string"!=typeof b?ye(b,(function(b){U(de(b))})):U(b):U("")}function Zt(b,T,N,U){var Q=Object.keys(b._attachments||{});if(!Q.length)return U&&U();var F=0;function s(){++F===Q.length&&U&&U()}Q.forEach((function(U){T.attachments&&T.include_docs?function(b,T){var U=b._attachments[T],Q=U.digest;N.objectStore(Hn).get(Q).onsuccess=function(b){U.body=b.target.result.body,s()}}(b,U):(b._attachments[U].stub=!0,s())}))}function en(b,T){return Promise.all(b.map((function(b){if(b.doc&&b.doc._attachments){var N=Object.keys(b.doc._attachments);return Promise.all(N.map((function(N){var U=b.doc._attachments[N];if("body"in U){var Q=U.body,F=U.content_type;return new Promise((function(K){Xt(Q,F,T,(function(T){b.doc._attachments[N]=be(w(U,["digest","content_type"]),{data:T}),K()}))}))}})))}})))}function tn(b,T,N){var U=[],Q=N.objectStore(Fn),F=N.objectStore(Hn),K=N.objectStore(Gn),J=b.length;function u(){--J||U.length&&U.forEach((function(b){K.index("digestSeq").count(IDBKeyRange.bound(b+"::",b+"::",!1,!1)).onsuccess=function(T){T.target.result||F.delete(b)}}))}b.forEach((function(b){var N=Q.index("_doc_id_rev"),F=T+"::"+b;N.getKey(F).onsuccess=function(b){var T=b.target.result;if("number"!=typeof T)return u();Q.delete(T),K.index("seq").openCursor(IDBKeyRange.only(T)).onsuccess=function(b){var T=b.target.result;if(T){var N=T.value.digestSeq.split("::")[0];U.push(N),K.delete(T.primaryKey),T.continue()}else u()}}}))}function nn(b,T,N){try{return{txn:b.transaction(T,N)}}catch(b){return{error:b}}}var tr=new q;function sn(b,T,N,U,Q){var F,K,J;function u(b){K=b.target.result,F&&Q(F,K,J)}function c(b){F=b.target.result,K&&Q(F,K,J)}function f(b){var T=b.target.result;if(!T)return Q();Q([T.key],[T.value],T)}-1===U&&(U=1e3),"function"==typeof b.getAll&&"function"==typeof b.getAllKeys&&1<U&&!N?(J={continue:function(){if(!F.length)return Q();var N,J=F[F.length-1];if(T&&T.upper)try{N=IDBKeyRange.bound(J,T.upper,!0,T.upperOpen)}catch(N){if("DataError"===N.name&&0===N.code)return Q()}else N=IDBKeyRange.lowerBound(J,!0);T=N,K=F=null,b.getAll(T,U).onsuccess=u,b.getAllKeys(T,U).onsuccess=c}},b.getAll(T,U).onsuccess=u,b.getAllKeys(T,U).onsuccess=c):N?b.openCursor(T,"prev").onsuccess=f:b.openCursor(T).onsuccess=f}var nr=!1,rr=[];function ln(){!nr&&rr.length&&(nr=!0,rr.shift()())}var mr,Er=new F,Or=new F;function _n(b,T){var N=this;!function dn(b,T,N){rr.push((function(){b((function(b,U){!function(b,T,N,U){try{b(T,N)}catch(T){U.emit("error",T)}}(T,b,U,N),nr=!1,K((function(){ln()}))}))})),ln()}((function(T){!function(b,T,N){var U=T.name,J=null;function o(b,T){var N=b.objectStore(Qn);N.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),N.openCursor().onsuccess=function(b){var U=b.target.result;if(U){var Q=U.value,F=Ue(Q);Q.deletedOrLocal=F?"1":"0",N.put(Q),U.continue()}else T()}}function s(b,T){var N=b.objectStore(Xn),U=b.objectStore(Qn),Q=b.objectStore(Fn);U.openCursor().onsuccess=function(b){var F=b.target.result;if(F){var K=F.value,J=K.id,z=Fe(J),V=Ee(K);if(z){var W=J+"::"+V,G=J+"::",oe=J+"::~",ie=Q.index("_doc_id_rev"),se=IDBKeyRange.bound(G,oe,!1,!1),ae=ie.openCursor(se);ae.onsuccess=function(b){if(ae=b.target.result){var T=ae.value;T._doc_id_rev===W&&N.put(T),Q.delete(ae.primaryKey),ae.continue()}else U.delete(F.primaryKey),F.continue()}}else F.continue()}else T&&T()}}function a(b,T){var N=b.objectStore(Fn),U=b.objectStore(Hn),Q=b.objectStore(Gn);U.count().onsuccess=function(b){if(!b.target.result)return T();N.openCursor().onsuccess=function(b){var N=b.target.result;if(!N)return T();for(var U=N.value,F=N.primaryKey,K=Object.keys(U._attachments||{}),J={},z=0;z<K.length;z++)J[U._attachments[K[z]].digest]=!0;var V=Object.keys(J);for(z=0;z<V.length;z++){var W=V[z];Q.put({seq:F,digestSeq:W+"::"+F})}N.continue()}}}function u(b){var T=b.objectStore(Fn),N=b.objectStore(Qn);N.openCursor().onsuccess=function(b){var U=b.target.result;if(U){var Q,F,K,J,z=function(b){return b.data?Yt(b):(b.deleted="1"===b.deletedOrLocal,b)}(U.value);if(z.winningRev=z.winningRev||Ee(z),z.seq)return a();Q=z.id+"::",F=z.id+"::",K=T.index("_doc_id_rev").openCursor(IDBKeyRange.bound(Q,F)),J=0,K.onsuccess=function(b){var T=b.target.result;if(!T)return z.seq=J,a();var N=T.primaryKey;J<N&&(J=N),T.continue()}}function a(){var b=Wt(z,z.winningRev,z.deleted);N.put(b).onsuccess=function(){U.continue()}}}}b._meta=null,b._remote=!1,b.type=function(){return"idb"},b._id=y((function(T){T(null,b._meta.instanceId)})),b._bulkDocs=function(N,U,Q){!function on(b,T,N,U,Q,K){for(var J,z,V,W,G,oe,ie,se,ae=T.docs,me=0,be=ae.length;me<be;me++){var qe=ae[me];qe._id&&Fe(qe._id)||(qe=ae[me]=It(qe,N.new_edits,b)).error&&!ie&&(ie=qe)}if(ie)return K(ie);var He=!1,Ze=0,Xe=new Array(ae.length),et=new F,rt=!1,ct=U._meta.blobSupport?"blob":"base64";function O(){He=!0,A()}function A(){se&&He&&(se.docCount+=Ze,oe.put(se))}function q(){rt||(tr.notify(U._meta.name),K(null,Xe))}function E(b,T,N,U,Q,F,K,J){b.metadata.winningRev=T,b.metadata.deleted=N;var z=b.data;if(z._id=b.metadata.id,z._rev=b.metadata.rev,U&&(z._deleted=!0),z._attachments&&Object.keys(z._attachments).length)return function(b,T,N,U,Q,F){var K=b.data,J=0,z=Object.keys(K._attachments);function c(){J===z.length&&S(b,T,N,U,Q,F)}function f(){J++,c()}z.forEach((function(N){var U=b.data._attachments[N];if(U.stub)J++,c();else{var Q=U.data;delete U.data,U.revpos=parseInt(T,10),function(b,T,N){W.count(b).onsuccess=function(U){if(U.target.result)return N();var Q={digest:b,body:T};W.put(Q).onsuccess=N}}(U.digest,Q,f)}}))}(b,T,N,Q,K,J);Ze+=F,A(),S(b,T,N,Q,K,J)}function S(b,T,N,Q,F,K){var W=b.data,oe=b.metadata;function u(F){var K=b.stemmedRevs||[];Q&&U.auto_compaction&&(K=K.concat(function(b){var T=[];return Se(b.rev_tree,(function(b,N,U,Q,F){"available"!==F.status||b||(T.push(N+"-"+U),F.status="missing")})),T}(b.metadata))),K&&K.length&&tn(K,b.metadata.id,J),oe.seq=F.target.result;var V=Wt(oe,T,N);z.put(V).onsuccess=c}function c(){Xe[F]={ok:!0,id:oe.id,rev:oe.rev},et.set(b.metadata.id,b.metadata),function(b,T,N){var U,Q,F,K=0,J=Object.keys(b.data._attachments||{});if(!J.length)return N();function o(){++K===J.length&&N()}for(var z=0;z<J.length;z++)U=J[z],F=void 0,Q=b.data._attachments[U].digest,(F=G.put({seq:T,digestSeq:Q+"::"+T})).onsuccess=o,F.onerror=function(b){b.preventDefault(),b.stopPropagation(),o()}}(b,oe.seq,K)}W._doc_id_rev=oe.id+"::"+oe.rev,delete W._id,delete W._rev;var ie=V.put(W);ie.onsuccess=u,ie.onerror=function(b){b.preventDefault(),b.stopPropagation(),V.index("_doc_id_rev").getKey(W._doc_id_rev).onsuccess=function(b){V.put(W,b.target.result).onsuccess=u}}}!function(b,T,N){if(!b.length)return N();var U,Q=0;function a(){Q++,b.length===Q&&(U?N(U):N())}b.forEach((function(b){var N=b.data&&b.data._attachments?Object.keys(b.data._attachments):[],Q=0;if(!N.length)return a();function r(b){U=b,++Q===N.length&&a()}for(var F in b.data._attachments)b.data._attachments.hasOwnProperty(F)&&Tt(b.data._attachments[F],T,r)}))}(ae,ct,(function(T){if(T)return K(T);!function(){var T=nn(Q,[Qn,Fn,Hn,Xn,Gn,Zn],"readwrite");if(T.error)return K(T.error);(J=T.txn).onabort=Qt(K),J.ontimeout=Qt(K),J.oncomplete=q,z=J.objectStore(Qn),V=J.objectStore(Fn),W=J.objectStore(Hn),G=J.objectStore(Gn),(oe=J.objectStore(Zn)).get(Zn).onsuccess=function(b){se=b.target.result,A()},function(b){var T=[];if(ae.forEach((function(b){b.data&&b.data._attachments&&Object.keys(b.data._attachments).forEach((function(N){var U=b.data._attachments[N];U.stub&&T.push(U.digest)}))})),!T.length)return b();var N,U=0;T.forEach((function(Q){!function(b,T){W.get(b).onsuccess=function(N){if(N.target.result)T();else{var U=Y(Ft,"unknown stub attachment with digest "+b);U.status=412,T(U)}}}(Q,(function(Q){Q&&!N&&(N=Q),++U===T.length&&b(N)}))}))}((function(T){if(T)return rt=!0,K(T);!function(){if(ae.length)for(var T=0,Q=0,F=ae.length;Q<F;Q++){var K=ae[Q];K._id&&Fe(K._id)?n():z.get(K.metadata.id).onsuccess=t}function n(){++T===ae.length&&Mt(b.revs_limit,ae,U,et,J,Xe,E,N,O)}function t(b){var T=Yt(b.target.result);T&&et.set(T.id,T),n()}}()}))}()}))}(T,N,U,b,J,Q)},b._get=function(b,T,N){var U,Q,F,K=T.ctx;if(!K){var z=nn(J,[Qn,Fn,Hn],"readonly");if(z.error)return N(z.error);K=z.txn}function c(){N(F,{doc:U,metadata:Q,ctx:K})}K.objectStore(Qn).get(b).onsuccess=function(b){if(!(Q=Yt(b.target.result)))return F=Y(He,"missing"),c();var N;if(T.rev)N=T.latest?function(b,T){for(var N,U=T.rev_tree.slice();N=U.pop();){var Q=N.pos,F=N.ids,K=F[0],J=F[1],z=F[2],V=0===z.length,W=N.history?N.history.slice():[];if(W.push({id:K,pos:Q,opts:J}),V)for(var G=0,oe=W.length;G<oe;G++){var ie=W[G];if(ie.pos+"-"+ie.id===b)return Q+"-"+K}for(var se=0,ae=z.length;se<ae;se++)U.push({pos:Q+1,ids:z[se],history:W})}throw new Error("Unable to resolve latest revision for id "+T.id+", rev "+b)}(T.rev,Q):T.rev;else if(N=Q.winningRev,Ue(Q))return F=Y(He,"deleted"),c();var J=K.objectStore(Fn),z=Q.id+"::"+N;J.index("_doc_id_rev").get(z).onsuccess=function(b){if(!(U=(U=b.target.result)&&Ht(U)))return F=Y(He,"missing"),c();c()}}},b._getAttachment=function(b,T,N,U,Q){var F;if(U.ctx)F=U.ctx;else{var K=nn(J,[Qn,Fn,Hn],"readonly");if(K.error)return Q(K.error);F=K.txn}var z=N.digest,V=N.content_type;F.objectStore(Hn).get(z).onsuccess=function(b){Xt(b.target.result.body,V,U.binary,(function(b){Q(null,b)}))}},b._info=function(T){var N,U,Q=nn(J,[Zn,Fn],"readonly");if(Q.error)return T(Q.error);var F=Q.txn;F.objectStore(Zn).get(Zn).onsuccess=function(b){U=b.target.result.docCount},F.objectStore(Fn).openCursor(null,"prev").onsuccess=function(b){var T=b.target.result;N=T?T.key:0},F.oncomplete=function(){T(null,{doc_count:U,update_seq:N,idb_attachment_format:b._meta.blobSupport?"binary":"base64"})}},b._allDocs=function(b,T){!function un(b,T,N){var U,Q,F="startkey"in b&&b.startkey,K="endkey"in b&&b.endkey,J="key"in b&&b.key,z="keys"in b&&b.keys,V=b.skip||0,W="number"==typeof b.limit?b.limit:-1,G=!1!==b.inclusive_end;if(!z&&(Q=(U=function(b,T,N,U,Q){try{if(b&&T)return Q?IDBKeyRange.bound(T,b,!N,!1):IDBKeyRange.bound(b,T,!1,!N);if(b)return Q?IDBKeyRange.upperBound(b):IDBKeyRange.lowerBound(b);if(T)return Q?IDBKeyRange.lowerBound(T,!N):IDBKeyRange.upperBound(T,!N);if(U)return IDBKeyRange.only(U)}catch(b){return{error:b}}return null}(F,K,G,J,b.descending))&&U.error)&&("DataError"!==Q.name||0!==Q.code))return N(Y(Nt,Q.name,Q.message));var oe=[Qn,Fn,Zn];b.attachments&&oe.push(Hn);var ie=nn(T,oe,"readonly");if(ie.error)return N(ie.error);var se=ie.txn;se.oncomplete=function(){b.attachments?en(et,b.binary).then(q):q()},se.onabort=Qt(N);var ae,me,be,qe=se.objectStore(Qn),He=se.objectStore(Fn),Ze=se.objectStore(Zn),Xe=He.index("_doc_id_rev"),et=[];function j(T,N){var U={id:N.id,key:N.id,value:{rev:T}};N.deleted?z&&(et.push(U),U.value.deleted=!0,U.doc=null):V--<=0&&(et.push(U),b.include_docs&&function(T,N,U){var Q=T.id+"::"+U;Xe.get(Q).onsuccess=function(U){if(N.doc=Ht(U.target.result)||{},b.conflicts){var Q=Pe(T);Q.length&&(N.doc._conflicts=Q)}Zt(N.doc,b,se)}}(N,U,T))}function O(b){for(var T=0,N=b.length;T<N&&et.length!==W;T++){var U=b[T];if(U.error&&z)et.push(U);else{var Q=Yt(U);j(Q.winningRev,Q)}}}function A(b,T,N){N&&(O(T),et.length<W&&N.continue())}function q(){var T={total_rows:ae,offset:b.skip,rows:et};b.update_seq&&void 0!==me&&(T.update_seq=me),N(null,T)}return Ze.get(Zn).onsuccess=function(b){ae=b.target.result.docCount},b.update_seq&&(be=function(b){b.target.result&&0<b.target.result.length&&(me=b.target.result[0])},He.openCursor(null,"prev").onsuccess=function(b){var T=b.target.result,N=void 0;return T&&T.key&&(N=T.key),be({target:{result:[N]}})}),Q||0===W?void 0:z?function(b,T,N){var U=new Array(b.length),Q=0;b.forEach((function(F,K){T.get(F).onsuccess=function(T){T.target.result?U[K]=T.target.result:U[K]={key:F,error:"not_found"},++Q===b.length&&N(b,U,{})}}))}(b.keys,qe,A):-1===W?function an(b,T,N){if("function"!=typeof b.getAll){var U=[];b.openCursor(T).onsuccess=function(b){var T=b.target.result;T?(U.push(T.value),T.continue()):N({target:{result:U}})}}else b.getAll(T).onsuccess=N}(qe,U,(function(T){var N=T.target.result;b.descending&&(N=N.reverse()),O(N)})):void sn(qe,U,b.descending,W+V,A)}(b,J,T)},b._changes=function(T){return function hn(b,T,N,U){if((b=R(b)).continuous){var K=N+":"+cn();return tr.addListener(N,K,T,b),tr.notify(N),{cancel:function(){tr.removeListener(N,K)}}}var J=b.doc_ids&&new Q(b.doc_ids);b.since=b.since||0;var z=b.since,V="limit"in b?b.limit:-1;0===V&&(V=1);var W,G,oe,ie,se=[],ae=0,me=X(b),be=new F;function m(b,T,N,U){if(N.seq!==T)return U();if(N.winningRev===b._rev)return U(N,b);var Q=b._id+"::"+N.winningRev;ie.get(Q).onsuccess=function(b){U(N,Ht(b.target.result))}}function s(){b.complete(null,{results:se,last_seq:z})}var qe=[Qn,Fn];b.attachments&&qe.push(Hn);var He=nn(U,qe,"readonly");if(He.error)return b.complete(He.error);(W=He.txn).onabort=Qt(b.complete),W.oncomplete=function(){!b.continuous&&b.attachments?en(se).then(s):s()},G=W.objectStore(Fn),oe=W.objectStore(Qn),ie=G.index("_doc_id_rev"),sn(G,b.since&&!b.descending?IDBKeyRange.lowerBound(b.since,!0):null,b.descending,V,(function(T,N,U){if(U&&T.length){var Q=new Array(T.length),F=new Array(T.length),K=0;N.forEach((function(N,z){!function(b,T,N){if(J&&!J.has(b._id))return N();var U=be.get(b._id);if(U)return m(b,T,U,N);oe.get(b._id).onsuccess=function(Q){U=Yt(Q.target.result),be.set(b._id,U),m(b,T,U,N)}}(Ht(N),T[z],(function(N,J){F[z]=N,Q[z]=J,++K===T.length&&function(){for(var T=[],N=0,K=Q.length;N<K&&ae!==V;N++){var J=Q[N];if(J){var z=F[N];T.push(u(z,J))}}Promise.all(T).then((function(T){for(var N=0,U=T.length;N<U;N++)T[N]&&b.onChange(T[N])})).catch(b.complete),ae!==V&&U.continue()}()}))}))}function u(T,N){var U=b.processChange(N,T,b);z=U.seq=T.seq;var Q=me(U);return"object"==typeof Q?Promise.reject(Q):Q?(ae++,b.return_docs&&se.push(U),b.attachments&&b.include_docs?new Promise((function(T){Zt(N,b,W,(function(){en([U],b.binary).then((function(){T(U)}))}))})):Promise.resolve(U)):Promise.resolve()}}))}(T,b,U,J)},b._close=function(b){J.close(),Er.delete(U),b()},b._getRevisionTree=function(b,T){var N=nn(J,[Qn],"readonly");if(N.error)return T(N.error);N.txn.objectStore(Qn).get(b).onsuccess=function(b){var N=Yt(b.target.result);N?T(null,N.rev_tree):T(Y(He))}},b._doCompaction=function(b,T,N){var U=nn(J,[Qn,Fn,Hn,Gn],"readwrite");if(U.error)return N(U.error);var Q=U.txn;Q.objectStore(Qn).get(b).onsuccess=function(N){var U=Yt(N.target.result);Se(U.rev_tree,(function(b,N,U,Q,F){var K=N+"-"+U;-1!==T.indexOf(K)&&(F.status="missing")})),tn(T,b,Q);var F=U.winningRev,K=U.deleted;Q.objectStore(Qn).put(Wt(U,F,K))},Q.onabort=Qt(N),Q.oncomplete=function(){N()}},b._getLocal=function(b,T){var N=nn(J,[Xn],"readonly");if(N.error)return T(N.error);var U=N.txn.objectStore(Xn).get(b);U.onerror=Qt(T),U.onsuccess=function(b){var N=b.target.result;N?(delete N._doc_id_rev,T(null,N)):T(Y(He))}},b._putLocal=function(b,T,N){"function"==typeof T&&(N=T,T={}),delete b._revisions;var U=b._rev,Q=b._id;b._rev=U?"0-"+(parseInt(U.split("-")[1],10)+1):"0-1";var F,K=T.ctx;if(!K){var z=nn(J,[Xn],"readwrite");if(z.error)return N(z.error);(K=z.txn).onerror=Qt(N),K.oncomplete=function(){F&&N(null,F)}}var V,W=K.objectStore(Xn);U?(V=W.get(Q)).onsuccess=function(Q){var K=Q.target.result;K&&K._rev===U?W.put(b).onsuccess=function(){F={ok:!0,id:b._id,rev:b._rev},T.ctx&&N(null,F)}:N(Y(Ze))}:((V=W.add(b)).onerror=function(b){N(Y(Ze)),b.preventDefault(),b.stopPropagation()},V.onsuccess=function(){F={ok:!0,id:b._id,rev:b._rev},T.ctx&&N(null,F)})},b._removeLocal=function(b,T,N){"function"==typeof T&&(N=T,T={});var U,Q=T.ctx;if(!Q){var F=nn(J,[Xn],"readwrite");if(F.error)return N(F.error);(Q=F.txn).oncomplete=function(){U&&N(null,U)}}var K=b._id,z=Q.objectStore(Xn),V=z.get(K);V.onerror=Qt(N),V.onsuccess=function(Q){var F=Q.target.result;F&&F._rev===b._rev?(z.delete(K),U={ok:!0,id:K,rev:"0-0"},T.ctx&&N(null,U)):N(Y(He))}},b._destroy=function(b,T){tr.removeAllListeners(U);var N=Or.get(U);N&&N.result&&(N.result.close(),Er.delete(U));var Q=indexedDB.deleteDatabase(U);Q.onsuccess=function(){Or.delete(U),A()&&U in localStorage&&delete localStorage[U],T(null,{ok:!0})},Q.onerror=Qt(T)};var z=Er.get(U);if(z)return J=z.idb,b._meta=z.global,K((function(){N(null,b)}));var V=indexedDB.open(U,5);Or.set(U,V),V.onupgradeneeded=function(b){var T=b.target.result;if(b.oldVersion<1)return function(b){var T=b.createObjectStore(Qn,{keyPath:"id"});b.createObjectStore(Fn,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),b.createObjectStore(Hn,{keyPath:"digest"}),b.createObjectStore(Zn,{keyPath:"id",autoIncrement:!1}),b.createObjectStore(er),T.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),b.createObjectStore(Xn,{keyPath:"_id"});var N=b.createObjectStore(Gn,{autoIncrement:!0});N.createIndex("seq","seq"),N.createIndex("digestSeq","digestSeq",{unique:!0})}(T);var N=b.currentTarget.transaction;b.oldVersion<3&&function(b){b.createObjectStore(Xn,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}(T),b.oldVersion<4&&function(b){var T=b.createObjectStore(Gn,{autoIncrement:!0});T.createIndex("seq","seq"),T.createIndex("digestSeq","digestSeq",{unique:!0})}(T);var U=[o,s,a,u],Q=b.oldVersion;!function e(){var b=U[Q-1];Q++,b&&b(N,e)}()},V.onsuccess=function(T){(J=T.target.result).onversionchange=function(){J.close(),Er.delete(U)},J.onabort=function(b){E("error","Database has a global failure",b.target.error),J.close(),Er.delete(U)};var Q,F,K,z,V=J.transaction([Zn,er,Qn],"readwrite"),W=!1;function a(){void 0!==K&&W&&(b._meta={name:U,instanceId:z,blobSupport:K},Er.set(U,{idb:J,global:b._meta}),N(null,b))}function u(){if(void 0!==F&&void 0!==Q){var b=U+"_id";b in Q?z=Q[b]:Q[b]=z=cn(),Q.docCount=F,V.objectStore(Zn).put(Q)}}V.objectStore(Zn).get(Zn).onsuccess=function(b){Q=b.target.result||{id:Zn},u()},function(b,T){b.objectStore(Qn).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(b){!function(b){F=b,u()}(b.target.result)}}(V),(mr=mr||function(b){return new Promise((function(T){var N=he([""]),U=b.objectStore(er).put(N,"key");U.onsuccess=function(){var b=navigator.userAgent.match(/Chrome\/(\d+)/),N=navigator.userAgent.match(/Edge\//);T(N||!b||43<=parseInt(b[1],10))},U.onerror=b.onabort=function(b){b.preventDefault(),b.stopPropagation(),T(!1)}})).catch((function(){return!1}))}(V)).then((function(b){K=b,a()})),V.oncomplete=function(){W=!0,a()},V.onabort=Qt(N)},V.onerror=function(b){var T=b.target.error&&b.target.error.message;T?-1!==T.indexOf("stored database is a higher version")&&(T=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):T="Failed to open indexedDB, are you in private browsing mode?",E("error",T),N(Y(Nt,T))}}(N,b,T)}),T,N.constructor)}_n.valid=function(){try{return"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(b){return!1}};var Ar=5e3,qr={};function jn(b){var T=b.doc||b.ok,N=T&&T._attachments;N&&Object.keys(N).forEach((function(b){var T=N[b];T.data=ve(T.data,T.content_type)}))}function On(b){return/^_design/.test(b)?"_design/"+encodeURIComponent(b.slice(8)):/^_local/.test(b)?"_local/"+encodeURIComponent(b.slice(7)):encodeURIComponent(b)}function An(b){return b._attachments&&Object.keys(b._attachments)?Promise.all(Object.keys(b._attachments).map((function(T){var N=b._attachments[T];if(N.data&&"string"!=typeof N.data)return new Promise((function(b){ge(N.data,b)})).then((function(b){N.data=b}))}))):Promise.resolve()}function En(b,T){return Sn(b,b.db+"/"+T)}function Sn(b,T){var N=b.path?"/":"";return b.protocol+"://"+b.host+(b.port?":"+b.port:"")+"/"+b.path+N+T}function xn(b){return"?"+Object.keys(b).map((function(T){return T+"="+encodeURIComponent(b[T])})).join("&")}function Cn(b,T){var U=this,Q=function qn(b,T){if(function(b){if(!b.prefix)return!1;var T=ue(b.prefix).protocol;return"http"===T||"https"===T}(T)){var N=T.name.substr(T.prefix.length);b=T.prefix.replace(/\/?$/,"/")+encodeURIComponent(N)}var U=ue(b);(U.user||U.password)&&(U.auth={username:U.user,password:U.password});var Q=U.path.replace(/(^\/|\/$)/g,"").split("/");return U.db=Q.pop(),-1===U.db.indexOf("%")&&(U.db=encodeURIComponent(U.db)),U.path=Q.join("/"),U}(b.name,b),F=En(Q,"");b=R(b);var J,a=function(T,N){if((N=N||{}).headers=N.headers||new vn,N.credentials="include",b.auth||Q.auth){var U=b.auth||Q.auth,F=U.username+":"+U.password,K=de(unescape(encodeURIComponent(F)));N.headers.set("Authorization","Basic "+K)}var J=b.headers||{};return Object.keys(J).forEach((function(b){N.headers.append(b,J[b])})),function(b){var T="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",N=-1!==T.indexOf("msie"),U=-1!==T.indexOf("trident"),Q=-1!==T.indexOf("edge"),F=!("method"in b)||"GET"===b.method;return(N||U||Q)&&F}(N)&&(T+=(-1===T.indexOf("?")?"?":"&")+"_nonce="+Date.now()),(b.fetch||pn)(T,N)};function i(b,T){return m(b,W((function(b){g().then((function(){return T.apply(this,b)})).catch((function(T){b.pop()(T)}))}))).bind(U)}function _(b,T,N){var U={};return(T=T||{}).headers=T.headers||new vn,T.headers.get("Content-Type")||T.headers.set("Content-Type","application/json"),T.headers.get("Accept")||T.headers.set("Accept","application/json"),a(b,T).then((function(b){return U.ok=b.ok,U.status=b.status,b.json()})).then((function(b){if(U.data=b,!U.ok){U.data.status=U.status;var T=H(U.data);if(N)return N(T);throw T}if(Array.isArray(U.data)&&(U.data=U.data.map((function(b){return b.error||b.missing?H(b):b}))),!N)return U;N(null,U.data)}))}function g(){return b.skip_setup?Promise.resolve():J||((J=_(F).catch((function(b){return b&&b.status&&404===b.status?(S(404,"PouchDB is just detecting if the remote exists."),_(F,{method:"PUT"})):Promise.reject(b)})).catch((function(b){return!(!b||!b.status||412!==b.status)||Promise.reject(b)}))).catch((function(){J=null})),J)}function c(b){return b.split("/").map(encodeURIComponent).join("/")}K((function(){T(null,U)})),U._remote=!0,U.type=function(){return"http"},U.id=i("id",(function(b){a(Sn(Q,"")).then((function(b){return b.json()})).catch((function(){return{}})).then((function(T){var N=T&&T.uuid?T.uuid+Q.db:En(Q,"");b(null,N)}))})),U.compact=i("compact",(function(b,T){"function"==typeof b&&(T=b,b={}),b=R(b),_(En(Q,"_compact"),{method:"POST"}).then((function(){!function n(){U.info((function(N,U){U&&!U.compact_running?T(null,{ok:!0}):setTimeout(n,b.interval||200)}))}()}))})),U.bulkGet=m("bulkGet",(function(b,T){var N=this;function e(T){var N={};b.revs&&(N.revs=!0),b.attachments&&(N.attachments=!0),b.latest&&(N.latest=!0),_(En(Q,"_bulk_get"+xn(N)),{method:"POST",body:JSON.stringify({docs:b.docs})}).then((function(N){b.attachments&&b.binary&&N.data.results.forEach((function(b){b.docs.forEach(jn)})),T(null,N.data)})).catch(T)}function n(){var U=Math.ceil(b.docs.length/50),Q=0,F=new Array(U);function t(b){return function(N,K){F[b]=K.results,++Q===U&&T(null,{results:Z(F)})}}for(var K=0;K<U;K++){var J=w(b,["revs","attachments","binary","latest"]);J.docs=b.docs.slice(50*K,Math.min(b.docs.length,50*(K+1))),O(N,J,t(K))}}var U=Sn(Q,""),F=qr[U];"boolean"!=typeof F?e((function(b,N){b?(qr[U]=!1,S(b.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),n()):(qr[U]=!0,T(null,N))})):F?e(T):n()})),U._info=function(b){g().then((function(){return a(En(Q,""))})).then((function(b){return b.json()})).then((function(T){T.host=En(Q,""),b(null,T)})).catch(b)},U.fetch=function(b,T){return g().then((function(){var N="/"===b.substring(0,1)?Sn(Q,b.substring(1)):En(Q,b);return a(N,T)}))},U.get=i("get",(function(b,T,N){"function"==typeof T&&(N=T,T={});var U={};function r(b){var N=b._attachments,U=N&&Object.keys(N);if(N&&U.length)return function(b,T){return new Promise((function(T,N){var U,Q=0,F=0,K=0,J=b.length;function a(){++K===J?U?N(U):T():f()}function u(){Q--,a()}function c(b){Q--,U=U||b,a()}function f(){for(;Q<5&&F<J;)Q++,b[F++]().then(u,c)}f()}))}(U.map((function(U){return function(){return function(U){var F=N[U],K=On(b._id)+"/"+c(U)+"?rev="+b._rev;return a(En(Q,K)).then((function(b){return"buffer"in b?b.buffer():b.blob()})).then((function(b){if(T.binary){var N=Object.getOwnPropertyDescriptor(b.__proto__,"type");return N&&!N.set||(b.type=F.content_type),b}return new Promise((function(T){ge(b,T)}))})).then((function(b){delete F.stub,delete F.length,F.data=b}))}(U)}})))}(T=R(T)).revs&&(U.revs=!0),T.revs_info&&(U.revs_info=!0),T.latest&&(U.latest=!0),T.open_revs&&("all"!==T.open_revs&&(T.open_revs=JSON.stringify(T.open_revs)),U.open_revs=T.open_revs),T.rev&&(U.rev=T.rev),T.conflicts&&(U.conflicts=T.conflicts),T.update_seq&&(U.update_seq=T.update_seq),b=On(b),_(En(Q,b+xn(U))).then((function(b){return Promise.resolve().then((function(){if(T.attachments)return function(b){return Array.isArray(b)?Promise.all(b.map((function(b){if(b.ok)return r(b.ok)}))):r(b)}(b.data)})).then((function(){N(null,b.data)}))})).catch((function(T){T.docId=b,N(T)}))})),U.remove=i("remove",(function(b,T,N,U){var F;"string"==typeof T?(F={_id:b,_rev:T},"function"==typeof N&&(U=N,N={})):(F=b,N="function"==typeof T?(U=T,{}):(U=N,T));var K=F._rev||N.rev;_(En(Q,On(F._id))+"?rev="+K,{method:"DELETE"},U).catch(U)})),U.getAttachment=i("getAttachment",(function(b,T,U,F){"function"==typeof U&&(F=U,U={});var K,J=U.rev?"?rev="+U.rev:"",z=En(Q,On(b))+"/"+c(T)+J;a(z,{method:"GET"}).then((function(b){if(K=b.headers.get("content-type"),b.ok)return void 0===N||N.browser||"function"!=typeof b.buffer?b.blob():b.buffer();throw b})).then((function(b){void 0===N||N.browser||(b.type=K),F(null,b)})).catch((function(b){F(b)}))})),U.removeAttachment=i("removeAttachment",(function(b,T,N,U){_(En(Q,On(b)+"/"+c(T))+"?rev="+N,{method:"DELETE"},U).catch(U)})),U.putAttachment=i("putAttachment",(function(b,T,N,U,F,K){"function"==typeof F&&(K=F,F=U,U=N,N=null);var J=On(b)+"/"+c(T),z=En(Q,J);if(N&&(z+="?rev="+N),"string"==typeof U){var V;try{V=le(U)}catch(b){return K(Y(ft,"Attachment is not a valid base64 string"))}U=V?pe(V,F):""}_(z,{headers:new vn({"Content-Type":F}),method:"PUT",body:U},K).catch(K)})),U._bulkDocs=function(b,T,N){b.new_edits=T.new_edits,g().then((function(){return Promise.all(b.docs.map(An))})).then((function(){return _(En(Q,"_bulk_docs"),{method:"POST",body:JSON.stringify(b)},N)})).catch(N)},U._put=function(b,T,N){g().then((function(){return An(b)})).then((function(){return _(En(Q,On(b._id)),{method:"PUT",body:JSON.stringify(b)})})).then((function(b){N(null,b.data)})).catch((function(T){T.docId=b&&b._id,N(T)}))},U.allDocs=i("allDocs",(function(b,T){"function"==typeof b&&(T=b,b={});var N,U={},F="GET";(b=R(b)).conflicts&&(U.conflicts=!0),b.update_seq&&(U.update_seq=!0),b.descending&&(U.descending=!0),b.include_docs&&(U.include_docs=!0),b.attachments&&(U.attachments=!0),b.key&&(U.key=JSON.stringify(b.key)),b.start_key&&(b.startkey=b.start_key),b.startkey&&(U.startkey=JSON.stringify(b.startkey)),b.end_key&&(b.endkey=b.end_key),b.endkey&&(U.endkey=JSON.stringify(b.endkey)),void 0!==b.inclusive_end&&(U.inclusive_end=!!b.inclusive_end),void 0!==b.limit&&(U.limit=b.limit),void 0!==b.skip&&(U.skip=b.skip);var K=xn(U);void 0!==b.keys&&(F="POST",N={keys:b.keys}),_(En(Q,"_all_docs"+K),{method:F,body:JSON.stringify(N)}).then((function(N){b.include_docs&&b.attachments&&b.binary&&N.data.rows.forEach(jn),T(null,N.data)})).catch(T)})),U._changes=function(b){var T="batch_size"in b?b.batch_size:25;!(b=R(b)).continuous||"heartbeat"in b||(b.heartbeat=1e4);var N="timeout"in b?b.timeout:3e4;"timeout"in b&&b.timeout&&N-b.timeout<Ar&&(N=b.timeout+Ar),"heartbeat"in b&&b.heartbeat&&N-b.heartbeat<Ar&&(N=b.heartbeat+Ar);var U={};"timeout"in b&&b.timeout&&(U.timeout=b.timeout);var F=void 0!==b.limit&&b.limit,J=F;if(b.style&&(U.style=b.style),(b.include_docs||b.filter&&"function"==typeof b.filter)&&(U.include_docs=!0),b.attachments&&(U.attachments=!0),b.continuous&&(U.feed="longpoll"),b.seq_interval&&(U.seq_interval=b.seq_interval),b.conflicts&&(U.conflicts=!0),b.descending&&(U.descending=!0),b.update_seq&&(U.update_seq=!0),"heartbeat"in b&&b.heartbeat&&(U.heartbeat=b.heartbeat),b.filter&&"string"==typeof b.filter&&(U.filter=b.filter),b.view&&"string"==typeof b.view&&(U.filter="_view",U.view=b.view),b.query_params&&"object"==typeof b.query_params)for(var z in b.query_params)b.query_params.hasOwnProperty(z)&&(U[z]=b.query_params[z]);var V,W="GET";function l(N,K){if(!b.aborted){U.since=N,"object"==typeof U.since&&(U.since=JSON.stringify(U.since)),b.descending?F&&(U.limit=J):U.limit=!F||T<J?T:J;var z=En(Q,"_changes"+xn(U)),ie={signal:oe.signal,method:W,body:JSON.stringify(V)};G=N,b.aborted||g().then((function(){return _(z,ie,K)})).catch(K)}}b.doc_ids?(U.filter="_doc_ids",W="POST",V={doc_ids:b.doc_ids}):b.selector&&(U.filter="_selector",W="POST",V={selector:b.selector});var G,oe=new fn,ie={results:[]},v=function(N,U){if(!b.aborted){var Q=0;if(U&&U.results){Q=U.results.length,ie.last_seq=U.last_seq;var z=null,V=null;"number"==typeof U.pending&&(z=U.pending),"string"!=typeof ie.last_seq&&"number"!=typeof ie.last_seq||(V=ie.last_seq),b.query_params,U.results=U.results.filter((function(T){J--;var N=X(b)(T);return N&&(b.include_docs&&b.attachments&&b.binary&&jn(T),b.return_docs&&ie.results.push(T),b.onChange(T,z,V)),N}))}else if(N)return b.aborted=!0,void b.complete(N);U&&U.last_seq&&(G=U.last_seq);var W=F&&J<=0||U&&Q<T||b.descending;(!b.continuous||F&&J<=0)&&W?b.complete(null,ie):K((function(){l(G,v)}))}};return l(b.since||0,v),{cancel:function(){b.aborted=!0,oe.abort()}}},U.revsDiff=i("revsDiff",(function(b,T,N){"function"==typeof T&&(N=T,T={}),_(En(Q,"_revs_diff"),{method:"POST",body:JSON.stringify(b)},N).catch(N)})),U._close=function(b){b()},U._destroy=function(b,T){_(En(Q,""),{method:"DELETE"}).then((function(b){T(null,b)})).catch((function(b){404===b.status?T(null,{ok:!0}):T(b)}))}}function Pn(b){this.status=400,this.name="query_parse_error",this.message=b,this.error=!0;try{Error.captureStackTrace(this,Pn)}catch(b){}}function Ln(b){this.status=404,this.name="not_found",this.message=b,this.error=!0;try{Error.captureStackTrace(this,Ln)}catch(b){}}function Dn(b){this.status=500,this.name="invalid_value",this.message=b,this.error=!0;try{Error.captureStackTrace(this,Dn)}catch(b){}}function $n(b,T){return T&&b.then((function(b){K((function(){T(null,b)}))}),(function(b){K((function(){T(b)}))})),b}function In(b,T){return function(){var N=arguments,U=this;return b.add((function(){return T.apply(U,N)}))}}function Bn(b){var T=new Q(b),N=new Array(T.size),U=-1;return T.forEach((function(b){N[++U]=b})),N}function Tn(b){var T=new Array(b.size),N=-1;return b.forEach((function(b,U){T[++N]=U})),T}function Rn(b){return new Dn("builtin "+b+" function requires map values to be numbers or number arrays")}function Mn(b){for(var T=0,N=0,U=b.length;N<U;N++){var Q=b[N];if("number"!=typeof Q){if(!Array.isArray(Q))throw Rn("_sum");T="number"==typeof T?[T]:T;for(var F=0,K=Q.length;F<K;F++){var J=Q[F];if("number"!=typeof J)throw Rn("_sum");void 0===T[F]?T.push(J):T[F]+=J}}else"number"==typeof T?T+=Q:T[0]+=Q}return T}Cn.valid=function(){return!0},G(Pn,Error),G(Ln,Error),G(Dn,Error);var Cr=E.bind(null,"log"),Dr=Array.isArray,Yr=JSON.parse;function Kn(b,T){return ce("return ("+b.replace(/;\s*$/,"")+");",{emit:T,sum:Mn,log:Cr,isArray:Dr,toJSON:Yr})}function Jn(){this.promise=new Promise((function(b){b()}))}function zn(b){if(!b)return"undefined";switch(typeof b){case"function":case"string":return b.toString();default:return JSON.stringify(b)}}function Vn(b,T,N,U,Q,F){var K,J=function(b,T){return zn(b)+zn(T)+"undefined"}(N,U);if(!Q&&(K=b._cachedViews=b._cachedViews||{})[J])return K[J];var z=b.info().then((function(z){var V=z.db_name+"-mrview-"+(Q?"temp":Oe(J));return fe(b,"_local/"+F,(function(b){b.views=b.views||{};var N=T;-1===N.indexOf("/")&&(N=T+"/"+T);var U=b.views[N]=b.views[N]||{};if(!U[V])return U[V]=!0,b})).then((function(){return b.registerDependentDatabase(V).then((function(T){var Q=T.db;Q.auto_compaction=!0;var F={name:V,db:Q,sourceDB:b,adapter:b.adapter,mapFun:N,reduceFun:U};return F.db.get("_local/lastSeq").catch((function(b){if(404!==b.status)throw b})).then((function(b){return F.seq=b?b.seq:0,K&&F.db.once("destroyed",(function(){delete K[J]})),F}))}))}))}));return K&&(K[J]=z),z}Jn.prototype.add=function(b){return this.promise=this.promise.catch((function(){})).then((function(){return b()})),this.promise},Jn.prototype.finish=function(){return this.promise};var Ur={},Qr=new Jn;function Wn(b){return-1===b.indexOf("/")?[b,b]:b.split("/")}function Yn(b,T){try{b.emit("error",T)}catch(b){E("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),E("error",T)}}var Fr,Kr,Jr,zr,Vr,Hn__sum=function(b,T){return Mn(T)},Hn__count=function(b,T){return T.length},Hn__stats=function(b,T){return{sum:Mn(T),min:Math.min.apply(null,T),max:Math.max.apply(null,T),count:T.length,sumsqr:function(b){for(var T=0,N=0,U=b.length;N<U;N++){var Q=b[N];T+=Q*Q}return T}(T)}},Wr=(Kr="mrviews",Jr=function(b,T){if("function"!=typeof b||2!==b.length)return Kn(b.toString(),T);var N=b;return function(b){return N(b,T)}},zr=function(b){var T=b.toString(),N=function(b){if(/^_sum/.test(b))return Hn__sum;if(/^_count/.test(b))return Hn__count;if(/^_stats/.test(b))return Hn__stats;if(/^_/.test(b))throw new Error(b+" is not a supported reduce function.")}(T);return N||Kn(T)},Vr=function(b,T){var N=b.views&&b.views[T];if("string"!=typeof N.map)throw new Ln("ddoc "+b._id+" has no string view named "+T+", instead found object of type: "+typeof N.map)},{query:function(b,T,N){var U=this;"function"==typeof T&&(N=T,T={}),T=T?function(b){return b.group_level=fr(b.group_level),b.limit=fr(b.limit),b.skip=fr(b.skip),b}(T):{},"function"==typeof b&&(b={map:b});var Q=Promise.resolve().then((function(){return function gr(b,T,N){if("function"==typeof b._query)return function(b,T,N){return new Promise((function(U,Q){b._query(T,N,(function(b,T){if(b)return Q(b);U(T)}))}))}(b,T,N);if(te(b))return function(b,T,N){var U,Q,F,K=[],J="GET";if(cr("reduce",N,K),cr("include_docs",N,K),cr("attachments",N,K),cr("limit",N,K),cr("descending",N,K),cr("group",N,K),cr("group_level",N,K),cr("skip",N,K),cr("stale",N,K),cr("conflicts",N,K),cr("startkey",N,K,!0),cr("start_key",N,K,!0),cr("endkey",N,K,!0),cr("end_key",N,K,!0),cr("inclusive_end",N,K),cr("key",N,K,!0),cr("update_seq",N,K),K=""===(K=K.join("&"))?"":"?"+K,void 0!==N.keys){var z="keys="+encodeURIComponent(JSON.stringify(N.keys));z.length+K.length+1<=2e3?K+=("?"===K[0]?"&":"?")+z:(J="POST","string"==typeof T?U={keys:N.keys}:T.keys=N.keys)}if("string"!=typeof T)return U=U||{},Object.keys(T).forEach((function(b){Array.isArray(T[b])?U[b]=T[b]:U[b]=T[b].toString()})),b.fetch("_temp_view"+K,{headers:new vn({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(U)}).then((function(b){return Q=b.ok,F=b.status,b.json()})).then((function(b){if(!Q)throw b.status=F,H(b);return b})).then(ur(N));var V=Wn(T);return b.fetch("_design/"+V[0]+"/_view/"+V[1]+K,{headers:new vn({"Content-Type":"application/json"}),method:J,body:JSON.stringify(U)}).then((function(b){return Q=b.ok,F=b.status,b.json()})).then((function(b){if(!Q)throw b.status=F,H(b);return b.rows.forEach((function(b){if(b.value&&b.value.error&&"builtin_reduce_error"===b.value.error)throw new Error(b.reason)})),b})).then(ur(N))}(b,T,N);if("string"!=typeof T)return lr(N,T),Qr.add((function(){return Vn(b,"temp_view/temp_view",T.map,T.reduce,!0,Kr).then((function(b){return function(b,T){return b.then((function(b){return T().then((function(){return b}))}),(function(b){return T().then((function(){throw b}))}))}(vr(b).then((function(){return _r(b,N)})),(function(){return b.db.destroy()}))}))})),Qr.finish();var U=T,Q=Wn(U),F=Q[0],J=Q[1];return b.get("_design/"+F).then((function(T){var Q=T.views&&T.views[J];if(!Q)throw new Ln("ddoc "+T._id+" has no view named "+J);return Vr(T,J),lr(N,Q),Vn(b,U,Q.map,Q.reduce,!1,Kr).then((function(b){return"ok"===N.stale||"update_after"===N.stale?("update_after"===N.stale&&K((function(){vr(b)})),_r(b,N)):vr(b).then((function(){return _r(b,N)}))}))}))}(U,b,T)}));return $n(Q,N),Q},viewCleanup:(Fr=function(){var b=this;return"function"==typeof b._viewCleanup?function(b){return new Promise((function(T,N){b._viewCleanup((function(b,U){if(b)return N(b);T(U)}))}))}(b):te(b)?function(b){return b.fetch("_view_cleanup",{headers:new vn({"Content-Type":"application/json"}),method:"POST"}).then((function(b){return b.json()}))}(b):function(b){return b.get("_local/"+Kr).then((function(T){var N=new F;Object.keys(T.views).forEach((function(b){var T=Wn(b),U="_design/"+T[0],F=T[1],K=N.get(U);K||(K=new Q,N.set(U,K)),K.add(F)}));var U={keys:Tn(N),include_docs:!0};return b.allDocs(U).then((function(U){var Q={};U.rows.forEach((function(b){var U=b.key.substring(8);N.get(b.key).forEach((function(N){var F=U+"/"+N;T.views[F]||(F=N);var K=Object.keys(T.views[F]),J=b.doc&&b.doc.views&&b.doc.views[N];K.forEach((function(b){Q[b]=Q[b]||J}))}))}));var F=Object.keys(Q).filter((function(b){return!Q[b]})).map((function(T){return In(pr(T),(function(){return new b.constructor(T,b.__opts).destroy()}))()}));return Promise.all(F).then((function(){return{ok:!0}}))}))}),dr({ok:!0}))}(b)},W((function(b){var T=b.pop(),N=Fr.apply(this,b);return"function"==typeof T&&$n(N,T),N})))});function ir(b,T,N){try{T(N)}catch(T){Yn(b,T)}}function or(b,T,N,U,Q){try{return{output:T(N,U,Q)}}catch(T){return Yn(b,T),{error:T}}}function sr(b,T){var N=dt(b.key,T.key);return 0!==N?N:dt(b.value,T.value)}function ar(b){var T=b.value;return T&&"object"==typeof T&&T._id||b.id}function ur(b){return function(T){return b.include_docs&&b.attachments&&b.binary&&function(b){b.rows.forEach((function(b){var T=b.doc&&b.doc._attachments;T&&Object.keys(T).forEach((function(b){var N=T[b];T[b].data=ve(N.data,N.content_type)}))}))}(T),T}}function cr(b,T,N,U){var Q=T[b];void 0!==Q&&(U&&(Q=encodeURIComponent(JSON.stringify(Q))),N.push(b+"="+Q))}function fr(b){if(void 0!==b){var T=Number(b);return isNaN(T)||T!==parseInt(b,10)?b:T}}function lr(b,T){var N=b.descending?"endkey":"startkey",U=b.descending?"startkey":"endkey";if(void 0!==b[N]&&void 0!==b[U]&&0<dt(b[N],b[U]))throw new Pn("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(T.reduce&&!1!==b.reduce){if(b.include_docs)throw new Pn("{include_docs:true} is invalid for reduce");if(b.keys&&1<b.keys.length&&!b.group&&!b.group_level)throw new Pn("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach((function(T){var N=function(b){if(b){if("number"!=typeof b)return new Pn('Invalid value for integer: "'+b+'"');if(b<0)return new Pn('Invalid value for positive integer: "'+b+'"')}}(b[T]);if(N)throw N}))}function dr(b){return function(T){if(404===T.status)return b;throw T}}function pr(b){var T="string"==typeof b?b:b.name,N=Ur[T];return N||(Ur[T]=new Jn)}function vr(b){return In(pr(b),(function(){return function(b){var T,N,U=Jr(b.mapFun,(function(b,U){var Q={id:N._id,key:ht(b)};null!=U&&(Q.value=ht(U)),T.push(Q)})),K=b.seq||0;function r(T,N){return function(){return function(b,T,N){var U="_local/lastSeq";return b.db.get(U).catch(dr({_id:U,seq:0})).then((function(U){var F=Tn(T);return Promise.all(F.map((function(N){return function hr(b,T,N){var U="_local/doc_"+b,F={_id:U,keys:[]},K=N.get(b),J=K[0];return(function(b){return 1===b.length&&/^1-/.test(b[0].rev)}(K[1])?Promise.resolve(F):T.db.get(U).catch(dr(F))).then((function(b){return function(b){return b.keys.length?T.db.allDocs({keys:b.keys,include_docs:!0}):Promise.resolve({rows:[]})}(b).then((function(T){return function(b,T){for(var N=[],U=new Q,F=0,K=T.rows.length;F<K;F++){var z=T.rows[F].doc;if(z&&(N.push(z),U.add(z._id),z._deleted=!J.has(z._id),!z._deleted)){var V=J.get(z._id);"value"in V&&(z.value=V.value)}}var W=Tn(J);return W.forEach((function(b){if(!U.has(b)){var T={_id:b},Q=J.get(b);"value"in Q&&(T.value=Q.value),N.push(T)}})),b.keys=Bn(W.concat(b.keys)),N.push(b),N}(b,T)}))}))}(N,b,T)}))).then((function(T){var Q=Z(T);return U.seq=N,Q.push(U),b.db.bulkDocs({docs:Q})}))}))}(b,T,N)}}var J=new Jn;function o(){return b.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:K,limit:50}).then(e)}function e(Q){var z=Q.results;if(z.length){var V=function(Q){for(var J=new F,z=0,V=Q.length;z<V;z++){var W=Q[z];if("_"!==W.doc._id[0]){T=[],(N=W.doc)._deleted||ir(b.sourceDB,U,N),T.sort(sr);var G=l(T);J.set(W.doc._id,[G,W.changes])}K=W.seq}return J}(z);if(J.add(r(V,K)),!(z.length<50))return o()}}function l(b){for(var T,N=new F,U=0,Q=b.length;U<Q;U++){var K=b[U],J=[K.key,K.id];0<U&&0===dt(K.key,T)&&J.push(U),N.set(vt(J),K),T=K.key}return N}return o().then((function(){return J.finish()})).then((function(){b.seq=K}))}(b)}))()}function _r(b,T){return In(pr(b),(function(){return function(b,T){var N,U=b.reduceFun&&!1!==T.reduce,Q=T.skip||0;function n(T){return T.include_docs=!0,b.db.allDocs(T).then((function(b){return N=b.total_rows,b.rows.map((function(b){if("value"in b.doc&&"object"==typeof b.doc.value&&null!==b.doc.value){var T=Object.keys(b.doc.value).sort(),N=["id","key","value"];if(!(T<N||N<T))return b.doc.value}var U=function(b){for(var T=[],N=[],U=0;;){var Q=b[U++];if("\0"!==Q)switch(Q){case"1":T.push(null);break;case"2":T.push("1"===b[U]),U++;break;case"3":var F=yt(b,U);T.push(F.num),U+=F.length;break;case"4":for(var K="";;){var J=b[U];if("\0"===J)break;K+=J,U++}K=K.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),T.push(K);break;case"5":var z={element:[],index:T.length};T.push(z.element),N.push(z);break;case"6":var V={element:{},index:T.length};T.push(V.element),N.push(V);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+Q)}else{if(1===T.length)return T.pop();_t(T,N)}}}(b.doc._id);return{key:U[0],id:U[1],value:"value"in b.doc?b.doc.value:null}}))}))}function e(K){var J;if(J=U?function yr(b,T,N){0===N.group_level&&delete N.group_level;var U=N.group||N.group_level,Q=zr(b.reduceFun),F=[],K=isNaN(N.group_level)?Number.POSITIVE_INFINITY:N.group_level;T.forEach((function(b){var T=F[F.length-1],N=U?b.key:null;if(U&&Array.isArray(N)&&(N=N.slice(0,K)),T&&0===dt(T.groupKey,N))return T.keys.push([b.key,b.id]),void T.values.push(b.value);F.push({keys:[[b.key,b.id]],values:[b.value],groupKey:N})})),T=[];for(var J=0,z=F.length;J<z;J++){var V=F[J],W=or(b.sourceDB,Q,V.keys,V.values,!1);if(W.error&&W.error instanceof Dn)throw W.error;T.push({value:W.error?null:W.output,key:V.groupKey})}return{rows:function(b,T,N){return N=N||0,"number"==typeof T?b.slice(N,T+N):0<N?b.slice(N):b}(T,N.limit,N.skip)}}(b,K,T):{total_rows:N,offset:Q,rows:K},T.update_seq&&(J.update_seq=b.seq),T.include_docs){var z=Bn(K.map(ar));return b.sourceDB.allDocs({keys:z,include_docs:!0,conflicts:T.conflicts,attachments:T.attachments,binary:T.binary}).then((function(b){var T=new F;return b.rows.forEach((function(b){T.set(b.id,b.doc)})),K.forEach((function(b){var N=ar(b),U=T.get(N);U&&(b.doc=U)})),J}))}return J}if(void 0===T.keys||T.keys.length||(T.limit=0,delete T.keys),void 0!==T.keys){var K=T.keys.map((function(b){var N={startkey:vt([b]),endkey:vt([b,{}])};return T.update_seq&&(N.update_seq=!0),n(N)}));return Promise.all(K).then(Z).then(e)}var J,z,V={descending:T.descending};if(T.update_seq&&(V.update_seq=!0),"start_key"in T&&(J=T.start_key),"startkey"in T&&(J=T.startkey),"end_key"in T&&(z=T.end_key),"endkey"in T&&(z=T.endkey),void 0!==J&&(V.startkey=T.descending?vt([J,{}]):vt([J])),void 0!==z){var W=!1!==T.inclusive_end;T.descending&&(W=!W),V.endkey=vt(W?[z,{}]:[z])}if(void 0!==T.key){var G=vt([T.key]),oe=vt([T.key,{}]);V.descending?(V.endkey=G,V.startkey=oe):(V.startkey=G,V.endkey=oe)}return U||("number"==typeof T.limit&&(V.limit=T.limit),V.skip=Q),n(V).then(e)}(b,T)}))()}var Hr={query:function(b,T,N){return Wr.query.call(this,b,T,N)},viewCleanup:function(b){return Wr.viewCleanup.call(this,b)}};function br(b){return/^1-/.test(b)}function wr(b,T){var N=Object.keys(T._attachments);return Promise.all(N.map((function(N){return b.getAttachment(T._id,N,{rev:T._rev})})))}function jr(b,T,N,U){N=R(N);var Q=[],F=!0;return Promise.resolve().then((function(){var T=Object.keys(N).filter((function(b){var T=N[b].missing;return 1===T.length&&br(T[0])}));if(0<T.length)return function a(T){return b.allDocs({keys:T,include_docs:!0,conflicts:!0}).then((function(b){if(U.cancelled)throw new Error("cancelled");b.rows.forEach((function(b){b.deleted||!b.doc||!br(b.value.rev)||function(b){return b._attachments&&0<Object.keys(b._attachments).length}(b.doc)||function(b){return b._conflicts&&0<b._conflicts.length}(b.doc)||(b.doc._conflicts&&delete b.doc._conflicts,Q.push(b.doc),delete N[b.id])}))}))}(T)})).then((function(){var K=function(b){var T=[];return Object.keys(b).forEach((function(N){b[N].missing.forEach((function(b){T.push({id:N,rev:b})}))})),{docs:T,revs:!0,latest:!0}}(N);if(K.docs.length)return b.bulkGet(K).then((function(N){if(U.cancelled)throw new Error("cancelled");return Promise.all(N.results.map((function(N){return Promise.all(N.docs.map((function(N){var U=N.ok;return N.error&&(F=!1),U&&U._attachments?function kr(b,T,N){var U=te(T)&&!te(b),Q=Object.keys(N._attachments);return U?b.get(N._id).then((function(U){return Promise.all(Q.map((function(Q){return function(b,T,N){return!b._attachments||!b._attachments[N]||b._attachments[N].digest!==T._attachments[N].digest}(U,N,Q)?T.getAttachment(N._id,Q):b.getAttachment(U._id,Q)})))})).catch((function(b){if(404!==b.status)throw b;return wr(T,N)})):wr(T,N)}(T,b,U).then((function(b){var T=Object.keys(U._attachments);return b.forEach((function(b,N){var Q=U._attachments[T[N]];delete Q.stub,delete Q.length,Q.data=b})),U})):U})))}))).then((function(b){Q=Q.concat(Z(b).filter(Boolean))}))}))})).then((function(){return{ok:F,docs:Q}}))}var Gr="pouchdb";function Sr(b,T,N,U,Q){return b.get(T).catch((function(N){if(404===N.status)return"http"!==b.adapter&&"https"!==b.adapter||S(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:U,_id:T,history:[],replicator:Gr,version:1};throw N})).then((function(F){if(!Q.cancelled&&F.last_seq!==N)return F.history=(F.history||[]).filter((function(b){return b.session_id!==U})),F.history.unshift({last_seq:N,session_id:U}),F.history=F.history.slice(0,5),F.version=1,F.replicator=Gr,F.session_id=U,F.last_seq=N,b.put(F).catch((function(F){if(409===F.status)return Sr(b,T,N,U,Q);throw F}))}))}function xr(b,T,N,U,Q){this.src=b,this.target=T,this.id=N,this.returnValue=U,this.opts=Q||{}}xr.prototype.writeCheckpoint=function(b,T){var N=this;return this.updateTarget(b,T).then((function(){return N.updateSource(b,T)}))},xr.prototype.updateTarget=function(b,T){return this.opts.writeTargetCheckpoint?Sr(this.target,this.id,b,T,this.returnValue):Promise.resolve(!0)},xr.prototype.updateSource=function(b,T){if(this.opts.writeSourceCheckpoint){var N=this;return Sr(this.src,this.id,b,T,this.returnValue).catch((function(b){if(Lr(b))return!(N.opts.writeSourceCheckpoint=!1);throw b}))}return Promise.resolve(!0)};var Zr={undefined:function(b,T){return 0===dt(b.last_seq,T.last_seq)?T.last_seq:0},1:function(b,T){return function(b,T){return b.session_id!==T.session_id?function e(b,T){var N=b[0],U=b.slice(1),Q=T[0],F=T.slice(1);return N&&0!==T.length?Pr(N.session_id,T)?{last_seq:N.last_seq,history:b}:Pr(Q.session_id,U)?{last_seq:Q.last_seq,history:F}:e(U,F):{last_seq:0,history:[]}}(b.history,T.history):{last_seq:b.last_seq,history:b.history}}(T,b).last_seq}};function Pr(b,T){var N=T[0],U=T.slice(1);return!(!b||0===T.length)&&(b===N.session_id||Pr(b,U))}function Lr(b){return"number"==typeof b.status&&4===Math.floor(b.status/100)}xr.prototype.getCheckpoint=function(){var b=this;return b.opts&&b.opts.writeSourceCheckpoint&&!b.opts.writeTargetCheckpoint?b.src.get(b.id).then((function(b){return b.last_seq||0})).catch((function(b){if(404!==b.status)throw b;return 0})):b.target.get(b.id).then((function(T){return b.opts&&b.opts.writeTargetCheckpoint&&!b.opts.writeSourceCheckpoint?T.last_seq||0:b.src.get(b.id).then((function(b){return T.version!==b.version?0:(N=T.version?T.version.toString():"undefined")in Zr?Zr[N](T,b):0;var N}),(function(N){if(404===N.status&&T.last_seq)return b.src.put({_id:b.id,last_seq:0}).then((function(){return 0}),(function(N){return Lr(N)?(b.opts.writeSourceCheckpoint=!1,T.last_seq):0}));throw N}))})).catch((function(b){if(404!==b.status)throw b;return 0}))};var Xr=0;function Ir(b,T,N,U,Q){var F,J,z,V=[],W={seq:0,changes:[],docs:[]},G=!1,oe=!1,ie=!1,se=0,ae=N.continuous||N.live||!1,me=N.batch_size||100,be=N.batches_limit||10,qe=!1,He=N.doc_ids,Ze=N.selector,Xe=[],et=cn();Q=Q||{ok:!0,start_time:(new Date).toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var rt={};function e(){return z?Promise.resolve():function $r(b,T,N){var U=N.doc_ids?N.doc_ids.sort(dt):"",Q=N.filter?N.filter.toString():"",F="",K="",J="";return N.selector&&(J=JSON.stringify(N.selector)),N.filter&&N.query_params&&(F=JSON.stringify(function(b){return Object.keys(b).sort(dt).reduce((function(T,N){return T[N]=b[N],T}),{})}(N.query_params))),N.filter&&"_view"===N.filter&&(K=N.view.toString()),Promise.all([b.id(),T.id()]).then((function(b){var T=b[0]+b[1]+Q+K+F+U+J;return new Promise((function(b){je(T,b)}))})).then((function(b){return"_local/"+b.replace(/\//g,".").replace(/\+/g,"_")}))}(b,T,N).then((function(Q){J=Q;var F;F=!1===N.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===N.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===N.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},z=new xr(b,T,J,U,F)}))}function O(){if(Xe=[],0!==F.docs.length){var b=F.docs,K={timeout:N.timeout};return T.bulkDocs({docs:b,new_edits:!1},K).then((function(T){if(U.cancelled)throw C(),new Error("cancelled");var N=Object.create(null);T.forEach((function(b){b.error&&(N[b.id]=b)}));var F=Object.keys(N).length;Q.doc_write_failures+=F,Q.docs_written+=b.length-F,b.forEach((function(b){var T=N[b._id];if(T){Q.errors.push(T);var F=(T.name||"").toLowerCase();if("unauthorized"!==F&&"forbidden"!==F)throw T;U.emit("denied",R(T))}else Xe.push(b)}))}),(function(T){throw Q.doc_write_failures+=b.length,T}))}}function A(){if(F.error)throw new Error("There was a problem getting docs.");Q.last_seq=se=F.seq;var b=R(Q);return Xe.length&&(b.docs=Xe,"number"==typeof F.pending&&(b.pending=F.pending,delete F.pending),U.emit("change",b)),G=!0,z.writeCheckpoint(F.seq,et).then((function(){if(G=!1,U.cancelled)throw C(),new Error("cancelled");F=void 0,$()})).catch((function(b){throw B(b),b}))}function q(){return jr(b,T,F.diffs,U).then((function(b){F.error=!b.ok,b.docs.forEach((function(b){delete F.diffs[b._id],Q.docs_read++,F.docs.push(b)}))}))}function E(){U.cancelled||F||(0!==V.length?(F=V.shift(),function(){var b={};return F.changes.forEach((function(T){"_user/"!==T.id&&(b[T.id]=T.changes.map((function(b){return b.rev})))})),T.revsDiff(b).then((function(b){if(U.cancelled)throw C(),new Error("cancelled");F.diffs=b}))}().then(q).then(O).then(A).then(E).catch((function(b){x("batch processing terminated with error",b)}))):S(!0))}function S(b){0!==W.changes.length?(b||oe||W.changes.length>=me)&&(V.push(W),W={seq:0,changes:[],docs:[]},"pending"!==U.state&&"stopped"!==U.state||(U.state="active",U.emit("active")),E()):0!==V.length||F||((ae&&rt.live||oe)&&(U.state="pending",U.emit("paused")),oe&&C())}function x(b,T){ie||(T.message||(T.message=b),Q.ok=!1,Q.status="aborting",V=[],W={seq:0,changes:[],docs:[]},C(T))}function C(F){if(!(ie||U.cancelled&&(Q.status="cancelled",G)))if(Q.status=Q.status||"complete",Q.end_time=(new Date).toISOString(),Q.last_seq=se,ie=!0,F){(F=Y(F)).result=Q;var K=(F.name||"").toLowerCase();"unauthorized"===K||"forbidden"===K?(U.emit("error",F),U.removeAllListeners()):function(b,T,N,U){if(!1===b.retry)return T.emit("error",N),T.removeAllListeners();if("function"!=typeof b.back_off_function&&(b.back_off_function=M),T.emit("requestError",N),"active"===T.state||"pending"===T.state){T.emit("paused",N),T.state="stopped";var i=function(){b.current_back_off=Xr};T.once("paused",(function(){T.removeListener("active",i)})),T.once("active",i)}b.current_back_off=b.current_back_off||Xr,b.current_back_off=b.back_off_function(b.current_back_off),setTimeout(U,b.current_back_off)}(N,U,F,(function(){Ir(b,T,N,U)}))}else U.emit("complete",Q),U.removeAllListeners()}function P(b,T,Q){if(U.cancelled)return C();"number"==typeof T&&(W.pending=T),X(N)(b)&&(W.seq=b.seq||Q,W.changes.push(b),K((function(){S(0===V.length&&rt.live)})))}function L(b){if(qe=!1,U.cancelled)return C();if(0<b.results.length)rt.since=b.results[b.results.length-1].seq,$(),S(!0);else{var t=function(){ae?(rt.live=!0,$()):oe=!0,S(!0)};F||0!==b.results.length?t():(G=!0,z.writeCheckpoint(b.last_seq,et).then((function(){G=!1,Q.last_seq=se=b.last_seq,t()})).catch(B))}}function D(b){if(qe=!1,U.cancelled)return C();x("changes rejected",b)}function $(){if(!qe&&!oe&&V.length<be){qe=!0,U._changes&&(U.removeListener("cancel",U._abortChanges),U._changes.cancel()),U.once("cancel",t);var T=b.changes(rt).on("change",P);T.then(n,n),T.then(L).catch(D),N.retry&&(U._changes=T,U._abortChanges=t)}function t(){T.cancel()}function n(){U.removeListener("cancel",t)}}function I(){e().then((function(){if(!U.cancelled)return z.getCheckpoint().then((function(b){rt={since:se=b,limit:me,batch_size:me,style:"all_docs",doc_ids:He,selector:Ze,return_docs:!0},N.filter&&("string"!=typeof N.filter?rt.include_docs=!0:rt.filter=N.filter),"heartbeat"in N&&(rt.heartbeat=N.heartbeat),"timeout"in N&&(rt.timeout=N.timeout),N.query_params&&(rt.query_params=N.query_params),N.view&&(rt.view=N.view),$()}));C()})).catch((function(b){x("getCheckpoint rejected with ",b)}))}function B(b){G=!1,x("writeCheckpoint completed with error",b)}U.ready(b,T),U.cancelled?C():(U._addedListeners||(U.once("cancel",C),"function"==typeof N.complete&&(U.once("error",N.complete),U.once("complete",(function(b){N.complete(null,b)}))),U._addedListeners=!0),void 0===N.since?I():e().then((function(){return G=!0,z.writeCheckpoint(N.since,et)})).then((function(){G=!1,U.cancelled?C():(se=N.since,I())})).catch(B))}function Br(){oe.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var b=this,T=new Promise((function(T,N){b.once("complete",T),b.once("error",N)}));b.then=function(b,N){return T.then(b,N)},b.catch=function(b){return T.catch(b)},b.catch((function(){}))}function Tr(b,T){var N=T.PouchConstructor;return"string"==typeof b?new N(b,T):b}function Rr(b,T,N,U){if("function"==typeof N&&(U=N,N={}),void 0===N&&(N={}),N.doc_ids&&!Array.isArray(N.doc_ids))throw Y(Lt,"`doc_ids` filter parameter is not a list.");N.complete=U,(N=R(N)).continuous=N.continuous||N.live,N.retry="retry"in N&&N.retry,N.PouchConstructor=N.PouchConstructor||this;var Q=new Br(N);return Ir(Tr(b,N),Tr(T,N),N,Q),Q}function Mr(b,T,N,U){return"function"==typeof N&&(U=N,N={}),void 0===N&&(N={}),(N=R(N)).PouchConstructor=N.PouchConstructor||this,new Nr(b=Tr(b,N),T=Tr(T,N),N,U)}function Nr(b,T,N,U){var Q=this;this.canceled=!1;var F=N.push?be({},N,N.push):N,K=N.pull?be({},N,N.pull):N;function a(b){Q.emit("change",{direction:"pull",change:b})}function u(b){Q.emit("change",{direction:"push",change:b})}function c(b){Q.emit("denied",{direction:"push",doc:b})}function f(b){Q.emit("denied",{direction:"pull",doc:b})}function l(){Q.pushPaused=!0,Q.pullPaused&&Q.emit("paused")}function d(){Q.pullPaused=!0,Q.pushPaused&&Q.emit("paused")}function h(){Q.pushPaused=!1,Q.pullPaused&&Q.emit("active",{direction:"push"})}function p(){Q.pullPaused=!1,Q.pushPaused&&Q.emit("active",{direction:"pull"})}this.push=Rr(b,T,F),this.pull=Rr(T,b,K),this.pushPaused=!0,this.pullPaused=!0;var J={};function y(b){return function(T,N){("change"!==T||N!==a&&N!==u)&&("denied"!==T||N!==f&&N!==c)&&("paused"!==T||N!==d&&N!==l)&&("active"!==T||N!==p&&N!==h)||(T in J||(J[T]={}),J[T][b]=!0,2===Object.keys(J[T]).length&&Q.removeAllListeners(T))}}function _(b,T,N){-1==b.listeners(T).indexOf(N)&&b.on(T,N)}N.live&&(this.push.on("complete",Q.pull.cancel.bind(Q.pull)),this.pull.on("complete",Q.push.cancel.bind(Q.push))),this.on("newListener",(function(b){"change"===b?(_(Q.pull,"change",a),_(Q.push,"change",u)):"denied"===b?(_(Q.pull,"denied",f),_(Q.push,"denied",c)):"active"===b?(_(Q.pull,"active",p),_(Q.push,"active",h)):"paused"===b&&(_(Q.pull,"paused",d),_(Q.push,"paused",l))})),this.on("removeListener",(function(b){"change"===b?(Q.pull.removeListener("change",a),Q.push.removeListener("change",u)):"denied"===b?(Q.pull.removeListener("denied",f),Q.push.removeListener("denied",c)):"active"===b?(Q.pull.removeListener("active",p),Q.push.removeListener("active",h)):"paused"===b&&(Q.pull.removeListener("paused",d),Q.push.removeListener("paused",l))})),this.pull.on("removeListener",y("pull")),this.push.on("removeListener",y("push"));var z=Promise.all([this.push,this.pull]).then((function(b){var T={push:b[0],pull:b[1]};return Q.emit("complete",T),U&&U(null,T),Q.removeAllListeners(),T}),(function(b){if(Q.cancel(),U?U(b):Q.emit("error",b),Q.removeAllListeners(),U)throw b}));this.then=function(b,T){return z.then(b,T)},this.catch=function(b){return z.catch(b)}}G(Br,oe.EventEmitter),Br.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},Br.prototype.ready=function(b,T){var N=this;function r(){N.cancel()}N._readyCalled||(N._readyCalled=!0,b.once("destroyed",r),T.once("destroyed",r),N.once("complete",(function(){b.removeListener("destroyed",r),T.removeListener("destroyed",r)})))},G(Nr,oe.EventEmitter),Nr.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},Ye.plugin((function(b){b.adapter("idb",_n,!0)})).plugin((function(b){b.adapter("http",Cn,!1),b.adapter("https",Cn,!1)})).plugin(Hr).plugin((function(b){b.replicate=Rr,b.sync=Mr,Object.defineProperty(b.prototype,"replicate",{get:function(){var b=this;return void 0===this.replicateMethods&&(this.replicateMethods={from:function(T,N,U){return b.constructor.replicate(T,b,N,U)},to:function(T,N,U){return b.constructor.replicate(b,T,N,U)}}),this.replicateMethods}}),b.prototype.sync=function(b,T,N){return this.constructor.sync(this,b,T,N)}})),T.exports=Ye}).call(this,b(5),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,12:12,2:2,3:3,4:4,5:5,6:6,7:7}]},{},[13])(13)}));