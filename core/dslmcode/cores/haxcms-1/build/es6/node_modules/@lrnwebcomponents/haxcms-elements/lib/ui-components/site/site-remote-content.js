/**
 * Copyright 2022 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{LitElement as e,html as t,css as m}from"../../../../../lit/index.js";import{store as r}from"../../core/haxcms-site-store.js";import{HAXCMSI18NMixin as i}from"../../core/utils/HAXCMSI18NMixin.js";import{wipeSlot as a,lightChildrenToShadowRootSelector as n,unwrap as o}from"../../../../utils/utils.js";import{enableServices as s}from"../../../../micro-frontend-registry/lib/microServices.js";import{MicroFrontendRegistry as l}from"../../../../micro-frontend-registry/micro-frontend-registry.js";import"../../../../citation-element/citation-element.js";s(["haxcms"]);class SiteRemoteContent extends(i(e)){static get styles(){return[m`
        :host {
          display: inline;
        }
        #slot {
          display: none;
        }
        :host #content {
          border-left: 10px solid #EEEEEE;
          margin-left: -10px;
        }
        :host([breakreference]) #slot {
          display: block;
        }
        :host([breakreference]) #content {
          display: none;
          border-left: unset;
          margin-left: unset;
        }
        :host([loading]) .loading {
          margin: 8px 0 0 -12px;
          font-size: 2px;
          width: 4px;
          height: 4px;
          border-radius: 50%;
          position: absolute;
          -webkit-animation: load5 1.1s infinite ease;
          animation: load5 1.1s infinite ease;
          -webkit-transform: translateZ(0);
          -ms-transform: translateZ(0);
          transform: translateZ(0);
        }
        @-webkit-keyframes load5 {
          0%,
          100% {
            box-shadow: 0em -2.6em 0em 0em var(--enhanced-text-color, #000000),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.5),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.7);
          }
          12.5% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.7),
              1.8em -1.8em 0 0em var(--enhanced-text-color, #000000),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.5);
          }
          25% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.5),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.7),
              2.5em 0em 0 0em var(--enhanced-text-color, #000000),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          37.5% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.5),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.7),
              1.75em 1.75em 0 0em var(--enhanced-text-color, #000000),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          50% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.5),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.7),
              0em 2.5em 0 0em var(--enhanced-text-color, #000000),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          62.5% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.5),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.7),
              -1.8em 1.8em 0 0em var(--enhanced-text-color, #000000),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          75% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.5),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.7),
              -2.6em 0em 0 0em var(--enhanced-text-color, #000000),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          87.5% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.5),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.7),
              -1.8em -1.8em 0 0em var(--enhanced-text-color, #000000);
          }
        }
        @keyframes load5 {
          0%,
          100% {
            box-shadow: 0em -2.6em 0em 0em var(--enhanced-text-color, #000000),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.5),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.7);
          }
          12.5% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.7),
              1.8em -1.8em 0 0em var(--enhanced-text-color, #000000),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.5);
          }
          25% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.5),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.7),
              2.5em 0em 0 0em var(--enhanced-text-color, #000000),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          37.5% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.5),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.7),
              1.75em 1.75em 0 0em var(--enhanced-text-color, #000000),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          50% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.5),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.7),
              0em 2.5em 0 0em var(--enhanced-text-color, #000000),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          62.5% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.5),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.7),
              -1.8em 1.8em 0 0em var(--enhanced-text-color, #000000),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          75% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.5),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.7),
              -2.6em 0em 0 0em var(--enhanced-text-color, #000000),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          87.5% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.5),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.7),
              -1.8em -1.8em 0 0em var(--enhanced-text-color, #000000);
          }
        }
      `]}static get tag(){return"site-remote-content"}constructor(){super(),this.circularBlock=!1,this.itemManifest={},this.loading=!1,this.uuid=null,this.siteurl="",this.showTitle=!1,this.breakreference=!1,this._remoteTitle=null,this.t={selectPage:"Select page"};let e=this,t=0;for(;e&&e.tagName;)e=e.parentNode,e&&e.tagName&&"SITE-REMOTE-CONTENT"===e.tagName&&(t++,t>=3&&(this.circularBlock=!0))}render(){return t`
    <div class="loading"></div>
    ${this.showTitle&&this._remoteTitle?t`<h3>${this._remoteTitle}</h3>`:""}
    <div id="slot"><slot></slot></div>
    <div id="content"></div>
    `}updated(e){super.updated&&super.updated(e),e.forEach(((e,t)=>{if("uuid"===t&&this[t]&&!this.breakreference&&!this.loading&&!this.circularBlock){this.loading=!0;let e=this.siteurl;""==e&&window.HAXCMS&&window.location&&(e=`${window.location.origin}${window.HAXCMS.instance.store.location.baseUrl}`),l.call("@haxcms/pageCache",{site:e,type:"link",uuid:this.uuid,data:!0},this.renderContentResponse.bind(this))}if("siteurl"!==t||!window.HaxStore||this.loading||this.circularBlock||(clearTimeout(this.__debounce),this.__debounce=setTimeout((()=>{this.loading=!0,this.__refresh=!0,window.HaxStore.instance.refreshActiveNodeForm()}),1500)),"breakreference"===t&&this[t]){const e=this.shadowRoot.querySelector("#content");let t=e.firstElementChild;for(;t;)this.appendChild(t),t=e.firstElementChild}else if("breakreference"===t&&!this[t]&&e&&!this.circularBlock){this.loading=!0,a(this);let e=this.siteurl;""==e&&window.HAXCMS&&window.location&&(e=`${window.location.origin}${window.HAXCMS.instance.store.location.baseUrl}`),l.call("@haxcms/pageCache",{site:e,type:"link",uuid:this.uuid,data:!0},this.renderContentResponse.bind(this))}}))}renderContentResponse(e){if(e.data){window.HaxStore&&!this.breakreference&&window.HaxStore.instance.activeBodyIgnoreActive(!0);const s=this.shadowRoot.querySelector("#content");a(s);let l=document.createElement("div"),c=e.data.content.replace(/<script[\s\S]*?>/gi,"&lt;script&gt;");if(c=c.replace(/<\/script>/gi,"&lt;/script&gt;"),l.innerHTML=c,this.appendChild(l),o(l),this._remoteTitle=e.data.title,this.loading=!1,this.breakreference||n(this,"#content"),this.itemManifest&&e.data&&!this.breakreference){window.HaxStore.instance.activeBodyIgnoreActive(!1);var t=new Date,m=t.getDate(),r=t.getMonth()+1,i=t.getFullYear();if(!this.nextElementSibling||this.nextElementSibling&&"CITATION-ELEMENT"!==this.nextElementSibling.tagName){let t=document.createElement("citation-element");t.title=`${this.itemManifest.title} - ${e.data.title}`,t.source=`${e.data.site}${e.data.slug}`,t.date=`${m}/${r}/${i}`,t.scope="sibling",t.license=this.itemManifest.license,t.creator=this.itemManifest.metadata.author.name,this.insertAdjacentElement("afterend",t)}else if(this.nextElementSibling&&"CITATION-ELEMENT"===this.nextElementSibling.tagName){let t=this.nextElementSibling;t.title=`${this.itemManifest.title} - ${e.data.title}`,t.source=`${e.data.site}${e.data.slug}`,t.date=`${m}/${r}/${i}`,t.scope="sibling",t.license=this.itemManifest.license,t.creator=this.itemManifest.metadata.author.name}}}}static get properties(){return{...super.properties,uuid:{type:String},siteurl:{type:String},showTitle:{type:Boolean,attribute:"show-title"},_remoteTitle:{type:String},loading:{type:Boolean,reflect:!0},breakreference:{type:Boolean,reflect:!0}}}firstUpdated(e){if(super.firstUpdated(e),this.children.length>0){let e=this.shadowRoot.querySelector("#content");a(e),n(this,"#content")}}static get haxProperties(){return{type:"grid",canScale:!1,canPosition:!1,canEditSource:!1,gizmo:{title:"Site Content",description:"Reuse content from one site in another.",icon:"hax:remote",color:"grey",groups:["Content","CMS"],handles:[],meta:{author:"HAXTheWeb core team"}},settings:{configure:[{property:"siteurl",title:"Site address",description:"Paste address to reference content from if not the current site",inputMethod:"textfield"},{property:"uuid",title:"Item",description:"Item to render for the link / title data",inputMethod:"textfield"},{property:"breakreference",title:"Break reference",description:"Checking this box copies the remote content for editing locally but removes the association. It will no longer get updates when the reference material updates.",inputMethod:"boolean"},{property:"showTitle",title:"Show title",description:"Toggle on to render the title of the resource being displayed",inputMethod:"boolean"}]},demoSchema:[{tag:"site-remote-content",properties:{showTitle:!0,_remoteTitle:"Select content"},content:"<div>Select content to load</div>"}],saveOptions:{unsetAttributes:["t","_remote-title"]}}}haxHooks(){return{progressiveEnhancement:"haxprogressiveEnhancement",setupActiveElementForm:"haxsetupActiveElementForm"}}haxprogressiveEnhancement(e){return this.shadowRoot.querySelector("#content").innerHTML}async haxsetupActiveElementForm(e){if(window.HAXCMS){if(0===Object.keys(this.itemManifest).length||this.__refresh)if(this.__refresh=!1,this.siteurl){const e=await l.call("@haxcms/siteManifest",{site:this.siteurl});e.data&&(this.itemManifest=e.data)}else this.itemManifest=r.getManifest(!0);var t=[{text:this.t.selectPage,value:null}];this.itemManifest.items.forEach((e=>{if(e.id!=this.itemId){let m=e,r="- ";for(;m&&null!=m.parent;)m=this.itemManifest.items.find((e=>e.id==m.parent)),m&&(r="--"+r);t.push({text:r+e.title,value:e.id})}})),e.settings.configure.forEach(((m,r)=>{"uuid"===m.property?(e.settings.configure[r].disabled=!1,e.settings.configure[r].inputMethod="select",e.settings.configure[r].itemsList=t,this.breakreference&&(e.settings.configure[r].disabled=!0)):"siteurl"===m.property&&(e.settings.configure[r].disabled=!1,this.breakreference&&(e.settings.configure[r].disabled=!0))})),this.loading=!1}}}customElements.define(SiteRemoteContent.tag,SiteRemoteContent);export{SiteRemoteContent};