/**
 * Copyright 2019 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{html as e,PolymerElement as t}from"../../../../../@polymer/polymer/polymer-element.js";import{encapScript as o,findTagsInHTML as n,wipeSlot as i,varExists as r}from"../../../../utils/utils.js";import{microTask as a}from"../../../../../@polymer/polymer/lib/utils/async.js";import{store as s}from"../../core/haxcms-site-store.js";import"../../../../../@polymer/iron-ajax/iron-ajax.js";import{autorun as m,toJS as l}from"../../../../../mobx/lib/mobx.module.js";class SiteRenderItem extends t{static get tag(){return"site-render-item"}static get template(){return e`
      <style>
        :host {
          display: block;
        }
      </style>
      <iron-ajax
        id="content"
        url="[[location]]"
        handle-as="text"
        loading="{{loading}}"
        debounce-duration="250"
        last-response="{{itemContent}}"
      ></iron-ajax>
      <slot></slot>
    `}static get properties(){return{render:{type:Boolean,value:!1},itemId:{type:String},location:{type:String,computed:"_computeLocation(itemId, render)",observer:"locationChanged"},itemContent:{type:String,notify:!0,observer:"_itemContentChanged"}}}_computeLocation(e,t){if(e&&t){return s.findItem(e).location+"?"+Math.floor(Date.now()/1e3)}}locationChanged(e){e&&this.shadowRoot.querySelector("#content").generateRequest()}pathFromUrl(e){return e.substring(0,e.lastIndexOf("/")+1)}_itemContentChanged(e,t){if(e){var s=e;if(null!==s&&(s=o(e),i(this,"*"),a.run(()=>{setTimeout(()=>{let e=document.createRange().createContextualFragment(s);this.appendChild(e)},5)}),r(this.manifest,"metadata.node.dynamicElementLoader"))){let e=n(s);const t=this.pathFromUrl(decodeURIComponent(import.meta.url));for(var m in e){const o=e[m];this.manifest.metadata.node.dynamicElementLoader[o]&&!window.customElements.get(o)&&import(`${t}../../../../../${this.manifest.metadata.node.dynamicElementLoader[o]}`).then(e=>{}).catch(e=>{console.log(e)})}}}}connectedCallback(){super.connectedCallback(),this.__disposer=[],m(e=>{this.manifest=l(s.manifest),this.__disposer.push(e)})}disconnectedCallback(){for(var e in this.__disposer)this.__disposer[e];super.disconnectedCallback()}}window.customElements.define(SiteRenderItem.tag,SiteRenderItem);export{SiteRenderItem};