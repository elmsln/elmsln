/**
 * Copyright 2019 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{HAXStore as a}from"../hax-body/lib/hax-store.js";import"./lib/h-a-x-dependencies.js";import{localStorageGet as t}from"../utils/utils.js";import{editableTableDisplayStyles as n}from"../editable-table/lib/editable-table-behaviors.js";import{SimpleIconsetStore as e}from"../simple-icon/lib/simple-iconset.js";import{learningComponentColors as o,iconFromPageType as r}from"../course-design/lib/learning-component.js";class HAX extends HTMLElement{get html(){let a=["red","blue","green","orange","purple"].map((a=>`\n        [data-style-decoration~="highlight"] {\n          color: var(--haxcms-style-element-color, white) !important;\n          background-color: var(--haxcms-style-element-background-color, black) !important;\n          font-weight: 400;\n          word-wrap: break-word;\n          padding: 4px 8px;\n          text-transform: uppercase;\n          text-decoration: none;\n        }\n        [data-style-decoration~="${a}"] {\n          --haxcms-style-element-background-color: var(--simple-colors-default-theme-${a}-7, ${a});\n        }\n        `)),t=Object.keys(o).map((a=>{let t=o[a];return`\n        h1[data-instructional-action="${a}"],\n        h2[data-instructional-action="${a}"],\n        h3[data-instructional-action="${a}"],\n        h4[data-instructional-action="${a}"],\n        h5[data-instructional-action="${a}"],\n        h6[data-instructional-action="${a}"] {\n          --hax-action-color: var(--simple-colors-default-theme-${t}-8, ${t});\n          --hax-action-line-color: var(--simple-colors-default-theme-${t}-8, ${t});\n          --hax-action-accent-color: #eeeeee;\n          --hax-action-border: var(--simple-colors-default-theme-${t}-8, ${t}) solid 3px;\n        }\n        h1[data-instructional-action="${a}"]::after,\n        h2[data-instructional-action="${a}"]::after,\n        h3[data-instructional-action="${a}"]::after,\n        h4[data-instructional-action="${a}"]::after,\n        h5[data-instructional-action="${a}"]::after,\n        h6[data-instructional-action="${a}"]::after {\n          -webkit-mask-image: url("${e.getIcon(r(a))}");\n        }\n        \n        hr[data-instructional-action="${a}"] {\n          --hax-action-color: var(--simple-colors-default-theme-${t}-8, ${t});\n          --hax-action-line-color: var(--simple-colors-default-theme-${t}-8, ${t});\n          --hax-action-accent-color: #eeeeee;\n          --hax-action-border: var(--simple-colors-default-theme-${t}-8, ${t}) solid 3px;\n        }\n        \n        hr[data-instructional-action="${a}"]::after {\n          -webkit-mask-image: url("${e.getIcon(r(a))}");\n        }\n        `}));return`\n    <style>\n    ${a.join("\n")}\n    ${t.join("\n")}\n    ${n.map((a=>a.cssText.replace(/:host/g,"hax-body table"))).join(" ")}\n    [data-style-decoration] {\n      --mark-red-bg: #fbe4e4;\n      --mark-pink-bg: #f4dfeb;\n      --mark-blue-bg: #ddebf1;\n      --mark-purple-bg: #eae4f2;\n      --mark-teal-bg: #ddedea;\n      --mark-yellow-bg: #fbf3db;\n      --mark-orange-bg: #faebdd;\n      --mark-brown-bg: #e9e5e3;\n      --mark-gray-bg: #ebeced;\n    }\n    [data-style-block-decoration] {\n      --mark-red-bg-callout: hsla(0,74%,94%,.3);\n      --mark-pink-bg-callout: rgba(244,223,235,.3);\n      --mark-blue-bg-callout: rgba(221,235,241,.3);\n      --mark-purple-bg-callout: rgba(234,228,242,.3);\n      --mark-teal-bg-callout: rgba(221,237,234,.3);\n      --mark-yellow-bg-callout: hsla(45,80%,92%,.3);\n      --mark-orange-bg-callout: hsla(29,74%,92%,.3);\n      --mark-brown-bg-callout: hsla(20,12%,90%,.3);\n      --mark-gray-bg-callout: hsla(210,5%,93%,.3);\n      padding: 16px 16px 16px 12px;\n      border-radius: 3px;\n      align-items: center;\n      box-sizing: border-box;\n      margin: 0.75em 0;\n      border: 2px solid rgba(55,53,47,.09);\n    }\n    [data-style-block-decoration="callout-red"]{\n      background-color: var(--mark-red-bg-callout);\n    }\n    \n    [data-style-block-decoration="callout-pink"]{\n        background-color: var(--mark-pink-bg-callout);\n    }\n    \n    [data-style-block-decoration="callout-blue"]{\n        background-color: var(--mark-blue-bg-callout);\n    }\n    \n    [data-style-block-decoration="callout-purple"]{\n        background-color: var(--mark-purple-bg-callout);\n    }\n    \n    [data-style-block-decoration="callout-teal"]{\n        background-color: var(--mark-teal-bg-callout);\n    }\n    \n    [data-style-block-decoration="callout-yellow"]{\n        background-color: var(--mark-yellow-bg-callout);\n    }\n    \n    [data-style-block-decoration="callout-orange"]{\n        background-color: var(--mark-orange-bg-callout);\n    }\n    \n    [data-style-block-decoration="callout-brown"]{\n        background-color: var(--mark-brown-bg-callout);\n    }\n    [data-style-block-decoration="callout-gray"]{\n        background-color: var(--mark-gray-bg-callout);\n    }\n    [data-style-decoration="mark-blue"],[data-style-decoration="mark-brown"],[data-style-decoration="mark-gray"],[data-style-decoration="mark-orange"],[data-style-decoration="mark-pink"],[data-style-decoration="mark-purple"],[data-style-decoration="mark-red"],[data-style-decoration="mark-teal"],[data-style-decoration="mark-yellow"] {\n      --bg-color: transparent;  \n      padding: 0 .5rem;\n      margin: 0 -.5rem 0 -.25rem;\n      border-radius: .5rem;\n      border-bottom-left-radius: .125rem;\n      -webkit-box-decoration-break: clone;\n      box-decoration-break: clone;\n      background-color: transparent;\n      background-image: linear-gradient(119deg,var(--bg-color),#fff697 10.5%,#fdf59d 85.29%,var(--bg-color));\n    }\n\n    [data-style-decoration="mark-pink"],[data-style-decoration="mark-purple"] {\n        background-image: linear-gradient(119deg,var(--bg-color),#f5b8d1 10.5%,#f9bcd3 85.29%,var(--bg-color))\n    }\n\n    [data-style-decoration="mark-blue"],[data-style-decoration="mark-gray"] {\n        background-image: linear-gradient(119deg,var(--bg-color),#adedfc 10.5%,#adebfd 85.29%,var(--bg-color));\n    }\n\n    [data-style-decoration="mark-orange"],[data-style-decoration="mark-red"] {\n        background-image: linear-gradient(119deg,var(--bg-color),#f5c4ff 10.5%,#e7a8fc 85.29%,var(--bg-color))\n    }\n\n    [data-style-decoration="mark-teal"] {\n        background-image: linear-gradient(119deg,var(--bg-color),#d4eabc 10.5%,#d2eabc 85.29%,var(--bg-color))\n    }\n\n    [data-style-decoration="mark-brown"] {\n        background-image: linear-gradient(119deg,var(--bg-color),#96b8ec 10.5%,#a6c3f0 85.29%,var(--bg-color))\n    }\n    [data-style-decoration="mark-red"] {\n        background-color: var(--mark-red-bg)\n    }\n\n    [data-style-decoration="mark-pink"] {\n        background-color: var(--mark-pink-bg)\n    }\n\n    [data-style-decoration="mark-blue"] {\n        background-color: var(--mark-blue-bg)\n    }\n\n    [data-style-decoration="mark-purple"] {\n        background-color: var(--mark-purple-bg)\n    }\n\n    [data-style-decoration="mark-teal"] {\n        background-color: var(--mark-teal-bg)\n    }\n\n    [data-style-decoration="mark-yellow"] {\n        background-color: var(--mark-yellow-bg)\n    }\n\n    [data-style-decoration="mark-orange"] {\n        background-color: var(--mark-orange-bg)\n    }\n\n    [data-style-decoration="mark-brown"] {\n        background-color: var(--mark-brown-bg)\n    }\n\n    [data-style-decoration="mark-gray"] {\n        background-color: var(--mark-gray-bg)\n    }\n    hr[data-instructional-action] {\n      border: none;\n      border-top: 2px dashed var(--hax-action-line-color, blue);\n      overflow: visible;\n      text-align: center;\n      height: 4px;\n      padding: 0px;\n      background-color: white;\n    }\n    \n    hr[data-instructional-action]::before {\n      background-color: var(--hax-action-accent-color, #aaa);\n      height: 50px;\n      width: 50px;\n      margin: 0 auto;\n      background-position: center;\n      content: '';\n      display: block;\n      top: -28px;\n      position: relative;\n      z-index: 1;\n      border: var(--hax-action-border ,2px solid blue);\n      border-radius: 50%;\n    }\n  \n    hr[data-instructional-action]::after {\n      content: '';\n      position: relative;\n      z-index: 2;\n      background-color: var(--hax-action-color, blue);\n      mask-repeat: no-repeat;\n      mask-size: contain;\n      -webkit-mask-repeat: no-repeat;\n      -webkit-mask-size: contain;\n      padding: 18px;\n      top: -64px;\n    }\n        h1[data-instructional-action],\n        h2[data-instructional-action],\n        h3[data-instructional-action],\n        h4[data-instructional-action],\n        h5[data-instructional-action],\n        h6[data-instructional-action] {\n          padding-left: 72px;\n          line-height: 50px;\n          min-height: 64px;\n          position: relative;\n        }\n\n        h1[data-instructional-action]::before,\n        h2[data-instructional-action]::before,\n        h3[data-instructional-action]::before,\n        h4[data-instructional-action]::before,\n        h5[data-instructional-action]::before,    \n        h6[data-instructional-action]::before {\n          background-color: var(--hax-action-accent-color, #aaa);\n          background-position: center;\n          content: '';\n          display: block;\n          position: absolute;\n          z-index: 1;\n          border: var(--hax-action-border , 3px solid black);\n          border-radius: 50%;\n          left: 0px;\n          margin: 5px;\n          height: 40px;\n          width: 40px;\n        }        \n\n        h1[data-instructional-action]::after,\n        h2[data-instructional-action]::after,\n        h3[data-instructional-action]::after,\n        h4[data-instructional-action]::after,\n        h5[data-instructional-action]::after,    \n        h6[data-instructional-action]::after {\n          content: '';\n          position: relative;\n          z-index: 2;\n          background-color: var(--hax-action-color, blue);\n          mask-repeat: no-repeat;\n          mask-size: contain;\n          -webkit-mask-repeat: no-repeat;\n          -webkit-mask-size: contain;\n          padding: 12px;\n          margin: 15px;\n          position: absolute;\n          left: 0px;\n        }\n    [data-instructional-action][data-id-emphasize] {\n      background-color: var(--hax-action-color) !important;\n      color: white;\n    }\n\n    :host,h-a-x {\n      display: block;\n    }\n\n    :host([hidden]),h-a-x([hidden]) {\n      display: none;\n    }\n\n    :host img, h-a-x img {\n      max-width: 100%;\n      max-width: -moz-available;\n      max-width: -webkit-fill-available;\n      max-width: fill-available;\n    }\n\n    hax-body[edit-mode] page-break[data-hax-active],\n    hax-body[edit-mode] [data-hax-active][contenteditable] {\n      outline-offset: 8px;\n      outline: var(--hax-body-active-outline, 2px solid var(--hax-ui-color-focus, #000)) !important;\n      caret-color: var(--hax-ui-caret-color, auto);\n    }\n\n  :host([edit-mode])\n    #bodycontainer\n    ::slotted([contenteditable][data-hax-ray][data-hax-active]:empty:not([data-instructional-action]))::before {\n    content: "Type / to add blocks";\n    opacity: 0.4;\n  }\n    </style>\n    <hax-body>\n        <slot></slot>\n    </hax-body>`}static get tag(){return"h-a-x"}constructor(a=!1){super(),this.windowControllers=new AbortController,this.windowControllersLoaded=new AbortController,this.windowControllersReady=new AbortController,this.__rendered=!1,this.tag=HAX.tag,this.template=document.createElement("template"),this.attachShadow({mode:"open"}),globalThis.document.adoptedStyleSheets&&globalThis.document.adoptedStyleSheets.map((a=>{a.hax&&this.shadowRoot.adoptedStyleSheets.push(a)})),a||this.render(),window.addEventListener("hax-store-ready",this.storeReady.bind(this),{once:!0,passive:!0,signal:this.windowControllersReady.signal}),window.addEventListener("hax-store-app-store-loaded",this.appStoreReady.bind(this),{once:!0,passive:!0,signal:this.windowControllersLoaded.signal}),window.addEventListener("hax-cancel",this.cancelEvent.bind(this),{signal:this.windowControllers.signal}),window.addEventListener("hax-save",this.saveEvent.bind(this),{signal:this.windowControllers.signal})}cancelEvent(a){this.importSlotToHaxBody()}async saveEvent(t){const n=await a.activeHaxBody.haxToContent();this.innerHTML=n,this.dispatchEvent(new CustomEvent("hax-save-body-value",{composed:!0,bubbles:!0,cancelable:!0,detail:{value:n}}))}connectedCallback(){super.connectedCallback&&super.connectedCallback(),this.__HAXApplied||window.__HAXApplied||(window.__HAXApplied=this.__HAXApplied=this.applyHAX())}storeReady(t){t.detail&&(setTimeout((()=>{try{let t={...JSON.parse(this.getAttribute("app-store"))};"object"==typeof t&&(a.appStore=t)}catch(a){console.warn(a)}"hide-panel-ops"===this.hidePanelOps&&(this.hidePanelOps=!0),a.haxTray.hidePanelOps=this.hidePanelOps,"hide-toolbar"===this.hideToolbar&&(this.hideToolbar=!0),a.haxTray.hideToolbar=this.hideToolbar,a.haxTray.offsetMargin=this.offsetMargin,a.elementAlign=this.elementAlign}),0),this.windowControllersReady.abort())}importSlotToHaxBody(){var t=[];t=this.shadowRoot.querySelector("slot")?this.shadowRoot.querySelector("slot").assignedNodes():this.children;let n="";for(let a in t)void 0!==t[a].outerHTML&&(n+=t[a].outerHTML);a.activeHaxBody.importContent(n)}appStoreReady(a){a.detail&&(this.importSlotToHaxBody(),this.windowControllersLoaded.abort())}render(){this.__rendered=!0,this.shadowRoot.innerHTML=null,this.template.innerHTML=this.html,this.shadowRoot.appendChild(this.template.content.cloneNode(!0))}applyHAX(){let a=window.HaxStore.requestAvailability(),n=document.createElement("hax-tray");return n.hidePanelOps=this.hidePanelOps,n.hideToolbar=this.hideToolbar,this.elementAlign=t("hax-tray-elementAlign"),this.elementAlign&&null!=this.elementAlign&&""!=this.elementAlign||(this.elementAlign="left"),a.elementAlign=this.elementAlign,document.body.appendChild(n),document.body.appendChild(document.createElement("hax-app-picker")),document.body.appendChild(document.createElement("hax-autoloader")),document.body.appendChild(document.createElement("hax-cancel-dialog")),!0}disconnectedCallback(){this.windowControllers.abort(),super.disconnectedCallback&&super.disconnectedCallback()}static get observedAttributes(){return["element-align","offset-margin","app-store","hide-panel-ops"]}get elementAlign(){return this.getAttribute("element-align")}set elementAlign(t){this.__rendered&&(this.setAttribute("element-align",t),a.elementAlign=t)}get offsetMargin(){return this.getAttribute("offset-margin")}set offsetMargin(t){this.setAttribute("offset-margin",t),this.__rendered&&(a.haxTray.offsetMargin=t)}get hideToolbar(){return this.getAttribute("hide-toolbar")}set hideToolbar(t){t&&(this.setAttribute("hide-toolbar","hide-toolbar"),this.__rendered&&(a.haxTray.hideToolbar=t))}get hidePanelOps(){return this.getAttribute("hide-panel-ops")}set hidePanelOps(t){t&&(this.setAttribute("hide-panel-ops","hide-panel-ops"),this.__rendered&&(a.haxTray.hidePanelOps=t))}get appStore(){return this.getAttribute("app-store")}set appStore(t){this.setAttribute("app-store",t),this.__rendered&&(a.appStore={...JSON.parse(this.getAttribute("app-store"))})}attributeChangedCallback(a,t,n){}}customElements.define("h-a-x",HAX);export{HAX};