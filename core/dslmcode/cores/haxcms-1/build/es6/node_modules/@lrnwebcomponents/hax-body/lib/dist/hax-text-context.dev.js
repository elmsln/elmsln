Object.defineProperty(exports,"__esModule",{value:!0}),exports.HaxTextContext=void 0;var e=require("lit");require("@lrnwebcomponents/simple-icon/lib/simple-icon-lite.js"),require("@lrnwebcomponents/hax-iconset/lib/simple-hax-iconset.js"),require("@lrnwebcomponents/hax-body/lib/hax-toolbar-menu.js"),require("@lrnwebcomponents/simple-toolbar/lib/simple-toolbar-menu-item.js"),require("@lrnwebcomponents/hax-body/lib/hax-context-item.js"),require("@lrnwebcomponents/hax-body/lib/hax-context-item-textop.js"),require("@lrnwebcomponents/hax-body/lib/hax-toolbar.js");var t=require("./hax-store.js"),n=require("mobx"),o=require("./hax-context-behaviors.js"),i=require("@lrnwebcomponents/i18n-manager/lib/I18NMixin.js");function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _templateObject3_e6b3a3308e0011ed99ce491205e67b1d(){var e=_taggedTemplateLiteral([' <simple-toolbar-menu-item slot="menuitem">\n                    <hax-context-item-textop\n                      action\n                      align-horizontal="left"\n                      role="menuitem"\n                      icon="','"\n                      label="','"\n                      show-text-label\n                      ?hidden="','"\n                      event-name="','"\n                      show-text-label\n                      ?disabled="','"\n                      @click="','"\n                    ></hax-context-item-textop>\n                  </simple-toolbar-menu-item>']);return _templateObject3_e6b3a3308e0011ed99ce491205e67b1d=function _templateObject3_e6b3a3308e0011ed99ce491205e67b1d(){return e},e}function _templateObject2_e6b3a3308e0011ed99ce491205e67b1d(){var e=_taggedTemplateLiteral(['\n      <div id="toolbar">\n        <hax-toolbar always-expanded>\n          <div class="group">\n            <hax-toolbar-menu\n              id="textformat"\n              icon="','"\n              label="Format"\n              show-text-label\n              data-simple-tour-stop\n              data-stop-title="Format"\n              ?disabled="','"\n            >\n              ','\n              <div slot="tour" data-stop-content>\n                Change how the text is structured and visualized in the page.\n              </div>\n            </hax-toolbar-menu>\n            \x3c!-- comment this in when rich-text-editor is viable --\x3e\n            \x3c!--\n            <hax-context-item\n              action\n              hidden\n              icon="icons:flip-to-back"\n              label="Full text editor"\n              event-name="hax-full-text-editor-toggle"\n            ></hax-context-item> --\x3e\n            <slot name="primary"></slot>\n            <hax-context-item-textop\n              mini\n              action\n              icon="editor:format-list-bulleted"\n              event-name="text-tag-ul"\n              label="','"\n              ?hidden="','"\n              ?disabled="','"\n            ></hax-context-item-textop>\n            <hax-context-item-textop\n              mini\n              action\n              icon="editor:format-list-numbered"\n              label="','"\n              event-name="text-tag-ol"\n              ?hidden="','"\n              ?disabled="','"\n            ></hax-context-item-textop>\n            <hax-context-item-textop\n              mini\n              action\n              icon="editor:format-indent-decrease"\n              label="','"\n              event-name="text-outdent"\n              ?hidden="','"\n              ?disabled="','"\n            ></hax-context-item-textop>\n            <hax-context-item-textop\n              mini\n              action\n              icon="editor:format-indent-increase"\n              label="','"\n              event-name="text-indent"\n              ?hidden="','"\n              ?disabled="','"\n            ></hax-context-item-textop>\n          </div>\n          <div class="group" ?hidden="','">\n            <hax-context-item-textop\n              mini\n              action\n              icon="editor:format-bold"\n              label="','"\n              class="selected-buttons"\n              event-name="text-bold"\n              ?hidden="','"\n              ?disabled="','"\n            ></hax-context-item-textop>\n            <hax-context-item-textop\n              mini\n              action\n              icon="editor:format-italic"\n              label="','"\n              class="selected-buttons"\n              event-name="text-italic"\n              ?hidden="','"\n              ?disabled="','"\n            ></hax-context-item-textop>\n          </div>\n          <div class="group" ?hidden="','">\n            <hax-context-item-textop\n              mini\n              action\n              icon="editor:insert-link"\n              label="','"\n              class="selected-buttons"\n              event-name="text-link"\n              ?hidden="','"\n              ?disabled="','"\n            ></hax-context-item-textop>\n            <hax-context-item-textop\n              mini\n              action\n              icon="mdextra:unlink"\n              label="','"\n              class="selected-buttons"\n              event-name="text-unlink"\n              ?hidden="','"\n              ?disabled="','"\n            ></hax-context-item-textop>\n          </div>\n          <div class="group" ?hidden="','">\n            <hax-context-item-textop\n              mini\n              action\n              icon="editor:format-clear"\n              label="','"\n              class="selected-buttons"\n              event-name="text-remove-format"\n              ?hidden="','"\n              ?disabled="','"\n            ></hax-context-item-textop>\n            <slot name="secondary"></slot>\n          </div>\n          <div class="group" ?hidden="','">\n            <hax-context-item-textop\n              action\n              menu\n              icon="editor:format-underlined"\n              label="','"\n              event-name="text-underline"\n              ?hidden="','"\n              ?disabled="','"\n            ></hax-context-item-textop>\n            <hax-context-item-textop\n              action\n              menu\n              icon="editor:format-strikethrough"\n              event-name="text-strikethrough"\n              ?hidden="','"\n              ?disabled="','"\n              label="','"\n            ></hax-context-item-textop>\n            <slot name="more"></slot>\n          </div>\n          <div class="group" ?hidden="','">\n            <hax-context-item-textop\n              action\n              menu\n              icon="mdextra:subscript"\n              event-name="text-subscript"\n              ?hidden="','"\n              ?disabled="','"\n              label="','"\n            ></hax-context-item-textop>\n            <hax-context-item-textop\n              action\n              menu\n              icon="mdextra:superscript"\n              event-name="text-superscript"\n              ?hidden="','"\n              ?disabled="','"\n              label="','"\n            ></hax-context-item-textop>\n          </div>\n          <div class="group" ?hidden="','">\n            <hax-context-item\n              mini\n              action\n              icon="hax:add-brick"\n              label="','"\n              class="selected-buttons"\n              event-name="insert-inline-gizmo"\n              ?hidden="','"\n              ?disabled="','"\n            ></hax-context-item>\n            <hax-context-item-textop\n              mini\n              action\n              icon="hax:add-brick"\n              label="','"\n              class="selected-buttons"\n              event-name="insert-inline-gizmo"\n              ?hidden="','"\n              ?disabled="','"\n            ></hax-context-item-textop>\n          </div>\n          <div class="group">\n            <hax-context-item\n              action\n              icon="icons:code"\n              label="','"\n              ?hidden="','"\n              event-name="hax-source-view-toggle"\n              toggles\n              ?toggled="','"\n            ></hax-context-item>\n          </div>\n          <div class="group">\n            <hax-toolbar-menu\n              icon="add"\n              label="','"\n            >\n              <simple-toolbar-menu-item slot="menuitem">\n                <hax-context-item\n                  action\n                  align-horizontal="left"\n                  role="menuitem"\n                  show-text-label\n                  icon="hardware:keyboard-arrow-up"\n                  event-name="insert-above-active"\n                  label="','"\n                  ?disabled="','"\n                ></hax-context-item>\n              </simple-toolbar-menu-item>\n              <simple-toolbar-menu-item slot="menuitem">\n                <hax-context-item\n                  action\n                  align-horizontal="left"\n                  role="menuitem"\n                  show-text-label\n                  icon="hardware:keyboard-arrow-down"\n                  event-name="insert-below-active"\n                  label="','"\n                  ?disabled="','"\n                ></hax-context-item>\n              </simple-toolbar-menu-item>\n            </hax-toolbar-menu>\n          </div>\n        </hax-toolbar>\n      </div>\n    ']);return _templateObject2_e6b3a3308e0011ed99ce491205e67b1d=function _templateObject2_e6b3a3308e0011ed99ce491205e67b1d(){return e},e}function _templateObject_e6b3a3308e0011ed99ce491205e67b1d(){var e=_taggedTemplateLiteral(["\n        .group,\n        .group > * {\n          flex: 1 1 auto;\n        }\n      "]);return _templateObject_e6b3a3308e0011ed99ce491205e67b1d=function _templateObject_e6b3a3308e0011ed99ce491205e67b1d(){return e},e}function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _toConsumableArray(e){return function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _get(e,t,n){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(e,t,n){var o=function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}},_get(e,t,n||e)}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}var a=function(a){function HaxTextContext(){var e;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,HaxTextContext),(e=function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}(this,_getPrototypeOf(HaxTextContext).call(this))).t={modifyHTMLSource:"Modify HTML source",bulledList:"Bulleted list",numberedList:"Numbered list",indent:"Indent",outdent:"Outdent",bold:"Bold",italic:"Italic",link:"Link",removeLink:"Remove link",removeFormat:"Remove format",addElementToSelection:"Add element to selection",subscript:"Subscript",superscript:"Superscript",underline:"Underline",crossOut:"Cross out",insertItemAbove:"Insert item above",insertItemAboveOrBelow:"Insert item above or below",insertItemBelow:"Insert item below"},e.registerLocalization({context:_assertThisInitialized(e),namespace:"hax"}),e.sourceView=!1,e.haxUIElement=!0,e.tourName="hax",setTimeout((function(){e.addEventListener("hax-context-item-selected",e._haxContextOperation.bind(_assertThisInitialized(e))),window.addEventListener("hax-context-item-selected",e._haxInMenuContextOperation.bind(_assertThisInitialized(e)))}),0),e.formattingList=[{value:"p",icon:"hax:paragraph",text:"Paragraph"},{value:"ul",icon:"editor:format-list-bulleted",text:"Bulleted list"},{value:"ol",icon:"editor:format-list-numbered",text:"Numbered list"},{value:"h2",icon:"hax:h2",text:"Title"},{value:"h3",icon:"hax:h3",text:"Content heading"},{value:"h4",icon:"hax:h4",text:"Subheading"},{value:"h5",icon:"hax:h5",text:"Deep subheading"},{value:"blockquote",icon:"editor:format-quote",text:"Blockquote"},{value:"code",icon:"icons:code",text:"Code"}],e.realSelectedValue="p",e.isSafari=e._isSafari(),(0,n.autorun)((function(){e.hasSelectedText=(0,n.toJS)(t.HAXStore.haxSelectedText).length>0})),(0,n.autorun)((function(){(0,n.toJS)(t.HAXStore.editMode);var o=(0,n.toJS)(t.HAXStore.activeNode);if(e.viewSource=!1,o&&o.tagName){var i=t.HAXStore.haxSchemaFromTag(o.tagName);e.sourceView=i.canEditSource}e.shadowRoot&&e.shadowRoot.querySelector("#textformat")&&(e.shadowRoot.querySelector("#textformat").collapsed=!0),o&&t.HAXStore.isTextElement(o)&&e.shadowRoot.querySelector('button[event-name="'+o.tagName.toLowerCase()+'"]')?e.updateTextIconSelection(o.tagName.toLowerCase()):o&&"LI"===o.tagName&&o.parentNode&&o.parentNode.tagName&&e.shadowRoot.querySelector('button[event-name="'+o.parentNode.tagName.toLowerCase()+'"]')&&e.updateTextIconSelection(o.parentNode.tagName.toLowerCase())})),e}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}(HaxTextContext,(0,i.I18NMixin)((0,o.HaxContextBehaviors)(e.LitElement))),_createClass(HaxTextContext,null,[{key:"styles",get:function get(){return[].concat(_toConsumableArray(_get(_getPrototypeOf(HaxTextContext),"styles",this)),[(0,e.css)(_templateObject_e6b3a3308e0011ed99ce491205e67b1d())])}}]),_createClass(HaxTextContext,[{key:"render",value:function render(){var t=this;return(0,e.html)(_templateObject2_e6b3a3308e0011ed99ce491205e67b1d(),this._formatIcon(this.realSelectedValue),this.viewSource,this.formattingList.map((function(n){return(0,e.html)(_templateObject3_e6b3a3308e0011ed99ce491205e67b1d(),n.icon,n.text,!t.sourceView,n.value,t.viewSource,(function(e){return t.textFormatChanged(n.value)}))})),this.t.bulledList,!this._showLists,this.viewSource,this.t.numberedList,!this._showLists,this.viewSource,this.t.outdent,!this._showIndent,this.viewSource,this.t.indent,!this._showIndent,this.viewSource,!this.hasSelectedText,this.t.bold,!this.hasSelectedText,this.viewSource,this.t.italic,!this.hasSelectedText,this.viewSource,!this.hasSelectedText,this.t.link,!this.hasSelectedText,this.viewSource,this.t.removeLink,!this.hasSelectedText,this.viewSource,!this.hasSelectedText,this.t.removeFormat,!this.hasSelectedText,this.viewSource,!this.hasSelectedText,this.t.underline,!this.hasSelectedText,this.viewSource,!this.hasSelectedText,this.viewSource,this.t.crossOut,!this.hasSelectedText,!this.hasSelectedText,this.viewSource,this.t.subscript,!this.hasSelectedText,this.viewSource,this.t.superscript,!this.hasSelectedText,this.t.addElementToSelection,this.isSafari||!this.hasSelectedText,this.viewSource,this.t.addElementToSelection,!this.isSafari||!this.hasSelectedText,this.viewSource,this.t.modifyHTMLSource,!this.sourceView,this.viewSource,this.t.insertItemAboveOrBelow,this.t.insertItemAbove,this.viewSource,this.t.insertItemBelow,this.viewSource)}},{key:"textFormatChanged",value:function textFormatChanged(e){this.shadowRoot.querySelector("#textformat").collapsed=!0,this.updateTextIconSelection(e),this.dispatchEvent(new CustomEvent("hax-context-item-selected",{bubbles:!0,cancelable:!0,composed:!0,detail:{eventName:"text-tag",value:this.realSelectedValue}}))}},{key:"updateTextIconSelection",value:function updateTextIconSelection(e){this.realSelectedValue=e;var t=this.shadowRoot.querySelector('button[event-name="'+this.realSelectedValue+'"]');t&&(this.formatIcon=t.icon)}},{key:"_formatIcon",value:function _formatIcon(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.realSelectedValue||"p",t=this.textFormatLookup[e];return t||"hax:paragraph"}},{key:"updated",value:function updated(e){var t=this;e.forEach((function(e,n){"realSelectedValue"==n&&(t._showIndent=t._computeShowIndent(t.realSelectedValue),"p"==t.realSelectedValue?t._showLists=!0:t._showLists=!1),"hasSelectedText"==n&&t.dispatchEvent(new CustomEvent("hax-context-menu-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:t}))}))}},{key:"firstUpdated",value:function firstUpdated(e){_get(_getPrototypeOf(HaxTextContext.prototype),"firstUpdated",this)&&_get(_getPrototypeOf(HaxTextContext.prototype),"firstUpdated",this).call(this,e),(0,n.toJS)(t.HAXStore.activeNode)&&(0,n.toJS)(t.HAXStore.activeNode).tagName&&this.updateTextIconSelection((0,n.toJS)(t.HAXStore.activeNode).tagName.toLowerCase())}},{key:"_computeShowIndent",value:function _computeShowIndent(e){return!(!t.HAXStore.computePolyfillSafe()||"li"!=e&&"ol"!=e&&"ul"!=e)}},{key:"_haxInMenuContextOperation",value:function _haxInMenuContextOperation(e){var t=!1;switch(e.detail.eventName){case"insert-above-active":case"insert-below-active":this.shadowRoot.querySelector("simple-popover-selection")&&(this.shadowRoot.querySelector("simple-popover-selection").opened=!1);break;case"text-underline":document.execCommand("underline"),t=!0;break;case"text-subscript":document.execCommand("subscript"),t=!0;break;case"text-superscript":document.execCommand("superscript"),t=!0;break;case"text-strikethrough":document.execCommand("strikeThrough"),t=!0}t&&(this.shadowRoot.querySelector("simple-popover-selection")&&this.shadowRoot.querySelector("simple-popover-selection").opened&&(this.shadowRoot.querySelector("simple-popover-selection").opened=!1),e.preventDefault(),e.stopPropagation())}},{key:"_haxContextOperation",value:function _haxContextOperation(e){var n=e.detail,o=t.HAXStore.getSelection(),i=!1;switch(n.eventName){case"insert-inline-gizmo":if(t.HAXStore._tmpSelection&&t.HAXStore.editMode)try{"HAX-BODY"!==t.HAXStore._tmpRange.startContainer.parentNode.parentNode.tagName&&"HAX-BODY"!==t.HAXStore._tmpRange.startContainer.parentNode.parentNode.parentNode.tagName||(t.HAXStore.activePlaceHolder=t.HAXStore._tmpRange)}catch(e){}if(null!=t.HAXStore.activePlaceHolder){var a={text:t.HAXStore.activePlaceHolder.toString()},r="inline",c=t.HAXStore.guessGizmo(r,a);c.length>0&&t.HAXStore.haxAppPicker.presentOptions(c,r,"Transform selected text to..","gizmo")}break;case"text-bold":document.execCommand("bold"),i=!0;break;case"text-italic":document.execCommand("italic"),i=!0;break;case"text-remove-format":document.execCommand("removeFormat"),i=!0;break;case"text-link":var s="";o&&o.focusNode&&o.focusNode.parentNode&&"undefined"!==_typeof(o.focusNode.parentNode.href)&&(s=o.focusNode.parentNode.href);var l=prompt("Enter a URL:",s);l&&(document.execCommand("createLink",!1,l),o.focusNode.parentNode&&(o.focusNode.parentNode.setAttribute("contenteditable",!0),o.focusNode.parentNode.removeEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()})),o.focusNode.parentNode.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}))),i=!0);break;case"text-unlink":document.execCommand("unlink"),i=!0;break;case"text-indent":t.HAXStore.activeHaxBody.__indentTrap=!0,document.execCommand("indent"),i=!0;break;case"text-outdent":t.HAXStore.activeHaxBody.__indentTrap=!0,document.execCommand("outdent"),i=!0}i&&(e.preventDefault(),e.stopPropagation())}},{key:"_isSafari",value:function _isSafari(){var e=navigator.userAgent.toLowerCase();return!(-1==e.indexOf("safari")||e.indexOf("chrome")>-1)}},{key:"textFormatLookup",get:function get(){var e={};return this.formattingList.forEach((function(t){e[t.value]=t.icon})),e}}],[{key:"tag",get:function get(){return"hax-text-context"}},{key:"properties",get:function get(){return function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(n,!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},_get(_getPrototypeOf(HaxTextContext),"properties",this),{_showIndent:{type:Boolean},_showLists:{type:Boolean},realSelectedValue:{type:String},sourceView:{type:Boolean},formattingList:{type:Array},hasSelectedText:{type:Boolean,attribute:"has-selected-text",reflect:!0},formatIcon:{type:String,attribute:"format-icon"},isSafari:{type:Boolean,attribute:"is-safari"}})}}]),HaxTextContext}();exports.HaxTextContext=a,window.customElements.define(a.tag,a);