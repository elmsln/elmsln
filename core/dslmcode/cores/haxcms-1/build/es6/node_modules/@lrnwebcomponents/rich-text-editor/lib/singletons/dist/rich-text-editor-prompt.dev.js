Object.defineProperty(exports,"__esModule",{value:!0}),exports.RichTextEditorPrompt=void 0;var e=require("lit"),t=require("../buttons/rich-text-editor-button.js");function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _templateObject2_c6338880809211edaa2833647dc78c6c(){var e=_taggedTemplateLiteral(["\n        #prompt {\n          display: block;\n          width: 300px;\n          max-width: 300px;\n          --simple-popover-padding: 0px;\n          z-index: 2;\n        }\n        #prompt[hidden] {\n          display: none;\n        }\n        #prompt #form {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: space-between;\n          z-index: 2;\n        }\n        #formfields {\n          width: calc(100% - 20px);\n          padding: 10px 10px 0;\n          overflow: visible;\n        }\n        #prompt simple-fields-field {\n          padding: 0;\n        }\n        #confirm,\n        #cancel {\n          min-width: unset;\n        }\n        #cancel {\n          color: var(--rich-text-editor-button-color);\n          background-color: var(--rich-text-editor-button-bg);\n        }\n        #cancel:focus,\n        #cancel:hover {\n          color: var(--rich-text-editor-button-hover-color);\n          background-color: var(--rich-text-editor-button-hover-bg);\n        }\n        #confirm {\n          color: var(--rich-text-editor-button-color);\n          background-color: var(--rich-text-editor-button-bg);\n        }\n        #confirm:focus,\n        #confirm:hover {\n          color: var(--rich-text-editor-button-hover-color);\n          background-color: var(--rich-text-editor-button-hover-bg);\n        }\n        .actions {\n          width: calc(100% - 20px);\n          padding: 0 10px 3px;\n          display: flex;\n          align-items: center;\n          justify-content: flex-end;\n        }\n        .confirm-or-cancel {\n          min-width: 40px;\n        }\n      "]);return _templateObject2_c6338880809211edaa2833647dc78c6c=function _templateObject2_c6338880809211edaa2833647dc78c6c(){return e},e}function _toConsumableArray(e){return function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _templateObject_c6338880809211edaa2833647dc78c6c(){var e=_taggedTemplateLiteral(['\n      <simple-popover\n        id="prompt"\n        ?auto="','"\n        for="','"\n        ?hidden="','"\n        position="bottom"\n        position-align="center"\n        .target="','"\n      >\n        <form\n          id="form"\n          @blur="','"\n          @focus="','"\n        >\n          <simple-fields\n            id="formfields"\n            hide-line-numbers\n            .fields="','"\n            @fields-ready="','"\n            .value="','"\n          ></simple-fields>\n          <div class="actions">\n            <rich-text-editor-button\n              id="cancel"\n              controls="','"\n              label="Cancel"\n              icon="clear"\n              @click="','"\n              tabindex="0"\n            >\n            </rich-text-editor-button>\n            <rich-text-editor-button\n              id="confirm"\n              controls="','"\n              @click="','"\n              icon="check"\n              label="OK"\n              tabindex="0"\n            >\n            </rich-text-editor-button>\n          </div>\n        </form>\n      </simple-popover>\n    ']);return _templateObject_c6338880809211edaa2833647dc78c6c=function _templateObject_c6338880809211edaa2833647dc78c6c(){return e},e}function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,n){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(e,t,n){var o=function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}},_get(e,t,n||e)}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}require("@lrnwebcomponents/simple-popover/simple-popover.js"),require("@lrnwebcomponents/simple-fields/simple-fields.js"),require("./rich-text-editor-selection.js");var n=function(n){function RichTextEditorPrompt(){var e;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,RichTextEditorPrompt),e=_possibleConstructorReturn(this,_getPrototypeOf(RichTextEditorPrompt).call(this)),window.addEventListener("rich-text-editor-prompt-open",e.open.bind(_assertThisInitialized(e))),window.RichTextEditorPrompt.instance?e:(window.RichTextEditorPrompt.instance=_assertThisInitialized(e),_possibleConstructorReturn(e,_assertThisInitialized(e)))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}(RichTextEditorPrompt,e.LitElement),_createClass(RichTextEditorPrompt,[{key:"render",value:function render(){return(0,e.html)(_templateObject_c6338880809211edaa2833647dc78c6c(),!this.hidden,this.selection?this.selection.id:"",this.hidden,this.selection,this._handleBlur,this._handleFocus,this.fields,this._handleReady,this.value,this.selection?this.selection.id:"",this._cancel,this.selection?this.selection.id:"",this._confirm)}}],[{key:"styles",get:function get(){return[].concat(_toConsumableArray(t.RichTextToolbarStyles),[(0,e.css)(_templateObject2_c6338880809211edaa2833647dc78c6c())])}},{key:"tag",get:function get(){return"rich-text-editor-prompt"}},{key:"properties",get:function get(){return{fields:{type:Array},range:{type:Object},value:{type:Object},__focused:{type:Boolean},__hovered:{type:Boolean},__opened:{type:Boolean}}}}]),_createClass(RichTextEditorPrompt,[{key:"firstUpdated",value:function firstUpdated(e){var t=this;this.selection.addEventListener("change",(function(e){return setTimeout(t._handleChange(e),300)})),this.addEventListener("focus",this._handleFocus),this.addEventListener("focus",this._handleFocus),this.addEventListener("blur",this._handleBlur)}},{key:"updated",value:function updated(e){var t=this;_get(_getPrototypeOf(RichTextEditorPrompt.prototype),"updated",this).call(this,e),e.forEach((function(e,n){["__focused","__hovered","__opened"].includes(n)&&setTimeout(t._handleChange.bind(t),300)}))}},{key:"_handleReady",value:function _handleReady(e){e.detail.focus()}},{key:"_handleFocus",value:function _handleFocus(e){this.__focused=!0}},{key:"_handleBlur",value:function _handleBlur(e){this.__focused=!1}},{key:"_handleChange",value:function _handleChange(e){!this.__opened||this.__focused||this.__hovered||this._cancel()}},{key:"open",value:function open(e){e&&(this.__opened=!0,this.shadowRoot.querySelector("#cancel").focus(),this.button=e.detail,this.fields=_toConsumableArray(e.detail.fields),this.__selection=e.detail.__selection,this.selectedNode=e.detail.selectedNode,this.value=function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(n,!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.detail.value))}},{key:"close",value:function close(){this.__opened=!1,this.__focused=!1,this.button=void 0,this.fields=[],this.value={}}},{key:"_cancel",value:function _cancel(e){e&&e.preventDefault(),this.button&&this.button.cancel(),this.close()}},{key:"_confirm",value:function _confirm(e){e.preventDefault(),this.button.confirm(this.value),this.close()}},{key:"hidden",get:function get(){return!this.__opened}},{key:"selection",get:function get(){return window.RichTextEditorSelection.requestAvailability()}}]),RichTextEditorPrompt}();exports.RichTextEditorPrompt=n,window.customElements.define(n.tag,n),window.RichTextEditorPrompt=window.RichTextEditorPrompt||{},window.RichTextEditorPrompt.requestAvailability=function(){return window.RichTextEditorPrompt.instance||(window.RichTextEditorPrompt.instance=document.createElement("rich-text-editor-prompt"),document.body.appendChild(window.RichTextEditorPrompt.instance)),window.RichTextEditorPrompt.instance};