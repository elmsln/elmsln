Object.defineProperty(exports,"__esModule",{value:!0}),exports.HaxTextEditorToolbar=void 0;var t=require("lit"),e=require("@lrnwebcomponents/rich-text-editor/lib/toolbars/rich-text-editor-toolbar.js"),o=(require("./hax-text-editor-button.js"),require("./hax-store.js")),r=require("./hax-context-behaviors.js"),n=require("@lrnwebcomponents/i18n-manager/lib/I18NMixin.js");function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function ownKeys(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,r)}return o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(o,!0).forEach((function(e){_defineProperty(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(o).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function _defineProperty(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function _templateObject2_afab67e0809211edaa2833647dc78c6c(){var t=_taggedTemplateLiteral(["\n        :host {\n          --rich-text-editor-button-color: var(--hax-ui-color);\n          --rich-text-editor-button-bg: var(--hax-ui-background-color);\n          --rich-text-editor-button-border-color: transparent;\n          --rich-text-editor-button-hover-color: var(--hax-ui-color);\n          --rich-text-editor-button-hover-bg: var(\n            --hax-ui-background-color-secondary\n          );\n          --rich-text-editor-button-toggled-color: var(--hax-ui-color-accent);\n          --rich-text-editor-button-toggled-bg: var(--hax-ui-background-color);\n          --rich-text-editor-button-toggled-border-color: var(\n            --hax-ui-color-accent\n          );\n          --rich-text-editor-button-disabled-opacity: 1;\n          --rich-text-editor-button-disabled-color: var(\n            --hax-ui-disabled-color\n          );\n          --rich-text-editor-button-disabled-bg: var(--hax-ui-background-color);\n          --rich-text-editor-button-disabled-border-color: transparent;\n        }\n        #morebutton {\n          align-self: flex-end;\n        }\n        ::slotted([icon-position]:hover) {\n          --rich-text-editor-button-toggled-bg: var(\n            --hax-ui-background-color-accent\n          );\n        }\n        ::slotted(.group) {\n          flex: 0 0 auto;\n          justify-content: center;\n          border-width: 1px;\n          margin: -1px;\n          padding: 0px;\n        }\n        ::slotted(.group),\n        ::slotted([icon-position]) {\n          z-index: 1;\n        }\n        ::slotted([icon-position]),\n        :host([collapsed]) ::slotted(.group) {\n          flex: 0 0 auto;\n        }\n        :host ::slotted(*:focus),\n        :host ::slotted(*:focus-within) {\n          z-index: 2 !important;\n        }\n        :host ::slotted(*:hover) {\n          z-index: 3 !important;\n        }\n      "]);return _templateObject2_afab67e0809211edaa2833647dc78c6c=function _templateObject2_afab67e0809211edaa2833647dc78c6c(){return t},t}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,o=new Array(t.length);e<t.length;e++)o[e]=t[e];return o}}(t)||function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _templateObject_afab67e0809211edaa2833647dc78c6c(){var t=_taggedTemplateLiteral([' <div slot="tour" data-stop-content>\n      ',"\n    </div>"]);return _templateObject_afab67e0809211edaa2833647dc78c6c=function _templateObject_afab67e0809211edaa2833647dc78c6c(){return t},t}function _taggedTemplateLiteral(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _get(t,e,o){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(t,e,o){var r=function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}(t,e);if(r){var n=Object.getOwnPropertyDescriptor(r,e);return n.get?n.get.call(o):n.value}},_get(t,e,o||t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var i=function(i){function HaxTextEditorToolbar(){var t;return function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,HaxTextEditorToolbar),(t=function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}(this,_getPrototypeOf(HaxTextEditorToolbar).call(this))).tag=HaxTextEditorToolbar.tag,t.t={undoButton:"Undo",redoButton:"Redo",formatButton:"Format",blockP:"Paragraph",blockH1:"Heading 1",blockH2:"Heading 2",blockH3:"Heading 3",blockH4:"Heading 4",blockH5:"Heading 5",blockH6:"Heading 6",blockPre:"Preformatted",italicButton:"Italic",boldButton:"Bold",underlineButton:"Underline",strikethroughButton:"Cross out",removeFormatButton:"Remove format",linkButton:"Link",cutButton:"Cut",copyButton:"Copy",pasteButton:"Paste",subscriptButton:"Subscript",superscriptButton:"Superscript",symbolButton:"Insert Symbol",emojiButton:"Insert Emoticon",imageButton:"Insert Image",orderedListButton:"Bulleted list",unorderedListButton:"Numbered list",blockquoteButton:"Blockquote",indentButton:"Indent",outdentButton:"Outdent",textEditorToolbarTour:"Change how the text is structured and visualized in the page."},t.registerLocalization({context:_assertThisInitialized(t),namespace:"hax"}),t.sourceView=!1,t.haxUIElement=!0,t.tourName="hax",window.HaxTextEditorToolbarConfig=window.HaxTextEditorToolbarConfig||{},window.HaxTextEditorToolbarConfig.inlineGizmos=window.HaxTextEditorToolbarConfig.inlineGizmos||{},window.HaxTextEditorToolbarConfig.default=window.HaxTextEditorToolbarConfig.default||_toConsumableArray(t.defaultConfig),t.config=window.HaxTextEditorToolbarConfig.default,t.sticky=!1,t.__updated=!1,t.setTarget(void 0),window.addEventListener("hax-store-ready",t._handleHaxStoreReady.bind(_assertThisInitialized(t))),window.addEventListener("hax-register-properties",t._handleElementRegister.bind(_assertThisInitialized(t))),t}return function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}(HaxTextEditorToolbar,(0,e.RichTextEditorToolbarBehaviors)((0,n.I18NMixin)((0,r.HaxContextBehaviors)(t.LitElement)))),_createClass(HaxTextEditorToolbar,[{key:"render",value:function render(){return _get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"toolbarTemplate",this)}},{key:"tag",value:function tag(){return"hax-text-editor-toolbar"}},{key:"tourTemplate",get:function get(){return(0,t.html)(_templateObject_afab67e0809211edaa2833647dc78c6c(),this.t.textEditorToolbarTour)}}],[{key:"styles",get:function get(){return[].concat(_toConsumableArray(_get(_getPrototypeOf(HaxTextEditorToolbar),"baseStyles",this)),_toConsumableArray(_get(_getPrototypeOf(HaxTextEditorToolbar),"stickyStyles",this)),[(0,t.css)(_templateObject2_afab67e0809211edaa2833647dc78c6c())])}},{key:"properties",get:function get(){return{__updated:{type:Boolean}}}}]),_createClass(HaxTextEditorToolbar,[{key:"updated",value:function updated(t){var e=this;_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"updated",this)&&_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"updated",this).call(this,t),t.forEach((function(t,o){"parentSchema"!==o&&"range"!==o||e.updateBlocks(),"activeNode"===o&&e.activeNode!==t&&e.setTarget(e.activeNode),"t"===o&&e.t!==t&&e.updateToolbarElements()}))}},{key:"firstUpdated",value:function firstUpdated(t){_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"firstUpdated",this)&&_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"firstUpdated",this).call(this,t),this.config=this.updateToolbarElements()}},{key:"updateBlocks",value:function updateBlocks(){var t=this.formatButtonElement&&this.formatButtonElement.rangeOrMatchingAncestor()?this.formatButtonElement.rangeOrMatchingAncestor().tagName:void 0;this.formatButtonElement&&this.formatButtonElement.blocks!==this.filteredBlocks&&(this.formatButtonElement.blocks=this.filteredBlocks,this.formatButtonElement.value=(t||"").toLowerCase(),this.filteredBlocks.length<2?this.formatButtonElement.setAttribute("disabled","disabled"):this.formatButtonElement.removeAttribute("disabled"))}},{key:"getRange",value:function getRange(){var t=o.HAXStore.getRange();return!t||t.rangeCount<1?void 0:o.HAXStore.getRange()}},{key:"getSelection",value:function getSelection(){return o.HAXStore.getSelection()}},{key:"positionByTarget",value:function positionByTarget(t){}},{key:"_handleElementRegister",value:function _handleElementRegister(t){var e=t.detail||{},o=e.tag||{},r=e.properties||{};this._setInlineElement(o,r)}},{key:"_handleHaxStoreReady",value:function _handleHaxStoreReady(t){var e=this,r=o.HAXStore.elementList||{};Object.keys(r).forEach((function(t){return e._setInlineElement(t,elemets[t])}))}},{key:"_setInlineElement",value:function _setInlineElement(t,e){if(t&&e&&!window.HaxTextEditorToolbarConfig.inlineGizmos[t]&&!(t.indexOf("-")<0)){var o=e,r=e.gizmo||{},n=r.handles||[],i=r.title||r.tag.replace(/-./g,(function(t){return t.toUpperCase()[1]})),a=n.filter((function(t){return"inline"===t.type}));o.gizmo=o.gizmo||{},o.gizmo.title="Add ".concat(i),a.length>0&&(window.HaxTextEditorToolbarConfig.inlineGizmos[t]={element:o,type:"hax-text-editor-button"},this.__updated=!1,setTimeout(this.updateToolbarElements.bind(this),500))}}},{key:"updateToolbarElements",value:function updateToolbarElements(){if(!this.__updated){this.__updated=!0;var t=Object.keys(window.HaxTextEditorToolbarConfig.inlineGizmos||{}).map((function(t){return window.HaxTextEditorToolbarConfig.inlineGizmos[t]}));this.config=0===t.length?_toConsumableArray(this.defaultConfig):[].concat(_toConsumableArray(this.defaultConfig),[{type:"button-group",buttons:t}]),this.updateToolbar()}}},{key:"undoButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"undoButton",this),{label:this.t.undoButton})}},{key:"redoButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"redoButton",this),{label:this.t.redoButton})}},{key:"formatButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"formatButton",this),{label:this.t.formatButton,blocks:this.formatBlocks})}},{key:"formatBlocks",get:function get(){return[{label:this.t.blockP,tag:"p"},{label:this.t.blockH1,tag:"h1"},{label:this.t.blockH2,tag:"h2"},{label:this.t.blockH3,tag:"h3"},{label:this.t.blockH4,tag:"h4"},{label:this.t.blockH5,tag:"h5"},{label:this.t.blockH6,tag:"h6"},{label:this.t.blockPre,tag:"pre"}]}},{key:"boldButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"boldButton",this),{label:this.t.boldButton})}},{key:"italicButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"italicButton",this),{label:this.t.italicButton})}},{key:"underlineButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"underlineButton",this),{label:this.t.underlineButton})}},{key:"strikethroughButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"strikethroughButton",this),{label:this.t.strikethroughButton})}},{key:"removeFormatButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"removeFormatButton",this),{label:this.t.removeFormatButton})}},{key:"advancedInlineButtonGroup",get:function get(){return{type:"button-group",subtype:"advanced-inline-button-group",buttons:[this.underlineButton,this.strikethroughButton]}}},{key:"linkButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"linkButton",this),{label:this.t.linkButton})}},{key:"cutButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"cutButton",this),{label:this.t.cutButton})}},{key:"copyButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"copyButton",this),{label:this.t.copyButton})}},{key:"pasteButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"pasteButton",this),{label:this.t.pasteButton})}},{key:"subscriptButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"subscriptButton",this),{label:this.t.subscriptButton})}},{key:"superscriptButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"superscriptButton",this),{label:this.t.superscriptButton})}},{key:"symbolButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"symbolButton",this),{label:this.t.symbolButton})}},{key:"emojiButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"emojiButton",this),{label:this.t.emojiButton})}},{key:"imageButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"imageButton",this),{label:this.t.imageButton})}},{key:"orderedListButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"orderedListButton",this),{label:this.t.orderedListButton})}},{key:"unorderedListButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"unorderedListButton",this),{label:this.t.unorderedListButton})}},{key:"blockquoteButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"blockquoteButton",this),{label:this.t.blockquoteButton})}},{key:"indentButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"indentButton",this),{label:this.t.indentButton})}},{key:"outdentButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"outdentButton",this),{label:this.t.outdentButton})}},{key:"sourceButton",get:function get(){return _objectSpread({},_get(_getPrototypeOf(HaxTextEditorToolbar.prototype),"sourceButton",this))}},{key:"haxInsertButtonGroup",get:function get(){return{type:"button-group",subtype:"hax-insert-button-group",blocks:[this.symbolButton,this.emojiButton]}}},{key:"iconButton",get:function get(){return{}}},{key:"defaultConfig",get:function get(){return[this.basicInlineButtonGroup,this.linkButtonGroup,this.listIndentButtonGroup,this.haxInsertButtonGroup,this.scriptButtonGroup,this.advancedInlineButtonGroup]}},{key:"filteredBlocks",get:function get(){return this.getFilteredBlocks(this.formatBlocks)}},{key:"formatButtonElement",get:function get(){return this.formatButton.type?this.querySelector(this.formatButton.type):void 0}}]),HaxTextEditorToolbar}();exports.HaxTextEditorToolbar=i,customElements.define("hax-text-editor-toolbar",i);