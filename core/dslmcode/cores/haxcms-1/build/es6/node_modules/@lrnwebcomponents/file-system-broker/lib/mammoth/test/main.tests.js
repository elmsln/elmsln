var t=require("assert"),e=require("child_process"),r=require("path"),n=require("fs"),u=require("temp").track(),i=require("../lib/promises"),a=require("./test")(module),o=require("./testing").testPath;a("HTML is printed to stdout if output file is not set",(function(){return runMammoth(o("single-paragraph.docx")).then((function(e){t.equal(e.stderrOutput,""),t.equal(e.output,"<p>Walking on imported air</p>")}))})),a("HTML is written to file if output file is set",(function(){return createTempDir().then((function(e){var u=r.join(e,"output.html");return runMammoth(o("single-paragraph.docx"),u).then((function(e){t.equal(e.stderrOutput,""),t.equal(e.output,""),t.equal(n.readFileSync(u,"utf8"),"<p>Walking on imported air</p>")}))}))}));var p="iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAIAAAACUFjqAAAAAXNSR0IArs4c6QAAAAlwSFlzAAAOvgAADr4B6kKxwAAAABNJREFUKFNj/M+ADzDhlWUYqdIAQSwBE8U+X40AAAAASUVORK5CYII=";function runMammoth(){var r=Array.prototype.slice.call(arguments,0),n=i.defer(),u=["node","bin/mammoth"].concat(r).join(" ");return e.exec(u,(function(e,r,u){console.log(u),t.equal(e,null),n.resolve({output:r,stderrOutput:u})})),n.promise}function createTempDir(){return i.nfcall(u.mkdir,null)}a("inline images are included in output if writing to single file",(function(){return runMammoth(o("tiny-picture.docx")).then((function(e){t.equal(e.stderrOutput,""),t.equal(e.output,'<p><img src="data:image/png;base64,'+p+'" /></p>')}))})),a("images are written to separate files if output dir is set",(function(){return createTempDir().then((function(e){var u=r.join(e,"tiny-picture.html"),i=r.join(e,"1.png");return runMammoth(o("tiny-picture.docx"),"--output-dir",e).then((function(e){t.equal(e.stderrOutput,""),t.equal(e.output,""),t.equal(n.readFileSync(u,"utf8"),'<p><img src="1.png" /></p>'),t.equal(n.readFileSync(i,"base64"),p)}))}))})),a("style map is used if set",(function(){return createTempDir().then((function(e){var u=r.join(e,"style-map");return n.writeFileSync(u,"p => span:fresh"),runMammoth(o("single-paragraph.docx"),"--style-map",u).then((function(e){t.equal(e.stderrOutput,""),t.equal(e.output,"<span>Walking on imported air</span>")}))}))})),a("--output-format=markdown option generate markdown output",(function(){return runMammoth(o("single-paragraph.docx"),"--output-format=markdown").then((function(e){t.equal(e.stderrOutput,""),t.equal(e.output,"Walking on imported air\n\n")}))}));