const t=window.document,e=1,a=2,n=3,i=4,s=5;let r,h,o=[],l=e,c="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js";function flush_typesets(){if(!o.length)return;const e=[],a=[];o.forEach((function(n){const i=t.createElement("script"),s=t.createElement("div");i.type=n[1]?"math/tex; mode=display":"math/tex",i.text=n[0],s.style.position="fixed",s.style.top=0,s.style.left="99999px",s.appendChild(i),t.body.appendChild(s),e.push(i),a.push([s,n[2]])})),o=[],l=i,r.Queue(["Typeset",r,e]),r.Queue((function(){h||function getStyleNode(){const e=t.querySelectorAll("style"),a=Array.prototype.filter.call(e,(function(t){return t.sheet&&t.sheet.cssRules.length>100&&".mjx-chtml"===t.sheet.cssRules[0].selectorText}));h=a[0]}(),a.forEach((function(e){const a=e[0],n="SPAN"===a.firstElementChild.tagName?a.firstElementChild:null;e[1](n,h),t.body.removeChild(a)})),l=n,flush_typesets()}))}function load_library(){l=a,window.MathJax={skipStartupTypeset:!0,showMathMenu:!1,jax:["input/TeX","output/CommonHTML"],TeX:{extensions:["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]},AuthorInit(){r=window.MathJax.Hub,r.Register.StartupHook("End",(function(){l=n,flush_typesets()}))}};var e=t.createElement("script");e.type="text/javascript",e.src=c,e.async=!0,e.onerror=function(){console.warn("Error loading MathJax library "+c),l=s,o=[]},t.head.appendChild(e)}class LrnMathController extends HTMLElement{connectedCallback(){this.hasAttribute("src")&&(c=this.getAttribute("src")),this.hasAttribute("lazy")||load_library()}typeset(t,a,i){l!==s&&(o.push([t,a,i]),l===e?load_library():l===n&&flush_typesets())}}const d="lrn-math-controller",u={childList:!0,characterData:!0,attributes:!0,subtree:!0};let m;class LrnMath extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._private={check:"",observer:new MutationObserver((()=>{this.updateMath()}))},this._private.observer.observe(this,u)}static get tag(){return"lrn-math"}haxHooks(){return{editModeChanged:"haxeditModeChanged",activeElementChanged:"haxactiveElementChanged"}}haxactiveElementChanged(t,e){e&&(this._haxstate=e)}haxeditModeChanged(t){this._haxstate=t}connectedCallback(){!function check_handler(e){m||(m=t.querySelector(d)||t.createElement(d),t.contains(m)||t.head.appendChild(m),setTimeout((()=>{e.refresh()}),0))}(this),setTimeout((()=>{this._haxstate&&this.innerHTML&&null==this.mathtext?this.mathtext=this.innerHTML:this.updateMath()}),0)}updateMath(){const t=this.shadowRoot,e=this.textContent.trim(),a="display"===this.getAttribute("mode"),n=(a?"D":"I")+e;this._private&&n!==this._private.check&&(this.shadowRoot.innerHTML="",this._private.check=n,e.length&&m&&m.typeset(e,a,(function(e,a){t.appendChild(a.cloneNode(!0)),t.appendChild(e)})))}get mathtext(){return this.getAttribute("mathtext")}set mathtext(t){this.setAttribute("mathtext",t)}static get observedAttributes(){return["mathtext"]}attributeChangedCallback(e,a,n){if("mathtext"===e)""!==n&&null!==n?(clearTimeout(this._typingTimeout),this._typingTimeout=setTimeout((()=>{const e=t.createElement("span");e.innerText=n,this.innerHTML="",this.appendChild(e)}),300)):this.updateMath()}static get haxProperties(){return{canScale:!1,canPosition:!1,canEditSource:!0,gizmo:{title:"Math",description:"Present math in a nice looking way.",icon:"hax:pi",color:"grey",tags:["Instructional","math","mathjax","mathml","latex","mathml"],handles:[{type:"math",math:"mathText"},{type:"inline",text:"mathText"}],meta:{author:"HAXTheWeb core team",inlineOnly:!0}},settings:{inline:[],configure:[{property:"mathtext",title:"Math",description:"Enter equation as MathML",inputMethod:"textarea"}],advanced:[]}}}refresh(){let e=t.createElement("lrn-math");this.parentNode.insertBefore(e,this),e.innerHTML=this.innerHTML,this.remove()}}customElements.define("lrn-math",LrnMath);export{LrnMath};customElements.define("lrn-math-controller",LrnMathController);export{LrnMathController};