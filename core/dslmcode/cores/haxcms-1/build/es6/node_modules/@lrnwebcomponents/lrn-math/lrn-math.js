const t=window.document,e={start:1,loading:2,ready:3,typesetting:4,error:5};let a,n,r=[],s=e.start,i="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js";function flush_typesets(){if(!r.length)return;const i=[],h=[];r.forEach((function(e){const a=t.createElement("script"),n=t.createElement("div");a.type=e[1]?"math/tex; mode=display":"math/tex",a.text=e[0],n.style.position="fixed",n.style.top=0,n.style.left="99999px",n.appendChild(a),t.body.appendChild(n),i.push(a),h.push([n,e[2]])})),r=[],s=e.typesetting,a.Queue(["Typeset",a,i]),a.Queue((function(){n||function getStyleNode(){const e=t.querySelectorAll("style"),a=Array.prototype.filter.call(e,(function(t){return t.sheet&&t.sheet.cssRules.length>100&&".mjx-chtml"===t.sheet.cssRules[0].selectorText}));n=a[0]}(),h.forEach((function(e){const a=e[0],r="SPAN"===a.firstElementChild.tagName?a.firstElementChild:null;e[1](r,n),t.body.removeChild(a)})),s=e.ready,flush_typesets()}))}function load_library(){s=e.loading,window.MathJax={skipStartupTypeset:!0,showMathMenu:!1,jax:["input/TeX","output/CommonHTML"],TeX:{extensions:["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]},AuthorInit(){a=window.MathJax.Hub,a.Register.StartupHook("End",(function(){s=e.ready,flush_typesets()}))}};var n=t.createElement("script");n.type="text/javascript",n.src=i,n.async=!0,n.onerror=function(){console.warn("Error loading MathJax library "+i),s=e.error,r=[]},t.head.appendChild(n)}class LrnMathController extends HTMLElement{connectedCallback(){this.hasAttribute("src")&&(i=this.getAttribute("src")),this.hasAttribute("lazy")||load_library()}typeset(t,a,n){s!==e.error&&(r.push([t,a,n]),s===e.start?load_library():s===e.ready&&flush_typesets())}}const h="lrn-math-controller",o={childList:!0,characterData:!0,attributes:!0,subtree:!0};let l;class LrnMath extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._private={check:"",observer:new MutationObserver((()=>{this.updateMath()}))},this._private.observer.observe(this,o)}static get tag(){return"lrn-math"}haxHooks(){return{editModeChanged:"haxeditModeChanged",activeElementChanged:"haxactiveElementChanged"}}haxactiveElementChanged(t,e){e&&(this._haxstate=e)}haxeditModeChanged(t){this._haxstate=t}connectedCallback(){!function check_handler(e){l||(l=t.querySelector(h)||t.createElement(h),t.contains(l)||t.head.appendChild(l),setTimeout((()=>{e.refresh()}),0))}(this),setTimeout((()=>{this._haxstate&&this.innerHTML&&null==this.mathtext?this.mathtext=this.innerHTML:this.updateMath()}),0)}updateMath(){const t=this.shadowRoot,e=this.textContent.trim(),a="display"===this.getAttribute("mode"),n=(a?"D":"I")+e;this._private&&n!==this._private.check&&(this.shadowRoot.innerHTML="",this._private.check=n,e.length&&l&&l.typeset(e,a,(function(e,a){t.appendChild(a.cloneNode(!0)),t.appendChild(e)})))}get mathtext(){return this.getAttribute("mathtext")}set mathtext(t){this.setAttribute("mathtext",t)}static get observedAttributes(){return["mathtext"]}attributeChangedCallback(e,a,n){if("mathtext"===e)""!==n&&null!==n?(clearTimeout(this._typingTimeout),this._typingTimeout=setTimeout((()=>{const e=t.createElement("span");e.innerText=n,this.innerHTML="",this.appendChild(e)}),300)):this.updateMath()}static get haxProperties(){return{canScale:!1,canPosition:!1,canEditSource:!0,gizmo:{title:"Math",description:"Present math in a nice looking way.",icon:"hax:pi",color:"grey",tags:["Instructional","math","mathjax","mathml","latex","mathml"],handles:[{type:"math",math:"mathText"},{type:"inline",text:"mathText"}],meta:{author:"HAXTheWeb core team",inlineOnly:!0}},settings:{inline:[],configure:[{property:"mathtext",title:"Math",description:"Enter equation as MathML",inputMethod:"textarea"}],advanced:[]}}}refresh(){let e=t.createElement("lrn-math");this.parentNode.insertBefore(e,this),e.innerHTML=this.innerHTML,this.remove()}}customElements.define("lrn-math",LrnMath);export{LrnMath};customElements.define("lrn-math-controller",LrnMathController);export{LrnMathController};