const t=window.document,e=1,n=2,r=3,o=4,i=5;let a,s,l=[],c=e,h="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js";function flush_typesets(){if(!l.length)return;const e=[],n=[];l.forEach((function(r){const o=t.createElement("script"),i=t.createElement("div");o.type=r[1]?"math/tex; mode=display":"math/tex",o.text=r[0],i.style.position="fixed",i.style.top=0,i.style.left="99999px",i.appendChild(o),t.body.appendChild(i),e.push(o),n.push([i,r[2]])})),l=[],c=o,a.Queue(["Typeset",a,e]),a.Queue((function(){s||function getStyleNode(){const e=t.querySelectorAll("style"),n=Array.prototype.filter.call(e,(function(t){return t.sheet&&t.sheet.cssRules.length>100&&".mjx-chtml"===t.sheet.cssRules[0].selectorText}));s=n[0]}(),n.forEach((function(e){const n=e[0],r="SPAN"===n.firstElementChild.tagName?n.firstElementChild:null;e[1](r,s),t.body.removeChild(n)})),c=r,flush_typesets()}))}function load_library(){c=n,window.MathJax={skipStartupTypeset:!0,showMathMenu:!1,jax:["input/TeX","output/CommonHTML"],TeX:{extensions:["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]},AuthorInit(){a=window.MathJax.Hub,a.Register.StartupHook("End",(function(){c=r,flush_typesets()}))}};var e=t.createElement("script");e.type="text/javascript",e.src=h,e.async=!0,e.onerror=function(){console.warn("Error loading MathJax library "+h),c=i,l=[]},t.head.appendChild(e)}class LrnMathController extends HTMLElement{connectedCallback(){this.hasAttribute("src")&&(h=this.getAttribute("src")),this.hasAttribute("lazy")||load_library()}typeset(t,n,o){c!==i&&(l.push([t,n,o]),c===e?load_library():c===r&&flush_typesets())}}const d={childList:!0,characterData:!0,attributes:!0,subtree:!0};let u;function update(t){const e=t.shadowRoot,n=t.textContent.trim(),r="display"===t.getAttribute("mode"),o=(r?"D":"I")+n;if(o!==t._private.check){for(;e.firstChild;)e.removeChild(e.firstChild);t._private.check=o,n.length&&u&&u.typeset(n,r,(function(t,n){e.appendChild(n.cloneNode(!0)),e.appendChild(t)}))}}const debounce=(t,e)=>{let n;return function executedFunction(...r){clearTimeout(n),n=setTimeout((()=>{clearTimeout(n),t(...r)}),e)}};class LrnMath extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get tag(){return"lrn-math"}connectedCallback(){const e=this;!function check_handler(e){u||(u=t.querySelector("lrn-math-controller")||t.createElement("lrn-math-controller"),t.contains(u)||t.head.appendChild(u),setTimeout((()=>{e.refresh()}),0))}(e),window.requestAnimationFrame((function(){e._private={check:"",observer:new MutationObserver(debounce((function(){update(e)}),500))},update(e),e._private.observer.observe(e,d)}))}static get observedAttributes(){return["math-text"]}attributeChangedCallback(e,n,r){if("math-text"===e)if(""!==r&&null!==r){const e=t.createElement("span");e.innerText=r,this.innerHTML="",this.appendChild(e),this.removeAttribute("math-text")}}static get haxProperties(){return{canScale:!0,canPosition:!0,canEditSource:!0,gizmo:{title:"Math",description:"Present math in a nice looking way.",icon:"hax:pi",color:"grey",groups:["Content"],handles:[{type:"math",math:"mathText"},{type:"inline",text:"mathText"}],meta:{author:"ELMS:LN",inlineOnly:!0}},settings:{configure:[{slot:"",title:"Math",description:"Enter equation as MathML",inputMethod:"code-editor",icon:"editor:format-quote"}],advanced:[]}}}refresh(){let e=t.createElement("lrn-math");this.parentNode.insertBefore(e,this),e.innerHTML=this.innerHTML,this.remove()}disconnectedCallback(){this._private&&(this._private.observer.disconnect(),delete this._private)}}window.customElements.define("lrn-math",LrnMath);export{LrnMath};window.customElements.define("lrn-math-controller",LrnMathController);export{LrnMathController};