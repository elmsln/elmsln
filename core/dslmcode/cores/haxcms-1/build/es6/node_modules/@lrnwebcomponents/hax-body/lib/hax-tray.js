import{LitElement as e,html as t,css as a}from"../../../lit-element/lit-element.js";import{winEventsElement as o,camelCaseToDash as i,wipeSlot as s,nodeToHaxElement as n,haxElementToNode as l}from"../../utils/utils.js";import"../../a11y-collapse/lib/a11y-collapse-group.js";import"../../a11y-collapse/a11y-collapse.js";import{HaxSchematizer as r,HaxElementizer as c}from"../../hax-body-behaviors/lib/HAXFields.js";class HaxTray extends(o(e)){static get tag(){return"hax-tray"}constructor(){super(),this.__winEvents={"hax-store-property-updated":"_haxStorePropertyUpdated"},this.activeValue={settings:{layout:{__position:"hax-align-left",__scale:100},configure:{},advanced:{}}},this.collapsed=!1,this.activeTab="item-0",this.activeSchema=[],this.canUndo=!0,this.canRedo=!0,this.elementAlign="right",this.activeTagName="Select an element to configure",this.activeTagIcon="icons:settings",this.__setup=!1,setTimeout(()=>{import("./hax-tray-button.js"),import("../../../@polymer/iron-icon/iron-icon.js"),import("../../../@polymer/iron-icons/iron-icons.js"),import("../../../@polymer/iron-icons/editor-icons.js"),import("../../../@polymer/iron-icons/device-icons.js"),import("../../../@polymer/iron-icons/hardware-icons.js"),import("../../../@polymer/iron-icons/communication-icons.js"),import("../../../@polymer/iron-icons/social-icons.js"),import("../../../@polymer/iron-icons/image-icons.js"),import("../../../@polymer/iron-icons/av-icons.js"),import("../../../@polymer/iron-icons/maps-icons.js"),import("../../../@polymer/iron-icons/places-icons.js"),import("../../md-extra-icons/md-extra-icons.js"),import("../../hax-iconset/hax-iconset.js"),import("../../lrn-icons/lrn-icons.js"),import("./hax-tray-upload.js"),import("../../simple-fields/simple-fields.js"),this.addEventListener("hax-tray-button-click",this._processTrayEvent.bind(this)),import("./hax-gizmo-browser.js"),import("./hax-app-browser.js"),import("./hax-blox-browser.js"),import("./hax-stax-browser.js")},0)}_haxStorePropertyUpdated(e){e.detail&&void 0!==e.detail.value&&e.detail.property&&("globalPreferences"!==e.detail.property&&"activeGizmo"!==e.detail.property&&"activeNode"!==e.detail.property||(this[e.detail.property]={}),this[e.detail.property]=e.detail.value)}static get styles(){return[a`
        :host {
          font-family: var(--simple-fields-font-family, sans-serif);
          display: block;
          z-index: 1000;
          position: absolute;
          transition: 0.2s all ease-in-out;
          --hax-contextual-action-text-color: var(
            --simple-colors-default-theme-grey-1,
            #fff
          );
          --hax-contextual-action-color: var(
            --simple-colors-default-theme-cyan-7,
            #009dc7
          );
          --hax-contextual-action-hover-color: var(
            --simple-colors-default-theme-cyan-8,
            #007999
          );
          --simple-fields-accent-color: var(
            --simple-colors-default-theme-cyan-8,
            #007999
          );
          --a11y-tabs-focus-color: var(
            --hax-contextual-action-hover-color,
            var(--simple-colors-default-theme-cyan-8, #007999)
          );
        }
        .wrapper {
          color: var(--hax-color-text, black);
          position: fixed;
          top: 0;
          background-color: transparent;
          font-size: 20px;
          width: var(---hax-tray-width, 300px);
          transition: 0.2s all ease-in-out;
          opacity: 0;
          visibility: hidden;
          pointer-events: none;
        }
        :host([edit-mode]) .wrapper {
          opacity: 1;
          visibility: visible;
          right: 0;
          pointer-events: all;
        }
        #addcollapse {
          --hax-tray-panel-accent-text: var(
            --simple-colors-default-theme-grey-1,
            #fff
          );
          --hax-tray-panel-accent: var(
            --simple-colors-default-theme-purple-8,
            #8a009b
          );
          --simple-fields-accent-color: var(
            --simple-colors-default-theme-purple-8,
            #8a009b
          );
        }
        #settingscollapse {
          --hax-tray-panel-accent-text: var(
            --simple-colors-default-theme-grey-1,
            #fff
          );
          --hax-tray-panel-accent: var(
            --simple-colors-default-theme-green-8,
            #00762e
          );
          --simple-fields-accent-color: var(
            --simple-colors-default-theme-green-8,
            #00762e
          );
        }
        #searchapps {
          --hax-tray-panel-accent-text: var(
            --simple-colors-default-theme-grey-1,
            #fff
          );
          --hax-tray-panel-accent: var(
            --simple-colors-default-theme-cyan-8,
            #007999
          );
          --simple-fields-accent-color: var(
            --simple-colors-default-theme-cyan-8,
            #007999
          );
        }
        #templateslayouts {
          --hax-tray-panel-accent-text: var(
            --simple-colors-default-theme-grey-1,
            #fff
          );
          --hax-tray-panel-accent: var(
            --simple-colors-default-theme-pink-8,
            #b80042
          );
          --simple-fields-accent-color: var(
            --simple-colors-default-theme-pink-8,
            #b80042
          );
        }
        :host([edit-mode][collapsed]) a11y-collapse-group {
          right: -100vw;
        }
        :host([element-align="left"]) .wrapper {
          left: -1000px;
        }
        :host([element-align="right"]) .wrapper {
          right: -1000px;
        }
        :host([edit-mode][element-align="left"]) .wrapper {
          left: 0;
        }
        :host([edit-mode][element-align="right"]) .wrapper {
          right: 0;
        }
        :host([edit-mode][element-align="left"]) #toggle-tray-size {
          --hax-tray-button-rotate: rotate(-180deg);
        }
        /** default is right so lets support left too */
        :host([edit-mode][element-align="left"][collapsed])
          a11y-collapse-group {
          right: unset;
          left: -100vw;
        }
        :host([edit-mode][element-align="left"]) .ops,
        :host([edit-mode][element-align="left"]) .quick,
        :host([edit-mode][element-align="left"]) .quick-buttons {
          flex-direction: row-reverse;
        }
        :host([element-align="left"]) #toggle-element-align {
          --hax-tray-button-rotate: rotate(-90deg) scaleX(-1) !important;
        }
        :host([element-align="right"]) #toggle-element-align {
          --hax-tray-button-rotate: rotate(90deg) !important;
        }
        hax-tray-button,
        a11y-collapse,
        a11y-collapse-group,
        hax-app-browser,
        hax-gizmo-browser {
          transition: 0.2s all ease-in-out;
          opacity: 1;
          visibility: visible;
        }
        hax-tray-button:not(:defined),
        a11y-collapse:not(:defined),
        a11y-collapse-group:not(:defined),
        hax-app-browser:not(:defined),
        hax-gizmo-browser:not(:defined) {
          opacity: 0;
          visibility: hidden;
        }
        *[hidden] {
          display: none;
        }
        :host([element-align="right"]) a11y-collapse-group {
          margin: 0 -350px 0 0;
          right: 0;
        }
        :host([element-align="left"]) a11y-collapse-group {
          margin: 0 0 0 -350px;
          left: 0;
        }
        :host([edit-mode][element-align="left"]) a11y-collapse-group,
        :host([edit-mode][element-align="right"]) a11y-collapse-group {
          position: absolute;
          margin: 0;
          top: 32;
        }
        a11y-collapse-group {
          position: fixed;
          font-size: 16px;
          margin: 0;
          background-color: var(--simple-colors-default-theme-grey-1, #fff);
        }
        a11y-collapse {
          font-size: 12px;
          font-weight: normal;
          --a11y-tabs-content-padding: 0;
          width: calc(var(---hax-tray-width, 300px) - 2px);
          --a11y-collapse-heading-color: var(
            --simple-colors-default-theme-grey-7,
            #666
          );
          --a11y-collapse-heading-background-color: var(
            --simple-colors-default-theme-grey-2,
            #eee
          );
          --a11y-collapse-padding-top: 0px;
          --a11y-collapse-padding-right: 0px;
          --a11y-collapse-padding-bottom: 0px;
          --a11y-collapse-padding-left: 0px;
          --a11y-collapse-border: 1px solid
            var(--simple-colors-default-theme-grey-3, #dddddd);
          --a11y-collapse-border-between: 1px solid
            var(--simple-colors-default-theme-grey-3, #dddddd);
          transition: all 0.5ms ease-in-out;
          border-left: 3px solid
            var(--simple-colors-default-theme-grey-3, #dddddd);
        }
        a11y-collapse:not([expanded]) div[slot="content"] {
          display: none;
        }
        a11y-collapse div[slot="heading"] {
          cursor: pointer;
          font-size: 16px;
        }
        a11y-collapse:hover {
          --a11y-collapse-heading-color: var(
            --hax-tray-panel-accent,
            var(--simple-colors-default-theme-grey-12, #000)
          );
          --a11y-collapse-heading-background-color: var(
            --hax-tray-panel-accent-text,
            var(--simple-colors-default-theme-grey-1, #fff)
          );
        }
        a11y-collapse:hover {
          border-left: 3px solid
            var(
              --hax-tray-panel-accent,
              var(--hax-contextual-action-hover-color)
            );
        }
        a11y-collapse[expanded],
        a11y-collapse[expanded]:hover {
          --a11y-collapse-heading-color: var(
            --hax-tray-panel-accent,
            var(--hax-contextual-action-hover-color)
          );
          --a11y-collapse-heading-background-color: var(
            --hax-tray-panel-accent-text,
            var(--simple-colors-default-theme-grey-1)
          );
        }
        a11y-collapse[disabled] {
          --a11y-collapse-heading-color: var(
            --simple-colors-default-theme-grey-7,
            #666
          ) !important;
          --a11y-collapse-heading-background-color: var(
            --simple-colors-default-theme-grey-2,
            #eee
          ) !important;
          cursor: not-allowed;
        }
        a11y-collapse[disabled] div[slot="heading"] {
          cursor: not-allowed !important;
          opacity: 0.6;
        }
        #settingscollapse div[slot="content"] {
          padding: 0;
          margin: 0;
        }
        a11y-collapse[expanded] div[slot="content"] {
          min-height: 300px;
          max-height: 70vh;
          overflow: auto;
        }
        iron-icon {
          margin-right: 8px;
        }
        .quick-buttons {
          width: var(---hax-tray-width, 300px);
          display: flex;
          color: var(--simple-colors-default-theme-grey-12, #000);
          background-color: var(--simple-colors-default-theme-grey-4, #bbb);
          justify-content: space-between;
          transition: all 0.5ms ease-in-out;
        }
        .quick-buttons hax-tray-button {
          --hax-tray-panel-accent-text: var(
            --simple-colors-default-theme-cyan-8,
            #007999
          );
          --hax-tray-panel-accent: var(
            --simple-colors-default-theme-grey-1,
            #fff
          );
        }
        #button,
        .quick-buttons #haxsavebutton {
          --hax-quick-button-accent: var(
            --simple-colors-default-theme-cyan-8,
            #007999
          );
          --hax-tray-panel-accent: var(
            --simple-colors-default-theme-cyan-7,
            #009dc7
          );
          --hax-quick-button-accent-text: var(
            --simple-colors-default-theme-grey-1,
            #fff
          );
          --hax-tray-panel-accent-text: var(
            --simple-colors-default-theme-grey-1,
            #fff
          );
        }
        .quick-buttons #haxcancelbutton {
          --hax-quick-button-accent: var(
            --simple-colors-default-theme-red-8,
            #ac0000
          );
          --hax-tray-panel-accent: var(
            --simple-colors-default-theme-red-7,
            #ee0000
          );
          --hax-quick-button-accent-text: var(
            --simple-colors-default-theme-grey-1,
            #fff
          );
          --hax-tray-panel-accent-text: var(
            --simple-colors-default-theme-grey-1,
            #fff
          );
        }
        .quick-buttons .ops {
          display: flex;
          justify-content: flex-start;
        }
        .quick-buttons .quick {
          display: flex;
          justify-content: flex-end;
        }
        div[slot="heading"] {
          margin: 0;
          padding: 10px;
        }
        :host([element-align="right"]) #button {
          right: 0;
        }
        :host([element-align="left"]) #button {
          left: 0;
        }

        #button {
          position: fixed;
          top: 0;
          visibility: visible;
          z-index: 1000;
          margin: 0;
        }
        :host([edit-mode]) #button {
          visibility: hidden;
          opacity: 0;
        }
        #button:hover {
          opacity: 1;
        }
        .active-op-name {
          display: inline-flex;
          vertical-align: text-bottom;
          padding: 4px 2px;
          max-width: 60px;
          font-size: 11px;
          overflow: hidden;
          text-align: center;
          color: white;
        }
        /** This is mobile layout for controls */
        @media screen and (max-width: 800px) {
          .ops,
          .quick,
          .quick-buttons {
            flex-direction: row-reverse;
          }
          .wrapper {
            top: 0;
            left: 0;
            right: 0;
            margin: 0 !important;
          }
          .quick-buttons {
            position: relative;
            z-index: 1;
          }
          #toggle-element-align {
            display: none;
          }
          #toggle-tray-size {
            --hax-tray-button-rotate: rotate(-90deg) !important;
          }
          :host([edit-mode][collapsed]) a11y-collapse-group {
            top: -200vh;
            left: unset !important;
            right: unset !important;
          }
        }
        @media screen and (max-width: 600px) {
          :host([edit-mode]) .hide-small {
            display: none;
          }
        }
      `]}render(){return t`
      ${this.hidePanelOps?"":t`
            <hax-tray-button
              voice-command="edit page"
              .data-opened="${this.editMode}"
              @click="${this._clickEditButton}"
              icon="create"
              id="button"
              label="${this.__tipText}"
            ></hax-tray-button>
          `}
      <div class="wrapper">
        <div class="quick-buttons">
          <div class="ops">
            ${this.hidePanelOps?"":t`
                  <hax-tray-button
                    mini
                    @click="${this._clickSaveButton}"
                    icon="save"
                    id="haxsavebutton"
                    label="${this.__tipText}"
                    event-name="save"
                    voice-command="save (content)(page)"
                    color-meaning
                  ></hax-tray-button>
                  <hax-tray-button
                    mini
                    icon="cancel"
                    id="haxcancelbutton"
                    label="Cancel"
                    event-name="cancel"
                    voice-command="cancel"
                    color-meaning
                  ></hax-tray-button>
                `}
            <hax-tray-button
              mini
              voice-command="toggle menu"
              id="toggle-tray-size"
              event-name="toggle-tray-size"
              icon="${this.traySizeIcon}"
              label="${this.traySizeText}"
            ></hax-tray-button>
            <hax-tray-button
              mini
              voice-command="toggle alignment"
              id="toggle-element-align"
              event-name="toggle-element-align"
              icon="image:photo-size-select-small"
              label="${this.menuAlignName}"
            ></hax-tray-button>
          </div>
          <div class="quick">
            <slot name="tray-buttons-pre"></slot>
            <hax-tray-button
              mini
              event-name="open-export-dialog"
              icon="code"
              label="View page source"
              voice-command="view (page) source"
            ></hax-tray-button>
            <hax-tray-button
              mini
              icon="icons:undo"
              hidden
              ?disabled="${!this.canUndo}"
              label="Undo previous action"
              event-name="undo"
              voice-command="undo"
              class="hide-small"
            ></hax-tray-button>
            <hax-tray-button
              mini
              icon="icons:redo"
              hidden
              ?disabled="${!this.canRedo}"
              label="Redo previous action"
              event-name="redo"
              voice-command="redo"
              class="hide-small"
            ></hax-tray-button>
            <hax-tray-button
              mini
              event-name="open-map-dialog"
              icon="maps:map"
              label="Content map"
              voice-command="open map"
            ></hax-tray-button>
            <hax-tray-button
              mini
              ?hidden="${this.hidePreferencesButton}"
              event-name="open-preferences-dialog"
              icon="settings"
              label="Advanced settings"
              voice-command="open preferences"
            ></hax-tray-button>
          </div>
        </div>
        <a11y-collapse-group accordion>
          <slot name="tray-collapse-pre"></slot>
          <a11y-collapse
            id="addcollapse"
            accordion
            @expand="${this._gizmoBrowserRefresh}"
          >
            <div slot="heading">
              <iron-icon icon="icons:add"></iron-icon> Add Content
            </div>
            <div slot="content">
              <hax-tray-upload></hax-tray-upload>
              <hax-gizmo-browser id="gizmobrowser"></hax-gizmo-browser>
            </div>
          </a11y-collapse>
          <a11y-collapse id="settingscollapse" accordion>
            <div slot="heading">
              <iron-icon icon="${this.activeTagIcon}"></iron-icon> ${this.activeTagName}
            </div>
            <div slot="content">
              <simple-fields
                id="settingsform"
                .schematizer="${r}"
                .elementizer="${c}"
              >
              </simple-fields>
            </div>
          </a11y-collapse>
          <a11y-collapse
            id="searchapps"
            accordion
            @expand="${this._appBrowserRefresh}"
          >
            <div slot="heading">
              <iron-icon icon="icons:search"></iron-icon> Search
            </div>
            <div slot="content">
              <hax-app-browser id="appbrowser"></hax-app-browser>
            </div>
          </a11y-collapse>
          <a11y-collapse
            id="templateslayouts"
            accordion
            @expand="${this._refreshLists}"
          >
            <div slot="heading">
              <iron-icon icon="hax:templates"></iron-icon>Templates & Layouts
            </div>
            <div slot="content">
              <hax-blox-browser id="bloxbrowser"></hax-blox-browser>
              <hax-stax-browser id="staxbrowser"></hax-stax-browser>
            </div>
          </a11y-collapse>
          <slot name="tray-collapse-post"></slot>
        </a11y-collapse-group>
      </div>
    `}__simpleFieldsClick(e){try{this.activeTab=this.shadowRoot.querySelector("#settingsform").shadowRoot.querySelector("simple-fields").activeTab}catch(e){this.activeTab="item-0"}}_gizmoBrowserRefresh(e){setTimeout(()=>{this.shadowRoot.querySelector("#gizmobrowser")&&this.shadowRoot.querySelector("#gizmobrowser").resetBrowser()},0)}_appBrowserRefresh(e){this.shadowRoot.querySelector("#appbrowser")&&this.shadowRoot.querySelector("#appbrowser").resetBrowser()}_refreshLists(e){this.shadowRoot.querySelector("#bloxbrowser").bloxList=[...window.HaxStore.instance.bloxList],this.shadowRoot.querySelector("#staxbrowser").staxList=[...window.HaxStore.instance.staxList]}_processTrayEvent(e){let t=e.detail;switch(t.eventName){case"search-selected":this.dispatchEvent(new CustomEvent("hax-search-source-updated",{bubbles:!0,cancelable:!0,composed:!0,detail:t.index}));break;case"insert-stax":this.dispatchEvent(new CustomEvent("hax-insert-content-array",{bubbles:!0,cancelable:!0,composed:!0,detail:e.path[0].stax}));break;case"insert-blox":let o="";for(var a=0;a<e.path[0].blox.length;a++){let t=l({tag:e.path[0].blox[a].tag,content:e.path[0].blox[a].content,properties:e.path[0].blox[a].properties});o+=window.HaxStore.nodeToContent(t)}let i={tag:"grid-plate",properties:{layout:e.path[0].layout},content:o};this.dispatchEvent(new CustomEvent("hax-insert-content",{bubbles:!0,cancelable:!0,composed:!0,detail:i}));break;case"insert-tag":let s={tag:t.value},n=JSON.parse(e.path[0].getAttribute("event-properties")),r=e.path[0].getAttribute("event-content");null==n&&(n={}),null==r&&(r="");let c=window.HaxStore.haxElementPrototype(s,n,r);this.dispatchEvent(new CustomEvent("hax-insert-content",{bubbles:!0,cancelable:!0,composed:!0,detail:c}));break;case"open-preferences-dialog":window.HaxStore.write("openDrawer",window.HaxStore.instance.haxPreferences,this);break;case"open-map-dialog":window.HaxStore.write("openDrawer",window.HaxStore.instance.haxMap,this);break;case"toggle-element-align":this.elementAlign="right"===this.elementAlign?"left":"right";break;case"toggle-tray-size":this.collapsed=!this.collapsed;break;case"open-export-dialog":window.HaxStore.write("openDrawer",window.HaxStore.instance.haxExport,this);break;case"undo":document.execCommand("undo");break;case"redo":document.execCommand("redo");break;case"cancel":window.HaxStore.write("editMode",!1,this),this.dispatchEvent(new CustomEvent("hax-cancel",{bubbles:!0,cancelable:!0,composed:!0,detail:t}))}}static get properties(){return{...super.properties,__tipText:{type:String},menuAlignName:{type:String},offsetMargin:{type:String},collapsed:{type:Boolean,reflect:!0},traySizeIcon:{type:String},traySizeText:{type:String},activeValue:{type:Object},activeSchema:{type:Object},elementAlign:{type:String,reflect:!0,attribute:"element-align"},light:{type:Boolean,reflect:!0},canUndo:{type:Boolean,attribute:"can-undo"},canRedo:{type:Boolean,attribute:"can-redo"},isDirty:{type:Boolean,attribute:"is-dirty"},hidePreferencesButton:{type:Boolean,reflect:!0,attribute:"hide-preferences-button"},hidePanelOps:{type:Boolean,reflect:!0,attribute:"hide-panel-ops"},globalPreferences:{type:Object},activeNode:{type:Object},activeTagIcon:{type:String},activeTagName:{type:String},activeGizmo:{type:Object},editMode:{type:Boolean,reflect:!0,attribute:"edit-mode"}}}firstUpdated(e){super.firstUpdated&&super.firstUpdated(e),this.__setup||(setTimeout(()=>{this.shadowRoot.querySelector(".wrapper").style.margin=this.offsetMargin},1e3),this.__setup=!0,this.shadowRoot.querySelector("#settingsform").addEventListener("click",this.__simpleFieldsClick.bind(this)),this.shadowRoot.querySelector("#settingsform").addEventListener("value-changed",this.__valueChangedEvent.bind(this)),this.dispatchEvent(new CustomEvent("hax-register-core-piece",{bubbles:!0,cancelable:!0,composed:!0,detail:{piece:"haxTray",object:this}})),this.dispatchEvent(new CustomEvent("hax-add-voice-command",{bubbles:!0,composed:!0,cancelable:!1,detail:{command:":name: (collapse)(open)(expand)(toggle) add content (menu)",context:this.shadowRoot.querySelector('#addcollapse div[slot="heading"]'),callback:"click"}})),this.dispatchEvent(new CustomEvent("hax-add-voice-command",{bubbles:!0,composed:!0,cancelable:!1,detail:{command:":name: (collapse)(open)(expand)(toggle) element settings (menu)",context:this.shadowRoot.querySelector('#settingscollapse div[slot="heading"]'),callback:"click"}})),this.dispatchEvent(new CustomEvent("hax-add-voice-command",{bubbles:!0,composed:!0,cancelable:!1,detail:{command:":name: (collapse)(open)(expand)(toggle) search (menu)",context:this.shadowRoot.querySelector('#searchapps div[slot="heading"]'),callback:"click"}})),this.dispatchEvent(new CustomEvent("hax-add-voice-command",{bubbles:!0,composed:!0,cancelable:!1,detail:{command:":name: (collapse)(open)(expand)(toggle) templates (menu)",context:this.shadowRoot.querySelector('#templateslayouts div[slot="heading"]'),callback:"click"}})))}updated(e){e.forEach((e,t)=>{"editMode"==t&&this._editModeChanged(this[t],e),"offsetMargin"==t&&setTimeout(()=>{this.shadowRoot.querySelector(".wrapper").style.margin=this.offsetMargin},0),"collapsed"==t&&(this[t]?(this.traySizeIcon="hax:hax:arrow-expand-left",this.traySizeText="Expand",this.shadowRoot.querySelector("a11y-collapse-group").setAttribute("aria-disabled","true"),this.shadowRoot.querySelector("a11y-collapse-group").setAttribute("tabindex","-1"),this._editModeChanged(this.editMode)):(this.traySizeIcon="hax:hax:arrow-expand-right",this.traySizeText="Collapse",this.shadowRoot.querySelector("a11y-collapse-group").removeAttribute("aria-disabled"),this.shadowRoot.querySelector("a11y-collapse-group").removeAttribute("tabindex"))),"elementAlign"==t&&("left"==this[t]?this.menuAlignName="Right align menu":this.menuAlignName="Left align menu"),"activeGizmo"==t&&(this.activeGizmo?(this.activeTagName=this.activeGizmo.title+" Settings",this.activeTagIcon=this.activeGizmo.icon):(this.activeTagName="Select an element",this.activeTagIcon="icons:settings",this.shadowRoot.querySelector("#addcollapse").expanded||this.shadowRoot.querySelector('#addcollapse div[slot="heading"]').click())),"activeNode"==t&&(this.activeNode&&this.activeNode.tagName?(this.shadowRoot.querySelector("#settingscollapse").disabled=!1,this.activeHaxElement=n(this.activeNode,null),this._setupForm()):(this.activeTagName="Select an element to configure",this.activeTagIcon="icons:settings",this.shadowRoot.querySelector("#settingscollapse").disabled=!0))})}_setupForm(){let e=this.activeNode;if(this.activeValue={settings:{layout:{__position:"hax-align-left",__scale:100},configure:{},advanced:{}}},this.shadowRoot.querySelector("#settingsform").fields=[],this.shadowRoot.querySelector("#settingsform").value={},e.tagName&&window.HaxStore.instance.elementList[e.tagName.toLowerCase()]){let a=window.HaxStore.instance.elementList[e.tagName.toLowerCase()];for(var t in void 0===a.gizmo.title?this.humanName=e.tagName.replace("-"," ").toLowerCase():this.humanName=a.gizmo.title,this.activeHaxElement.properties)a.settings.configure.forEach(e=>{e.property===t&&(this.activeValue.settings.configure[t]=this.activeHaxElement.properties[t]),e.attribute===t&&(this.activeValue.settings.configure[t]=this.activeHaxElement.properties[t]),e.slot===t&&(this.activeValue.settings.configure[t]=this.activeHaxElement.properties[t])}),a.settings.advanced.forEach(e=>{e.property===t&&(this.activeValue.settings.advanced[t]=this.activeHaxElement.properties[t]),e.attribute===t&&(this.activeValue.settings.advanced[t]=this.activeHaxElement.properties[t]),e.slot===t&&(this.activeValue.settings.advanced[t]=this.activeHaxElement.properties[t])});let o=document.createElement("div");o.innerHTML=this.activeHaxElement.content,o.childNodes.forEach(e=>{1===e.nodeType&&"undefined"!==e.innerHTML&&(a.settings.configure.forEach(t=>{t.slot===e.getAttribute("slot")?this.activeValue.settings.configure[t.slot]=e.innerHTML:""!=t.slot||null!=e.getAttribute("slot")&&"null"!=e.getAttribute("slot")||(this.activeValue.settings.configure[t.slot]=e.innerHTML)}),a.settings.advanced.forEach(t=>{t.slot===e.getAttribute("slot")?this.activeValue.settings.advanced[t.slot]=e.innerHTML:""!=t.slot||null!=e.getAttribute("slot")&&"null"!=e.getAttribute("slot")||(this.activeValue.settings.advanced[t.slot]=e.innerHTML)}))}),""!=e.style.width?this.activeValue.settings.layout.__scale=e.style.width.replace("%",""):this.activeValue.settings.layout.__scale=100,"block"==e.style.display&&"0px auto"==e.style.margin&&"right"==e.style.float?this.activeValue.settings.layout.__position="hax-align-right":"block"==e.style.display&&"0px auto"==e.style.margin?this.activeValue.settings.layout.__position="hax-align-center":this.activeValue.settings.layout.__position="hax-align-left",this.activeHaxElement.properties.__scale=this.activeValue.settings.layout.__scale,this.activeHaxElement.properties.__position=this.activeValue.settings.layout.__position,a.settings.configure.forEach((e,t)=>{a.settings.configure[t].attribute&&(a.settings.configure[t].property=a.settings.configure[t].attribute),a.settings.configure[t].slot&&(a.settings.configure[t].property=a.settings.configure[t].slot)}),a.settings.advanced.forEach((e,t)=>{a.settings.advanced[t].attribute&&(a.settings.advanced[t].property=a.settings.advanced[t].attribute),a.settings.advanced[t].slot&&(a.settings.advanced[t].property=a.settings.advanced[t].slot)}),a.settings.layout=[],a.canPosition&&a.settings.layout.push({property:"__position",title:"Alignment",description:"Align content relative to other content",inputMethod:"select",value:this.activeValue.settings.layout.__position,options:{"hax-align-left":"Left","hax-align-center":"Center","hax-align-right":"Right"}}),a.canScale&&a.settings.layout.push({property:"__scale",title:"Width",description:"Scale and resize content",inputMethod:"slider",value:this.activeValue.settings.layout.__scale,min:a.canScale.min?a.canScale.min:12.5,max:a.canScale.max?a.canScale.max:100,step:a.canScale.step?a.canScale.step:12.5}),this.activeSchema=[{property:"settings",inputMethod:"tabs",properties:[]}];a.settings.layout.length>0?this.activeSchema[0].properties.push({property:"layout",title:"Layout",description:"Position the element relative to other items",properties:a.settings.layout}):this.activeSchema[0].properties.push({property:"layout",title:"Layout",description:"Position the element relative to other items",disabled:!0}),a.settings.configure.length>0?this.activeSchema[0].properties.push({property:"configure",title:"Configure",description:"Configure the element",properties:a.settings.configure}):this.activeSchema[0].properties.push({property:"configure",title:"Configure",description:"Configure the element",disabled:!0}),a.settings.advanced.length>0?this.activeSchema[0].properties.push({property:"advanced",title:"Advanced",description:"Advanced element settings",properties:a.settings.advanced}):this.activeSchema[0].properties.push({property:"advanced",title:"Advanced",description:"Advanced element settings",disabled:!0}),this.__activePropSchema=a,this.shadowRoot.querySelector("#settingsform").fields=[...this.activeSchema],this.shadowRoot.querySelector("#settingsform").value={...this.activeValue}}}_toArray(e){return null==e?[]:Object.keys(e).map((function(t){return e[t]}))}__valueChangedEvent(e){if(this.editMode&&e.detail.value&&e.detail.value.settings){let l=e.detail.value.settings,r={advanced:"advanced",configure:"configure",layout:"layout"};var t;for(let c in r)for(let r in l[c])if(t=!1,null==l[c][r]||l[c][r].readOnly)this.activeNode.removeAttribute(i(r));else{if("prefix"===r&&""!=l[c][r])this.activeNode.setAttribute("prefix",l[c][r]),t=!0;else if("layout"===c&&"__position"===r)t=!0,this.dispatchEvent(new CustomEvent("hax-context-item-selected",{bubbles:!0,composed:!0,detail:{eventName:l[c][r],value:l[c][r]}}));else if("layout"===c&&"__scale"===r)t=!0,this.dispatchEvent(new CustomEvent("hax-context-item-selected",{bubbles:!0,composed:!0,detail:{eventName:"hax-size-change",value:l[c][r]}}));else if(this.activeNode.hasOwnProperty(r)||this.activeNode.properties&&this.activeNode.properties.hasOwnProperty(r)||null!=l[c][r]&&l[c][r].constructor===Array||null!=l[c][r]&&l[c][r].constructor===Object)try{l[c][r].constructor===Array?this.activeNode[r]=[...l[c][r]]:l[c][r].constructor===Object?this.activeNode[r]={...l[c][r]}:this.activeNode[r]=l[c][r],t=!0}catch(e){console.warn(e),t=!1}else for(var a in this.__activePropSchema.settings[c])if(this.__activePropSchema.settings[c][a].slot==r){let e="span";this.__activePropSchema.settings[c][a].slotWrapper?e=this.__activePropSchema.settings[c][a].slotWrapper:"code-editor"===this.activeNode.tagName.toLowerCase()&&(e="template");var o=document.createElement(e);if(this.__activePropSchema.settings[c][a].slotAttributes)for(var n in this.__activePropSchema.settings[c][a].slotAttributes)o.setAttribute(n,this.__activePropSchema.settings[c][a].slotAttributes[n]);""!==this.__activePropSchema.settings[c][a].slot&&(o.slot=this.__activePropSchema.settings[c][a].slot),o.innerHTML=l[c][r];const i=o.cloneNode(!0);t=!0,window.HaxStore.instance.isTextElement(this.activeNode)?this.activeNode.innerHTML=o.innerHTML:(s(this.activeNode,this.__activePropSchema.settings[c][a].slot),this.activeNode.appendChild(i))}if(!t)try{!0===l[c][r]?this.activeNode.setAttribute(i(r),i(r)):!1===l[c][r]||""===l[c][r]?this.activeNode.removeAttribute(i(r)):this.activeNode.setAttribute(i(r),l[c][r])}catch(e){console.warn(e),console.warn(r,l[c][r])}}}}_editModeChanged(e,t){void 0!==e&&e?(this.__tipText="Save content",this.shadowRoot.querySelector("#button").icon="save"):(this.__tipText="Edit content",this.shadowRoot.querySelector("#button").icon="create")}_clickEditButton(e){this.editMode=!0,window.HaxStore.write("editMode",!0,this),window.dispatchEvent(new CustomEvent("simple-modal-hide",{bubbles:!0,cancelable:!0,detail:{}}))}_clickSaveButton(e){this.editMode=!1,window.HaxStore.write("editMode",!1,this),this.dispatchEvent(new CustomEvent("hax-save",{bubbles:!0,cancelable:!0,composed:!0,detail:e.detail})),window.dispatchEvent(new CustomEvent("simple-modal-hide",{bubbles:!0,cancelable:!0,detail:{}}))}}window.customElements.define(HaxTray.tag,HaxTray);export{HaxTray};