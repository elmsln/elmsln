Object.defineProperty(exports,"__esModule",{value:!0}),exports.SimpleFieldsArrayItem=void 0;var e=require("lit"),t=require("./simple-fields-fieldset.js"),n=require("./simple-fields-ui.js");require("@lrnwebcomponents/utils/utils.js");function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _templateObject2_ea1210708e0011ed99ce491205e67b1d(){var e=_taggedTemplateLiteral(['\n        :host {\n          padding: 0;\n          border-radius: var(--simple-fields-border-radius, 2px);\n          display: block;\n          border: none;\n          transform: rotate(0deg);\n          transition: all 0.5s ease;\n          z-index: 1;\n          position: relative;\n        }\n        :host([disabled]) {\n          opacity: 0.5;\n        }\n        :host([aria-expanded="true"]) {\n          padding: var(--simple-fields-margin, 16px)\n            var(--simple-fields-margin-small, 8px);\n          outline: 1px solid var(--simple-fields-border-color-light, #ccc);\n          transition: all 0.5s ease;\n        }\n        :host([error]) {\n          outline: 1px solid var(--simple-fields-error-color, #b40000);\n          transition: border 0.5s ease;\n        }\n        *[aria-controls="content"][disabled] {\n          cursor: not-allowed;\n        }\n        #drag-handle {\n          flex: 0 1 auto;\n          position: relative;\n          overflow: visible;\n        }\n        #preview {\n          flex: 1 0 auto;\n          margin: 0;\n          margin-right: calc(0 - var(--simple-fields-margin-small, 8px) / 2);\n          margin-left: calc(50px + var(--simple-fields-margin-small, 8px) / 2);\n          max-width: calc(\n            100% - 72px - 2 * var(--simple-fields-margin-small, 8px) / 2\n          );\n        }\n        #heading,\n        .heading-inner {\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-start;\n        }\n        #content {\n          overflow: hidden;\n          max-height: 0;\n        }\n        :host #content-inner {\n          display: flex;\n          align-items: flex-end;\n          justify-content: space-between;\n          flex-wrap: wrap;\n          overflow: hidden;\n          max-height: 0;\n          transition: max-height 0.75s ease 0.1s;\n        }\n        :host([aria-expanded="true"]) #content {\n          max-height: 20000vh;\n          transition: max-height 0.75s ease 0.1s;\n        }\n        :host([aria-expanded="true"]) #content-inner {\n          max-height: 20000vh;\n        }\n        #content-inner > * {\n          flex: 1 1 auto;\n        }\n        #copy-delete {\n          display: flex;\n          align-items: stretch;\n          justify-content: flex-end;\n          flex: 1 0 auto;\n        }\n        #copy,\n        #remove {\n          flex: 0 0 auto;\n        }\n        #expand {\n          margin-left: calc(var(--simple-fields-margin-small, 8px) / 2);\n        }\n        #drag-handle {\n          position: absolute;\n          left: 2px;\n          top: 2px;\n          --simple-toolbar-button-white-space: normal !important;\n        }\n        :host([aria-expanded="true"]) #drag-handle {\n          top: var(--simple-fields-margin, 16px);\n          left: var(--simple-fields-margin-small, 8px);\n        }\n        #dropzone {\n          height: 0px;\n        }\n        :host(.dragging) #heading {\n          opacity: 0.5;\n        }\n        :host(.dragging) #content,\n        :host(.dragging) #expand {\n          display: none;\n        }\n        #content:hover,\n        #content:focus-within,\n        #content:hover #content-inner,\n        #content:focus-within #content-inner {\n          overflow: visible;\n        }\n        :host(.dragging) #preview,\n        :host(.droppable) #preview {\n          margin-left: calc(var(--simple-fields-margin-small, 8px) / 2);\n        }\n        :host(.dropzone) #dropzone {\n          background-color: var(\n            --simple-fields-button-focus-background-color,\n            var(--simple-fields-accent-color-light, #d9eaff)\n          );\n          height: 80px;\n        }\n\n        :host([aria-expanded="true"]) #expand::part(icon) {\n          transform: rotate(90deg);\n          transition: all 0.5s ease;\n        }\n        ::slotted([slot="preview"]),\n        ::slotted(*:first-child) {\n          margin-top: 0;\n        }\n        ::slotted([slot="preview"]),\n        ::slotted(*:last-child) {\n          margin-bottom: 0;\n        }\n        :host(:hover),\n        :host(:focus),\n        :host(:focus-within) {\n          z-index: 100000;\n        }\n        :host(.dropzone) {\n          z-index: 1;\n        }\n        [hidden],\n        :host(:first-child) #move-up-outer,\n        :host(:last-child) #move-down-outer,\n        :host(:first-child):last-child #drag-handle {\n          display: none;\n        }\n      ']);return _templateObject2_ea1210708e0011ed99ce491205e67b1d=function _templateObject2_ea1210708e0011ed99ce491205e67b1d(){return e},e}function _toConsumableArray(e){return function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _templateObject_ea1210708e0011ed99ce491205e67b1d(){var e=_taggedTemplateLiteral(['\n      <div id="dropzone"></div>\n      <simple-toolbar-menu\n        id="drag-handle"\n        controls="','"\n        icon="icons:reorder"\n        label="Reorder this item"\n        ?disabled="','"\n        ?hidden="','"\n        part="drag"\n        tooltip-direction="right"\n        @mousedown="','"\n        @mouseup="','"\n      >\n        <simple-toolbar-menu-item id="move-up-outer">\n          <simple-toolbar-button\n            id="move-up"\n            align-horizontal="left"\n            role="menuitem"\n            icon="arrow-upward"\n            show-text-label\n            label="Up"\n            @click="','"\n          >\n          </simple-toolbar-button>\n        </simple-toolbar-menu-item>\n        <simple-toolbar-menu-item id="move-down-outer">\n          <simple-toolbar-button\n            align-horizontal="left"\n            id="move-up"\n            role="menuitem"\n            icon="arrow-downward"\n            show-text-label\n            label="Down"\n            @click="','"\n          >\n          </simple-toolbar-button>\n        </simple-toolbar-menu-item>\n      </simple-toolbar-menu>\n      <div id="heading" part="heading" .item="','">\n        <div id="preview" part="preview"><slot name="preview"></slot></div>\n        <simple-toolbar-button\n          id="expand"\n          controls="','"\n          icon="more-vert"\n          label="Toggle expand"\n          @click="','"\n          toggles\n          ?toggled="','"\n          part="expand"\n          tooltip-direction="left"\n        >\n        </simple-toolbar-button>\n      </div>\n      <div id="content" part="content">\n        <div id="content-inner" part="content-inner">\n          <div><slot></slot></div>\n          <div id="copy-delete">\n            <simple-toolbar-button\n              id="copy"\n              controls="','"\n              icon="content-copy"\n              label="Copy this item"\n              ?disabled="','"\n              @click="','"\n              part="copy"\n              tooltip-direction="left"\n            >\n            </simple-toolbar-button>\n            <simple-toolbar-menu\n              id="remove"\n              icon="delete"\n              label="Remove this item"\n              ?disabled="','"\n              fit-to-visible-bounds\n              part="remove"\n              position-align="end"\n              tooltip-direction="left"\n            >\n              <simple-toolbar-menu-item>\n                <simple-toolbar-button\n                  id="confirm-remove"\n                  class="danger"\n                  align-horizontal="left"\n                  role="menuitem"\n                  show-text-label\n                  controls="','"\n                  icon="delete"\n                  label="Remove"\n                  ?disabled="','"\n                  @click="','"\n                  part="confirm-remove"\n                >\n                </simple-toolbar-button>\n              </simple-toolbar-menu-item>\n            </simple-toolbar-menu>\n          </div>\n        </div>\n      </div>\n    ']);return _templateObject_ea1210708e0011ed99ce491205e67b1d=function _templateObject_ea1210708e0011ed99ce491205e67b1d(){return e},e}function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _get(e,t,n){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(e,t,n){var o=function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}},_get(e,t,n||e)}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}require("@lrnwebcomponents/simple-icon/simple-icon.js"),require("@lrnwebcomponents/simple-icon/lib/simple-icons.js"),require("@lrnwebcomponents/simple-toolbar/lib/simple-toolbar-button.js"),require("@lrnwebcomponents/simple-toolbar/lib/simple-toolbar-menu.js"),require("@lrnwebcomponents/simple-toolbar/lib/simple-toolbar-menu-item.js");var o=function(o){function SimpleFieldsArrayItem(){var e;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SimpleFieldsArrayItem),(e=_possibleConstructorReturn(this,_getPrototypeOf(SimpleFieldsArrayItem).call(this))).disabled=!1,e.draggable="truest",e.previewBy=[],e.addEventListener("dragenter",e._dragEnter),e.addEventListener("dragleave",e._dragLeave),e.addEventListener("dragover",e._dragMoving),e.addEventListener("dragstart",e._dragStart),e.addEventListener("dragend",e._dragEnd),e.addEventListener("drop",e._dragDrop),e}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}(SimpleFieldsArrayItem,(0,t.SimpleFieldsFieldsetBehaviors)(e.LitElement)),_createClass(SimpleFieldsArrayItem,[{key:"render",value:function render(){var t=this;return(0,e.html)(_templateObject_ea1210708e0011ed99ce491205e67b1d(),this.id,this.disabled,this.__dropAccepts||this.__dragging,(function(e){return t.draggable="true"}),(function(e){return t.draggable="false"}),this._moveUp,this._moveDown,this,this.id,this.toggle,this.expanded,(this.parentNode||{}).id,this.disabled,this._handleCopy,this.disabled,this.id,this.disabled,this._handleRemove)}}],[{key:"styles",get:function get(){return[].concat(_toConsumableArray(_get(_getPrototypeOf(SimpleFieldsArrayItem),"styles",this)),_toConsumableArray(n.SimpleFieldsButtonStyles),[(0,e.css)(_templateObject2_ea1210708e0011ed99ce491205e67b1d())])}},{key:"tag",get:function get(){return"simple-fields-array-item"}},{key:"properties",get:function get(){return{expanded:{type:Boolean},disabled:{type:Boolean,reflect:!0,attribute:"disabled"},draggable:{type:String,reflect:!0},preview:{type:Boolean},previewBy:{type:Array,reflect:!0,attribute:"preview-by"},__dragging:{type:Boolean},__dropAccepts:{type:Object},__prev:{type:Object},__next:{type:Object}}}}]),_createClass(SimpleFieldsArrayItem,[{key:"_dragMoving",value:function _dragMoving(e){this.__dragMoving=!0,e.preventDefault()}},{key:"_dragEnd",value:function _dragEnd(e){_toConsumableArray(this.parentNode.childNodes).forEach((function(e){return e._setDropzone(!1)})),this._setDragging(!1)}},{key:"_dragStart",value:function _dragStart(e){var t=this.shadowRoot.querySelector("#heading");e.dataTransfer.setDragImage(t,0,0),this._setDragging(),e.stopPropagation(),e.stopImmediatePropagation()}},{key:"_dragEnter",value:function _dragEnter(e){this._setDropzone()}},{key:"_dragLeave",value:function _dragLeave(e){this._setDropzone(!1)}},{key:"_dragDrop",value:function _dragDrop(e){this._moveBefore(e,this.__dropAccepts,this)}},{key:"_moveUp",value:function _moveUp(e){var t=this.previousElementSibling;t&&this._moveBefore(e,this,t)}},{key:"_moveDown",value:function _moveDown(e){var t=this.nextElementSibling;t&&this._moveBefore(e,this,t.nextElementSibling)}},{key:"_moveBefore",value:function _moveBefore(e,t,n){!this.parentNode.disabled&&t&&(n?this.parentNode.insertBefore(t,n):this.parentNode.append(t),_toConsumableArray(this.parentNode.childNodes).forEach((function(e){e._setDragging(!1),e._setDragging(!1)})),this.dispatchEvent(new CustomEvent("reorder",{bubbles:!0,cancelable:!0,composed:!0,detail:this.parentNode})))}},{key:"_setDragging",value:function _setDragging(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.parentNode.disabled||(this.__dragging=t),t?(_toConsumableArray(this.parentNode.childNodes).forEach((function(t){t!==e&&(t.__dropAccepts=e,t.classList.add("droppable"))})),this.classList.add("dragging")):(_toConsumableArray(this.parentNode.childNodes).forEach((function(t){t!==e&&(t.__dropAccepts=void 0,t.classList.remove("droppable"))})),this.classList.remove("dragging"))}},{key:"_setDropzone",value:function _setDropzone(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&!this.__dragging&&this.__dropAccepts?this.classList.add("dropzone"):this.classList.remove("dropzone")}},{key:"connectedCallback",value:function connectedCallback(){var e=this;_get(_getPrototypeOf(SimpleFieldsArrayItem.prototype),"connectedCallback",this).call(this),setTimeout((function(){e.dispatchEvent(new CustomEvent("added",{bubbles:!0,cancelable:!0,composed:!0,detail:e}))}),0)}},{key:"updated",value:function updated(e){var t=this;e.forEach((function(e,n){var o=t.getAttribute("aria-expanded");"error"===n&&t.setAttribute("aria-expanded",t.error||o)}))}},{key:"toggle",value:function toggle(){"true"===this.getAttribute("aria-expanded")?this.setAttribute("aria-expanded","false"):this.setAttribute("aria-expanded","true")}},{key:"_handleCopy",value:function _handleCopy(){this.dispatchEvent(new CustomEvent("copy",{bubbles:!0,cancelable:!0,composed:!0,detail:this}))}},{key:"_handleRemove",value:function _handleRemove(){this.dispatchEvent(new CustomEvent("remove",{bubbles:!0,cancelable:!0,composed:!0,detail:this}))}},{key:"disconnectedCallback",value:function disconnectedCallback(){this.dispatchEvent(new CustomEvent("removed",{bubbles:!0,cancelable:!0,composed:!0,detail:this})),_get(_getPrototypeOf(SimpleFieldsArrayItem.prototype),"disconnectedCallback",this).call(this)}},{key:"slots",get:function get(){var e={};return this.previewBy.forEach((function(t){return e[t]="preview"})),e}}]),SimpleFieldsArrayItem}();exports.SimpleFieldsArrayItem=o,window.customElements.define(o.tag,o);