/**
 * Copyright 2018 Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import"./rich-text-editor-highlight.js";import"./rich-text-editor-clipboard.js";import"./rich-text-editor-source.js";export const RichTextEditorRangeBehaviors=function(e){return class extends e{static get properties(){return{...super.properties,range:{name:"range",type:Object},__toolbar:{name:toolbar,type:Object},__highlight:{type:Object},__clipboard:{type:Object},__source:{type:Object}}}constructor(){super(),this.haxUIElement=!0,this.__highlight=window.RichTextEditorHighlight.requestAvailability(),this.__clipboard=window.RichTextEditorClipboard.requestAvailability()}get commandIsToggled(){return this.commandToggledForRange(this.range)}get hasBreadcrumbs(){return!1}get toggledCommands(){return this.toggledCommandsForRange()}get validCommands(){return["backColor","bold","copy","createLink","cut","decreaseFontSize","defaultParagraphSeparator","delete","fontName","fontSize","foreColor","formatBlock","forwardDelete","hiliteColor","increaseFontSize","indent","insertBrOnReturn","insertHorizontalRule","insertHTML","insertImage","insertLineBreak","insertOrderedList","insertUnorderedList","insertParagraph","insertText","italic","justifyCenter","justifyFull","justifyLeft","justifyRight","outdent","paste","redo","removeFormat","selectAll","strikeThrough","styleWithCss","subscript","superscript","underline","undo","unlink","useCSS","wrapRange"]}closeToolbar(e=this.__toolbar,t=this.__toolbar.target){t&&e.disableEditing(t),e.target=void 0,document.body.append(e)}sanitizeHTML(e){return this.__toolbar.sanitizeHTML(e)}trimHTML(e){let t=e?e.innerHTML:void 0;return this.trimString(t)}trimString(e){return(e||"").replace(/<!--[^(-->)]*-->/g,"").replace(/[\s\t\r\n]/gim,"")}outdentHTML(e=""){let t=(e=(this.sanitizeHTML(e)||"").replace(/[\s]*$/,"").replace(/^[\n\r]*/,"").replace(/[\n\r]+/gm,"\n")).match(/^\s+/),n=!!t&&t[0],r=!!n&&new RegExp(`\\n${n}`,"gm");return e=e.replace(/^\s+/,""),e=r?e.replace(r,"\n "):e}pasteFromClipboard(e=this.range){this.__clipboard.setClipboard(),setTimeout((async()=>{this.paste(this.__clipboard.value,e,!0)}),100)}paste(e,t=this.range,n=!0){this.dispatchEvent(new CustomEvent("paste",{bubbles:!0,cancelable:!0,composed:!0,detail:this.target}));let r=this.__toolbar.target;if(r){let t=this.range,i=document.createElement("div");if(r=t.commonAncestorContainer.parentNode.closest("[contenteditable=true]:not([disabled]),input:not([disabled]),textarea:not([disabled])")){for(i.innerHTML=n?this.sanitizeHTML(e||this.__clipboard.value):e,t&&t.extractContents&&t.extractContents(),t.insertNode(i);i.firstChild;)i.parentNode.insertBefore(i.firstChild,i);i.parentNode.removeChild(i)}r.normalize()}}get highlighted(){return!!this.__highlight&&!this.__highlight.hidden}getRange(){let e=this.getSelection();return this.__toolbar?this.__toolbar.getRange():e.getRangeAt(0)}getSelection(){return this.__toolbar?this.__toolbar.getSelection():window.getSelection()}getRoot(e){return e&&e!==document?e.parentNode?this.getRoot(e.parentNode):e:document}debugRange(e=this.getRange()){let t=!(!e||e.collapsed||!e.cloneContents)&&e.cloneContents();return{range:e,contents:t,text:!!t&&t.textContent}}commandToggledForRange(e=this.range||this.getRange(),t=this.command,n=this.commandVal){let r=!(!e||!t)&&document.queryCommandState(this.command);return!!("underline"===t?!!this.rangeOrMatchingAncestor("u"):"wrapRange"===t?!!this.rangeOrMatchingAncestor(n):r)}toggledCommandsForRange(e=this.range||this.getRange()){return this.validCommands.filter((t=>{this.commandToggledForRange(e,t)}))}rangeOrMatchingAncestor(e=this.tagsList||"",t=this.range||this.getRange()){let n=this.rangeElementOrParentElement(t);return n&&""!=e?n.matches(e)?n:n.closest(e):void 0}rangeElementOrParentElement(e=this.range||this.getRange()){return this.rangeIsElement(e)?e.startContainer:this.rangeParentElement(e)}rangeNodeOrParentNode(e=this.range||this.getRange()){return this.rangeIsNode(e)?e.startContainer:this.rangeParentNode(e)}rangeBreadcrumbs(e=this.range||this.getRange()){let t=[];return t.push({nodeName:!1}),t.reverse()}rangeIsNode(e=this.range||this.getRange()){let t=e?e.startContainer:void 0,n=e?e.startOffset:void 0,r=e?e.endContainer:void 0,i=e?e.endOffset:void 0;return!!t&&t===r&&i-n==1}rangeIsElement(e=this.range||this.getRange()){return this.rangeIsNode(e)&&1==e.startContainer.nodeType}rangeParentElement(e=this.range||this.getRange()){let t=e?e.commonAncestorContainer:void 0;return t?1==t.nodeType?t:t.parentElement:void 0}rangeParentNode(e=this.range||this.getRange()){let t=e?e.commonAncestorContainer:void 0;return t?t.parentNode:void 0}rangeNodes(e=this.range||this.getRange()){let t=this.rangeFirstNode(e),n=[];for(;t;)n.push(t),t=t.nextSibling;return n}rangeFirstNode(e=this.range||this.getRange()){return e&&e.startContainer&&e.startContainer.childNodes?e.startContainer.childNodes[e.startOffset-1]:void 0}rangeLastNode(e=this.range||this.getRange()){return e&&e.endContainer&&e.endContainer.childNodes?e.endContainer.childNodes[e.endOffset-1]:void 0}selectNode(e,t=this.range){if(e&&e.parentNode){if(!t){let e=this.getSelection();t=document.createRange(),e.removeAllRanges(),e.addRange(t)}t&&(t.selectNode(e),this._rangeChanged(t))}}selectNodeContents(e,t=this.range){if(e){if(!t){let e=this.getSelection();t=document.createRange(),e.removeAllRanges(),e.addRange(t)}t&&(t.selectNodeContents(e),this._rangeChanged(t))}}highlightNode(e,t=this.range){(e||this.rangeOrMatchingAncestor())&&this.selectNode(e,t),this.__toolbar.updateRange(),this.__highlight.wrap(t)}selectRange(e=this.range,t=!0){if(e)if(t){let t=this.getSelection();t.removeAllRanges(),t.addRange(e)}else e.isCollapsed||e.collapse();return e}surroundRange(e,t=this.range){t&&t.surroundContents(e)}_rangeChanged(e){this.dispatchEvent(new CustomEvent("rangechange",{bubbles:!0,composed:!0,cancelable:!0,detail:{element:this,range:e}}))}initViewSource(){this.__source=this.__source||window.RichTextEditorSource.requestAvailability()}_handleCommand(e,t,n=this.getRange()){let r=this.__toolbar,i=r.target;if(this.validCommands.includes(e)){if(t=r&&t?r.sanitizeHTML(t):t,"wrapRange"==e&&t){let e=this.commandToggledForRange(n,"wrapRange",t),r=this.rangeOrMatchingAncestor(t);if(e){if(e){let e=r?[...r.childNodes].reverse():[];n&&n.setStartBefore(r),e.forEach((e=>{n&&n.insertNode(e)})),r&&r.parentElement.normalize(),r&&n.selectNodeContents(r),r&&r.remove()}}else{this.__highlight.wrap(n);let e=this.__highlight.innerHTML;this.__highlight.innerHTML=`<${t}>${e.trim()}</${t}>`,r=this.__highlight.querySelector(t),n.selectNode(r),this.__highlight.unwrap(n)}i.normalize()}this.__highlight.parentNode===document.body&&this.__highlight.wrap(n),this.__highlight.unwrap(n),n=n||this.__highlight.range||this.range,this.selectRange(n),"paste"!=e&&"wrapRange"!=e?(document.execCommand(e,!1,t),i.normalize()):navigator.clipboard&&"paste"==e&&this.pasteFromClipboard()}else"cancel"===e?(i&&i.revert(),r.close(i)):"close"===e?r.close(i):"viewSource"===e&&this.__source.toggle(r)}}};