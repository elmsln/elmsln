import{localStorageGet as e,localStorageSet as t}from"../../../utils/utils.js";import{observable as s,makeObservable as i,computed as a,configure as n}from"../../../../mobx/dist/mobx.esm.js";import{DeviceDetails as o}from"../../../replace-tag/lib/PerformanceDetect.js";n({enforceActions:!1});export const store=new class Store{constructor(){this.badDevice=null,this.evaluateBadDevice(),this.location=null,this.token=null,this.version="0.0.0",this.items=null,this.itemFiles=null,this.refreshSiteList=!0,this.createSiteSteps=!1,fetch(new URL("../../../haxcms-elements/package.json",import.meta.url)).then((e=>e.json())).then((e=>this.version=e.version)),this.appSettings=window.appSettings||{},this.appSettings.jwt&&t("jwt",this.appSettings.jwt),this.jwt=e("jwt",null),this.AppHaxAPI={},this.newSitePromiseList=[()=>import("../../../i18n-manager/lib/I18NMixin.js"),()=>import("../../../wc-autoload/wc-autoload.js"),()=>import("../../../replace-tag/replace-tag.js"),()=>import("../../../utils/utils.js"),()=>import("../../../grid-plate/grid-plate.js"),()=>import("../../../simple-fields/simple-fields.js"),()=>import("../../../../mobx/dist/mobx.esm.js"),()=>import("../../../h-a-x/h-a-x.js"),()=>import("../../../haxcms-elements/lib/core/haxcms-site-store.js"),()=>import("../../../haxcms-elements/lib/core/haxcms-site-router.js"),()=>import("../../../haxcms-elements/lib/core/haxcms-site-builder.js"),()=>import("../../../haxcms-elements/lib/core/HAXCMSLitElementTheme.js"),()=>import("../../../haxcms-elements/lib/core/haxcms-site-editor.js"),()=>import("../../../haxcms-elements/lib/core/haxcms-editor-builder.js"),()=>import("../../../haxcms-elements/lib/core/haxcms-site-editor-ui.js")],this.appEl=null,this.appReady=!1,this.soundStatus=e("app-hax-soundStatus",!0),this.appMode="search",this.activeSiteOp=null,this.activeSiteId=null,this.baseRoutes=[{path:"createSite-step-1",component:"fake",step:1,name:"step-1",label:"New Journey",statement:"What sort of journey is it?",title:"Step 1: Create"},{path:"createSite-step-2",component:"fake",step:2,name:"step-2",label:"Structure",statement:"How is the :structure organized?",title:"Step 2: Structure"},{path:"createSite-step-3",component:"fake",step:3,name:"step-3",label:"Theme select",statement:"What your :structure feels like?",title:"Step 3: Theme"},{path:"createSite-step-4",component:"fake",step:4,name:"step-4",label:"Name",statement:"What do you want to call your site?",title:"Step 4: Name"},{path:"createSite-step-5",component:"fake",step:5,name:"step-5",label:"Building..",statement:"Getting your :structure ready to launch",title:"Step 5: Building site"},{path:"home",component:"fake",name:"home",label:"Welcome back",statement:"Let's go on a HAX Journey",title:"Home"},{path:"index.html",component:"fake",name:"home",label:"Welcome back",statement:"Let's go on a HAX Journey",title:"Home"},{path:"index.php",component:"fake",name:"home",label:"Welcome back",statement:"Let's go on a HAX Journey",title:"Home"},{path:"search",component:"fake",name:"search",label:"Search",statement:"Discover active adventures",title:"Search sites"},{path:"/",component:"fake",name:"welcome",label:"Welcome",statement:"Let's build something awesome!",title:"Home"},{path:"/(.*)",component:"fake",name:"404",label:"404 :[",statement:"it's not you.. it's me",title:"FoUr Oh FoUr"}],this.routes=this.baseRoutes,this.siteReady=!1,this.manifest={},this.searchTerm="",this.user={name:""},this.site=e("app-hax-site")?e("app-hax-site"):{structure:null,type:null,theme:null,name:null},this.step=this.stepTest(null),this.darkMode=!!e("app-hax-darkMode")&&e("app-hax-darkMode"),i(this,{location:s.ref,routes:s,appSettings:s,appReady:s,appMode:s,createSiteSteps:s,step:s,site:s,newSitePromiseList:s,items:s,itemFiles:s,version:s,jwt:s,token:s,manifest:s,user:s,searchTerm:s,darkMode:s,soundStatus:s,activeItem:a,isNewUser:a,isLoggedIn:a,badDevice:s,activeSiteOp:s,activeSiteId:s,activeSite:a,siteReady:s,refreshSiteList:s})}setPageTitle(e){document.querySelector("title")&&(document.querySelector("title").innerText=`HAX: ${e}`)}refreshSiteListing(){this.refreshSiteList=!1,this.refreshSiteList=!0}get activeSite(){if(this.activeSiteId&&this.manifest&&this.manifest.items){const e=this.manifest.items.filter((e=>e.id===this.activeSiteId));return 1===e.length?e.pop():null}}async evaluateBadDevice(){this.badDevice=await o.badDevice(),!0===this.badDevice&&(this.soundStatus=!1)}stepTest(e){return null===this.site.structure&&1!==e?1:null!==this.site.structure&&null===this.site.type&&2!==e?2:null!==this.site.structure&&null!==this.site.type&&null===this.site.theme&&3!==e?3:null!==this.site.structure&&null!==this.site.type&&null!==this.site.theme&&null===this.site.name&&4!==e?4:null!==this.site.structure&&null!==this.site.type&&null!==this.site.theme&&null!==this.site.name?5:e}get isLoggedIn(){if(this.appReady&&this.AppHaxAPI)return"null"!==this.jwt&&this.jwt}get isNewUser(){if(this.manifest&&this.manifest.items)return 0===this.manifest.items.length}get activeItem(){if(this.routes.length>0&&this.location&&this.location.route){if(this.createSiteSteps){return this.routes.find((e=>void 0!==e.step&&e.step===this.step))}return this.location.route}}toast(e,t=3e3,s={}){window.dispatchEvent(new CustomEvent("haxcms-toast-show",{bubbles:!0,cancelable:!0,composed:!0,detail:{text:e,duration:t,...s}}))}};