Object.defineProperty(exports,"__esModule",{value:!0}),exports.SimpleFieldsFormLite=void 0;var e=require("lit");require("./simple-fields-lite.js"),require("../simple-fields.js");function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _templateObject2_b2e66ea0809211edaa2833647dc78c6c(){var e=_taggedTemplateLiteral(["\n        :host {\n          display: block;\n        }\n      "]);return _templateObject2_b2e66ea0809211edaa2833647dc78c6c=function _templateObject2_b2e66ea0809211edaa2833647dc78c6c(){return e},e}function _slicedToArray(e,t){return function _arrayWithHoles(e){if(Array.isArray(e))return e}(e)||function _iterableToArrayLimit(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var r=[],o=!0,n=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);o=!0);}catch(e){n=!0,a=e}finally{try{o||null==s.return||s.return()}finally{if(n)throw a}}return r}(e,t)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _templateObject_b2e66ea0809211edaa2833647dc78c6c(){var e=_taggedTemplateLiteral(['\n      <form part="form">\n        <slot name="before"></slot>\n        <simple-fields-lite\n          id="sf"\n          .autofocus="','"\n          .language="','"\n          .resources="','"\n          .schema="','"\n          .elementizer="','"\n          .value="','"\n          @value-changed="','"\n          part="fields"\n        >\n        </simple-fields-lite>\n        <slot name="after"></slot>\n        <slot></slot>\n      </form>\n    ']);return _templateObject_b2e66ea0809211edaa2833647dc78c6c=function _templateObject_b2e66ea0809211edaa2833647dc78c6c(){return e},e}function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}var t=function(t){function SimpleFieldsFormLite(){var e;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SimpleFieldsFormLite),(e=_possibleConstructorReturn(this,_getPrototypeOf(SimpleFieldsFormLite).call(this)))._setFieldProperties(),e._setFormProperties(),e}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}(SimpleFieldsFormLite,e.LitElement),_createClass(SimpleFieldsFormLite,[{key:"render",value:function render(){return(0,e.html)(_templateObject_b2e66ea0809211edaa2833647dc78c6c(),!this.disableAutofocus,this.language,this.resources,this.schema,this.elementizer,this.value,this._valueChanged)}},{key:"_valueChanged",value:function _valueChanged(e){this.value=e.detail.value}},{key:"setValue",value:function setValue(e){this.value=e}},{key:"firstUpdated",value:function firstUpdated(e){var t=this;e.forEach((function(e,r){"loadEndpoint"===r&&t.autoload&&t.loadData()}))}},{key:"updated",value:function updated(e){var t=this;e.forEach((function(e,r){!t.autoload||t.loadResponse||t.loading||"loadEndpoint"!==r&&"autoload"!==r||t.loadData(),"loadResponse"===r&&t.loadResponse.data&&(t._applyLoadedData(),t.dispatchEvent(new CustomEvent("response",{bubbles:!0,composed:!0,cancelable:!1,detail:t.loadResponse})))}))}},{key:"_applyLoadedData",value:function _applyLoadedData(){this.loadResponse.data.schema&&(this.schema=this.loadResponse.data.schema),this.loadResponse.data.value&&(this.value=this.loadResponse.data.value)}},{key:"loadData",value:function loadData(){var e=this;this.loading=!0,this.fetchData(this.loadEndpoint,this.method,this.headers,this.body).then((function(t){e.loading=!1,e.loadResponse=t,e.dispatchEvent(new CustomEvent("simple-fields-form-data-loaded",{detail:{value:t}}))}))}},{key:"fetchData",value:function fetchData(e,t,r,o){var n,a;return regeneratorRuntime.async((function fetchData$(i){for(;;)switch(i.prev=i.next){case 0:if(n={},"GET"!=t){i.next=8;break}return o&&(e+="?"+Object.entries(o).map((function(e){var t=_slicedToArray(e,2),r=t[0],o=t[1];return"".concat(encodeURIComponent(r),"=").concat(encodeURIComponent(o))})).join("&")),i.next=5,regeneratorRuntime.awrap(fetch(e,{method:t,headers:r}));case 5:n=i.sent,i.next=11;break;case 8:return i.next=10,regeneratorRuntime.awrap(fetch(e,{method:t,headers:r,body:JSON.stringify(o)}));case 10:n=i.sent;case 11:return i.next=13,regeneratorRuntime.awrap(n.json());case 13:return a=i.sent,i.abrupt("return",a);case 15:case"end":return i.stop()}}))}}],[{key:"styles",get:function get(){return[(0,e.css)(_templateObject2_b2e66ea0809211edaa2833647dc78c6c())]}},{key:"tag",get:function get(){return"simple-fields-form-lite"}}]),_createClass(SimpleFieldsFormLite,[{key:"_setFieldProperties",value:function _setFieldProperties(){this.disableAutofocus=!1,this.language="en",this.resources={},this.schema={},this.value={}}},{key:"_setFormProperties",value:function _setFormProperties(){this.method="POST",this.loading=!1,this.autoload=!1,this.headers={Accept:"application/json","Content-Type":"application/json"},this.body={}}},{key:"submit",value:function submit(){var e=this.shadowRoot.querySelector("#sf");return this.saveEndpoint&&fetch(this.saveEndpoint,{method:this.method,headers:this.headers,body:JSON.stringify(e.value)}),e.value}},{key:"formFields",get:function get(){return this.shadowRoot&&this.shadowRoot.querySelector&&this.shadowRoot.querySelector("#sf")?this.shadowRoot.querySelector("#sf"):void 0}},{key:"formElements",get:function get(){return this.formFields?this.formFields.formElements:{}}},{key:"formElementsArray",get:function get(){return this.formFields?this.formFields.formElementsArray:[]}}],[{key:"fieldProperties",get:function get(){return{disableAutofocus:{type:Boolean},error:{type:Object},language:{type:String,attribute:"lang",reflect:!0},resources:{type:Object},schema:{type:Object},schemaConversion:{type:Object,attribute:"schema-conversion"},value:{type:Object}}}},{key:"formProperties",get:function get(){return{autoload:{type:Boolean,reflect:!0},loading:{type:Boolean,reflect:!0},loadEndpoint:{type:String,attribute:"load-endpoint"},saveEndpoint:{type:String,attribute:"save-endpoint"},method:{type:String},headers:{type:Object},body:{type:Object},loadResponse:{type:Object}}}},{key:"properties",get:function get(){return function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(r,!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},this.fieldProperties,{},this.formProperties)}}]),SimpleFieldsFormLite}();exports.SimpleFieldsFormLite=t,window.customElements.define(t.tag,t);