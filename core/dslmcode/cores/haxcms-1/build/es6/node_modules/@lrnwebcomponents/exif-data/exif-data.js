/**
 * Copyright 2019 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{ESGlobalBridgeStore as t}from"../es-global-bridge/es-global-bridge.js";class ExifData extends HTMLElement{static get tag(){return"exif-data"}get html(){return'\n    <style>\n      ul.showdata {\n        z-index: 1;\n        visibility: visible;\n        opacity: .9;\n      }\n      ul {\n        position: absolute;\n        transition: 0.3s linear all;\n        background-color: #000000;\n        opacity: 0;\n        visibility: hidden;\n        overflow: scroll;\n        padding: 0;\n        margin: 0;\n      }\n      ul li {\n        padding: 8px;\n        font-size: 14px;\n        color: white;\n      }\n    </style>\n    <slot></slot>\n    <ul id="data"></ul>'}render(){this.shadowRoot.innerHTML=null,this.template.innerHTML=this.html,this.shadowRoot.appendChild(this.template.content.cloneNode(!0))}constructor(){super(),this.windowControllers=new AbortController,this.nodeData=[],window.WCGlobalBasePath?this.basePath=window.WCGlobalBasePath+"lib/exif-js.js":this.basePath=new URL("./lib/exif-js.js",import.meta.url).href,t.imports["exif-js"]?setTimeout((()=>{this.__ready=!0,this.updateExif()}),0):(t.load("exif-js",`${this.basePath}`),window.addEventListener("es-bridge-exif-js-loaded",this._onExifJsLoaded.bind(this),{signal:this.windowControllers.signal})),this.template=document.createElement("template"),this.attachShadow({mode:"open"}),this.render()}_onExifJsLoaded(){this.windowControllers.abort(),this.__ready=!0,this.updateExif()}showDetails(t){if(!t)return!1;let e=this.alignTarget;e||(e=t.node);const i=e.getBoundingClientRect();var a="";for(var s in t.data)""!=t.data[s]&&0!=t.data[s]&&" "!=t.data[s]&&0!=t.data[s]&&null!=t.data[s]&&(a+=`<li><strong>${s}</strong>: ${t.data[s]}</li>`);this.dataElement.innerHTML=a,this.alignTargetTop?this.dataElement.style.top=this.alignTargetTop:this.dataElement.style.top=i.top+"px",this.dataElement.style.height=i.height+"px",this.dataElement.style.width=i.width+"px",this.noLeft||(this.dataElement.style.left=i.left+"px"),this.dataElement.classList.add("showdata")}clickImage(t){"IMG"===t.target.tagName&&this.nodeData.forEach((e=>{e.node===t.target&&this.showDetails(e)}))}getExifData(t,e){window.EXIF&&window.EXIF.getData(t,(()=>{let i=window.EXIF.getAllTags(t);delete i.MakerNote,delete i.thumbnail,this.nodeData.push({node:t,data:i}),e&&1===this.children.length&&this.showDetails(this.nodeData[0])}))}updateExif(t=!1){for(var e of(this.nodeData=[],this.dataElement.innerHTML="",this.childNodes))this.__ready&&e.tagName&&"IMG"===e.tagName&&this.getExifData(e,t)}clickData(t){this.dataElement.classList.remove("showdata")}connectedCallback(){window.ShadyCSS&&window.ShadyCSS.styleElement(this),this.dataElement=this.shadowRoot.querySelector("#data"),null==this.getAttribute("no-events")&&(this.addEventListener("click",this.clickImage.bind(this)),this.dataElement.addEventListener("click",this.clickData.bind(this))),null==this.getAttribute("no-left")?this.noLeft=!1:this.noLeft=!0,this.observer=new MutationObserver((t=>{this.updateExif()})),this.observer.observe(this,{childList:!0})}disconnectedCallback(){null==this.getAttribute("no-events")&&(this.removeEventListener("click",this.clickImage.bind(this)),this.dataElement.removeEventListener("click",this.clickData.bind(this))),this.observer.disconnect()}}customElements.define(ExifData.tag,ExifData);export{ExifData};