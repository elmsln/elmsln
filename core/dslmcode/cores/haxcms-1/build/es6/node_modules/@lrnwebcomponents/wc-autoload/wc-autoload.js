/**
 * Copyright 2020 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import"../dynamic-import-registry/dynamic-import-registry.js";window.WCAutoload=window.WCAutoload||{},window.WCAutoload.requestAvailability=()=>(window.WCAutoload.instance||(window.WCAutoload.instance=document.createElement("wc-autoload"),document.body.appendChild(window.WCAutoload.instance)),window.WCAutoload.instance);window.WCAutoload.process=t=>{var e=window.WCAutoload.requestAvailability();e.loaded=!0;var o={};if(window.WCAutoloadRegistryFileProcessed){let t=document;e.target&&(t=e.target,e.processNewElement(t)),t.querySelectorAll("*").forEach(t=>{t.tagName&&!o[t.tagName]&&(e.processNewElement(t),o[t.tagName]=t.tagName)})}else setTimeout(async()=>{if(window.WCAutoloadBasePath&&(e.registry.basePath=window.WCAutoloadBasePath),window.WCAutoloadRegistryFile&&!window.WCAutoloadRegistryFileProcessed&&await(async(t,e,o)=>{for(let a=0;a<o;a++)try{return await fetch(t,e)}catch(t){if(a+1===o)throw t}})(window.WCAutoloadRegistryFile,{},3).then((function(t){return t.json()})).then((function(t){window.WCAutoloadRegistryFileProcessed=!0,window.WCAutoloadRegistry=t})),window.WCAutoloadRegistry)for(var t in window.WCAutoloadRegistry)e.registry.register({tag:t,path:window.WCAutoloadRegistry[t]});let a=document;e.target&&(a=e.target,e.processNewElement(a)),a.querySelectorAll("*").forEach(t=>{t.tagName&&!o[t.tagName]&&(e.processNewElement(t),o[t.tagName]=t.tagName)})},0)},window.addEventListener("load",window.WCAutoload.process),window.WCAutoload.postLoaded=t=>{setTimeout(()=>{let e=window.WCAutoload.requestAvailability();e.loaded&&document.querySelectorAll(t.detail.tag).length>0&&e.registry.loadDefinition(t.detail.tag)},0)},window.addEventListener("dynamic-import-registry--new-registration",window.WCAutoload.postLoaded);class WcRegistry extends HTMLElement{static get tag(){return"wc-registry"}constructor(){super(),this.loader=window.WCAutoload.requestAvailability()}connectedCallback(){setTimeout(()=>{if(this.children.length>0&&"TEMPLATE"==this.children[0].tagName)try{let e=JSON.parse(this.children[0].content.textContent);for(var t in e)this.loader.registry.register({tag:t,path:e[t]})}catch(t){console.warn(t)}},0)}}customElements.define(WcRegistry.tag,WcRegistry);class WcAutoload extends HTMLElement{static get tag(){return"wc-autoload"}constructor(){super(),this.loaded=!1,this.registry=window.DynamicImportRegistry.requestAvailability(),this.options={childList:!0,subtree:!0}}connectedCallback(){this._mutationObserver=new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{this.processNewElement(t)})})}),window.WCAutoloadOptions&&(this.options=window.WCAutoloadOptions),setTimeout(()=>{window.WCAutoloadTarget?this.target=window.WCAutoloadTarget:this.target=document.body,this._mutationObserver.observe(this.target,this.options)},0)}disconnectedCallback(){this._mutationObserver.disconnect()}processNewElement(t){t.tagName&&t.tagName.includes("-")&&"DYNAMIC-IMPORT-REGISTRY"!=t.tagName&&"WC-AUTOLOAD"!=t.tagName&&this.registry.loadDefinition(t.tagName)}}window.customElements.define(WcAutoload.tag,WcAutoload);export{WcAutoload};