import{LitElement as t,html as e,render as i}from"../../../lit/index.js";import{unsafeHTML as s}from"../../../lit/directives/unsafe-html.js";import"../../simple-toolbar/simple-toolbar.js";import"../../simple-icon/lib/simple-icon-button-lite.js";import"../../simple-tooltip/simple-tooltip.js";import"./simple-popover-manager.js";class SimpleTour extends t{constructor(){super(),this.stacks={},this.orientation="lr",this.active=null,this.tourInfo={},this.activeElementDelay=500,this.stop=-1,window.addEventListener("simple-tour-register",this.registerNewTourEvent.bind(this)),window.addEventListener("simple-tour-create-tour-stop",this.createTourStopEvent.bind(this))}registerNewTourEvent(t){this.registerNewTour(t.detail)}registerNewTour(t){return this.stacks[t.key]||(this.stacks[t.key]=[]),this.tourInfo[t.key]||(this.tourInfo[t.key]=t),this.stacks[t.key]}createTourStopEvent(t){this.createTourStop(t.detail.name,t.detail.target,t.detail.title,t.detail.description,t.detail.mode)}createTourStop(t,e,i,s,o){let r=new TourStop;return r.target=e,r.title=i,r.description=s,r.mode=o,this.addStops(t,[r]),r}removeTarget(t,e){let i=[];this.stacks[t].forEach(((t,s)=>{t.target===e&&i.push(s)})),i.forEach((e=>{this.stacks[t].splice(e,1)}))}addStops(t,e){this.stacks[t]||(this.stacks[t]=[]),this.stacks[t]=this.stacks[t].concat(e)}hasNext(){return this.stop<this.stacks[this.active].length-1}hasPrev(){return this.stop>0}nextStop(t){this.stop<this.stacks[this.active].length-1&&(this.stop+=1)}prevStop(t){this.stop>0&&(this.stop-=1)}startTour(t){this.active=t,this.dispatchEvent(new CustomEvent("tour-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:this}))}stopTour(t){window.SimplePopoverManager.requestAvailability().setPopover(this,this,!1,this.orientation),this.stop=-1,this.active=null,this.dispatchEvent(new CustomEvent("tour-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:this}))}tourButtons(){return e`<h1 class="title" slot="heading">
        ${this.tourInfo[this.active].name},
        <span class="xofy"
          >${this.stop+1}/${this.stacks[this.active].length}</span
        >
      </h1>
      <simple-icon-button-lite
        id="close"
        slot="heading"
        @click="${this.stopTour.bind(this)}"
        label="Stop Tour"
        icon="close"
      >
      </simple-icon-button-lite>
      <simple-icon-button-lite
        id="prev"
        slot="nav"
        @click="${this.prevStop.bind(this)}"
        ?disabled="${!this.hasPrev()}"
        label="Prev"
        icon="arrow-back"
        show-text-label
      >
      </simple-icon-button-lite>
      <simple-tooltip for="prev" position="top" slot="nav">
        Previous Item
      </simple-tooltip>
      <simple-icon-button-lite
        id="next"
        slot="nav"
        @click="${this.nextStop.bind(this)}"
        ?disabled="${!this.hasNext()}"
        label="Next"
        icon="arrow-forward"
        show-text-label
      >
      </simple-icon-button-lite>
      <simple-tooltip for="close" slot="body"> Stop Tour </simple-tooltip>
      <simple-tooltip for="next" position="top" slot="nav">
        Next Item
      </simple-tooltip>`}scrollHere(t){"function"==typeof t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded(!0):t.scrollIntoView({behavior:"smooth",inline:"center"})}managerReset(){this.stopTour()}updated(t){t.forEach(((t,o)=>{if("active"==o&&this.active&&(this.stop=0),"stop"==o&&-1!=this.stop||"active"==o&&this.active){i(document.createElement("div"),window.SimplePopoverManager.requestAvailability());let t=this.stacks[this.active][this.stop].title,o=this.stacks[this.active][this.stop].description;if("live"==this.stacks[this.active][this.stop].mode){let e=this.stacks[this.active][this.stop].target;e.getAttribute("data-stop-title")&&e.getAttribute(e.getAttribute("data-stop-title"))?t=e.getAttribute(e.getAttribute("data-stop-title")):e.querySelector("[data-stop-title]")&&(t=e.querySelector("[data-stop-title]").innerHTML),o=e.querySelector("[data-stop-content]").innerHTML?e.querySelector("[data-stop-content]").innerHTML:""}let r=e`${this.tourButtons()}
          <h2 class="subheading" slot="body">
            ${s("<span>"+t+"</span>")}
          </h2>
          ${s('<p slot="body">'+o+"</p>")}${this.tourInfo[this.active].style?s("<style>"+this.tourInfo[this.active].style+"</style>"):""}`;i(r,window.SimplePopoverManager.requestAvailability()),window.SimplePopoverManager.requestAvailability().setPopover(this,this.stacks[this.active][this.stop].target,!0,this.orientation,this.active),this.scrollHere(this.stacks[this.active][this.stop].target);let a=this.stacks[this.active][this.stop].target,l=this.stacks[this.active][this.stop].target.getAttribute("part");a.setAttribute("part","simple-tour-active"),setTimeout((()=>{null==l||"simple-tour-active"==l?a.removeAttribute("part"):a.setAttribute("part",l)}),this.activeElementDelay)}}))}static get properties(){return{stop:{type:Number},active:{type:String},stacks:{type:Object},activeElementDelay:{type:Number}}}}class TourStop{constructor(){this.target=null,this.title="Title",this.description="<p>Description</p>"}}customElements.define("simple-tour",SimpleTour);export{SimpleTour,TourStop};window.SimpleTourManager=window.SimpleTourManager||{},window.SimpleTourManager.requestAvailability=()=>(window.SimpleTourManager.instance||(window.SimpleTourManager.instance=document.createElement("simple-tour"),document.body.appendChild(window.SimpleTourManager.instance)),window.SimpleTourManager.instance);export const SimpleTourManager=window.SimpleTourManager.requestAvailability();