import{popup_styles_default as t}from"./chunk.NJGFDSYD.js";import{ShoelaceElement as e}from"./chunk.Z7XDKKOD.js";import{__decorateClass as i,__spreadProps as a,__spreadValues as o}from"./chunk.6M63UXML.js";import{arrow as r,autoUpdate as s,computePosition as p,flip as n,offset as h,platform as l,shift as c,size as d}from"../../../../@floating-ui/dom/dist/floating-ui.dom.esm.js";import{classMap as u}from"../../../../lit/directives/class-map.js";import{html as y}from"../../../../lit/index.js";import{offsetParent as f}from"../../../../composed-offset-position/dist/composed-offset-position.esm.js";import{property as m,query as g}from"../../../../lit/decorators.js";var b=class extends e{constructor(){super(...arguments),this.active=!1,this.placement="top",this.strategy="absolute",this.distance=0,this.skidding=0,this.arrow=!1,this.arrowPlacement="anchor",this.arrowPadding=10,this.flip=!1,this.flipFallbackPlacements="",this.flipFallbackStrategy="best-fit",this.flipPadding=0,this.shift=!1,this.shiftPadding=0,this.autoSizePadding=0}async connectedCallback(){super.connectedCallback(),await this.updateComplete,this.start()}disconnectedCallback(){this.stop()}async updated(t){super.updated(t),t.has("active")&&(this.active?this.start():this.stop()),t.has("anchor")&&this.handleAnchorChange(),this.active&&(await this.updateComplete,this.reposition())}async handleAnchorChange(){if(await this.stop(),this.anchor&&"string"==typeof this.anchor){const t=this.getRootNode();this.anchorEl=t.getElementById(this.anchor)}else this.anchor instanceof Element||function isVirtualElement(t){return null!==t&&"object"==typeof t&&"getBoundingClientRect"in t}(this.anchor)?this.anchorEl=this.anchor:this.anchorEl=this.querySelector('[slot="anchor"]');if(this.anchorEl instanceof HTMLSlotElement&&(this.anchorEl=this.anchorEl.assignedElements({flatten:!0})[0]),!this.anchorEl)throw new Error("Invalid anchor element: no anchor could be found using the anchor slot or the anchor attribute.");this.start()}start(){this.anchorEl&&(this.cleanup=s(this.anchorEl,this.popup,(()=>{this.reposition()})))}async stop(){return new Promise((t=>{this.cleanup?(this.cleanup(),this.cleanup=void 0,this.removeAttribute("data-current-placement"),this.style.removeProperty("--auto-size-available-width"),this.style.removeProperty("--auto-size-available-height"),requestAnimationFrame((()=>t()))):t()}))}reposition(){if(!this.active||!this.anchorEl)return;const t=[h({mainAxis:this.distance,crossAxis:this.skidding})];this.sync?t.push(d({apply:({rects:t})=>{const e="width"===this.sync||"both"===this.sync,i="height"===this.sync||"both"===this.sync;this.popup.style.width=e?`${t.reference.width}px`:"",this.popup.style.height=i?`${t.reference.height}px`:""}})):(this.popup.style.width="",this.popup.style.height=""),this.flip&&t.push(n({boundary:this.flipBoundary,fallbackPlacements:this.flipFallbackPlacements,fallbackStrategy:"best-fit"===this.flipFallbackStrategy?"bestFit":"initialPlacement",padding:this.flipPadding})),this.shift&&t.push(c({boundary:this.shiftBoundary,padding:this.shiftPadding})),this.autoSize?t.push(d({boundary:this.autoSizeBoundary,padding:this.autoSizePadding,apply:({availableWidth:t,availableHeight:e})=>{"vertical"===this.autoSize||"both"===this.autoSize?this.style.setProperty("--auto-size-available-height",`${e}px`):this.style.removeProperty("--auto-size-available-height"),"horizontal"===this.autoSize||"both"===this.autoSize?this.style.setProperty("--auto-size-available-width",`${t}px`):this.style.removeProperty("--auto-size-available-width")}})):(this.style.removeProperty("--auto-size-available-width"),this.style.removeProperty("--auto-size-available-height")),this.arrow&&t.push(r({element:this.arrowEl,padding:this.arrowPadding}));const e="absolute"===this.strategy?t=>l.getOffsetParent(t,f):l.getOffsetParent;p(this.anchorEl,this.popup,{placement:this.placement,middleware:t,strategy:this.strategy,platform:a(o({},l),{getOffsetParent:e})}).then((({x:t,y:e,middlewareData:i,placement:a})=>{const o="rtl"===getComputedStyle(this).direction,r={top:"bottom",right:"left",bottom:"top",left:"right"}[a.split("-")[0]];if(this.setAttribute("data-current-placement",a),Object.assign(this.popup.style,{left:`${t}px`,top:`${e}px`}),this.arrow){const t=i.arrow.x,e=i.arrow.y;let a="",s="",p="",n="";if("start"===this.arrowPlacement){const i="number"==typeof t?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:"";a="number"==typeof e?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:"",s=o?i:"",n=o?"":i}else if("end"===this.arrowPlacement){const i="number"==typeof t?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:"";s=o?"":i,n=o?i:"",p="number"==typeof e?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:""}else"center"===this.arrowPlacement?(n="number"==typeof t?"calc(50% - var(--arrow-size-diagonal))":"",a="number"==typeof e?"calc(50% - var(--arrow-size-diagonal))":""):(n="number"==typeof t?`${t}px`:"",a="number"==typeof e?`${e}px`:"");Object.assign(this.arrowEl.style,{top:a,right:s,bottom:p,left:n,[r]:"calc(var(--arrow-size-diagonal) * -1)"})}})),this.emit("sl-reposition")}render(){return y`
      <slot name="anchor" @slotchange=${this.handleAnchorChange}></slot>

      <div
        part="popup"
        class=${u({popup:!0,"popup--active":this.active,"popup--fixed":"fixed"===this.strategy,"popup--has-arrow":this.arrow})}
      >
        <slot></slot>
        ${this.arrow?y`<div part="arrow" class="popup__arrow" role="presentation"></div>`:""}
      </div>
    `}};b.styles=t,i([g(".popup")],b.prototype,"popup",2),i([g(".popup__arrow")],b.prototype,"arrowEl",2),i([m()],b.prototype,"anchor",2),i([m({type:Boolean,reflect:!0})],b.prototype,"active",2),i([m({reflect:!0})],b.prototype,"placement",2),i([m({reflect:!0})],b.prototype,"strategy",2),i([m({type:Number})],b.prototype,"distance",2),i([m({type:Number})],b.prototype,"skidding",2),i([m({type:Boolean})],b.prototype,"arrow",2),i([m({attribute:"arrow-placement"})],b.prototype,"arrowPlacement",2),i([m({attribute:"arrow-padding",type:Number})],b.prototype,"arrowPadding",2),i([m({type:Boolean})],b.prototype,"flip",2),i([m({attribute:"flip-fallback-placements",converter:{fromAttribute:t=>t.split(" ").map((t=>t.trim())).filter((t=>""!==t)),toAttribute:t=>t.join(" ")}})],b.prototype,"flipFallbackPlacements",2),i([m({attribute:"flip-fallback-strategy"})],b.prototype,"flipFallbackStrategy",2),i([m({type:Object})],b.prototype,"flipBoundary",2),i([m({attribute:"flip-padding",type:Number})],b.prototype,"flipPadding",2),i([m({type:Boolean})],b.prototype,"shift",2),i([m({type:Object})],b.prototype,"shiftBoundary",2),i([m({attribute:"shift-padding",type:Number})],b.prototype,"shiftPadding",2),i([m({attribute:"auto-size"})],b.prototype,"autoSize",2),i([m()],b.prototype,"sync",2),i([m({type:Object})],b.prototype,"autoSizeBoundary",2),i([m({attribute:"auto-size-padding",type:Number})],b.prototype,"autoSizePadding",2);export{b as SlPopup};