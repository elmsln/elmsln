/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
import"../../../../@webcomponents/shadycss/entrypoints/apply-shim.js";import{ElementMixin as e,builtCSS as t}from"../mixins/element-mixin.js";import{GestureEventListeners as s}from"../mixins/gesture-event-listeners.js";import{DirMixin as r}from"../mixins/dir-mixin.js";import{dedupingMixin as i}from"../utils/mixin.js";import"../utils/render-status.js";import"../utils/unresolved.js";import{dom as n,matchesSelector as o}from"./polymer.dom.js";import{setTouchAction as l}from"../utils/gestures.js";import{Debouncer as a}from"../utils/debounce.js";import{timeOut as u,microTask as d}from"../utils/async.js";import{get as h}from"../utils/path.js";import{wrap as c}from"../utils/wrap.js";import{scopeSubtree as b}from"../utils/scope-subtree.js";import{legacyOptimizations as _,legacyNoObservedAttributes as p}from"../utils/settings.js";import{findObservedAttributesGetter as m}from"../mixins/disable-upgrade-mixin.js";import{register as g}from"../utils/telemetry.js";const y="disable-upgrade";let f=window.ShadyCSS;export const LegacyElementMixin=i((i=>{const A=s(e(i)),C=t?A:r(A),v=m(C),E={x:"pan-x",y:"pan-y",none:"none",all:"auto"};class LegacyElement extends C{constructor(){super(),this.isAttached,this.__boundListeners,this._debouncers,this.__isUpgradeDisabled,this.__needsAttributesAtConnected,this._legacyForceObservedAttributes}static get importMeta(){return this.prototype.importMeta}created(){}__attributeReaction(e,t,s){(this.__dataAttributes&&this.__dataAttributes[e]||e===y)&&this.attributeChangedCallback(e,t,s,null)}setAttribute(e,t){if(p&&!this._legacyForceObservedAttributes){const s=this.getAttribute(e);super.setAttribute(e,t),this.__attributeReaction(e,s,String(t))}else super.setAttribute(e,t)}removeAttribute(e){if(p&&!this._legacyForceObservedAttributes){const t=this.getAttribute(e);super.removeAttribute(e),this.__attributeReaction(e,t,null)}else super.removeAttribute(e)}static get observedAttributes(){return p&&!this.prototype._legacyForceObservedAttributes?(this.hasOwnProperty(JSCompiler_renameProperty("__observedAttributes",this))||(this.__observedAttributes=[],g(this.prototype)),this.__observedAttributes):v.call(this).concat(y)}_enableProperties(){this.__isUpgradeDisabled||super._enableProperties()}_canApplyPropertyDefault(e){return super._canApplyPropertyDefault(e)&&!(this.__isUpgradeDisabled&&this._isPropertyPending(e))}connectedCallback(){this.__needsAttributesAtConnected&&this._takeAttributes(),this.__isUpgradeDisabled||(super.connectedCallback(),this.isAttached=!0,this.attached())}attached(){}disconnectedCallback(){this.__isUpgradeDisabled||(super.disconnectedCallback(),this.isAttached=!1,this.detached())}detached(){}attributeChangedCallback(e,t,s,r){t!==s&&(e==y?this.__isUpgradeDisabled&&null==s&&(this._initializeProperties(),this.__isUpgradeDisabled=!1,c(this).isConnected&&this.connectedCallback()):(super.attributeChangedCallback(e,t,s,r),this.attributeChanged(e,t,s)))}attributeChanged(e,t,s){}_initializeProperties(){if(_&&this.hasAttribute(y))this.__isUpgradeDisabled=!0;else{let e=Object.getPrototypeOf(this);e.hasOwnProperty(JSCompiler_renameProperty("__hasRegisterFinished",e))||(this._registered(),e.__hasRegisterFinished=!0),super._initializeProperties(),this.root=this,this.created(),p&&!this._legacyForceObservedAttributes&&(this.hasAttributes()?this._takeAttributes():this.parentNode||(this.__needsAttributesAtConnected=!0)),this._applyListeners()}}_takeAttributes(){const e=this.attributes;for(let t=0,s=e.length;t<s;t++){const s=e[t];this.__attributeReaction(s.name,null,s.value)}}_registered(){}ready(){this._ensureAttributes(),super.ready()}_ensureAttributes(){}_applyListeners(){}serialize(e){return this._serializeValue(e)}deserialize(e,t){return this._deserializeValue(e,t)}reflectPropertyToAttribute(e,t,s){this._propertyToAttribute(e,t,s)}serializeValueToAttribute(e,t,s){this._valueToNodeAttribute(s||this,e,t)}extend(e,t){if(!e||!t)return e||t;let s=Object.getOwnPropertyNames(t);for(let r,i=0;i<s.length&&(r=s[i]);i++){let s=Object.getOwnPropertyDescriptor(t,r);s&&Object.defineProperty(e,r,s)}return e}mixin(e,t){for(let s in t)e[s]=t[s];return e}chainObject(e,t){return e&&t&&e!==t&&(e.__proto__=t),e}instanceTemplate(e){let t=this.constructor._contentForTemplate(e);return document.importNode(t,!0)}fire(e,t,s){s=s||{},t=null==t?{}:t;let r=new Event(e,{bubbles:void 0===s.bubbles||s.bubbles,cancelable:Boolean(s.cancelable),composed:void 0===s.composed||s.composed});r.detail=t;let i=s.node||this;return c(i).dispatchEvent(r),r}listen(e,t,s){e=e||this;let r=this.__boundListeners||(this.__boundListeners=new WeakMap),i=r.get(e);i||(i={},r.set(e,i));let n=t+s;i[n]||(i[n]=this._addMethodEventListenerToNode(e,t,s,this))}unlisten(e,t,s){e=e||this;let r=this.__boundListeners&&this.__boundListeners.get(e),i=t+s,n=r&&r[i];n&&(this._removeEventListenerFromNode(e,t,n),r[i]=null)}setScrollDirection(e,t){l(t||this,E[e]||"auto")}$$(e){return this.root.querySelector(e)}get domHost(){let e=c(this).getRootNode();return e instanceof DocumentFragment?e.host:e}distributeContent(){const e=n(this);window.ShadyDOM&&e.shadowRoot&&ShadyDOM.flush()}getEffectiveChildNodes(){return n(this).getEffectiveChildNodes()}queryDistributedElements(e){return n(this).queryDistributedElements(e)}getEffectiveChildren(){return this.getEffectiveChildNodes().filter((function(e){return e.nodeType===Node.ELEMENT_NODE}))}getEffectiveTextContent(){let e=this.getEffectiveChildNodes(),t=[];for(let s,r=0;s=e[r];r++)s.nodeType!==Node.COMMENT_NODE&&t.push(s.textContent);return t.join("")}queryEffectiveChildren(e){let t=this.queryDistributedElements(e);return t&&t[0]}queryAllEffectiveChildren(e){return this.queryDistributedElements(e)}getContentChildNodes(e){let t=this.root.querySelector(e||"slot");return t?n(t).getDistributedNodes():[]}getContentChildren(e){return this.getContentChildNodes(e).filter((function(e){return e.nodeType===Node.ELEMENT_NODE}))}isLightDescendant(e){const t=this;return t!==e&&c(t).contains(e)&&c(t).getRootNode()===c(e).getRootNode()}isLocalDescendant(e){return this.root===c(e).getRootNode()}scopeSubtree(e,t=!1){return b(e,t)}getComputedStyleValue(e){return f.getComputedStyleValue(this,e)}debounce(e,t,s){return this._debouncers=this._debouncers||{},this._debouncers[e]=a.debounce(this._debouncers[e],s>0?u.after(s):d,t.bind(this))}isDebouncerActive(e){this._debouncers=this._debouncers||{};let t=this._debouncers[e];return!(!t||!t.isActive())}flushDebouncer(e){this._debouncers=this._debouncers||{};let t=this._debouncers[e];t&&t.flush()}cancelDebouncer(e){this._debouncers=this._debouncers||{};let t=this._debouncers[e];t&&t.cancel()}async(e,t){return t>0?u.run(e.bind(this),t):~d.run(e.bind(this))}cancelAsync(e){e<0?d.cancel(~e):u.cancel(e)}create(e,t){let s=document.createElement(e);if(t)if(s.setProperties)s.setProperties(t);else for(let e in t)s[e]=t[e];return s}elementMatches(e,t){return o(t||this,e)}toggleAttribute(e,t){let s=this;return 3===arguments.length&&(s=arguments[2]),1==arguments.length&&(t=!s.hasAttribute(e)),t?(c(s).setAttribute(e,""),!0):(c(s).removeAttribute(e),!1)}toggleClass(e,t,s){s=s||this,1==arguments.length&&(t=!s.classList.contains(e)),t?s.classList.add(e):s.classList.remove(e)}transform(e,t){(t=t||this).style.webkitTransform=e,t.style.transform=e}translate3d(e,t,s,r){r=r||this,this.transform("translate3d("+e+","+t+","+s+")",r)}arrayDelete(e,t){let s;if(Array.isArray(e)){if(s=e.indexOf(t),s>=0)return e.splice(s,1)}else{if(s=h(this,e).indexOf(t),s>=0)return this.splice(e,s,1)}return null}_logger(e,t){switch(Array.isArray(t)&&1===t.length&&Array.isArray(t[0])&&(t=t[0]),e){case"log":case"warn":case"error":console[e](...t)}}_log(...e){this._logger("log",e)}_warn(...e){this._logger("warn",e)}_error(...e){this._logger("error",e)}_logf(e,...t){return["[%s::%s]",this.is,e,...t]}}return LegacyElement.prototype.is="",LegacyElement}));